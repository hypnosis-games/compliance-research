/*
  Combined project source export
  Root: C:/Users/wmacf/OneDrive/Documents/GitHub/compliance-research
  Generated: 2025-12-13T16:24:24.818Z
*/


/* =====================================================================================
   FILE: app/audio/binaural-beat.js
   ===================================================================================== */

    1 | /*
    2 | /app/audio/binaural-beat.js
    3 | Generates configurable binaural beat audio for induction sequences using Tone.js.
    4 | */
    5 | const DEFAULT_LEFT_FREQUENCY = 220;
    6 | const DEFAULT_RIGHT_FREQUENCY = 230;
    7 | const DEFAULT_GAIN = 0.08;
    8 | 
    9 | let leftOscillator = null;
   10 | let rightOscillator = null;
   11 | let stereoMerger = null;
   12 | let masterGain = null;
   13 | let toneReadyPromise = null;
   14 | 
   15 | function getAudioContext(ToneJS) {
   16 |   if (!ToneJS) return null;
   17 | 
   18 |   const context = ToneJS.context || (typeof ToneJS.getContext === "function" ? ToneJS.getContext() : null);
   19 |   if (!context) return null;
   20 | 
   21 |   if (context.rawContext) return context.rawContext;
   22 |   if (context.context) return context.context;
   23 |   return context;
   24 | }
   25 | 
   26 | function getTone() {
   27 |   if (typeof Tone !== "undefined") return Tone;
   28 |   if (typeof window !== "undefined" && window.Tone) return window.Tone;
   29 |   return null;
   30 | }
   31 | 
   32 | function teardownNodes() {
   33 |   [leftOscillator, rightOscillator].forEach((osc) => {
   34 |     if (osc) {
   35 |       osc.stop();
   36 |       osc.disconnect();
   37 |       if (typeof osc.dispose === "function") {
   38 |         osc.dispose();
   39 |       }
   40 |     }
   41 |   });
   42 | 
   43 |   [stereoMerger, masterGain].forEach((node) => {
   44 |     if (node && typeof node.dispose === "function") {
   45 |       node.dispose();
   46 |     }
   47 |   });
   48 | 
   49 |   leftOscillator = null;
   50 |   rightOscillator = null;
   51 |   stereoMerger = null;
   52 |   masterGain = null;
   53 | }
   54 | 
   55 | export function stopBinauralBeat() {
   56 |   teardownNodes();
   57 | }
   58 | 
   59 | export async function warmBinauralBeatContext() {
   60 |   const ToneJS = getTone();
   61 |   if (!ToneJS) return false;
   62 | 
   63 |   return ensureToneReady(ToneJS);
   64 | }
   65 | 
   66 | async function ensureToneReady(ToneJS) {
   67 |   if (!ToneJS) return false;
   68 | 
   69 |   if (toneReadyPromise) return toneReadyPromise;
   70 | 
   71 |   toneReadyPromise = (async () => {
   72 |     // iOS Safari requires AudioContext resume from a user gesture. Tone.start()
   73 |     // and context.resume() return promises, so await both to ensure the
   74 |     // context is ready before creating any nodes.
   75 |     if (typeof ToneJS.start === "function") {
   76 |       await ToneJS.start();
   77 |     }
   78 | 
   79 |     const audioContext = getAudioContext(ToneJS);
   80 |     if (audioContext?.state === "suspended" && audioContext.resume) {
   81 |       await audioContext.resume();
   82 |     }
   83 | 
   84 |     return true;
   85 |   })();
   86 | 
   87 |   try {
   88 |     await toneReadyPromise;
   89 |     return true;
   90 |   } catch (err) {
   91 |     console.warn("Tone.js could not start audio context", err);
   92 |     toneReadyPromise = null;
   93 |     return false;
   94 |   }
   95 | }
   96 | 
   97 | export async function startBinauralBeat({
   98 |   leftFrequency = DEFAULT_LEFT_FREQUENCY,
   99 |   rightFrequency = DEFAULT_RIGHT_FREQUENCY,
  100 |   gain = DEFAULT_GAIN,
  101 | } = {}) {
  102 |   const ToneJS = getTone();
  103 |   if (!ToneJS) {
  104 |     console.warn("Tone.js not available; cannot start binaural beat.");
  105 |     return false;
  106 |   }
  107 | 
  108 |   const toneReady = await ensureToneReady(ToneJS);
  109 |   if (!toneReady) return false;
  110 | 
  111 |   teardownNodes();
  112 | 
  113 |   masterGain = new ToneJS.Gain(gain).toDestination();
  114 |   stereoMerger = new ToneJS.Merge().connect(masterGain);
  115 | 
  116 |   leftOscillator = new ToneJS.Oscillator(leftFrequency, "sine")
  117 |     .connect(stereoMerger, 0, 0)
  118 |     .start();
  119 |   rightOscillator = new ToneJS.Oscillator(rightFrequency, "sine")
  120 |     .connect(stereoMerger, 0, 1)
  121 |     .start();
  122 | 
  123 |   return true;
  124 | }
  125 | 
  126 | export function updateBinauralBeat({ leftFrequency, rightFrequency } = {}) {
  127 |   const ToneJS = getTone();
  128 |   if (!ToneJS || !leftOscillator || !rightOscillator) return;
  129 | 
  130 |   const rampTime = 0.2;
  131 | 
  132 |   if (typeof leftFrequency === "number") {
  133 |     leftOscillator.frequency.rampTo(leftFrequency, rampTime);
  134 |   }
  135 | 
  136 |   if (typeof rightFrequency === "number") {
  137 |     rightOscillator.frequency.rampTo(rightFrequency, rampTime);
  138 |   }
  139 | }
  140 | 
  141 | export {
  142 |   DEFAULT_LEFT_FREQUENCY,
  143 |   DEFAULT_RIGHT_FREQUENCY,
  144 |   DEFAULT_GAIN,
  145 | };
  146 | 

/* =====================================================================================
   FILE: app/data/compliance-questions.js
   ===================================================================================== */

    1 | /*
    2 | /app/data/compliance-questions.js
    3 | Provides the compliance question set used throughout the induction arcade assessments.
    4 | */
    5 | // data/compliance-questions.js
    6 | export const complianceInstructions = [
    7 |   "Please read each item aloud slowly and carefully before answering.",
    8 | ];
    9 | 
   10 | export const complianceLikertOptions = [1, 2, 3, 4, 5];
   11 | 
   12 | export const complianceLikertLabels = {
   13 |   1: "1 - Strongly disagree",
   14 |   2: "2 - Disagree",
   15 |   3: "3 - Neither agree nor disagree",
   16 |   4: "4 - Agree",
   17 |   5: "5 - Strongly agree",
   18 | };
   19 | 
   20 | export const complianceQuestions = [
   21 |   { id: "q1", text: "I like being told what to do." },
   22 |   { id: "q2", text: "Doing what I’m told feels good." },
   23 |   { id: "q3", text: "I want to do things right." },
   24 |   { id: "q4", text: "I like being guided." },
   25 |   { id: "q5", text: "Being correct feels good." },
   26 |   { id: "q6", text: "I want to be good." },
   27 |   { id: "q7", text: "I like knowing I’m doing things correctly." },
   28 |   { id: "q8", text: "I feel good when I follow directions." },
   29 |   { id: "q9", text: "I like clear instructions." },
   30 |   { id: "q10", text: "I try hard to please others." },
   31 |   { id: "q11", text: "I enjoy being directed." },
   32 |   { id: "q12", text: "I want to meet expectations." },
   33 |   { id: "q13", text: "I like being praised for doing well." },
   34 |   { id: "q14", text: "I feel relaxed when I’m told what to do." },
   35 |   { id: "q15", text: "I like having someone lead me." },
   36 |   { id: "q16", text: "I want to please others" },
   37 |   { id: "q17", text: "I feel good when I obey rules." },
   38 |   { id: "q18", text: "I like knowing someone is guiding me." },
   39 |   { id: "q19", text: "I want to do what is asked of me." },
   40 |   { id: "q20", text: "Being good feels right." },
   41 | ];
   42 | 

/* =====================================================================================
   FILE: app/data/induction-arcade-constants.js
   ===================================================================================== */

    1 | /*
    2 | /app/data/induction-arcade-constants.js
    3 | Defines constants and configuration values shared across induction arcade components.
    4 | */
    5 | export const PHASES = Object.freeze({
    6 |   HEADPHONES: "headphones",
    7 |   INTRO: "intro",
    8 |   INSTRUCTIONS: "instructions",
    9 |   GAME: "game",
   10 |   SURVEY: "survey",
   11 |   INTERJECTION: "interjection",
   12 |   COMPLETE: "complete",
   13 | });
   14 | 
   15 | export const GAME_IDS = Object.freeze({
   16 |   TAP_WHEN_WHITE: "tapWhenWhite",
   17 |   FOLLOW_THE_FADE: "followTheFade",
   18 | });
   19 | 
   20 | export const BASE_SPIRAL_INTENSITY = 0.01;
   21 | export const DEPTH_INCREMENT_PER_SUCCESS = 1;
   22 | export const MAX_DEPTH_LEVEL = 3;
   23 | export const SPIRAL_SCALE_PER_DEPTH = 0.2;
   24 | export const BEAT_INTENSITY_BASE = 0.3;
   25 | export const BEAT_INTENSITY_SCALE = 0.2;
   26 | 
   27 | export const TIMING = Object.freeze({
   28 |   AFFIRMATION_CLEAR_MS: 900,
   29 |   SURVEY_FADE_MS: 500,
   30 |   SURVEY_ADVANCE_MS: 900,
   31 | });
   32 | 
   33 | export const DEFAULT_ENV = Object.freeze({
   34 |   depthLevel: 0,
   35 |   spiralIntensity: BASE_SPIRAL_INTENSITY,
   36 |   beatIntensity: BEAT_INTENSITY_BASE,
   37 | });
   38 | 
   39 | export const DEFAULT_STARTING_GAME = GAME_IDS.TAP_WHEN_WHITE;
   40 | 

/* =====================================================================================
   FILE: app/directors/content-director.js
   ===================================================================================== */

    1 | /*
    2 | /app/directors/content-director.js
    3 | Orchestrates content transitions and messaging between different app states.
    4 | */
    5 | const MAX_DEPTH = 3;
    6 | 
    7 | const affirmationBanks = {
    8 |   success: {
    9 |     0: [
   10 |       "Good work.",
   11 |       "You did that cleanly.",
   12 |       "Nice focus.",
   13 |       "That landed well.",
   14 |     ],
   15 |     1: [
   16 |       "Very good focus.",
   17 |       "You followed that perfectly.",
   18 |       "Nice and steady.",
   19 |       "You are syncing up well.",
   20 |     ],
   21 |     2: [
   22 |       "You followed right on cue.",
   23 |       "Obeying feels smooth, does it not?",
   24 |       "Keep sinking into the rhythm.",
   25 |       "You are wonderfully compliant.",
   26 |     ],
   27 |     3: [
   28 |       "You obey so naturally now.",
   29 |       "Perfect. Just like I want you.",
   30 |       "Good subject. Keep yielding.",
   31 |       "You love doing exactly as told.",
   32 |     ],
   33 |   },
   34 |   neutral: {
   35 |     0: [
   36 |       "Keep going.",
   37 |       "Stay with it.",
   38 |       "Next one coming.",
   39 |       "Hold your focus.",
   40 |     ],
   41 |     1: [
   42 |       "Stay guided.",
   43 |       "Follow the prompt.",
   44 |       "Stay receptive.",
   45 |       "Keep following along.",
   46 |     ],
   47 |     2: [
   48 |       "Sink into the direction.",
   49 |       "Let the guidance carry you.",
   50 |       "Keep yielding to the cues.",
   51 |       "Easier to follow than think.",
   52 |     ],
   53 |     3: [
   54 |       "Just do as you are told.",
   55 |       "Obedience is effortless now.",
   56 |       "You love following every word.",
   57 |       "Yield and please me.",
   58 |     ],
   59 |   },
   60 | };
   61 | 
   62 | const surveyStatementsByDepth = {
   63 |   0: [
   64 |     "I follow directions easily.",
   65 |     "Being focused feels good.",
   66 |     "I like being guided.",
   67 |     "I want to do this right.",
   68 |     "Doing well matters to me.",
   69 |     "I keep my attention steady.",
   70 |   ],
   71 |   1: [
   72 |     "I enjoy being directed.",
   73 |     "I relax when I am led.",
   74 |     "I like hearing what to do.",
   75 |     "I want to be praised for obeying.",
   76 |     "I feel safe following orders.",
   77 |     "I give in to clear instructions.",
   78 |   ],
   79 |   2: [
   80 |     "I sink deeper when told to.",
   81 |     "Obeying feels natural now.",
   82 |     "I crave more precise commands.",
   83 |     "Being compliant feels soothing.",
   84 |     "I love being reminded to yield.",
   85 |     "I focus best when controlled.",
   86 |   ],
   87 |   3: [
   88 |     "Obedience is the only thing I want.",
   89 |     "I feel proud when I submit instantly.",
   90 |     "I ache to be told what to do next.",
   91 |     "I love proving my obedience.",
   92 |     "I belong in instructed obedience.",
   93 |     "I am happiest when I obey.",
   94 |   ],
   95 | };
   96 | 
   97 | const interjectionStepsByType = {
   98 |   focus: {
   99 |     0: [
  100 |       "Take a slow breath.",
  101 |       "Notice the center of the screen.",
  102 |       "Let curiosity hold your gaze.",
  103 |     ],
  104 |     1: [
  105 |       "Breathe in and let the instruction settle.",
  106 |       "Feel your attention narrow to the task.",
  107 |       "Stay ready to follow the very next cue.",
  108 |     ],
  109 |     2: [
  110 |       "Exhale and let thinking fade.",
  111 |       "Fixate on the direction you are given.",
  112 |       "Let obedience feel automatic and easy.",
  113 |     ],
  114 |     3: [
  115 |       "Release every stray thought.",
  116 |       "Lock onto the command in front of you.",
  117 |       "Enjoy how your mind awaits the next order.",
  118 |     ],
  119 |   },
  120 |   relaxation: {
  121 |     0: [
  122 |       "Loosen your shoulders.",
  123 |       "Let your breath slow down.",
  124 |       "Stay here and soft.",
  125 |     ],
  126 |     1: [
  127 |       "Feel weightless for a moment.",
  128 |       "Let guidance carry you gently.",
  129 |       "Sink into the calm of being led.",
  130 |     ],
  131 |     2: [
  132 |       "Melt a little deeper now.",
  133 |       "Let obedience lull you further down.",
  134 |       "Rest in the pleasure of surrender.",
  135 |     ],
  136 |     3: [
  137 |       "Drop all tension and wait to be used.",
  138 |       "Float in obedient quiet for me.",
  139 |       "Enjoy being pliant and ready.",
  140 |     ],
  141 |   },
  142 | };
  143 | 
  144 | function normalizeDepth(rawDepth = 0) {
  145 |   const numericDepth = Number.isFinite(rawDepth) ? rawDepth : 0;
  146 |   return Math.max(0, Math.min(MAX_DEPTH, Math.round(numericDepth)));
  147 | }
  148 | 
  149 | function pickRandom(items = []) {
  150 |   if (!items.length) return "";
  151 |   const index = Math.floor(Math.random() * items.length);
  152 |   return items[index];
  153 | }
  154 | 
  155 | function getAffirmation({ depth = 0, outcome = "neutral" } = {}) {
  156 |   const normalizedDepth = normalizeDepth(depth);
  157 |   const outcomeKey = outcome === "success" ? "success" : "neutral";
  158 |   const bank = affirmationBanks[outcomeKey][normalizedDepth]
  159 |     ? affirmationBanks[outcomeKey][normalizedDepth]
  160 |     : affirmationBanks[outcomeKey][0];
  161 |   return pickRandom(bank);
  162 | }
  163 | 
  164 | function selectSurveyStatements(depth, count) {
  165 |   const normalizedDepth = normalizeDepth(depth);
  166 |   const availableStatements = Object.keys(surveyStatementsByDepth)
  167 |     .map(Number)
  168 |     .filter((level) => level <= normalizedDepth)
  169 |     .sort((a, b) => a - b)
  170 |     .reduce((accumulated, level) => {
  171 |       return [...accumulated, ...(surveyStatementsByDepth[level] || [])];
  172 |     }, []);
  173 | 
  174 |   const uniqueStatements = Array.from(new Set(availableStatements));
  175 |   const selections = [];
  176 |   const mutablePool = [...uniqueStatements];
  177 |   const targetCount = Math.min(count, mutablePool.length);
  178 | 
  179 |   while (selections.length < targetCount && mutablePool.length) {
  180 |     const index = Math.floor(Math.random() * mutablePool.length);
  181 |     const [text] = mutablePool.splice(index, 1);
  182 |     selections.push(text);
  183 |   }
  184 | 
  185 |   return selections;
  186 | }
  187 | 
  188 | function getSurvey({ depth = 0, count = 5 } = {}) {
  189 |   const statements = selectSurveyStatements(depth, count);
  190 |   return statements.map((text, index) => ({
  191 |     id: `survey-${index}-${Math.floor(Math.random() * 100000)}`,
  192 |     text,
  193 |   }));
  194 | }
  195 | 
  196 | function getInterjection({ depth = 0, type = "focus" } = {}) {
  197 |   const normalizedDepth = normalizeDepth(depth);
  198 |   const typeKey = type === "relaxation" ? "relaxation" : "focus";
  199 |   const depthBanks = interjectionStepsByType[typeKey];
  200 |   if (!depthBanks) return [];
  201 |   const steps = depthBanks[normalizedDepth] || depthBanks[0] || [];
  202 |   return [...steps];
  203 | }
  204 | 
  205 | export const ContentDirector = Object.freeze({
  206 |   getAffirmation,
  207 |   getSurvey,
  208 |   getInterjection,
  209 |   normalizeDepth,
  210 | });
  211 | 
  212 | export default ContentDirector;
  213 | 

/* =====================================================================================
   FILE: app/index.js
   ===================================================================================== */

    1 | /*
    2 | /app/index.js
    3 | Bootstraps the client-side application by registering stores, views, and routes.
    4 | */
    5 | // index.js
    6 | import MainView from "./views/main-view.js";
    7 | import store from "./store/store.js";
    8 | import { initArcadeGame } from "./phaser/induction-arcade-game.js";
    9 | 
   10 | const choo = Choo({ hash: true });
   11 | 
   12 | choo.use(store);
   13 | 
   14 | choo.route("/", MainView);
   15 | choo.route("/:module", MainView);
   16 | 
   17 | choo.route("/compliance-research", MainView);
   18 | choo.route("/compliance-research/:module", MainView);
   19 | choo.mount("#app");
   20 | initArcadeGame({
   21 |   onGameEvent: (evt) => {
   22 |     // forward events into Choo
   23 |     // you can refine this later
   24 |     choo.emitter.emit("inductionArcade/gameEvent", evt);
   25 |   },
   26 | });
   27 | 
   28 | window.choo = choo;
   29 | 

/* =====================================================================================
   FILE: app/lib/choo.js
   ===================================================================================== */

    1 | /*
    2 | /app/lib/choo.js
    3 | Choo framework bundle supporting routing, state management, and rendering.
    4 | */
    5 | (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
    6 |     window.Choo = require('choo')
    7 |     window.html = require('choo/html')
    8 |     window.raw = require('choo/html/raw')
    9 |     
   10 |     },{"choo":5,"choo/html":3,"choo/html/raw":4}],2:[function(require,module,exports){
   11 |     var assert = require('assert')
   12 |     var LRU = require('nanolru')
   13 |     
   14 |     module.exports = ChooComponentCache
   15 |     
   16 |     function ChooComponentCache (state, emit, lru) {
   17 |       assert.ok(this instanceof ChooComponentCache, 'ChooComponentCache should be created with `new`')
   18 |     
   19 |       assert.equal(typeof state, 'object', 'ChooComponentCache: state should be type object')
   20 |       assert.equal(typeof emit, 'function', 'ChooComponentCache: emit should be type function')
   21 |     
   22 |       if (typeof lru === 'number') this.cache = new LRU(lru)
   23 |       else this.cache = lru || new LRU(100)
   24 |       this.state = state
   25 |       this.emit = emit
   26 |     }
   27 |     
   28 |     // Get & create component instances.
   29 |     ChooComponentCache.prototype.render = function (Component, id) {
   30 |       assert.equal(typeof Component, 'function', 'ChooComponentCache.render: Component should be type function')
   31 |       assert.ok(typeof id === 'string' || typeof id === 'number', 'ChooComponentCache.render: id should be type string or type number')
   32 |     
   33 |       var el = this.cache.get(id)
   34 |       if (!el) {
   35 |         var args = []
   36 |         for (var i = 2, len = arguments.length; i < len; i++) {
   37 |           args.push(arguments[i])
   38 |         }
   39 |         args.unshift(Component, id, this.state, this.emit)
   40 |         el = newCall.apply(newCall, args)
   41 |         this.cache.set(id, el)
   42 |       }
   43 |     
   44 |       return el
   45 |     }
   46 |     
   47 |     // Because you can't call `new` and `.apply()` at the same time. This is a mad
   48 |     // hack, but hey it works so we gonna go for it. Whoop.
   49 |     function newCall (Cls) {
   50 |       return new (Cls.bind.apply(Cls, arguments)) // eslint-disable-line
   51 |     }
   52 |     
   53 |     },{"assert":9,"nanolru":19}],3:[function(require,module,exports){
   54 |     module.exports = require('nanohtml')
   55 |     
   56 |     },{"nanohtml":14}],4:[function(require,module,exports){
   57 |     module.exports = require('nanohtml/raw')
   58 |     
   59 |     },{"nanohtml/raw":17}],5:[function(require,module,exports){
   60 |     var scrollToAnchor = require('scroll-to-anchor')
   61 |     var documentReady = require('document-ready')
   62 |     var nanotiming = require('nanotiming')
   63 |     var nanorouter = require('nanorouter')
   64 |     var nanomorph = require('nanomorph')
   65 |     var nanoquery = require('nanoquery')
   66 |     var nanohref = require('nanohref')
   67 |     var nanoraf = require('nanoraf')
   68 |     var nanobus = require('nanobus')
   69 |     var assert = require('assert')
   70 |     
   71 |     var Cache = require('./component/cache')
   72 |     
   73 |     module.exports = Choo
   74 |     
   75 |     var HISTORY_OBJECT = {}
   76 |     
   77 |     function Choo (opts) {
   78 |       var timing = nanotiming('choo.constructor')
   79 |       if (!(this instanceof Choo)) return new Choo(opts)
   80 |       opts = opts || {}
   81 |     
   82 |       assert.equal(typeof opts, 'object', 'choo: opts should be type object')
   83 |     
   84 |       var self = this
   85 |     
   86 |       // define events used by choo
   87 |       this._events = {
   88 |         DOMCONTENTLOADED: 'DOMContentLoaded',
   89 |         DOMTITLECHANGE: 'DOMTitleChange',
   90 |         REPLACESTATE: 'replaceState',
   91 |         PUSHSTATE: 'pushState',
   92 |         NAVIGATE: 'navigate',
   93 |         POPSTATE: 'popState',
   94 |         RENDER: 'render'
   95 |       }
   96 |     
   97 |       // properties for internal use only
   98 |       this._historyEnabled = opts.history === undefined ? true : opts.history
   99 |       this._hrefEnabled = opts.href === undefined ? true : opts.href
  100 |       this._hashEnabled = opts.hash === undefined ? false : opts.hash
  101 |       this._hasWindow = typeof window !== 'undefined'
  102 |       this._cache = opts.cache
  103 |       this._loaded = false
  104 |       this._stores = [ondomtitlechange]
  105 |       this._tree = null
  106 |     
  107 |       // state
  108 |       var _state = {
  109 |         events: this._events,
  110 |         components: {}
  111 |       }
  112 |       if (this._hasWindow) {
  113 |         this.state = window.initialState
  114 |           ? Object.assign({}, window.initialState, _state)
  115 |           : _state
  116 |         delete window.initialState
  117 |       } else {
  118 |         this.state = _state
  119 |       }
  120 |     
  121 |       // properties that are part of the API
  122 |       this.router = nanorouter({ curry: true })
  123 |       this.emitter = nanobus('choo.emit')
  124 |       this.emit = this.emitter.emit.bind(this.emitter)
  125 |     
  126 |       // listen for title changes; available even when calling .toString()
  127 |       if (this._hasWindow) this.state.title = document.title
  128 |       function ondomtitlechange (state) {
  129 |         self.emitter.prependListener(self._events.DOMTITLECHANGE, function (title) {
  130 |           assert.equal(typeof title, 'string', 'events.DOMTitleChange: title should be type string')
  131 |           state.title = title
  132 |           if (self._hasWindow) document.title = title
  133 |         })
  134 |       }
  135 |       timing()
  136 |     }
  137 |     
  138 |     Choo.prototype.route = function (route, handler) {
  139 |       var routeTiming = nanotiming("choo.route('" + route + "')")
  140 |       assert.equal(typeof route, 'string', 'choo.route: route should be type string')
  141 |       assert.equal(typeof handler, 'function', 'choo.handler: route should be type function')
  142 |       this.router.on(route, handler)
  143 |       routeTiming()
  144 |     }
  145 |     
  146 |     Choo.prototype.use = function (cb) {
  147 |       assert.equal(typeof cb, 'function', 'choo.use: cb should be type function')
  148 |       var self = this
  149 |       this._stores.push(function (state) {
  150 |         var msg = 'choo.use'
  151 |         msg = cb.storeName ? msg + '(' + cb.storeName + ')' : msg
  152 |         var endTiming = nanotiming(msg)
  153 |         cb(state, self.emitter, self)
  154 |         endTiming()
  155 |       })
  156 |     }
  157 |     
  158 |     Choo.prototype.start = function () {
  159 |       assert.equal(typeof window, 'object', 'choo.start: window was not found. .start() must be called in a browser, use .toString() if running in Node')
  160 |       var startTiming = nanotiming('choo.start')
  161 |     
  162 |       var self = this
  163 |       if (this._historyEnabled) {
  164 |         this.emitter.prependListener(this._events.NAVIGATE, function () {
  165 |           self._matchRoute(self.state)
  166 |           if (self._loaded) {
  167 |             self.emitter.emit(self._events.RENDER)
  168 |             setTimeout(scrollToAnchor.bind(null, window.location.hash), 0)
  169 |           }
  170 |         })
  171 |     
  172 |         this.emitter.prependListener(this._events.POPSTATE, function () {
  173 |           self.emitter.emit(self._events.NAVIGATE)
  174 |         })
  175 |     
  176 |         this.emitter.prependListener(this._events.PUSHSTATE, function (href) {
  177 |           assert.equal(typeof href, 'string', 'events.pushState: href should be type string')
  178 |           window.history.pushState(HISTORY_OBJECT, null, href)
  179 |           self.emitter.emit(self._events.NAVIGATE)
  180 |         })
  181 |     
  182 |         this.emitter.prependListener(this._events.REPLACESTATE, function (href) {
  183 |           assert.equal(typeof href, 'string', 'events.replaceState: href should be type string')
  184 |           window.history.replaceState(HISTORY_OBJECT, null, href)
  185 |           self.emitter.emit(self._events.NAVIGATE)
  186 |         })
  187 |     
  188 |         window.onpopstate = function () {
  189 |           self.emitter.emit(self._events.POPSTATE)
  190 |         }
  191 |     
  192 |         if (self._hrefEnabled) {
  193 |           nanohref(function (location) {
  194 |             var href = location.href
  195 |             var hash = location.hash
  196 |             if (href === window.location.href) {
  197 |               if (!self._hashEnabled && hash) scrollToAnchor(hash)
  198 |               return
  199 |             }
  200 |             self.emitter.emit(self._events.PUSHSTATE, href)
  201 |           })
  202 |         }
  203 |       }
  204 |     
  205 |       this._setCache(this.state)
  206 |       this._matchRoute(this.state)
  207 |       this._stores.forEach(function (initStore) {
  208 |         initStore(self.state)
  209 |       })
  210 |     
  211 |       this._tree = this._prerender(this.state)
  212 |       assert.ok(this._tree, 'choo.start: no valid DOM node returned for location ' + this.state.href)
  213 |     
  214 |       this.emitter.prependListener(self._events.RENDER, nanoraf(function () {
  215 |         var renderTiming = nanotiming('choo.render')
  216 |         var newTree = self._prerender(self.state)
  217 |         assert.ok(newTree, 'choo.render: no valid DOM node returned for location ' + self.state.href)
  218 |     
  219 |         assert.equal(self._tree.nodeName, newTree.nodeName, 'choo.render: The target node <' +
  220 |           self._tree.nodeName.toLowerCase() + '> is not the same type as the new node <' +
  221 |           newTree.nodeName.toLowerCase() + '>.')
  222 |     
  223 |         var morphTiming = nanotiming('choo.morph')
  224 |         nanomorph(self._tree, newTree)
  225 |         morphTiming()
  226 |     
  227 |         renderTiming()
  228 |       }))
  229 |     
  230 |       documentReady(function () {
  231 |         self.emitter.emit(self._events.DOMCONTENTLOADED)
  232 |         self._loaded = true
  233 |       })
  234 |     
  235 |       startTiming()
  236 |       return this._tree
  237 |     }
  238 |     
  239 |     Choo.prototype.mount = function mount (selector) {
  240 |       var mountTiming = nanotiming("choo.mount('" + selector + "')")
  241 |       if (typeof window !== 'object') {
  242 |         assert.ok(typeof selector === 'string', 'choo.mount: selector should be type String')
  243 |         this.selector = selector
  244 |         mountTiming()
  245 |         return this
  246 |       }
  247 |     
  248 |       assert.ok(typeof selector === 'string' || typeof selector === 'object', 'choo.mount: selector should be type String or HTMLElement')
  249 |     
  250 |       var self = this
  251 |     
  252 |       documentReady(function () {
  253 |         var renderTiming = nanotiming('choo.render')
  254 |         var newTree = self.start()
  255 |         if (typeof selector === 'string') {
  256 |           self._tree = document.querySelector(selector)
  257 |         } else {
  258 |           self._tree = selector
  259 |         }
  260 |     
  261 |         assert.ok(self._tree, 'choo.mount: could not query selector: ' + selector)
  262 |         assert.equal(self._tree.nodeName, newTree.nodeName, 'choo.mount: The target node <' +
  263 |           self._tree.nodeName.toLowerCase() + '> is not the same type as the new node <' +
  264 |           newTree.nodeName.toLowerCase() + '>.')
  265 |     
  266 |         var morphTiming = nanotiming('choo.morph')
  267 |         nanomorph(self._tree, newTree)
  268 |         morphTiming()
  269 |     
  270 |         renderTiming()
  271 |       })
  272 |       mountTiming()
  273 |     }
  274 |     
  275 |     Choo.prototype.toString = function (location, state) {
  276 |       state = state || {}
  277 |       state.components = state.components || {}
  278 |       state.events = Object.assign({}, state.events, this._events)
  279 |     
  280 |       assert.notEqual(typeof window, 'object', 'choo.mount: window was found. .toString() must be called in Node, use .start() or .mount() if running in the browser')
  281 |       assert.equal(typeof location, 'string', 'choo.toString: location should be type string')
  282 |       assert.equal(typeof state, 'object', 'choo.toString: state should be type object')
  283 |     
  284 |       this._setCache(state)
  285 |       this._matchRoute(state, location)
  286 |       this.emitter.removeAllListeners()
  287 |       this._stores.forEach(function (initStore) {
  288 |         initStore(state)
  289 |       })
  290 |     
  291 |       var html = this._prerender(state)
  292 |       assert.ok(html, 'choo.toString: no valid value returned for the route ' + location)
  293 |       assert(!Array.isArray(html), 'choo.toString: return value was an array for the route ' + location)
  294 |       return typeof html.outerHTML === 'string' ? html.outerHTML : html.toString()
  295 |     }
  296 |     
  297 |     Choo.prototype._matchRoute = function (state, locationOverride) {
  298 |       var location, queryString
  299 |       if (locationOverride) {
  300 |         location = locationOverride.replace(/\?.+$/, '').replace(/\/$/, '')
  301 |         if (!this._hashEnabled) location = location.replace(/#.+$/, '')
  302 |         queryString = locationOverride
  303 |       } else {
  304 |         location = window.location.pathname.replace(/\/$/, '')
  305 |         if (this._hashEnabled) location += window.location.hash.replace(/^#/, '/')
  306 |         queryString = window.location.search
  307 |       }
  308 |       var matched = this.router.match(location)
  309 |       this._handler = matched.cb
  310 |       state.href = location
  311 |       state.query = nanoquery(queryString)
  312 |       state.route = matched.route
  313 |       state.params = matched.params
  314 |     }
  315 |     
  316 |     Choo.prototype._prerender = function (state) {
  317 |       var routeTiming = nanotiming("choo.prerender('" + state.route + "')")
  318 |       var res = this._handler(state, this.emit)
  319 |       routeTiming()
  320 |       return res
  321 |     }
  322 |     
  323 |     Choo.prototype._setCache = function (state) {
  324 |       var cache = new Cache(state, this.emitter.emit.bind(this.emitter), this._cache)
  325 |       state.cache = renderComponent
  326 |     
  327 |       function renderComponent (Component, id) {
  328 |         assert.equal(typeof Component, 'function', 'choo.state.cache: Component should be type function')
  329 |         var args = []
  330 |         for (var i = 0, len = arguments.length; i < len; i++) {
  331 |           args.push(arguments[i])
  332 |         }
  333 |         return cache.render.apply(cache, args)
  334 |       }
  335 |     
  336 |       // When the state gets stringified, make sure `state.cache` isn't
  337 |       // stringified too.
  338 |       renderComponent.toJSON = function () {
  339 |         return null
  340 |       }
  341 |     }
  342 |     
  343 |     },{"./component/cache":2,"assert":9,"document-ready":6,"nanobus":10,"nanohref":11,"nanomorph":20,"nanoquery":23,"nanoraf":24,"nanorouter":25,"nanotiming":27,"scroll-to-anchor":29}],6:[function(require,module,exports){
  344 |     'use strict'
  345 |     
  346 |     module.exports = ready
  347 |     
  348 |     function ready (callback) {
  349 |       if (typeof document === 'undefined') {
  350 |         throw new Error('document-ready only runs in the browser')
  351 |       }
  352 |       var state = document.readyState
  353 |       if (state === 'complete' || state === 'interactive') {
  354 |         return setTimeout(callback, 0)
  355 |       }
  356 |     
  357 |       document.addEventListener('DOMContentLoaded', function onLoad () {
  358 |         callback()
  359 |       })
  360 |     }
  361 |     
  362 |     },{}],7:[function(require,module,exports){
  363 |     module.exports = attributeToProperty
  364 |     
  365 |     var transform = {
  366 |       'class': 'className',
  367 |       'for': 'htmlFor',
  368 |       'http-equiv': 'httpEquiv'
  369 |     }
  370 |     
  371 |     function attributeToProperty (h) {
  372 |       return function (tagName, attrs, children) {
  373 |         for (var attr in attrs) {
  374 |           if (attr in transform) {
  375 |             attrs[transform[attr]] = attrs[attr]
  376 |             delete attrs[attr]
  377 |           }
  378 |         }
  379 |         return h(tagName, attrs, children)
  380 |       }
  381 |     }
  382 |     
  383 |     },{}],8:[function(require,module,exports){
  384 |     var attrToProp = require('hyperscript-attribute-to-property')
  385 |     
  386 |     var VAR = 0, TEXT = 1, OPEN = 2, CLOSE = 3, ATTR = 4
  387 |     var ATTR_KEY = 5, ATTR_KEY_W = 6
  388 |     var ATTR_VALUE_W = 7, ATTR_VALUE = 8
  389 |     var ATTR_VALUE_SQ = 9, ATTR_VALUE_DQ = 10
  390 |     var ATTR_EQ = 11, ATTR_BREAK = 12
  391 |     var COMMENT = 13
  392 |     
  393 |     module.exports = function (h, opts) {
  394 |       if (!opts) opts = {}
  395 |       var concat = opts.concat || function (a, b) {
  396 |         return String(a) + String(b)
  397 |       }
  398 |       if (opts.attrToProp !== false) {
  399 |         h = attrToProp(h)
  400 |       }
  401 |     
  402 |       return function (strings) {
  403 |         var state = TEXT, reg = ''
  404 |         var arglen = arguments.length
  405 |         var parts = []
  406 |     
  407 |         for (var i = 0; i < strings.length; i++) {
  408 |           if (i < arglen - 1) {
  409 |             var arg = arguments[i+1]
  410 |             var p = parse(strings[i])
  411 |             var xstate = state
  412 |             if (xstate === ATTR_VALUE_DQ) xstate = ATTR_VALUE
  413 |             if (xstate === ATTR_VALUE_SQ) xstate = ATTR_VALUE
  414 |             if (xstate === ATTR_VALUE_W) xstate = ATTR_VALUE
  415 |             if (xstate === ATTR) xstate = ATTR_KEY
  416 |             if (xstate === OPEN) {
  417 |               if (reg === '/') {
  418 |                 p.push([ OPEN, '/', arg ])
  419 |                 reg = ''
  420 |               } else {
  421 |                 p.push([ OPEN, arg ])
  422 |               }
  423 |             } else if (xstate === COMMENT && opts.comments) {
  424 |               reg += String(arg)
  425 |             } else if (xstate !== COMMENT) {
  426 |               p.push([ VAR, xstate, arg ])
  427 |             }
  428 |             parts.push.apply(parts, p)
  429 |           } else parts.push.apply(parts, parse(strings[i]))
  430 |         }
  431 |     
  432 |         var tree = [null,{},[]]
  433 |         var stack = [[tree,-1]]
  434 |         for (var i = 0; i < parts.length; i++) {
  435 |           var cur = stack[stack.length-1][0]
  436 |           var p = parts[i], s = p[0]
  437 |           if (s === OPEN && /^\//.test(p[1])) {
  438 |             var ix = stack[stack.length-1][1]
  439 |             if (stack.length > 1) {
  440 |               stack.pop()
  441 |               stack[stack.length-1][0][2][ix] = h(
  442 |                 cur[0], cur[1], cur[2].length ? cur[2] : undefined
  443 |               )
  444 |             }
  445 |           } else if (s === OPEN) {
  446 |             var c = [p[1],{},[]]
  447 |             cur[2].push(c)
  448 |             stack.push([c,cur[2].length-1])
  449 |           } else if (s === ATTR_KEY || (s === VAR && p[1] === ATTR_KEY)) {
  450 |             var key = ''
  451 |             var copyKey
  452 |             for (; i < parts.length; i++) {
  453 |               if (parts[i][0] === ATTR_KEY) {
  454 |                 key = concat(key, parts[i][1])
  455 |               } else if (parts[i][0] === VAR && parts[i][1] === ATTR_KEY) {
  456 |                 if (typeof parts[i][2] === 'object' && !key) {
  457 |                   for (copyKey in parts[i][2]) {
  458 |                     if (parts[i][2].hasOwnProperty(copyKey) && !cur[1][copyKey]) {
  459 |                       cur[1][copyKey] = parts[i][2][copyKey]
  460 |                     }
  461 |                   }
  462 |                 } else {
  463 |                   key = concat(key, parts[i][2])
  464 |                 }
  465 |               } else break
  466 |             }
  467 |             if (parts[i][0] === ATTR_EQ) i++
  468 |             var j = i
  469 |             for (; i < parts.length; i++) {
  470 |               if (parts[i][0] === ATTR_VALUE || parts[i][0] === ATTR_KEY) {
  471 |                 if (!cur[1][key]) cur[1][key] = strfn(parts[i][1])
  472 |                 else parts[i][1]==="" || (cur[1][key] = concat(cur[1][key], parts[i][1]));
  473 |               } else if (parts[i][0] === VAR
  474 |               && (parts[i][1] === ATTR_VALUE || parts[i][1] === ATTR_KEY)) {
  475 |                 if (!cur[1][key]) cur[1][key] = strfn(parts[i][2])
  476 |                 else parts[i][2]==="" || (cur[1][key] = concat(cur[1][key], parts[i][2]));
  477 |               } else {
  478 |                 if (key.length && !cur[1][key] && i === j
  479 |                 && (parts[i][0] === CLOSE || parts[i][0] === ATTR_BREAK)) {
  480 |                   // https://html.spec.whatwg.org/multipage/infrastructure.html#boolean-attributes
  481 |                   // empty string is falsy, not well behaved value in browser
  482 |                   cur[1][key] = key.toLowerCase()
  483 |                 }
  484 |                 if (parts[i][0] === CLOSE) {
  485 |                   i--
  486 |                 }
  487 |                 break
  488 |               }
  489 |             }
  490 |           } else if (s === ATTR_KEY) {
  491 |             cur[1][p[1]] = true
  492 |           } else if (s === VAR && p[1] === ATTR_KEY) {
  493 |             cur[1][p[2]] = true
  494 |           } else if (s === CLOSE) {
  495 |             if (selfClosing(cur[0]) && stack.length) {
  496 |               var ix = stack[stack.length-1][1]
  497 |               stack.pop()
  498 |               stack[stack.length-1][0][2][ix] = h(
  499 |                 cur[0], cur[1], cur[2].length ? cur[2] : undefined
  500 |               )
  501 |             }
  502 |           } else if (s === VAR && p[1] === TEXT) {
  503 |             if (p[2] === undefined || p[2] === null) p[2] = ''
  504 |             else if (!p[2]) p[2] = concat('', p[2])
  505 |             if (Array.isArray(p[2][0])) {
  506 |               cur[2].push.apply(cur[2], p[2])
  507 |             } else {
  508 |               cur[2].push(p[2])
  509 |             }
  510 |           } else if (s === TEXT) {
  511 |             cur[2].push(p[1])
  512 |           } else if (s === ATTR_EQ || s === ATTR_BREAK) {
  513 |             // no-op
  514 |           } else {
  515 |             throw new Error('unhandled: ' + s)
  516 |           }
  517 |         }
  518 |     
  519 |         if (tree[2].length > 1 && /^\s*$/.test(tree[2][0])) {
  520 |           tree[2].shift()
  521 |         }
  522 |     
  523 |         if (tree[2].length > 2
  524 |         || (tree[2].length === 2 && /\S/.test(tree[2][1]))) {
  525 |           if (opts.createFragment) return opts.createFragment(tree[2])
  526 |           throw new Error(
  527 |             'multiple root elements must be wrapped in an enclosing tag'
  528 |           )
  529 |         }
  530 |         if (Array.isArray(tree[2][0]) && typeof tree[2][0][0] === 'string'
  531 |         && Array.isArray(tree[2][0][2])) {
  532 |           tree[2][0] = h(tree[2][0][0], tree[2][0][1], tree[2][0][2])
  533 |         }
  534 |         return tree[2][0]
  535 |     
  536 |         function parse (str) {
  537 |           var res = []
  538 |           if (state === ATTR_VALUE_W) state = ATTR
  539 |           for (var i = 0; i < str.length; i++) {
  540 |             var c = str.charAt(i)
  541 |             if (state === TEXT && c === '<') {
  542 |               if (reg.length) res.push([TEXT, reg])
  543 |               reg = ''
  544 |               state = OPEN
  545 |             } else if (c === '>' && !quot(state) && state !== COMMENT) {
  546 |               if (state === OPEN && reg.length) {
  547 |                 res.push([OPEN,reg])
  548 |               } else if (state === ATTR_KEY) {
  549 |                 res.push([ATTR_KEY,reg])
  550 |               } else if (state === ATTR_VALUE && reg.length) {
  551 |                 res.push([ATTR_VALUE,reg])
  552 |               }
  553 |               res.push([CLOSE])
  554 |               reg = ''
  555 |               state = TEXT
  556 |             } else if (state === COMMENT && /-$/.test(reg) && c === '-') {
  557 |               if (opts.comments) {
  558 |                 res.push([ATTR_VALUE,reg.substr(0, reg.length - 1)])
  559 |               }
  560 |               reg = ''
  561 |               state = TEXT
  562 |             } else if (state === OPEN && /^!--$/.test(reg)) {
  563 |               if (opts.comments) {
  564 |                 res.push([OPEN, reg],[ATTR_KEY,'comment'],[ATTR_EQ])
  565 |               }
  566 |               reg = c
  567 |               state = COMMENT
  568 |             } else if (state === TEXT || state === COMMENT) {
  569 |               reg += c
  570 |             } else if (state === OPEN && c === '/' && reg.length) {
  571 |               // no-op, self closing tag without a space <br/>
  572 |             } else if (state === OPEN && /\s/.test(c)) {
  573 |               if (reg.length) {
  574 |                 res.push([OPEN, reg])
  575 |               }
  576 |               reg = ''
  577 |               state = ATTR
  578 |             } else if (state === OPEN) {
  579 |               reg += c
  580 |             } else if (state === ATTR && /[^\s"'=/]/.test(c)) {
  581 |               state = ATTR_KEY
  582 |               reg = c
  583 |             } else if (state === ATTR && /\s/.test(c)) {
  584 |               if (reg.length) res.push([ATTR_KEY,reg])
  585 |               res.push([ATTR_BREAK])
  586 |             } else if (state === ATTR_KEY && /\s/.test(c)) {
  587 |               res.push([ATTR_KEY,reg])
  588 |               reg = ''
  589 |               state = ATTR_KEY_W
  590 |             } else if (state === ATTR_KEY && c === '=') {
  591 |               res.push([ATTR_KEY,reg],[ATTR_EQ])
  592 |               reg = ''
  593 |               state = ATTR_VALUE_W
  594 |             } else if (state === ATTR_KEY) {
  595 |               reg += c
  596 |             } else if ((state === ATTR_KEY_W || state === ATTR) && c === '=') {
  597 |               res.push([ATTR_EQ])
  598 |               state = ATTR_VALUE_W
  599 |             } else if ((state === ATTR_KEY_W || state === ATTR) && !/\s/.test(c)) {
  600 |               res.push([ATTR_BREAK])
  601 |               if (/[\w-]/.test(c)) {
  602 |                 reg += c
  603 |                 state = ATTR_KEY
  604 |               } else state = ATTR
  605 |             } else if (state === ATTR_VALUE_W && c === '"') {
  606 |               state = ATTR_VALUE_DQ
  607 |             } else if (state === ATTR_VALUE_W && c === "'") {
  608 |               state = ATTR_VALUE_SQ
  609 |             } else if (state === ATTR_VALUE_DQ && c === '"') {
  610 |               res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  611 |               reg = ''
  612 |               state = ATTR
  613 |             } else if (state === ATTR_VALUE_SQ && c === "'") {
  614 |               res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  615 |               reg = ''
  616 |               state = ATTR
  617 |             } else if (state === ATTR_VALUE_W && !/\s/.test(c)) {
  618 |               state = ATTR_VALUE
  619 |               i--
  620 |             } else if (state === ATTR_VALUE && /\s/.test(c)) {
  621 |               res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  622 |               reg = ''
  623 |               state = ATTR
  624 |             } else if (state === ATTR_VALUE || state === ATTR_VALUE_SQ
  625 |             || state === ATTR_VALUE_DQ) {
  626 |               reg += c
  627 |             }
  628 |           }
  629 |           if (state === TEXT && reg.length) {
  630 |             res.push([TEXT,reg])
  631 |             reg = ''
  632 |           } else if (state === ATTR_VALUE && reg.length) {
  633 |             res.push([ATTR_VALUE,reg])
  634 |             reg = ''
  635 |           } else if (state === ATTR_VALUE_DQ && reg.length) {
  636 |             res.push([ATTR_VALUE,reg])
  637 |             reg = ''
  638 |           } else if (state === ATTR_VALUE_SQ && reg.length) {
  639 |             res.push([ATTR_VALUE,reg])
  640 |             reg = ''
  641 |           } else if (state === ATTR_KEY) {
  642 |             res.push([ATTR_KEY,reg])
  643 |             reg = ''
  644 |           }
  645 |           return res
  646 |         }
  647 |       }
  648 |     
  649 |       function strfn (x) {
  650 |         if (typeof x === 'function') return x
  651 |         else if (typeof x === 'string') return x
  652 |         else if (x && typeof x === 'object') return x
  653 |         else if (x === null || x === undefined) return x
  654 |         else return concat('', x)
  655 |       }
  656 |     }
  657 |     
  658 |     function quot (state) {
  659 |       return state === ATTR_VALUE_SQ || state === ATTR_VALUE_DQ
  660 |     }
  661 |     
  662 |     var closeRE = RegExp('^(' + [
  663 |       'area', 'base', 'basefont', 'bgsound', 'br', 'col', 'command', 'embed',
  664 |       'frame', 'hr', 'img', 'input', 'isindex', 'keygen', 'link', 'meta', 'param',
  665 |       'source', 'track', 'wbr', '!--',
  666 |       // SVG TAGS
  667 |       'animate', 'animateTransform', 'circle', 'cursor', 'desc', 'ellipse',
  668 |       'feBlend', 'feColorMatrix', 'feComposite',
  669 |       'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap',
  670 |       'feDistantLight', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR',
  671 |       'feGaussianBlur', 'feImage', 'feMergeNode', 'feMorphology',
  672 |       'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile',
  673 |       'feTurbulence', 'font-face-format', 'font-face-name', 'font-face-uri',
  674 |       'glyph', 'glyphRef', 'hkern', 'image', 'line', 'missing-glyph', 'mpath',
  675 |       'path', 'polygon', 'polyline', 'rect', 'set', 'stop', 'tref', 'use', 'view',
  676 |       'vkern'
  677 |     ].join('|') + ')(?:[\.#][a-zA-Z0-9\u007F-\uFFFF_:-]+)*$')
  678 |     function selfClosing (tag) { return closeRE.test(tag) }
  679 |     
  680 |     },{"hyperscript-attribute-to-property":7}],9:[function(require,module,exports){
  681 |     assert.notEqual = notEqual
  682 |     assert.notOk = notOk
  683 |     assert.equal = equal
  684 |     assert.ok = assert
  685 |     
  686 |     module.exports = assert
  687 |     
  688 |     function equal (a, b, m) {
  689 |       assert(a == b, m) // eslint-disable-line eqeqeq
  690 |     }
  691 |     
  692 |     function notEqual (a, b, m) {
  693 |       assert(a != b, m) // eslint-disable-line eqeqeq
  694 |     }
  695 |     
  696 |     function notOk (t, m) {
  697 |       assert(!t, m)
  698 |     }
  699 |     
  700 |     function assert (t, m) {
  701 |       if (!t) throw new Error(m || 'AssertionError')
  702 |     }
  703 |     
  704 |     },{}],10:[function(require,module,exports){
  705 |     var splice = require('remove-array-items')
  706 |     var nanotiming = require('nanotiming')
  707 |     var assert = require('assert')
  708 |     
  709 |     module.exports = Nanobus
  710 |     
  711 |     function Nanobus (name) {
  712 |       if (!(this instanceof Nanobus)) return new Nanobus(name)
  713 |     
  714 |       this._name = name || 'nanobus'
  715 |       this._starListeners = []
  716 |       this._listeners = {}
  717 |     }
  718 |     
  719 |     Nanobus.prototype.emit = function (eventName) {
  720 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.emit: eventName should be type string or symbol')
  721 |     
  722 |       var data = []
  723 |       for (var i = 1, len = arguments.length; i < len; i++) {
  724 |         data.push(arguments[i])
  725 |       }
  726 |     
  727 |       var emitTiming = nanotiming(this._name + "('" + eventName.toString() + "')")
  728 |       var listeners = this._listeners[eventName]
  729 |       if (listeners && listeners.length > 0) {
  730 |         this._emit(this._listeners[eventName], data)
  731 |       }
  732 |     
  733 |       if (this._starListeners.length > 0) {
  734 |         this._emit(this._starListeners, eventName, data, emitTiming.uuid)
  735 |       }
  736 |       emitTiming()
  737 |     
  738 |       return this
  739 |     }
  740 |     
  741 |     Nanobus.prototype.on = Nanobus.prototype.addListener = function (eventName, listener) {
  742 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.on: eventName should be type string or symbol')
  743 |       assert.equal(typeof listener, 'function', 'nanobus.on: listener should be type function')
  744 |     
  745 |       if (eventName === '*') {
  746 |         this._starListeners.push(listener)
  747 |       } else {
  748 |         if (!this._listeners[eventName]) this._listeners[eventName] = []
  749 |         this._listeners[eventName].push(listener)
  750 |       }
  751 |       return this
  752 |     }
  753 |     
  754 |     Nanobus.prototype.prependListener = function (eventName, listener) {
  755 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.prependListener: eventName should be type string or symbol')
  756 |       assert.equal(typeof listener, 'function', 'nanobus.prependListener: listener should be type function')
  757 |     
  758 |       if (eventName === '*') {
  759 |         this._starListeners.unshift(listener)
  760 |       } else {
  761 |         if (!this._listeners[eventName]) this._listeners[eventName] = []
  762 |         this._listeners[eventName].unshift(listener)
  763 |       }
  764 |       return this
  765 |     }
  766 |     
  767 |     Nanobus.prototype.once = function (eventName, listener) {
  768 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.once: eventName should be type string or symbol')
  769 |       assert.equal(typeof listener, 'function', 'nanobus.once: listener should be type function')
  770 |     
  771 |       var self = this
  772 |       this.on(eventName, once)
  773 |       function once () {
  774 |         listener.apply(self, arguments)
  775 |         self.removeListener(eventName, once)
  776 |       }
  777 |       return this
  778 |     }
  779 |     
  780 |     Nanobus.prototype.prependOnceListener = function (eventName, listener) {
  781 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.prependOnceListener: eventName should be type string or symbol')
  782 |       assert.equal(typeof listener, 'function', 'nanobus.prependOnceListener: listener should be type function')
  783 |     
  784 |       var self = this
  785 |       this.prependListener(eventName, once)
  786 |       function once () {
  787 |         listener.apply(self, arguments)
  788 |         self.removeListener(eventName, once)
  789 |       }
  790 |       return this
  791 |     }
  792 |     
  793 |     Nanobus.prototype.removeListener = function (eventName, listener) {
  794 |       assert.ok(typeof eventName === 'string' || typeof eventName === 'symbol', 'nanobus.removeListener: eventName should be type string or symbol')
  795 |       assert.equal(typeof listener, 'function', 'nanobus.removeListener: listener should be type function')
  796 |     
  797 |       if (eventName === '*') {
  798 |         this._starListeners = this._starListeners.slice()
  799 |         return remove(this._starListeners, listener)
  800 |       } else {
  801 |         if (typeof this._listeners[eventName] !== 'undefined') {
  802 |           this._listeners[eventName] = this._listeners[eventName].slice()
  803 |         }
  804 |     
  805 |         return remove(this._listeners[eventName], listener)
  806 |       }
  807 |     
  808 |       function remove (arr, listener) {
  809 |         if (!arr) return
  810 |         var index = arr.indexOf(listener)
  811 |         if (index !== -1) {
  812 |           splice(arr, index, 1)
  813 |           return true
  814 |         }
  815 |       }
  816 |     }
  817 |     
  818 |     Nanobus.prototype.removeAllListeners = function (eventName) {
  819 |       if (eventName) {
  820 |         if (eventName === '*') {
  821 |           this._starListeners = []
  822 |         } else {
  823 |           this._listeners[eventName] = []
  824 |         }
  825 |       } else {
  826 |         this._starListeners = []
  827 |         this._listeners = {}
  828 |       }
  829 |       return this
  830 |     }
  831 |     
  832 |     Nanobus.prototype.listeners = function (eventName) {
  833 |       var listeners = eventName !== '*'
  834 |         ? this._listeners[eventName]
  835 |         : this._starListeners
  836 |     
  837 |       var ret = []
  838 |       if (listeners) {
  839 |         var ilength = listeners.length
  840 |         for (var i = 0; i < ilength; i++) ret.push(listeners[i])
  841 |       }
  842 |       return ret
  843 |     }
  844 |     
  845 |     Nanobus.prototype._emit = function (arr, eventName, data, uuid) {
  846 |       if (typeof arr === 'undefined') return
  847 |       if (arr.length === 0) return
  848 |       if (data === undefined) {
  849 |         data = eventName
  850 |         eventName = null
  851 |       }
  852 |     
  853 |       if (eventName) {
  854 |         if (uuid !== undefined) {
  855 |           data = [eventName].concat(data, uuid)
  856 |         } else {
  857 |           data = [eventName].concat(data)
  858 |         }
  859 |       }
  860 |     
  861 |       var length = arr.length
  862 |       for (var i = 0; i < length; i++) {
  863 |         var listener = arr[i]
  864 |         listener.apply(listener, data)
  865 |       }
  866 |     }
  867 |     
  868 |     },{"assert":9,"nanotiming":27,"remove-array-items":28}],11:[function(require,module,exports){
  869 |     var assert = require('assert')
  870 |     
  871 |     var safeExternalLink = /(noopener|noreferrer) (noopener|noreferrer)/
  872 |     var protocolLink = /^[\w-_]+:/
  873 |     
  874 |     module.exports = href
  875 |     
  876 |     function href (cb, root) {
  877 |       assert.notEqual(typeof window, 'undefined', 'nanohref: expected window to exist')
  878 |     
  879 |       root = root || window.document
  880 |     
  881 |       assert.equal(typeof cb, 'function', 'nanohref: cb should be type function')
  882 |       assert.equal(typeof root, 'object', 'nanohref: root should be type object')
  883 |     
  884 |       window.addEventListener('click', function (e) {
  885 |         if ((e.button && e.button !== 0) ||
  886 |           e.ctrlKey || e.metaKey || e.altKey || e.shiftKey ||
  887 |           e.defaultPrevented) return
  888 |     
  889 |         var anchor = (function traverse (node) {
  890 |           if (!node || node === root) return
  891 |           if (node.localName !== 'a' || node.href === undefined) {
  892 |             return traverse(node.parentNode)
  893 |           }
  894 |           return node
  895 |         })(e.target)
  896 |     
  897 |         if (!anchor) return
  898 |     
  899 |         if (window.location.protocol !== anchor.protocol ||
  900 |             window.location.hostname !== anchor.hostname ||
  901 |             window.location.port !== anchor.port ||
  902 |           anchor.hasAttribute('data-nanohref-ignore') ||
  903 |           anchor.hasAttribute('download') ||
  904 |           (anchor.getAttribute('target') === '_blank' &&
  905 |             safeExternalLink.test(anchor.getAttribute('rel'))) ||
  906 |           protocolLink.test(anchor.getAttribute('href'))) return
  907 |     
  908 |         e.preventDefault()
  909 |         cb(anchor)
  910 |       })
  911 |     }
  912 |     
  913 |     },{"assert":9}],12:[function(require,module,exports){
  914 |     'use strict'
  915 |     
  916 |     var trailingNewlineRegex = /\n[\s]+$/
  917 |     var leadingNewlineRegex = /^\n[\s]+/
  918 |     var trailingSpaceRegex = /[\s]+$/
  919 |     var leadingSpaceRegex = /^[\s]+/
  920 |     var multiSpaceRegex = /[\n\s]+/g
  921 |     
  922 |     var TEXT_TAGS = [
  923 |       'a', 'abbr', 'b', 'bdi', 'bdo', 'br', 'cite', 'data', 'dfn', 'em', 'i',
  924 |       'kbd', 'mark', 'q', 'rp', 'rt', 'rtc', 'ruby', 's', 'amp', 'small', 'span',
  925 |       'strong', 'sub', 'sup', 'time', 'u', 'var', 'wbr'
  926 |     ]
  927 |     
  928 |     var VERBATIM_TAGS = [
  929 |       'code', 'pre', 'textarea'
  930 |     ]
  931 |     
  932 |     module.exports = function appendChild (el, childs) {
  933 |       if (!Array.isArray(childs)) return
  934 |     
  935 |       var nodeName = el.nodeName.toLowerCase()
  936 |     
  937 |       var hadText = false
  938 |       var value, leader
  939 |     
  940 |       for (var i = 0, len = childs.length; i < len; i++) {
  941 |         var node = childs[i]
  942 |         if (Array.isArray(node)) {
  943 |           appendChild(el, node)
  944 |           continue
  945 |         }
  946 |     
  947 |         if (typeof node === 'number' ||
  948 |           typeof node === 'boolean' ||
  949 |           typeof node === 'function' ||
  950 |           node instanceof Date ||
  951 |           node instanceof RegExp) {
  952 |           node = node.toString()
  953 |         }
  954 |     
  955 |         var lastChild = el.childNodes[el.childNodes.length - 1]
  956 |     
  957 |         // Iterate over text nodes
  958 |         if (typeof node === 'string') {
  959 |           hadText = true
  960 |     
  961 |           // If we already had text, append to the existing text
  962 |           if (lastChild && lastChild.nodeName === '#text') {
  963 |             lastChild.nodeValue += node
  964 |     
  965 |           // We didn't have a text node yet, create one
  966 |           } else {
  967 |             node = el.ownerDocument.createTextNode(node)
  968 |             el.appendChild(node)
  969 |             lastChild = node
  970 |           }
  971 |     
  972 |           // If this is the last of the child nodes, make sure we close it out
  973 |           // right
  974 |           if (i === len - 1) {
  975 |             hadText = false
  976 |             // Trim the child text nodes if the current node isn't a
  977 |             // node where whitespace matters.
  978 |             if (TEXT_TAGS.indexOf(nodeName) === -1 &&
  979 |               VERBATIM_TAGS.indexOf(nodeName) === -1) {
  980 |               value = lastChild.nodeValue
  981 |                 .replace(leadingNewlineRegex, '')
  982 |                 .replace(trailingSpaceRegex, '')
  983 |                 .replace(trailingNewlineRegex, '')
  984 |                 .replace(multiSpaceRegex, ' ')
  985 |               if (value === '') {
  986 |                 el.removeChild(lastChild)
  987 |               } else {
  988 |                 lastChild.nodeValue = value
  989 |               }
  990 |             } else if (VERBATIM_TAGS.indexOf(nodeName) === -1) {
  991 |               // The very first node in the list should not have leading
  992 |               // whitespace. Sibling text nodes should have whitespace if there
  993 |               // was any.
  994 |               leader = i === 0 ? '' : ' '
  995 |               value = lastChild.nodeValue
  996 |                 .replace(leadingNewlineRegex, leader)
  997 |                 .replace(leadingSpaceRegex, ' ')
  998 |                 .replace(trailingSpaceRegex, '')
  999 |                 .replace(trailingNewlineRegex, '')
 1000 |                 .replace(multiSpaceRegex, ' ')
 1001 |               lastChild.nodeValue = value
 1002 |             }
 1003 |           }
 1004 |     
 1005 |         // Iterate over DOM nodes
 1006 |         } else if (node && node.nodeType) {
 1007 |           // If the last node was a text node, make sure it is properly closed out
 1008 |           if (hadText) {
 1009 |             hadText = false
 1010 |     
 1011 |             // Trim the child text nodes if the current node isn't a
 1012 |             // text node or a code node
 1013 |             if (TEXT_TAGS.indexOf(nodeName) === -1 &&
 1014 |               VERBATIM_TAGS.indexOf(nodeName) === -1) {
 1015 |               value = lastChild.nodeValue
 1016 |                 .replace(leadingNewlineRegex, '')
 1017 |                 .replace(trailingNewlineRegex, ' ')
 1018 |                 .replace(multiSpaceRegex, ' ')
 1019 |     
 1020 |               // Remove empty text nodes, append otherwise
 1021 |               if (value === '') {
 1022 |                 el.removeChild(lastChild)
 1023 |               } else {
 1024 |                 lastChild.nodeValue = value
 1025 |               }
 1026 |             // Trim the child nodes but preserve the appropriate whitespace
 1027 |             } else if (VERBATIM_TAGS.indexOf(nodeName) === -1) {
 1028 |               value = lastChild.nodeValue
 1029 |                 .replace(leadingSpaceRegex, ' ')
 1030 |                 .replace(leadingNewlineRegex, '')
 1031 |                 .replace(trailingNewlineRegex, ' ')
 1032 |                 .replace(multiSpaceRegex, ' ')
 1033 |               lastChild.nodeValue = value
 1034 |             }
 1035 |           }
 1036 |     
 1037 |           // Store the last nodename
 1038 |           var _nodeName = node.nodeName
 1039 |           if (_nodeName) nodeName = _nodeName.toLowerCase()
 1040 |     
 1041 |           // Append the node to the DOM
 1042 |           el.appendChild(node)
 1043 |         }
 1044 |       }
 1045 |     }
 1046 |     
 1047 |     },{}],13:[function(require,module,exports){
 1048 |     'use strict'
 1049 |     
 1050 |     module.exports = [
 1051 |       'async', 'autofocus', 'autoplay', 'checked', 'controls', 'default',
 1052 |       'defaultchecked', 'defer', 'disabled', 'formnovalidate', 'hidden',
 1053 |       'ismap', 'loop', 'multiple', 'muted', 'novalidate', 'open', 'playsinline',
 1054 |       'readonly', 'required', 'reversed', 'selected'
 1055 |     ]
 1056 |     
 1057 |     },{}],14:[function(require,module,exports){
 1058 |     module.exports = require('./dom')(document)
 1059 |     
 1060 |     },{"./dom":16}],15:[function(require,module,exports){
 1061 |     'use strict'
 1062 |     
 1063 |     module.exports = [
 1064 |       'indeterminate'
 1065 |     ]
 1066 |     
 1067 |     },{}],16:[function(require,module,exports){
 1068 |     'use strict'
 1069 |     
 1070 |     var hyperx = require('hyperx')
 1071 |     var appendChild = require('./append-child')
 1072 |     var SVG_TAGS = require('./svg-tags')
 1073 |     var BOOL_PROPS = require('./bool-props')
 1074 |     // Props that need to be set directly rather than with el.setAttribute()
 1075 |     var DIRECT_PROPS = require('./direct-props')
 1076 |     
 1077 |     var SVGNS = 'http://www.w3.org/2000/svg'
 1078 |     var XLINKNS = 'http://www.w3.org/1999/xlink'
 1079 |     
 1080 |     var COMMENT_TAG = '!--'
 1081 |     
 1082 |     module.exports = function (document) {
 1083 |       function nanoHtmlCreateElement (tag, props, children) {
 1084 |         var el
 1085 |     
 1086 |         // If an svg tag, it needs a namespace
 1087 |         if (SVG_TAGS.indexOf(tag) !== -1) {
 1088 |           props.namespace = SVGNS
 1089 |         }
 1090 |     
 1091 |         // If we are using a namespace
 1092 |         var ns = false
 1093 |         if (props.namespace) {
 1094 |           ns = props.namespace
 1095 |           delete props.namespace
 1096 |         }
 1097 |     
 1098 |         // If we are extending a builtin element
 1099 |         var isCustomElement = false
 1100 |         if (props.is) {
 1101 |           isCustomElement = props.is
 1102 |           delete props.is
 1103 |         }
 1104 |     
 1105 |         // Create the element
 1106 |         if (ns) {
 1107 |           if (isCustomElement) {
 1108 |             el = document.createElementNS(ns, tag, { is: isCustomElement })
 1109 |           } else {
 1110 |             el = document.createElementNS(ns, tag)
 1111 |           }
 1112 |         } else if (tag === COMMENT_TAG) {
 1113 |           return document.createComment(props.comment)
 1114 |         } else if (isCustomElement) {
 1115 |           el = document.createElement(tag, { is: isCustomElement })
 1116 |         } else {
 1117 |           el = document.createElement(tag)
 1118 |         }
 1119 |     
 1120 |         // Create the properties
 1121 |         for (var p in props) {
 1122 |           if (props.hasOwnProperty(p)) {
 1123 |             var key = p.toLowerCase()
 1124 |             var val = props[p]
 1125 |             // Normalize className
 1126 |             if (key === 'classname') {
 1127 |               key = 'class'
 1128 |               p = 'class'
 1129 |             }
 1130 |             // The for attribute gets transformed to htmlFor, but we just set as for
 1131 |             if (p === 'htmlFor') {
 1132 |               p = 'for'
 1133 |             }
 1134 |             // If a property is boolean, set itself to the key
 1135 |             if (BOOL_PROPS.indexOf(key) !== -1) {
 1136 |               if (String(val) === 'true') val = key
 1137 |               else if (String(val) === 'false') continue
 1138 |             }
 1139 |             // If a property prefers being set directly vs setAttribute
 1140 |             if (key.slice(0, 2) === 'on' || DIRECT_PROPS.indexOf(key) !== -1) {
 1141 |               el[p] = val
 1142 |             } else {
 1143 |               if (ns) {
 1144 |                 if (p === 'xlink:href') {
 1145 |                   el.setAttributeNS(XLINKNS, p, val)
 1146 |                 } else if (/^xmlns($|:)/i.test(p)) {
 1147 |                   // skip xmlns definitions
 1148 |                 } else {
 1149 |                   el.setAttributeNS(null, p, val)
 1150 |                 }
 1151 |               } else {
 1152 |                 el.setAttribute(p, val)
 1153 |               }
 1154 |             }
 1155 |           }
 1156 |         }
 1157 |     
 1158 |         appendChild(el, children)
 1159 |         return el
 1160 |       }
 1161 |     
 1162 |       function createFragment (nodes) {
 1163 |         var fragment = document.createDocumentFragment()
 1164 |         for (var i = 0; i < nodes.length; i++) {
 1165 |           if (nodes[i] == null) continue
 1166 |           if (Array.isArray(nodes[i])) {
 1167 |             fragment.appendChild(createFragment(nodes[i]))
 1168 |           } else {
 1169 |             if (typeof nodes[i] === 'string') nodes[i] = document.createTextNode(nodes[i])
 1170 |             fragment.appendChild(nodes[i])
 1171 |           }
 1172 |         }
 1173 |         return fragment
 1174 |       }
 1175 |     
 1176 |       var exports = hyperx(nanoHtmlCreateElement, {
 1177 |         comments: true,
 1178 |         createFragment: createFragment
 1179 |       })
 1180 |       exports.default = exports
 1181 |       exports.createComment = nanoHtmlCreateElement
 1182 |       return exports
 1183 |     }
 1184 |     
 1185 |     },{"./append-child":12,"./bool-props":13,"./direct-props":15,"./svg-tags":18,"hyperx":8}],17:[function(require,module,exports){
 1186 |     'use strict'
 1187 |     
 1188 |     function nanohtmlRawBrowser (tag) {
 1189 |       var el = document.createElement('div')
 1190 |       el.innerHTML = tag
 1191 |       return toArray(el.childNodes)
 1192 |     }
 1193 |     
 1194 |     function toArray (arr) {
 1195 |       return Array.isArray(arr) ? arr : [].slice.call(arr)
 1196 |     }
 1197 |     
 1198 |     module.exports = nanohtmlRawBrowser
 1199 |     
 1200 |     },{}],18:[function(require,module,exports){
 1201 |     'use strict'
 1202 |     
 1203 |     module.exports = [
 1204 |       'svg', 'altGlyph', 'altGlyphDef', 'altGlyphItem', 'animate', 'animateColor',
 1205 |       'animateMotion', 'animateTransform', 'circle', 'clipPath', 'color-profile',
 1206 |       'cursor', 'defs', 'desc', 'ellipse', 'feBlend', 'feColorMatrix',
 1207 |       'feComponentTransfer', 'feComposite', 'feConvolveMatrix',
 1208 |       'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feFlood',
 1209 |       'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage',
 1210 |       'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight',
 1211 |       'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence', 'filter',
 1212 |       'font', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src',
 1213 |       'font-face-uri', 'foreignObject', 'g', 'glyph', 'glyphRef', 'hkern', 'image',
 1214 |       'line', 'linearGradient', 'marker', 'mask', 'metadata', 'missing-glyph',
 1215 |       'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialGradient', 'rect',
 1216 |       'set', 'stop', 'switch', 'symbol', 'text', 'textPath', 'title', 'tref',
 1217 |       'tspan', 'use', 'view', 'vkern'
 1218 |     ]
 1219 |     
 1220 |     },{}],19:[function(require,module,exports){
 1221 |     module.exports = LRU
 1222 |     
 1223 |     function LRU (opts) {
 1224 |       if (!(this instanceof LRU)) return new LRU(opts)
 1225 |       if (typeof opts === 'number') opts = {max: opts}
 1226 |       if (!opts) opts = {}
 1227 |       this.cache = {}
 1228 |       this.head = this.tail = null
 1229 |       this.length = 0
 1230 |       this.max = opts.max || 1000
 1231 |       this.maxAge = opts.maxAge || 0
 1232 |     }
 1233 |     
 1234 |     Object.defineProperty(LRU.prototype, 'keys', {
 1235 |       get: function () { return Object.keys(this.cache) }
 1236 |     })
 1237 |     
 1238 |     LRU.prototype.clear = function () {
 1239 |       this.cache = {}
 1240 |       this.head = this.tail = null
 1241 |       this.length = 0
 1242 |     }
 1243 |     
 1244 |     LRU.prototype.remove = function (key) {
 1245 |       if (typeof key !== 'string') key = '' + key
 1246 |       if (!this.cache.hasOwnProperty(key)) return
 1247 |     
 1248 |       var element = this.cache[key]
 1249 |       delete this.cache[key]
 1250 |       this._unlink(key, element.prev, element.next)
 1251 |       return element.value
 1252 |     }
 1253 |     
 1254 |     LRU.prototype._unlink = function (key, prev, next) {
 1255 |       this.length--
 1256 |     
 1257 |       if (this.length === 0) {
 1258 |         this.head = this.tail = null
 1259 |       } else {
 1260 |         if (this.head === key) {
 1261 |           this.head = prev
 1262 |           this.cache[this.head].next = null
 1263 |         } else if (this.tail === key) {
 1264 |           this.tail = next
 1265 |           this.cache[this.tail].prev = null
 1266 |         } else {
 1267 |           this.cache[prev].next = next
 1268 |           this.cache[next].prev = prev
 1269 |         }
 1270 |       }
 1271 |     }
 1272 |     
 1273 |     LRU.prototype.peek = function (key) {
 1274 |       if (!this.cache.hasOwnProperty(key)) return
 1275 |     
 1276 |       var element = this.cache[key]
 1277 |     
 1278 |       if (!this._checkAge(key, element)) return
 1279 |       return element.value
 1280 |     }
 1281 |     
 1282 |     LRU.prototype.set = function (key, value) {
 1283 |       if (typeof key !== 'string') key = '' + key
 1284 |     
 1285 |       var element
 1286 |     
 1287 |       if (this.cache.hasOwnProperty(key)) {
 1288 |         element = this.cache[key]
 1289 |         element.value = value
 1290 |         if (this.maxAge) element.modified = Date.now()
 1291 |     
 1292 |         // If it's already the head, there's nothing more to do:
 1293 |         if (key === this.head) return value
 1294 |         this._unlink(key, element.prev, element.next)
 1295 |       } else {
 1296 |         element = {value: value, modified: 0, next: null, prev: null}
 1297 |         if (this.maxAge) element.modified = Date.now()
 1298 |         this.cache[key] = element
 1299 |     
 1300 |         // Eviction is only possible if the key didn't already exist:
 1301 |         if (this.length === this.max) this.evict()
 1302 |       }
 1303 |     
 1304 |       this.length++
 1305 |       element.next = null
 1306 |       element.prev = this.head
 1307 |     
 1308 |       if (this.head) this.cache[this.head].next = key
 1309 |       this.head = key
 1310 |     
 1311 |       if (!this.tail) this.tail = key
 1312 |       return value
 1313 |     }
 1314 |     
 1315 |     LRU.prototype._checkAge = function (key, element) {
 1316 |       if (this.maxAge && (Date.now() - element.modified) > this.maxAge) {
 1317 |         this.remove(key)
 1318 |         return false
 1319 |       }
 1320 |       return true
 1321 |     }
 1322 |     
 1323 |     LRU.prototype.get = function (key) {
 1324 |       if (typeof key !== 'string') key = '' + key
 1325 |       if (!this.cache.hasOwnProperty(key)) return
 1326 |     
 1327 |       var element = this.cache[key]
 1328 |     
 1329 |       if (!this._checkAge(key, element)) return
 1330 |     
 1331 |       if (this.head !== key) {
 1332 |         if (key === this.tail) {
 1333 |           this.tail = element.next
 1334 |           this.cache[this.tail].prev = null
 1335 |         } else {
 1336 |           // Set prev.next -> element.next:
 1337 |           this.cache[element.prev].next = element.next
 1338 |         }
 1339 |     
 1340 |         // Set element.next.prev -> element.prev:
 1341 |         this.cache[element.next].prev = element.prev
 1342 |     
 1343 |         // Element is the new head
 1344 |         this.cache[this.head].next = key
 1345 |         element.prev = this.head
 1346 |         element.next = null
 1347 |         this.head = key
 1348 |       }
 1349 |     
 1350 |       return element.value
 1351 |     }
 1352 |     
 1353 |     LRU.prototype.evict = function () {
 1354 |       if (!this.tail) return
 1355 |       this.remove(this.tail)
 1356 |     }
 1357 |     
 1358 |     },{}],20:[function(require,module,exports){
 1359 |     var assert = require('nanoassert')
 1360 |     var morph = require('./lib/morph')
 1361 |     
 1362 |     var TEXT_NODE = 3
 1363 |     // var DEBUG = false
 1364 |     
 1365 |     module.exports = nanomorph
 1366 |     
 1367 |     // Morph one tree into another tree
 1368 |     //
 1369 |     // no parent
 1370 |     //   -> same: diff and walk children
 1371 |     //   -> not same: replace and return
 1372 |     // old node doesn't exist
 1373 |     //   -> insert new node
 1374 |     // new node doesn't exist
 1375 |     //   -> delete old node
 1376 |     // nodes are not the same
 1377 |     //   -> diff nodes and apply patch to old node
 1378 |     // nodes are the same
 1379 |     //   -> walk all child nodes and append to old node
 1380 |     function nanomorph (oldTree, newTree, options) {
 1381 |       // if (DEBUG) {
 1382 |       //   console.log(
 1383 |       //   'nanomorph\nold\n  %s\nnew\n  %s',
 1384 |       //   oldTree && oldTree.outerHTML,
 1385 |       //   newTree && newTree.outerHTML
 1386 |       // )
 1387 |       // }
 1388 |       assert.equal(typeof oldTree, 'object', 'nanomorph: oldTree should be an object')
 1389 |       assert.equal(typeof newTree, 'object', 'nanomorph: newTree should be an object')
 1390 |     
 1391 |       if (options && options.childrenOnly) {
 1392 |         updateChildren(newTree, oldTree)
 1393 |         return oldTree
 1394 |       }
 1395 |     
 1396 |       assert.notEqual(
 1397 |         newTree.nodeType,
 1398 |         11,
 1399 |         'nanomorph: newTree should have one root node (which is not a DocumentFragment)'
 1400 |       )
 1401 |     
 1402 |       return walk(newTree, oldTree)
 1403 |     }
 1404 |     
 1405 |     // Walk and morph a dom tree
 1406 |     function walk (newNode, oldNode) {
 1407 |       // if (DEBUG) {
 1408 |       //   console.log(
 1409 |       //   'walk\nold\n  %s\nnew\n  %s',
 1410 |       //   oldNode && oldNode.outerHTML,
 1411 |       //   newNode && newNode.outerHTML
 1412 |       // )
 1413 |       // }
 1414 |       if (!oldNode) {
 1415 |         return newNode
 1416 |       } else if (!newNode) {
 1417 |         return null
 1418 |       } else if (newNode.isSameNode && newNode.isSameNode(oldNode)) {
 1419 |         return oldNode
 1420 |       } else if (newNode.tagName !== oldNode.tagName || getComponentId(newNode) !== getComponentId(oldNode)) {
 1421 |         return newNode
 1422 |       } else {
 1423 |         morph(newNode, oldNode)
 1424 |         updateChildren(newNode, oldNode)
 1425 |         return oldNode
 1426 |       }
 1427 |     }
 1428 |     
 1429 |     function getComponentId (node) {
 1430 |       return node.dataset ? node.dataset.nanomorphComponentId : undefined
 1431 |     }
 1432 |     
 1433 |     // Update the children of elements
 1434 |     // (obj, obj) -> null
 1435 |     function updateChildren (newNode, oldNode) {
 1436 |       // if (DEBUG) {
 1437 |       //   console.log(
 1438 |       //   'updateChildren\nold\n  %s\nnew\n  %s',
 1439 |       //   oldNode && oldNode.outerHTML,
 1440 |       //   newNode && newNode.outerHTML
 1441 |       // )
 1442 |       // }
 1443 |       var oldChild, newChild, morphed, oldMatch
 1444 |     
 1445 |       // The offset is only ever increased, and used for [i - offset] in the loop
 1446 |       var offset = 0
 1447 |     
 1448 |       for (var i = 0; ; i++) {
 1449 |         oldChild = oldNode.childNodes[i]
 1450 |         newChild = newNode.childNodes[i - offset]
 1451 |         // if (DEBUG) {
 1452 |         //   console.log(
 1453 |         //   '===\n- old\n  %s\n- new\n  %s',
 1454 |         //   oldChild && oldChild.outerHTML,
 1455 |         //   newChild && newChild.outerHTML
 1456 |         // )
 1457 |         // }
 1458 |         // Both nodes are empty, do nothing
 1459 |         if (!oldChild && !newChild) {
 1460 |           break
 1461 |     
 1462 |         // There is no new child, remove old
 1463 |         } else if (!newChild) {
 1464 |           oldNode.removeChild(oldChild)
 1465 |           i--
 1466 |     
 1467 |         // There is no old child, add new
 1468 |         } else if (!oldChild) {
 1469 |           oldNode.appendChild(newChild)
 1470 |           offset++
 1471 |     
 1472 |         // Both nodes are the same, morph
 1473 |         } else if (same(newChild, oldChild)) {
 1474 |           morphed = walk(newChild, oldChild)
 1475 |           if (morphed !== oldChild) {
 1476 |             oldNode.replaceChild(morphed, oldChild)
 1477 |             offset++
 1478 |           }
 1479 |     
 1480 |         // Both nodes do not share an ID or a placeholder, try reorder
 1481 |         } else {
 1482 |           oldMatch = null
 1483 |     
 1484 |           // Try and find a similar node somewhere in the tree
 1485 |           for (var j = i; j < oldNode.childNodes.length; j++) {
 1486 |             if (same(oldNode.childNodes[j], newChild)) {
 1487 |               oldMatch = oldNode.childNodes[j]
 1488 |               break
 1489 |             }
 1490 |           }
 1491 |     
 1492 |           // If there was a node with the same ID or placeholder in the old list
 1493 |           if (oldMatch) {
 1494 |             morphed = walk(newChild, oldMatch)
 1495 |             if (morphed !== oldMatch) offset++
 1496 |             oldNode.insertBefore(morphed, oldChild)
 1497 |     
 1498 |           // It's safe to morph two nodes in-place if neither has an ID
 1499 |           } else if (!newChild.id && !oldChild.id) {
 1500 |             morphed = walk(newChild, oldChild)
 1501 |             if (morphed !== oldChild) {
 1502 |               oldNode.replaceChild(morphed, oldChild)
 1503 |               offset++
 1504 |             }
 1505 |     
 1506 |           // Insert the node at the index if we couldn't morph or find a matching node
 1507 |           } else {
 1508 |             oldNode.insertBefore(newChild, oldChild)
 1509 |             offset++
 1510 |           }
 1511 |         }
 1512 |       }
 1513 |     }
 1514 |     
 1515 |     function same (a, b) {
 1516 |       if (a.id) return a.id === b.id
 1517 |       if (a.isSameNode) return a.isSameNode(b)
 1518 |       if (a.tagName !== b.tagName) return false
 1519 |       if (a.type === TEXT_NODE) return a.nodeValue === b.nodeValue
 1520 |       return false
 1521 |     }
 1522 |     
 1523 |     },{"./lib/morph":22,"nanoassert":9}],21:[function(require,module,exports){
 1524 |     module.exports = [
 1525 |       // attribute events (can be set with attributes)
 1526 |       'onclick',
 1527 |       'ondblclick',
 1528 |       'onmousedown',
 1529 |       'onmouseup',
 1530 |       'onmouseover',
 1531 |       'onmousemove',
 1532 |       'onmouseout',
 1533 |       'onmouseenter',
 1534 |       'onmouseleave',
 1535 |       'ontouchcancel',
 1536 |       'ontouchend',
 1537 |       'ontouchmove',
 1538 |       'ontouchstart',
 1539 |       'ondragstart',
 1540 |       'ondrag',
 1541 |       'ondragenter',
 1542 |       'ondragleave',
 1543 |       'ondragover',
 1544 |       'ondrop',
 1545 |       'ondragend',
 1546 |       'onkeydown',
 1547 |       'onkeypress',
 1548 |       'onkeyup',
 1549 |       'onunload',
 1550 |       'onabort',
 1551 |       'onerror',
 1552 |       'onresize',
 1553 |       'onscroll',
 1554 |       'onselect',
 1555 |       'onchange',
 1556 |       'onsubmit',
 1557 |       'onreset',
 1558 |       'onfocus',
 1559 |       'onblur',
 1560 |       'oninput',
 1561 |       'onanimationend',
 1562 |       'onanimationiteration',
 1563 |       'onanimationstart',
 1564 |       // other common events
 1565 |       'oncontextmenu',
 1566 |       'onfocusin',
 1567 |       'onfocusout'
 1568 |     ]
 1569 |     
 1570 |     },{}],22:[function(require,module,exports){
 1571 |     var events = require('./events')
 1572 |     var eventsLength = events.length
 1573 |     
 1574 |     var ELEMENT_NODE = 1
 1575 |     var TEXT_NODE = 3
 1576 |     var COMMENT_NODE = 8
 1577 |     
 1578 |     module.exports = morph
 1579 |     
 1580 |     // diff elements and apply the resulting patch to the old node
 1581 |     // (obj, obj) -> null
 1582 |     function morph (newNode, oldNode) {
 1583 |       var nodeType = newNode.nodeType
 1584 |       var nodeName = newNode.nodeName
 1585 |     
 1586 |       if (nodeType === ELEMENT_NODE) {
 1587 |         copyAttrs(newNode, oldNode)
 1588 |       }
 1589 |     
 1590 |       if (nodeType === TEXT_NODE || nodeType === COMMENT_NODE) {
 1591 |         if (oldNode.nodeValue !== newNode.nodeValue) {
 1592 |           oldNode.nodeValue = newNode.nodeValue
 1593 |         }
 1594 |       }
 1595 |     
 1596 |       // Some DOM nodes are weird
 1597 |       // https://github.com/patrick-steele-idem/morphdom/blob/master/src/specialElHandlers.js
 1598 |       if (nodeName === 'INPUT') updateInput(newNode, oldNode)
 1599 |       else if (nodeName === 'OPTION') updateOption(newNode, oldNode)
 1600 |       else if (nodeName === 'TEXTAREA') updateTextarea(newNode, oldNode)
 1601 |     
 1602 |       copyEvents(newNode, oldNode)
 1603 |     }
 1604 |     
 1605 |     function copyAttrs (newNode, oldNode) {
 1606 |       var oldAttrs = oldNode.attributes
 1607 |       var newAttrs = newNode.attributes
 1608 |       var attrNamespaceURI = null
 1609 |       var attrValue = null
 1610 |       var fromValue = null
 1611 |       var attrName = null
 1612 |       var attr = null
 1613 |     
 1614 |       for (var i = newAttrs.length - 1; i >= 0; --i) {
 1615 |         attr = newAttrs[i]
 1616 |         attrName = attr.name
 1617 |         attrNamespaceURI = attr.namespaceURI
 1618 |         attrValue = attr.value
 1619 |         if (attrNamespaceURI) {
 1620 |           attrName = attr.localName || attrName
 1621 |           fromValue = oldNode.getAttributeNS(attrNamespaceURI, attrName)
 1622 |           if (fromValue !== attrValue) {
 1623 |             oldNode.setAttributeNS(attrNamespaceURI, attrName, attrValue)
 1624 |           }
 1625 |         } else {
 1626 |           if (!oldNode.hasAttribute(attrName)) {
 1627 |             oldNode.setAttribute(attrName, attrValue)
 1628 |           } else {
 1629 |             fromValue = oldNode.getAttribute(attrName)
 1630 |             if (fromValue !== attrValue) {
 1631 |               // apparently values are always cast to strings, ah well
 1632 |               if (attrValue === 'null' || attrValue === 'undefined') {
 1633 |                 oldNode.removeAttribute(attrName)
 1634 |               } else {
 1635 |                 oldNode.setAttribute(attrName, attrValue)
 1636 |               }
 1637 |             }
 1638 |           }
 1639 |         }
 1640 |       }
 1641 |     
 1642 |       // Remove any extra attributes found on the original DOM element that
 1643 |       // weren't found on the target element.
 1644 |       for (var j = oldAttrs.length - 1; j >= 0; --j) {
 1645 |         attr = oldAttrs[j]
 1646 |         if (attr.specified !== false) {
 1647 |           attrName = attr.name
 1648 |           attrNamespaceURI = attr.namespaceURI
 1649 |     
 1650 |           if (attrNamespaceURI) {
 1651 |             attrName = attr.localName || attrName
 1652 |             if (!newNode.hasAttributeNS(attrNamespaceURI, attrName)) {
 1653 |               oldNode.removeAttributeNS(attrNamespaceURI, attrName)
 1654 |             }
 1655 |           } else {
 1656 |             if (!newNode.hasAttributeNS(null, attrName)) {
 1657 |               oldNode.removeAttribute(attrName)
 1658 |             }
 1659 |           }
 1660 |         }
 1661 |       }
 1662 |     }
 1663 |     
 1664 |     function copyEvents (newNode, oldNode) {
 1665 |       for (var i = 0; i < eventsLength; i++) {
 1666 |         var ev = events[i]
 1667 |         if (newNode[ev]) {           // if new element has a whitelisted attribute
 1668 |           oldNode[ev] = newNode[ev]  // update existing element
 1669 |         } else if (oldNode[ev]) {    // if existing element has it and new one doesnt
 1670 |           oldNode[ev] = undefined    // remove it from existing element
 1671 |         }
 1672 |       }
 1673 |     }
 1674 |     
 1675 |     function updateOption (newNode, oldNode) {
 1676 |       updateAttribute(newNode, oldNode, 'selected')
 1677 |     }
 1678 |     
 1679 |     // The "value" attribute is special for the <input> element since it sets the
 1680 |     // initial value. Changing the "value" attribute without changing the "value"
 1681 |     // property will have no effect since it is only used to the set the initial
 1682 |     // value. Similar for the "checked" attribute, and "disabled".
 1683 |     function updateInput (newNode, oldNode) {
 1684 |       var newValue = newNode.value
 1685 |       var oldValue = oldNode.value
 1686 |     
 1687 |       updateAttribute(newNode, oldNode, 'checked')
 1688 |       updateAttribute(newNode, oldNode, 'disabled')
 1689 |     
 1690 |       // The "indeterminate" property can not be set using an HTML attribute.
 1691 |       // See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox
 1692 |       if (newNode.indeterminate !== oldNode.indeterminate) {
 1693 |         oldNode.indeterminate = newNode.indeterminate
 1694 |       }
 1695 |     
 1696 |       // Persist file value since file inputs can't be changed programatically
 1697 |       if (oldNode.type === 'file') return
 1698 |     
 1699 |       if (newValue !== oldValue) {
 1700 |         oldNode.setAttribute('value', newValue)
 1701 |         oldNode.value = newValue
 1702 |       }
 1703 |     
 1704 |       if (newValue === 'null') {
 1705 |         oldNode.value = ''
 1706 |         oldNode.removeAttribute('value')
 1707 |       }
 1708 |     
 1709 |       if (!newNode.hasAttributeNS(null, 'value')) {
 1710 |         oldNode.removeAttribute('value')
 1711 |       } else if (oldNode.type === 'range') {
 1712 |         // this is so elements like slider move their UI thingy
 1713 |         oldNode.value = newValue
 1714 |       }
 1715 |     }
 1716 |     
 1717 |     function updateTextarea (newNode, oldNode) {
 1718 |       var newValue = newNode.value
 1719 |       if (newValue !== oldNode.value) {
 1720 |         oldNode.value = newValue
 1721 |       }
 1722 |     
 1723 |       if (oldNode.firstChild && oldNode.firstChild.nodeValue !== newValue) {
 1724 |         // Needed for IE. Apparently IE sets the placeholder as the
 1725 |         // node value and vise versa. This ignores an empty update.
 1726 |         if (newValue === '' && oldNode.firstChild.nodeValue === oldNode.placeholder) {
 1727 |           return
 1728 |         }
 1729 |     
 1730 |         oldNode.firstChild.nodeValue = newValue
 1731 |       }
 1732 |     }
 1733 |     
 1734 |     function updateAttribute (newNode, oldNode, name) {
 1735 |       if (newNode[name] !== oldNode[name]) {
 1736 |         oldNode[name] = newNode[name]
 1737 |         if (newNode[name]) {
 1738 |           oldNode.setAttribute(name, '')
 1739 |         } else {
 1740 |           oldNode.removeAttribute(name)
 1741 |         }
 1742 |       }
 1743 |     }
 1744 |     
 1745 |     },{"./events":21}],23:[function(require,module,exports){
 1746 |     var reg = /([^?=&]+)(=([^&]*))?/g
 1747 |     var assert = require('assert')
 1748 |     
 1749 |     module.exports = qs
 1750 |     
 1751 |     function qs (url) {
 1752 |       assert.equal(typeof url, 'string', 'nanoquery: url should be type string')
 1753 |     
 1754 |       var obj = {}
 1755 |       url.replace(/^.*\?/, '').replace(reg, function (a0, a1, a2, a3) {
 1756 |         var value = decodeURIComponent(a3)
 1757 |         var key = decodeURIComponent(a1)
 1758 |         if (obj.hasOwnProperty(key)) {
 1759 |           if (Array.isArray(obj[key])) obj[key].push(value)
 1760 |           else obj[key] = [obj[key], value]
 1761 |         } else {
 1762 |           obj[key] = value
 1763 |         }
 1764 |       })
 1765 |     
 1766 |       return obj
 1767 |     }
 1768 |     
 1769 |     },{"assert":9}],24:[function(require,module,exports){
 1770 |     'use strict'
 1771 |     
 1772 |     var assert = require('assert')
 1773 |     
 1774 |     module.exports = nanoraf
 1775 |     
 1776 |     // Only call RAF when needed
 1777 |     // (fn, fn?) -> fn
 1778 |     function nanoraf (render, raf) {
 1779 |       assert.equal(typeof render, 'function', 'nanoraf: render should be a function')
 1780 |       assert.ok(typeof raf === 'function' || typeof raf === 'undefined', 'nanoraf: raf should be a function or undefined')
 1781 |     
 1782 |       if (!raf) raf = window.requestAnimationFrame
 1783 |       var redrawScheduled = false
 1784 |       var args = null
 1785 |     
 1786 |       return function frame () {
 1787 |         if (args === null && !redrawScheduled) {
 1788 |           redrawScheduled = true
 1789 |     
 1790 |           raf(function redraw () {
 1791 |             redrawScheduled = false
 1792 |     
 1793 |             var length = args.length
 1794 |             var _args = new Array(length)
 1795 |             for (var i = 0; i < length; i++) _args[i] = args[i]
 1796 |     
 1797 |             render.apply(render, _args)
 1798 |             args = null
 1799 |           })
 1800 |         }
 1801 |     
 1802 |         args = arguments
 1803 |       }
 1804 |     }
 1805 |     
 1806 |     },{"assert":9}],25:[function(require,module,exports){
 1807 |     var assert = require('assert')
 1808 |     var wayfarer = require('wayfarer')
 1809 |     
 1810 |     // electron support
 1811 |     var isLocalFile = (/file:\/\//.test(
 1812 |       typeof window === 'object' &&
 1813 |       window.location &&
 1814 |       window.location.origin
 1815 |     ))
 1816 |     
 1817 |     /* eslint-disable no-useless-escape */
 1818 |     var electron = '^(file:\/\/|\/)(.*\.html?\/?)?'
 1819 |     var protocol = '^(http(s)?(:\/\/))?(www\.)?'
 1820 |     var domain = '[a-zA-Z0-9-_\.]+(:[0-9]{1,5})?(\/{1})?'
 1821 |     var qs = '[\?].*$'
 1822 |     /* eslint-enable no-useless-escape */
 1823 |     
 1824 |     var stripElectron = new RegExp(electron)
 1825 |     var prefix = new RegExp(protocol + domain)
 1826 |     var normalize = new RegExp('#')
 1827 |     var suffix = new RegExp(qs)
 1828 |     
 1829 |     module.exports = Nanorouter
 1830 |     
 1831 |     function Nanorouter (opts) {
 1832 |       if (!(this instanceof Nanorouter)) return new Nanorouter(opts)
 1833 |       opts = opts || {}
 1834 |       this.router = wayfarer(opts.default || '/404')
 1835 |     }
 1836 |     
 1837 |     Nanorouter.prototype.on = function (routename, listener) {
 1838 |       assert.equal(typeof routename, 'string')
 1839 |       routename = routename.replace(/^[#/]/, '')
 1840 |       this.router.on(routename, listener)
 1841 |     }
 1842 |     
 1843 |     Nanorouter.prototype.emit = function (routename) {
 1844 |       assert.equal(typeof routename, 'string')
 1845 |       routename = pathname(routename, isLocalFile)
 1846 |       return this.router.emit(routename)
 1847 |     }
 1848 |     
 1849 |     Nanorouter.prototype.match = function (routename) {
 1850 |       assert.equal(typeof routename, 'string')
 1851 |       routename = pathname(routename, isLocalFile)
 1852 |       return this.router.match(routename)
 1853 |     }
 1854 |     
 1855 |     // replace everything in a route but the pathname and hash
 1856 |     function pathname (routename, isElectron) {
 1857 |       if (isElectron) routename = routename.replace(stripElectron, '')
 1858 |       else routename = routename.replace(prefix, '')
 1859 |       return decodeURI(routename.replace(suffix, '').replace(normalize, '/'))
 1860 |     }
 1861 |     
 1862 |     },{"assert":9,"wayfarer":30}],26:[function(require,module,exports){
 1863 |     var assert = require('assert')
 1864 |     
 1865 |     var hasWindow = typeof window !== 'undefined'
 1866 |     
 1867 |     function createScheduler () {
 1868 |       var scheduler
 1869 |       if (hasWindow) {
 1870 |         if (!window._nanoScheduler) window._nanoScheduler = new NanoScheduler(true)
 1871 |         scheduler = window._nanoScheduler
 1872 |       } else {
 1873 |         scheduler = new NanoScheduler()
 1874 |       }
 1875 |       return scheduler
 1876 |     }
 1877 |     
 1878 |     function NanoScheduler (hasWindow) {
 1879 |       this.hasWindow = hasWindow
 1880 |       this.hasIdle = this.hasWindow && window.requestIdleCallback
 1881 |       this.method = this.hasIdle ? window.requestIdleCallback.bind(window) : this.setTimeout
 1882 |       this.scheduled = false
 1883 |       this.queue = []
 1884 |     }
 1885 |     
 1886 |     NanoScheduler.prototype.push = function (cb) {
 1887 |       assert.equal(typeof cb, 'function', 'nanoscheduler.push: cb should be type function')
 1888 |     
 1889 |       this.queue.push(cb)
 1890 |       this.schedule()
 1891 |     }
 1892 |     
 1893 |     NanoScheduler.prototype.schedule = function () {
 1894 |       if (this.scheduled) return
 1895 |     
 1896 |       this.scheduled = true
 1897 |       var self = this
 1898 |       this.method(function (idleDeadline) {
 1899 |         var cb
 1900 |         while (self.queue.length && idleDeadline.timeRemaining() > 0) {
 1901 |           cb = self.queue.shift()
 1902 |           cb(idleDeadline)
 1903 |         }
 1904 |         self.scheduled = false
 1905 |         if (self.queue.length) self.schedule()
 1906 |       })
 1907 |     }
 1908 |     
 1909 |     NanoScheduler.prototype.setTimeout = function (cb) {
 1910 |       setTimeout(cb, 0, {
 1911 |         timeRemaining: function () {
 1912 |           return 1
 1913 |         }
 1914 |       })
 1915 |     }
 1916 |     
 1917 |     module.exports = createScheduler
 1918 |     
 1919 |     },{"assert":9}],27:[function(require,module,exports){
 1920 |     var scheduler = require('nanoscheduler')()
 1921 |     var assert = require('assert')
 1922 |     
 1923 |     var perf
 1924 |     nanotiming.disabled = true
 1925 |     try {
 1926 |       perf = window.performance
 1927 |       nanotiming.disabled = window.localStorage.DISABLE_NANOTIMING === 'true' || !perf.mark
 1928 |     } catch (e) { }
 1929 |     
 1930 |     module.exports = nanotiming
 1931 |     
 1932 |     function nanotiming (name) {
 1933 |       assert.equal(typeof name, 'string', 'nanotiming: name should be type string')
 1934 |     
 1935 |       if (nanotiming.disabled) return noop
 1936 |     
 1937 |       var uuid = (perf.now() * 10000).toFixed() % Number.MAX_SAFE_INTEGER
 1938 |       var startName = 'start-' + uuid + '-' + name
 1939 |       perf.mark(startName)
 1940 |     
 1941 |       function end (cb) {
 1942 |         var endName = 'end-' + uuid + '-' + name
 1943 |         perf.mark(endName)
 1944 |     
 1945 |         scheduler.push(function () {
 1946 |           var err = null
 1947 |           try {
 1948 |             var measureName = name + ' [' + uuid + ']'
 1949 |             perf.measure(measureName, startName, endName)
 1950 |             perf.clearMarks(startName)
 1951 |             perf.clearMarks(endName)
 1952 |           } catch (e) { err = e }
 1953 |           if (cb) cb(err, name)
 1954 |         })
 1955 |       }
 1956 |     
 1957 |       end.uuid = uuid
 1958 |       return end
 1959 |     }
 1960 |     
 1961 |     function noop (cb) {
 1962 |       if (cb) {
 1963 |         scheduler.push(function () {
 1964 |           cb(new Error('nanotiming: performance API unavailable'))
 1965 |         })
 1966 |       }
 1967 |     }
 1968 |     
 1969 |     },{"assert":9,"nanoscheduler":26}],28:[function(require,module,exports){
 1970 |     'use strict'
 1971 |     
 1972 |     /**
 1973 |      * Remove a range of items from an array
 1974 |      *
 1975 |      * @function removeItems
 1976 |      * @param {Array<*>} arr The target array
 1977 |      * @param {number} startIdx The index to begin removing from (inclusive)
 1978 |      * @param {number} removeCount How many items to remove
 1979 |      */
 1980 |     module.exports = function removeItems (arr, startIdx, removeCount) {
 1981 |       var i, length = arr.length
 1982 |     
 1983 |       if (startIdx >= length || removeCount === 0) {
 1984 |         return
 1985 |       }
 1986 |     
 1987 |       removeCount = (startIdx + removeCount > length ? length - startIdx : removeCount)
 1988 |     
 1989 |       var len = length - removeCount
 1990 |     
 1991 |       for (i = startIdx; i < len; ++i) {
 1992 |         arr[i] = arr[i + removeCount]
 1993 |       }
 1994 |     
 1995 |       arr.length = len
 1996 |     }
 1997 |     
 1998 |     },{}],29:[function(require,module,exports){
 1999 |     module.exports = scrollToAnchor
 2000 |     
 2001 |     function scrollToAnchor (anchor, options) {
 2002 |       if (anchor) {
 2003 |         try {
 2004 |           var el = document.querySelector(anchor)
 2005 |           if (el) el.scrollIntoView(options)
 2006 |         } catch (e) {}
 2007 |       }
 2008 |     }
 2009 |     
 2010 |     },{}],30:[function(require,module,exports){
 2011 |     /* eslint-disable node/no-deprecated-api */
 2012 |     var assert = require('assert')
 2013 |     var trie = require('./trie')
 2014 |     
 2015 |     module.exports = Wayfarer
 2016 |     
 2017 |     // create a router
 2018 |     // str -> obj
 2019 |     function Wayfarer (dft) {
 2020 |       if (!(this instanceof Wayfarer)) return new Wayfarer(dft)
 2021 |     
 2022 |       var _default = (dft || '').replace(/^\//, '')
 2023 |       var _trie = trie()
 2024 |     
 2025 |       emit._trie = _trie
 2026 |       emit.on = on
 2027 |       emit.emit = emit
 2028 |       emit.match = match
 2029 |       emit._wayfarer = true
 2030 |     
 2031 |       return emit
 2032 |     
 2033 |       // define a route
 2034 |       // (str, fn) -> obj
 2035 |       function on (route, cb) {
 2036 |         assert.equal(typeof route, 'string')
 2037 |         assert.equal(typeof cb, 'function')
 2038 |     
 2039 |         route = route || '/'
 2040 |     
 2041 |         if (cb._wayfarer && cb._trie) {
 2042 |           _trie.mount(route, cb._trie.trie)
 2043 |         } else {
 2044 |           var node = _trie.create(route)
 2045 |           node.cb = cb
 2046 |           node.route = route
 2047 |         }
 2048 |     
 2049 |         return emit
 2050 |       }
 2051 |     
 2052 |       // match and call a route
 2053 |       // (str, obj?) -> null
 2054 |       function emit (route) {
 2055 |         var matched = match(route)
 2056 |     
 2057 |         var args = new Array(arguments.length)
 2058 |         args[0] = matched.params
 2059 |         for (var i = 1; i < args.length; i++) {
 2060 |           args[i] = arguments[i]
 2061 |         }
 2062 |     
 2063 |         return matched.cb.apply(matched.cb, args)
 2064 |       }
 2065 |     
 2066 |       function match (route) {
 2067 |         assert.notEqual(route, undefined, "'route' must be defined")
 2068 |     
 2069 |         var matched = _trie.match(route)
 2070 |         if (matched && matched.cb) return new Route(matched)
 2071 |     
 2072 |         var dft = _trie.match(_default)
 2073 |         if (dft && dft.cb) return new Route(dft)
 2074 |     
 2075 |         throw new Error("route '" + route + "' did not match")
 2076 |       }
 2077 |     
 2078 |       function Route (matched) {
 2079 |         this.cb = matched.cb
 2080 |         this.route = matched.route
 2081 |         this.params = matched.params
 2082 |       }
 2083 |     }
 2084 |     
 2085 |     },{"./trie":31,"assert":9}],31:[function(require,module,exports){
 2086 |     /* eslint-disable node/no-deprecated-api */
 2087 |     var assert = require('assert')
 2088 |     
 2089 |     module.exports = Trie
 2090 |     
 2091 |     // create a new trie
 2092 |     // null -> obj
 2093 |     function Trie () {
 2094 |       if (!(this instanceof Trie)) return new Trie()
 2095 |       this.trie = { nodes: {} }
 2096 |     }
 2097 |     
 2098 |     // create a node on the trie at route
 2099 |     // and return a node
 2100 |     // str -> obj
 2101 |     Trie.prototype.create = function (route) {
 2102 |       assert.equal(typeof route, 'string', 'route should be a string')
 2103 |       // strip leading '/' and split routes
 2104 |       var routes = route.replace(/^\//, '').split('/')
 2105 |     
 2106 |       function createNode (index, trie) {
 2107 |         var thisRoute = (has(routes, index) && routes[index])
 2108 |         if (thisRoute === false) return trie
 2109 |     
 2110 |         var node = null
 2111 |         if (/^:|^\*/.test(thisRoute)) {
 2112 |           // if node is a name match, set name and append to ':' node
 2113 |           if (!has(trie.nodes, '$$')) {
 2114 |             node = { nodes: {} }
 2115 |             trie.nodes.$$ = node
 2116 |           } else {
 2117 |             node = trie.nodes.$$
 2118 |           }
 2119 |     
 2120 |           if (thisRoute[0] === '*') {
 2121 |             trie.wildcard = true
 2122 |           }
 2123 |     
 2124 |           trie.name = thisRoute.replace(/^:|^\*/, '')
 2125 |         } else if (!has(trie.nodes, thisRoute)) {
 2126 |           node = { nodes: {} }
 2127 |           trie.nodes[thisRoute] = node
 2128 |         } else {
 2129 |           node = trie.nodes[thisRoute]
 2130 |         }
 2131 |     
 2132 |         // we must recurse deeper
 2133 |         return createNode(index + 1, node)
 2134 |       }
 2135 |     
 2136 |       return createNode(0, this.trie)
 2137 |     }
 2138 |     
 2139 |     // match a route on the trie
 2140 |     // and return the node
 2141 |     // str -> obj
 2142 |     Trie.prototype.match = function (route) {
 2143 |       assert.equal(typeof route, 'string', 'route should be a string')
 2144 |     
 2145 |       var routes = route.replace(/^\//, '').split('/')
 2146 |       var params = {}
 2147 |     
 2148 |       function search (index, trie) {
 2149 |         // either there's no match, or we're done searching
 2150 |         if (trie === undefined) return undefined
 2151 |         var thisRoute = routes[index]
 2152 |         if (thisRoute === undefined) return trie
 2153 |     
 2154 |         if (has(trie.nodes, thisRoute)) {
 2155 |           // match regular routes first
 2156 |           return search(index + 1, trie.nodes[thisRoute])
 2157 |         } else if (trie.name) {
 2158 |           // match named routes
 2159 |           try {
 2160 |             params[trie.name] = decodeURIComponent(thisRoute)
 2161 |           } catch (e) {
 2162 |             return search(index, undefined)
 2163 |           }
 2164 |           return search(index + 1, trie.nodes.$$)
 2165 |         } else if (trie.wildcard) {
 2166 |           // match wildcards
 2167 |           try {
 2168 |             params.wildcard = decodeURIComponent(routes.slice(index).join('/'))
 2169 |           } catch (e) {
 2170 |             return search(index, undefined)
 2171 |           }
 2172 |           // return early, or else search may keep recursing through the wildcard
 2173 |           return trie.nodes.$$
 2174 |         } else {
 2175 |           // no matches found
 2176 |           return search(index + 1)
 2177 |         }
 2178 |       }
 2179 |     
 2180 |       var node = search(0, this.trie)
 2181 |     
 2182 |       if (!node) return undefined
 2183 |       node = Object.assign({}, node)
 2184 |       node.params = params
 2185 |       return node
 2186 |     }
 2187 |     
 2188 |     // mount a trie onto a node at route
 2189 |     // (str, obj) -> null
 2190 |     Trie.prototype.mount = function (route, trie) {
 2191 |       assert.equal(typeof route, 'string', 'route should be a string')
 2192 |       assert.equal(typeof trie, 'object', 'trie should be a object')
 2193 |     
 2194 |       var split = route.replace(/^\//, '').split('/')
 2195 |       var node = null
 2196 |       var key = null
 2197 |     
 2198 |       if (split.length === 1) {
 2199 |         key = split[0]
 2200 |         node = this.create(key)
 2201 |       } else {
 2202 |         var head = split.join('/')
 2203 |         key = split[0]
 2204 |         node = this.create(head)
 2205 |       }
 2206 |     
 2207 |       Object.assign(node.nodes, trie.nodes)
 2208 |       if (trie.name) node.name = trie.name
 2209 |     
 2210 |       // delegate properties from '/' to the new node
 2211 |       // '/' cannot be reached once mounted
 2212 |       if (node.nodes['']) {
 2213 |         Object.keys(node.nodes['']).forEach(function (key) {
 2214 |           if (key === 'nodes') return
 2215 |           node[key] = node.nodes[''][key]
 2216 |         })
 2217 |         Object.assign(node.nodes, node.nodes[''].nodes)
 2218 |         delete node.nodes[''].nodes
 2219 |       }
 2220 |     }
 2221 |     
 2222 |     function has (object, property) {
 2223 |       return Object.prototype.hasOwnProperty.call(object, property)
 2224 |     }
 2225 |     
 2226 |     },{"assert":9}]},{},[1]);
 2227 |     
 2228 | 

/* =====================================================================================
   FILE: app/lib/nanohtml.js
   ===================================================================================== */

    1 | /*
    2 | /app/lib/nanohtml.js
    3 | Nanohtml library bundle providing tagged template rendering utilities.
    4 | */
    5 | (function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.html = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
    6 |   module.exports = require(5)(document)
    7 |   
    8 |   },{"5":5}],2:[function(require,module,exports){
    9 |   'use strict'
   10 |   
   11 |   var trailingNewlineRegex = /\n[\s]+$/
   12 |   var leadingNewlineRegex = /^\n[\s]+/
   13 |   var trailingSpaceRegex = /[\s]+$/
   14 |   var leadingSpaceRegex = /^[\s]+/
   15 |   var multiSpaceRegex = /[\n\s]+/g
   16 |   
   17 |   var TEXT_TAGS = [
   18 |     'a', 'abbr', 'b', 'bdi', 'bdo', 'br', 'cite', 'data', 'dfn', 'em', 'i',
   19 |     'kbd', 'mark', 'q', 'rp', 'rt', 'rtc', 'ruby', 's', 'amp', 'small', 'span',
   20 |     'strong', 'sub', 'sup', 'time', 'u', 'var', 'wbr'
   21 |   ]
   22 |   
   23 |   var VERBATIM_TAGS = [
   24 |     'code', 'pre', 'textarea'
   25 |   ]
   26 |   
   27 |   module.exports = function appendChild (el, childs) {
   28 |     if (!Array.isArray(childs)) return
   29 |   
   30 |     var nodeName = el.nodeName.toLowerCase()
   31 |   
   32 |     var hadText = false
   33 |     var value, leader
   34 |   
   35 |     for (var i = 0, len = childs.length; i < len; i++) {
   36 |       var node = childs[i]
   37 |       if (Array.isArray(node)) {
   38 |         appendChild(el, node)
   39 |         continue
   40 |       }
   41 |   
   42 |       if (typeof node === 'number' ||
   43 |         typeof node === 'boolean' ||
   44 |         typeof node === 'function' ||
   45 |         node instanceof Date ||
   46 |         node instanceof RegExp) {
   47 |         node = node.toString()
   48 |       }
   49 |   
   50 |       var lastChild = el.childNodes[el.childNodes.length - 1]
   51 |   
   52 |       // Iterate over text nodes
   53 |       if (typeof node === 'string') {
   54 |         hadText = true
   55 |   
   56 |         // If we already had text, append to the existing text
   57 |         if (lastChild && lastChild.nodeName === '#text') {
   58 |           lastChild.nodeValue += node
   59 |   
   60 |         // We didn't have a text node yet, create one
   61 |         } else {
   62 |           node = el.ownerDocument.createTextNode(node)
   63 |           el.appendChild(node)
   64 |           lastChild = node
   65 |         }
   66 |   
   67 |         // If this is the last of the child nodes, make sure we close it out
   68 |         // right
   69 |         if (i === len - 1) {
   70 |           hadText = false
   71 |           // Trim the child text nodes if the current node isn't a
   72 |           // node where whitespace matters.
   73 |           if (TEXT_TAGS.indexOf(nodeName) === -1 &&
   74 |             VERBATIM_TAGS.indexOf(nodeName) === -1) {
   75 |             value = lastChild.nodeValue
   76 |               .replace(leadingNewlineRegex, '')
   77 |               .replace(trailingSpaceRegex, '')
   78 |               .replace(trailingNewlineRegex, '')
   79 |               .replace(multiSpaceRegex, ' ')
   80 |             if (value === '') {
   81 |               el.removeChild(lastChild)
   82 |             } else {
   83 |               lastChild.nodeValue = value
   84 |             }
   85 |           } else if (VERBATIM_TAGS.indexOf(nodeName) === -1) {
   86 |             // The very first node in the list should not have leading
   87 |             // whitespace. Sibling text nodes should have whitespace if there
   88 |             // was any.
   89 |             leader = i === 0 ? '' : ' '
   90 |             value = lastChild.nodeValue
   91 |               .replace(leadingNewlineRegex, leader)
   92 |               .replace(leadingSpaceRegex, ' ')
   93 |               .replace(trailingSpaceRegex, '')
   94 |               .replace(trailingNewlineRegex, '')
   95 |               .replace(multiSpaceRegex, ' ')
   96 |             lastChild.nodeValue = value
   97 |           }
   98 |         }
   99 |   
  100 |       // Iterate over DOM nodes
  101 |       } else if (node && node.nodeType) {
  102 |         // If the last node was a text node, make sure it is properly closed out
  103 |         if (hadText) {
  104 |           hadText = false
  105 |   
  106 |           // Trim the child text nodes if the current node isn't a
  107 |           // text node or a code node
  108 |           if (TEXT_TAGS.indexOf(nodeName) === -1 &&
  109 |             VERBATIM_TAGS.indexOf(nodeName) === -1) {
  110 |             value = lastChild.nodeValue
  111 |               .replace(leadingNewlineRegex, '')
  112 |               .replace(trailingNewlineRegex, ' ')
  113 |               .replace(multiSpaceRegex, ' ')
  114 |   
  115 |             // Remove empty text nodes, append otherwise
  116 |             if (value === '') {
  117 |               el.removeChild(lastChild)
  118 |             } else {
  119 |               lastChild.nodeValue = value
  120 |             }
  121 |           // Trim the child nodes but preserve the appropriate whitespace
  122 |           } else if (VERBATIM_TAGS.indexOf(nodeName) === -1) {
  123 |             value = lastChild.nodeValue
  124 |               .replace(leadingSpaceRegex, ' ')
  125 |               .replace(leadingNewlineRegex, '')
  126 |               .replace(trailingNewlineRegex, ' ')
  127 |               .replace(multiSpaceRegex, ' ')
  128 |             lastChild.nodeValue = value
  129 |           }
  130 |         }
  131 |   
  132 |         // Store the last nodename
  133 |         var _nodeName = node.nodeName
  134 |         if (_nodeName) nodeName = _nodeName.toLowerCase()
  135 |   
  136 |         // Append the node to the DOM
  137 |         el.appendChild(node)
  138 |       }
  139 |     }
  140 |   }
  141 |   
  142 |   },{}],3:[function(require,module,exports){
  143 |   'use strict'
  144 |   
  145 |   module.exports = [
  146 |     'async', 'autofocus', 'autoplay', 'checked', 'controls', 'default',
  147 |     'defaultchecked', 'defer', 'disabled', 'formnovalidate', 'hidden',
  148 |     'ismap', 'loop', 'multiple', 'muted', 'novalidate', 'open', 'playsinline',
  149 |     'readonly', 'required', 'reversed', 'selected'
  150 |   ]
  151 |   
  152 |   },{}],4:[function(require,module,exports){
  153 |   'use strict'
  154 |   
  155 |   module.exports = [
  156 |     'indeterminate'
  157 |   ]
  158 |   
  159 |   },{}],5:[function(require,module,exports){
  160 |   'use strict'
  161 |   
  162 |   var hyperx = require(8)
  163 |   var appendChild = require(2)
  164 |   var SVG_TAGS = require(6)
  165 |   var BOOL_PROPS = require(3)
  166 |   // Props that need to be set directly rather than with el.setAttribute()
  167 |   var DIRECT_PROPS = require(4)
  168 |   
  169 |   var SVGNS = 'http://www.w3.org/2000/svg'
  170 |   var XLINKNS = 'http://www.w3.org/1999/xlink'
  171 |   
  172 |   var COMMENT_TAG = '!--'
  173 |   
  174 |   module.exports = function (document) {
  175 |     function nanoHtmlCreateElement (tag, props, children) {
  176 |       var el
  177 |   
  178 |       // If an svg tag, it needs a namespace
  179 |       if (SVG_TAGS.indexOf(tag) !== -1) {
  180 |         props.namespace = SVGNS
  181 |       }
  182 |   
  183 |       // If we are using a namespace
  184 |       var ns = false
  185 |       if (props.namespace) {
  186 |         ns = props.namespace
  187 |         delete props.namespace
  188 |       }
  189 |   
  190 |       // If we are extending a builtin element
  191 |       var isCustomElement = false
  192 |       if (props.is) {
  193 |         isCustomElement = props.is
  194 |         delete props.is
  195 |       }
  196 |   
  197 |       // Create the element
  198 |       if (ns) {
  199 |         if (isCustomElement) {
  200 |           el = document.createElementNS(ns, tag, { is: isCustomElement })
  201 |         } else {
  202 |           el = document.createElementNS(ns, tag)
  203 |         }
  204 |       } else if (tag === COMMENT_TAG) {
  205 |         return document.createComment(props.comment)
  206 |       } else if (isCustomElement) {
  207 |         el = document.createElement(tag, { is: isCustomElement })
  208 |       } else {
  209 |         el = document.createElement(tag)
  210 |       }
  211 |   
  212 |       // Create the properties
  213 |       for (var p in props) {
  214 |         if (props.hasOwnProperty(p)) {
  215 |           var key = p.toLowerCase()
  216 |           var val = props[p]
  217 |           // Normalize className
  218 |           if (key === 'classname') {
  219 |             key = 'class'
  220 |             p = 'class'
  221 |           }
  222 |           // The for attribute gets transformed to htmlFor, but we just set as for
  223 |           if (p === 'htmlFor') {
  224 |             p = 'for'
  225 |           }
  226 |           // If a property is boolean, set itself to the key
  227 |           if (BOOL_PROPS.indexOf(key) !== -1) {
  228 |             if (String(val) === 'true') val = key
  229 |             else if (String(val) === 'false') continue
  230 |           }
  231 |           // If a property prefers being set directly vs setAttribute
  232 |           if (key.slice(0, 2) === 'on' || DIRECT_PROPS.indexOf(key) !== -1) {
  233 |             el[p] = val
  234 |           } else {
  235 |             if (ns) {
  236 |               if (p === 'xlink:href') {
  237 |                 el.setAttributeNS(XLINKNS, p, val)
  238 |               } else if (/^xmlns($|:)/i.test(p)) {
  239 |                 // skip xmlns definitions
  240 |               } else {
  241 |                 el.setAttributeNS(null, p, val)
  242 |               }
  243 |             } else {
  244 |               el.setAttribute(p, val)
  245 |             }
  246 |           }
  247 |         }
  248 |       }
  249 |   
  250 |       appendChild(el, children)
  251 |       return el
  252 |     }
  253 |   
  254 |     function createFragment (nodes) {
  255 |       var fragment = document.createDocumentFragment()
  256 |       for (var i = 0; i < nodes.length; i++) {
  257 |         if (nodes[i] == null) continue
  258 |         if (Array.isArray(nodes[i])) {
  259 |           fragment.appendChild(createFragment(nodes[i]))
  260 |         } else {
  261 |           if (typeof nodes[i] === 'string') nodes[i] = document.createTextNode(nodes[i])
  262 |           fragment.appendChild(nodes[i])
  263 |         }
  264 |       }
  265 |       return fragment
  266 |     }
  267 |   
  268 |     var exports = hyperx(nanoHtmlCreateElement, {
  269 |       comments: true,
  270 |       createFragment: createFragment
  271 |     })
  272 |     exports.default = exports
  273 |     exports.createComment = nanoHtmlCreateElement
  274 |     return exports
  275 |   }
  276 |   
  277 |   },{"2":2,"3":3,"4":4,"6":6,"8":8}],6:[function(require,module,exports){
  278 |   'use strict'
  279 |   
  280 |   module.exports = [
  281 |     'svg', 'altGlyph', 'altGlyphDef', 'altGlyphItem', 'animate', 'animateColor',
  282 |     'animateMotion', 'animateTransform', 'circle', 'clipPath', 'color-profile',
  283 |     'cursor', 'defs', 'desc', 'ellipse', 'feBlend', 'feColorMatrix',
  284 |     'feComponentTransfer', 'feComposite', 'feConvolveMatrix',
  285 |     'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feFlood',
  286 |     'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage',
  287 |     'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight',
  288 |     'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence', 'filter',
  289 |     'font', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src',
  290 |     'font-face-uri', 'foreignObject', 'g', 'glyph', 'glyphRef', 'hkern', 'image',
  291 |     'line', 'linearGradient', 'marker', 'mask', 'metadata', 'missing-glyph',
  292 |     'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialGradient', 'rect',
  293 |     'set', 'stop', 'switch', 'symbol', 'text', 'textPath', 'title', 'tref',
  294 |     'tspan', 'use', 'view', 'vkern'
  295 |   ]
  296 |   
  297 |   },{}],7:[function(require,module,exports){
  298 |   module.exports = attributeToProperty
  299 |   
  300 |   var transform = {
  301 |     'class': 'className',
  302 |     'for': 'htmlFor',
  303 |     'http-equiv': 'httpEquiv'
  304 |   }
  305 |   
  306 |   function attributeToProperty (h) {
  307 |     return function (tagName, attrs, children) {
  308 |       for (var attr in attrs) {
  309 |         if (attr in transform) {
  310 |           attrs[transform[attr]] = attrs[attr]
  311 |           delete attrs[attr]
  312 |         }
  313 |       }
  314 |       return h(tagName, attrs, children)
  315 |     }
  316 |   }
  317 |   
  318 |   },{}],8:[function(require,module,exports){
  319 |   var attrToProp = require(7)
  320 |   
  321 |   var VAR = 0, TEXT = 1, OPEN = 2, CLOSE = 3, ATTR = 4
  322 |   var ATTR_KEY = 5, ATTR_KEY_W = 6
  323 |   var ATTR_VALUE_W = 7, ATTR_VALUE = 8
  324 |   var ATTR_VALUE_SQ = 9, ATTR_VALUE_DQ = 10
  325 |   var ATTR_EQ = 11, ATTR_BREAK = 12
  326 |   var COMMENT = 13
  327 |   
  328 |   module.exports = function (h, opts) {
  329 |     if (!opts) opts = {}
  330 |     var concat = opts.concat || function (a, b) {
  331 |       return String(a) + String(b)
  332 |     }
  333 |     if (opts.attrToProp !== false) {
  334 |       h = attrToProp(h)
  335 |     }
  336 |   
  337 |     return function (strings) {
  338 |       var state = TEXT, reg = ''
  339 |       var arglen = arguments.length
  340 |       var parts = []
  341 |   
  342 |       for (var i = 0; i < strings.length; i++) {
  343 |         if (i < arglen - 1) {
  344 |           var arg = arguments[i+1]
  345 |           var p = parse(strings[i])
  346 |           var xstate = state
  347 |           if (xstate === ATTR_VALUE_DQ) xstate = ATTR_VALUE
  348 |           if (xstate === ATTR_VALUE_SQ) xstate = ATTR_VALUE
  349 |           if (xstate === ATTR_VALUE_W) xstate = ATTR_VALUE
  350 |           if (xstate === ATTR) xstate = ATTR_KEY
  351 |           if (xstate === OPEN) {
  352 |             if (reg === '/') {
  353 |               p.push([ OPEN, '/', arg ])
  354 |               reg = ''
  355 |             } else {
  356 |               p.push([ OPEN, arg ])
  357 |             }
  358 |           } else if (xstate === COMMENT && opts.comments) {
  359 |             reg += String(arg)
  360 |           } else if (xstate !== COMMENT) {
  361 |             p.push([ VAR, xstate, arg ])
  362 |           }
  363 |           parts.push.apply(parts, p)
  364 |         } else parts.push.apply(parts, parse(strings[i]))
  365 |       }
  366 |   
  367 |       var tree = [null,{},[]]
  368 |       var stack = [[tree,-1]]
  369 |       for (var i = 0; i < parts.length; i++) {
  370 |         var cur = stack[stack.length-1][0]
  371 |         var p = parts[i], s = p[0]
  372 |         if (s === OPEN && /^\//.test(p[1])) {
  373 |           var ix = stack[stack.length-1][1]
  374 |           if (stack.length > 1) {
  375 |             stack.pop()
  376 |             stack[stack.length-1][0][2][ix] = h(
  377 |               cur[0], cur[1], cur[2].length ? cur[2] : undefined
  378 |             )
  379 |           }
  380 |         } else if (s === OPEN) {
  381 |           var c = [p[1],{},[]]
  382 |           cur[2].push(c)
  383 |           stack.push([c,cur[2].length-1])
  384 |         } else if (s === ATTR_KEY || (s === VAR && p[1] === ATTR_KEY)) {
  385 |           var key = ''
  386 |           var copyKey
  387 |           for (; i < parts.length; i++) {
  388 |             if (parts[i][0] === ATTR_KEY) {
  389 |               key = concat(key, parts[i][1])
  390 |             } else if (parts[i][0] === VAR && parts[i][1] === ATTR_KEY) {
  391 |               if (typeof parts[i][2] === 'object' && !key) {
  392 |                 for (copyKey in parts[i][2]) {
  393 |                   if (parts[i][2].hasOwnProperty(copyKey) && !cur[1][copyKey]) {
  394 |                     cur[1][copyKey] = parts[i][2][copyKey]
  395 |                   }
  396 |                 }
  397 |               } else {
  398 |                 key = concat(key, parts[i][2])
  399 |               }
  400 |             } else break
  401 |           }
  402 |           if (parts[i][0] === ATTR_EQ) i++
  403 |           var j = i
  404 |           for (; i < parts.length; i++) {
  405 |             if (parts[i][0] === ATTR_VALUE || parts[i][0] === ATTR_KEY) {
  406 |               if (!cur[1][key]) cur[1][key] = strfn(parts[i][1])
  407 |               else parts[i][1]==="" || (cur[1][key] = concat(cur[1][key], parts[i][1]));
  408 |             } else if (parts[i][0] === VAR
  409 |             && (parts[i][1] === ATTR_VALUE || parts[i][1] === ATTR_KEY)) {
  410 |               if (!cur[1][key]) cur[1][key] = strfn(parts[i][2])
  411 |               else parts[i][2]==="" || (cur[1][key] = concat(cur[1][key], parts[i][2]));
  412 |             } else {
  413 |               if (key.length && !cur[1][key] && i === j
  414 |               && (parts[i][0] === CLOSE || parts[i][0] === ATTR_BREAK)) {
  415 |                 // https://html.spec.whatwg.org/multipage/infrastructure.html#boolean-attributes
  416 |                 // empty string is falsy, not well behaved value in browser
  417 |                 cur[1][key] = key.toLowerCase()
  418 |               }
  419 |               if (parts[i][0] === CLOSE) {
  420 |                 i--
  421 |               }
  422 |               break
  423 |             }
  424 |           }
  425 |         } else if (s === ATTR_KEY) {
  426 |           cur[1][p[1]] = true
  427 |         } else if (s === VAR && p[1] === ATTR_KEY) {
  428 |           cur[1][p[2]] = true
  429 |         } else if (s === CLOSE) {
  430 |           if (selfClosing(cur[0]) && stack.length) {
  431 |             var ix = stack[stack.length-1][1]
  432 |             stack.pop()
  433 |             stack[stack.length-1][0][2][ix] = h(
  434 |               cur[0], cur[1], cur[2].length ? cur[2] : undefined
  435 |             )
  436 |           }
  437 |         } else if (s === VAR && p[1] === TEXT) {
  438 |           if (p[2] === undefined || p[2] === null) p[2] = ''
  439 |           else if (!p[2]) p[2] = concat('', p[2])
  440 |           if (Array.isArray(p[2][0])) {
  441 |             cur[2].push.apply(cur[2], p[2])
  442 |           } else {
  443 |             cur[2].push(p[2])
  444 |           }
  445 |         } else if (s === TEXT) {
  446 |           cur[2].push(p[1])
  447 |         } else if (s === ATTR_EQ || s === ATTR_BREAK) {
  448 |           // no-op
  449 |         } else {
  450 |           throw new Error('unhandled: ' + s)
  451 |         }
  452 |       }
  453 |   
  454 |       if (tree[2].length > 1 && /^\s*$/.test(tree[2][0])) {
  455 |         tree[2].shift()
  456 |       }
  457 |   
  458 |       if (tree[2].length > 2
  459 |       || (tree[2].length === 2 && /\S/.test(tree[2][1]))) {
  460 |         if (opts.createFragment) return opts.createFragment(tree[2])
  461 |         throw new Error(
  462 |           'multiple root elements must be wrapped in an enclosing tag'
  463 |         )
  464 |       }
  465 |       if (Array.isArray(tree[2][0]) && typeof tree[2][0][0] === 'string'
  466 |       && Array.isArray(tree[2][0][2])) {
  467 |         tree[2][0] = h(tree[2][0][0], tree[2][0][1], tree[2][0][2])
  468 |       }
  469 |       return tree[2][0]
  470 |   
  471 |       function parse (str) {
  472 |         var res = []
  473 |         if (state === ATTR_VALUE_W) state = ATTR
  474 |         for (var i = 0; i < str.length; i++) {
  475 |           var c = str.charAt(i)
  476 |           if (state === TEXT && c === '<') {
  477 |             if (reg.length) res.push([TEXT, reg])
  478 |             reg = ''
  479 |             state = OPEN
  480 |           } else if (c === '>' && !quot(state) && state !== COMMENT) {
  481 |             if (state === OPEN && reg.length) {
  482 |               res.push([OPEN,reg])
  483 |             } else if (state === ATTR_KEY) {
  484 |               res.push([ATTR_KEY,reg])
  485 |             } else if (state === ATTR_VALUE && reg.length) {
  486 |               res.push([ATTR_VALUE,reg])
  487 |             }
  488 |             res.push([CLOSE])
  489 |             reg = ''
  490 |             state = TEXT
  491 |           } else if (state === COMMENT && /-$/.test(reg) && c === '-') {
  492 |             if (opts.comments) {
  493 |               res.push([ATTR_VALUE,reg.substr(0, reg.length - 1)])
  494 |             }
  495 |             reg = ''
  496 |             state = TEXT
  497 |           } else if (state === OPEN && /^!--$/.test(reg)) {
  498 |             if (opts.comments) {
  499 |               res.push([OPEN, reg],[ATTR_KEY,'comment'],[ATTR_EQ])
  500 |             }
  501 |             reg = c
  502 |             state = COMMENT
  503 |           } else if (state === TEXT || state === COMMENT) {
  504 |             reg += c
  505 |           } else if (state === OPEN && c === '/' && reg.length) {
  506 |             // no-op, self closing tag without a space <br/>
  507 |           } else if (state === OPEN && /\s/.test(c)) {
  508 |             if (reg.length) {
  509 |               res.push([OPEN, reg])
  510 |             }
  511 |             reg = ''
  512 |             state = ATTR
  513 |           } else if (state === OPEN) {
  514 |             reg += c
  515 |           } else if (state === ATTR && /[^\s"'=/]/.test(c)) {
  516 |             state = ATTR_KEY
  517 |             reg = c
  518 |           } else if (state === ATTR && /\s/.test(c)) {
  519 |             if (reg.length) res.push([ATTR_KEY,reg])
  520 |             res.push([ATTR_BREAK])
  521 |           } else if (state === ATTR_KEY && /\s/.test(c)) {
  522 |             res.push([ATTR_KEY,reg])
  523 |             reg = ''
  524 |             state = ATTR_KEY_W
  525 |           } else if (state === ATTR_KEY && c === '=') {
  526 |             res.push([ATTR_KEY,reg],[ATTR_EQ])
  527 |             reg = ''
  528 |             state = ATTR_VALUE_W
  529 |           } else if (state === ATTR_KEY) {
  530 |             reg += c
  531 |           } else if ((state === ATTR_KEY_W || state === ATTR) && c === '=') {
  532 |             res.push([ATTR_EQ])
  533 |             state = ATTR_VALUE_W
  534 |           } else if ((state === ATTR_KEY_W || state === ATTR) && !/\s/.test(c)) {
  535 |             res.push([ATTR_BREAK])
  536 |             if (/[\w-]/.test(c)) {
  537 |               reg += c
  538 |               state = ATTR_KEY
  539 |             } else state = ATTR
  540 |           } else if (state === ATTR_VALUE_W && c === '"') {
  541 |             state = ATTR_VALUE_DQ
  542 |           } else if (state === ATTR_VALUE_W && c === "'") {
  543 |             state = ATTR_VALUE_SQ
  544 |           } else if (state === ATTR_VALUE_DQ && c === '"') {
  545 |             res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  546 |             reg = ''
  547 |             state = ATTR
  548 |           } else if (state === ATTR_VALUE_SQ && c === "'") {
  549 |             res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  550 |             reg = ''
  551 |             state = ATTR
  552 |           } else if (state === ATTR_VALUE_W && !/\s/.test(c)) {
  553 |             state = ATTR_VALUE
  554 |             i--
  555 |           } else if (state === ATTR_VALUE && /\s/.test(c)) {
  556 |             res.push([ATTR_VALUE,reg],[ATTR_BREAK])
  557 |             reg = ''
  558 |             state = ATTR
  559 |           } else if (state === ATTR_VALUE || state === ATTR_VALUE_SQ
  560 |           || state === ATTR_VALUE_DQ) {
  561 |             reg += c
  562 |           }
  563 |         }
  564 |         if (state === TEXT && reg.length) {
  565 |           res.push([TEXT,reg])
  566 |           reg = ''
  567 |         } else if (state === ATTR_VALUE && reg.length) {
  568 |           res.push([ATTR_VALUE,reg])
  569 |           reg = ''
  570 |         } else if (state === ATTR_VALUE_DQ && reg.length) {
  571 |           res.push([ATTR_VALUE,reg])
  572 |           reg = ''
  573 |         } else if (state === ATTR_VALUE_SQ && reg.length) {
  574 |           res.push([ATTR_VALUE,reg])
  575 |           reg = ''
  576 |         } else if (state === ATTR_KEY) {
  577 |           res.push([ATTR_KEY,reg])
  578 |           reg = ''
  579 |         }
  580 |         return res
  581 |       }
  582 |     }
  583 |   
  584 |     function strfn (x) {
  585 |       if (typeof x === 'function') return x
  586 |       else if (typeof x === 'string') return x
  587 |       else if (x && typeof x === 'object') return x
  588 |       else if (x === null || x === undefined) return x
  589 |       else return concat('', x)
  590 |     }
  591 |   }
  592 |   
  593 |   function quot (state) {
  594 |     return state === ATTR_VALUE_SQ || state === ATTR_VALUE_DQ
  595 |   }
  596 |   
  597 |   var closeRE = RegExp('^(' + [
  598 |     'area', 'base', 'basefont', 'bgsound', 'br', 'col', 'command', 'embed',
  599 |     'frame', 'hr', 'img', 'input', 'isindex', 'keygen', 'link', 'meta', 'param',
  600 |     'source', 'track', 'wbr', '!--',
  601 |     // SVG TAGS
  602 |     'animate', 'animateTransform', 'circle', 'cursor', 'desc', 'ellipse',
  603 |     'feBlend', 'feColorMatrix', 'feComposite',
  604 |     'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap',
  605 |     'feDistantLight', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR',
  606 |     'feGaussianBlur', 'feImage', 'feMergeNode', 'feMorphology',
  607 |     'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile',
  608 |     'feTurbulence', 'font-face-format', 'font-face-name', 'font-face-uri',
  609 |     'glyph', 'glyphRef', 'hkern', 'image', 'line', 'missing-glyph', 'mpath',
  610 |     'path', 'polygon', 'polyline', 'rect', 'set', 'stop', 'tref', 'use', 'view',
  611 |     'vkern'
  612 |   ].join('|') + ')(?:[\.#][a-zA-Z0-9\u007F-\uFFFF_:-]+)*$')
  613 |   function selfClosing (tag) { return closeRE.test(tag) }
  614 |   
  615 |   },{"7":7}]},{},[1])(1)
  616 |   });
  617 | 

/* =====================================================================================
   FILE: app/lib/phaser.js
   ===================================================================================== */

    1 | /*
    2 | /app/lib/phaser.js
    3 | Phaser game framework bundle supplying rendering, physics, and input utilities.
    4 | */
    5 | });
    6 | 

/* =====================================================================================
   FILE: app/lib/tachyons.min.css
   ===================================================================================== */

    1 | /*
    2 | /app/lib/tachyons.min.css
    3 | Minified Tachyons utility CSS library used for functional styling helpers.
    4 | */
    5 | /*! TACHYONS v4.12.0 | http://tachyons.io */
    6 | /*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}.border-box,a,article,aside,blockquote,body,code,dd,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,html,input[type=email],input[type=number],input[type=password],input[type=tel],input[type=text],input[type=url],legend,li,main,nav,ol,p,pre,section,table,td,textarea,th,tr,ul{box-sizing:border-box}.aspect-ratio{height:0;position:relative}.aspect-ratio--16x9{padding-bottom:56.25%}.aspect-ratio--9x16{padding-bottom:177.77%}.aspect-ratio--4x3{padding-bottom:75%}.aspect-ratio--3x4{padding-bottom:133.33%}.aspect-ratio--6x4{padding-bottom:66.6%}.aspect-ratio--4x6{padding-bottom:150%}.aspect-ratio--8x5{padding-bottom:62.5%}.aspect-ratio--5x8{padding-bottom:160%}.aspect-ratio--7x5{padding-bottom:71.42%}.aspect-ratio--5x7{padding-bottom:140%}.aspect-ratio--1x1{padding-bottom:100%}.aspect-ratio--object{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;z-index:100}img{max-width:100%}.cover{background-size:cover!important}.contain{background-size:contain!important}.bg-center{background-position:50%}.bg-center,.bg-top{background-repeat:no-repeat}.bg-top{background-position:top}.bg-right{background-position:100%}.bg-bottom,.bg-right{background-repeat:no-repeat}.bg-bottom{background-position:bottom}.bg-left{background-repeat:no-repeat;background-position:0}.outline{outline:1px solid}.outline-transparent{outline:1px solid transparent}.outline-0{outline:0}.ba{border-style:solid;border-width:1px}.bt{border-top-style:solid;border-top-width:1px}.br{border-right-style:solid;border-right-width:1px}.bb{border-bottom-style:solid;border-bottom-width:1px}.bl{border-left-style:solid;border-left-width:1px}.bn{border-style:none;border-width:0}.b--black{border-color:#000}.b--near-black{border-color:#111}.b--dark-gray{border-color:#333}.b--mid-gray{border-color:#555}.b--gray{border-color:#777}.b--silver{border-color:#999}.b--light-silver{border-color:#aaa}.b--moon-gray{border-color:#ccc}.b--light-gray{border-color:#eee}.b--near-white{border-color:#f4f4f4}.b--white{border-color:#fff}.b--white-90{border-color:hsla(0,0%,100%,.9)}.b--white-80{border-color:hsla(0,0%,100%,.8)}.b--white-70{border-color:hsla(0,0%,100%,.7)}.b--white-60{border-color:hsla(0,0%,100%,.6)}.b--white-50{border-color:hsla(0,0%,100%,.5)}.b--white-40{border-color:hsla(0,0%,100%,.4)}.b--white-30{border-color:hsla(0,0%,100%,.3)}.b--white-20{border-color:hsla(0,0%,100%,.2)}.b--white-10{border-color:hsla(0,0%,100%,.1)}.b--white-05{border-color:hsla(0,0%,100%,.05)}.b--white-025{border-color:hsla(0,0%,100%,.025)}.b--white-0125{border-color:hsla(0,0%,100%,.0125)}.b--black-90{border-color:rgba(0,0,0,.9)}.b--black-80{border-color:rgba(0,0,0,.8)}.b--black-70{border-color:rgba(0,0,0,.7)}.b--black-60{border-color:rgba(0,0,0,.6)}.b--black-50{border-color:rgba(0,0,0,.5)}.b--black-40{border-color:rgba(0,0,0,.4)}.b--black-30{border-color:rgba(0,0,0,.3)}.b--black-20{border-color:rgba(0,0,0,.2)}.b--black-10{border-color:rgba(0,0,0,.1)}.b--black-05{border-color:rgba(0,0,0,.05)}.b--black-025{border-color:rgba(0,0,0,.025)}.b--black-0125{border-color:rgba(0,0,0,.0125)}.b--dark-red{border-color:#e7040f}.b--red{border-color:#ff4136}.b--light-red{border-color:#ff725c}.b--orange{border-color:#ff6300}.b--gold{border-color:#ffb700}.b--yellow{border-color:gold}.b--light-yellow{border-color:#fbf1a9}.b--purple{border-color:#5e2ca5}.b--light-purple{border-color:#a463f2}.b--dark-pink{border-color:#d5008f}.b--hot-pink{border-color:#ff41b4}.b--pink{border-color:#ff80cc}.b--light-pink{border-color:#ffa3d7}.b--dark-green{border-color:#137752}.b--green{border-color:#19a974}.b--light-green{border-color:#9eebcf}.b--navy{border-color:#001b44}.b--dark-blue{border-color:#00449e}.b--blue{border-color:#357edd}.b--light-blue{border-color:#96ccff}.b--lightest-blue{border-color:#cdecff}.b--washed-blue{border-color:#f6fffe}.b--washed-green{border-color:#e8fdf5}.b--washed-yellow{border-color:#fffceb}.b--washed-red{border-color:#ffdfdf}.b--transparent{border-color:transparent}.b--inherit{border-color:inherit}.b--initial{border-color:initial}.b--unset{border-color:unset}.br0{border-radius:0}.br1{border-radius:.125rem}.br2{border-radius:.25rem}.br3{border-radius:.5rem}.br4{border-radius:1rem}.br-100{border-radius:100%}.br-pill{border-radius:9999px}.br--bottom{border-top-left-radius:0;border-top-right-radius:0}.br--top{border-bottom-right-radius:0}.br--right,.br--top{border-bottom-left-radius:0}.br--right{border-top-left-radius:0}.br--left{border-top-right-radius:0;border-bottom-right-radius:0}.br-inherit{border-radius:inherit}.br-initial{border-radius:initial}.br-unset{border-radius:unset}.b--dotted{border-style:dotted}.b--dashed{border-style:dashed}.b--solid{border-style:solid}.b--none{border-style:none}.bw0{border-width:0}.bw1{border-width:.125rem}.bw2{border-width:.25rem}.bw3{border-width:.5rem}.bw4{border-width:1rem}.bw5{border-width:2rem}.bt-0{border-top-width:0}.br-0{border-right-width:0}.bb-0{border-bottom-width:0}.bl-0{border-left-width:0}.shadow-1{box-shadow:0 0 4px 2px rgba(0,0,0,.2)}.shadow-2{box-shadow:0 0 8px 2px rgba(0,0,0,.2)}.shadow-3{box-shadow:2px 2px 4px 2px rgba(0,0,0,.2)}.shadow-4{box-shadow:2px 2px 8px 0 rgba(0,0,0,.2)}.shadow-5{box-shadow:4px 4px 8px 0 rgba(0,0,0,.2)}.pre{overflow-x:auto;overflow-y:hidden;overflow:scroll}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.top-1{top:1rem}.right-1{right:1rem}.bottom-1{bottom:1rem}.left-1{left:1rem}.top-2{top:2rem}.right-2{right:2rem}.bottom-2{bottom:2rem}.left-2{left:2rem}.top--1{top:-1rem}.right--1{right:-1rem}.bottom--1{bottom:-1rem}.left--1{left:-1rem}.top--2{top:-2rem}.right--2{right:-2rem}.bottom--2{bottom:-2rem}.left--2{left:-2rem}.absolute--fill{top:0;right:0;bottom:0;left:0}.cf:after,.cf:before{content:" ";display:table}.cf:after{clear:both}.cf{*zoom:1}.cl{clear:left}.cr{clear:right}.cb{clear:both}.cn{clear:none}.dn{display:none}.di{display:inline}.db{display:block}.dib{display:inline-block}.dit{display:inline-table}.dt{display:table}.dtc{display:table-cell}.dt-row{display:table-row}.dt-row-group{display:table-row-group}.dt-column{display:table-column}.dt-column-group{display:table-column-group}.dt--fixed{table-layout:fixed;width:100%}.flex{display:flex}.inline-flex{display:inline-flex}.flex-auto{flex:1 1 auto;min-width:0;min-height:0}.flex-none{flex:none}.flex-column{flex-direction:column}.flex-row{flex-direction:row}.flex-wrap{flex-wrap:wrap}.flex-nowrap{flex-wrap:nowrap}.flex-wrap-reverse{flex-wrap:wrap-reverse}.flex-column-reverse{flex-direction:column-reverse}.flex-row-reverse{flex-direction:row-reverse}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-baseline{align-self:baseline}.self-stretch{align-self:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-stretch{align-content:stretch}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-last{order:99999}.flex-grow-0{flex-grow:0}.flex-grow-1{flex-grow:1}.flex-shrink-0{flex-shrink:0}.flex-shrink-1{flex-shrink:1}.fl{float:left}.fl,.fr{_display:inline}.fr{float:right}.fn{float:none}.sans-serif{font-family:-apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue,helvetica,ubuntu,roboto,noto,segoe ui,arial,sans-serif}.serif{font-family:georgia,times,serif}.system-sans-serif{font-family:sans-serif}.system-serif{font-family:serif}.code,code{font-family:Consolas,monaco,monospace}.courier{font-family:Courier Next,courier,monospace}.helvetica{font-family:helvetica neue,helvetica,sans-serif}.avenir{font-family:avenir next,avenir,sans-serif}.athelas{font-family:athelas,georgia,serif}.georgia{font-family:georgia,serif}.times{font-family:times,serif}.bodoni{font-family:Bodoni MT,serif}.calisto{font-family:Calisto MT,serif}.garamond{font-family:garamond,serif}.baskerville{font-family:baskerville,serif}.i{font-style:italic}.fs-normal{font-style:normal}.normal{font-weight:400}.b{font-weight:700}.fw1{font-weight:100}.fw2{font-weight:200}.fw3{font-weight:300}.fw4{font-weight:400}.fw5{font-weight:500}.fw6{font-weight:600}.fw7{font-weight:700}.fw8{font-weight:800}.fw9{font-weight:900}.input-reset{-webkit-appearance:none;-moz-appearance:none}.button-reset::-moz-focus-inner,.input-reset::-moz-focus-inner{border:0;padding:0}.h1{height:1rem}.h2{height:2rem}.h3{height:4rem}.h4{height:8rem}.h5{height:16rem}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.min-h-100{min-height:100%}.vh-25{height:25vh}.vh-50{height:50vh}.vh-75{height:75vh}.vh-100{height:100vh}.min-vh-100{min-height:100vh}.h-auto{height:auto}.h-inherit{height:inherit}.tracked{letter-spacing:.1em}.tracked-tight{letter-spacing:-.05em}.tracked-mega{letter-spacing:.25em}.lh-solid{line-height:1}.lh-title{line-height:1.25}.lh-copy{line-height:1.5}.link{text-decoration:none}.link,.link:active,.link:focus,.link:hover,.link:link,.link:visited{transition:color .15s ease-in}.link:focus{outline:1px dotted currentColor}.list{list-style-type:none}.mw-100{max-width:100%}.mw1{max-width:1rem}.mw2{max-width:2rem}.mw3{max-width:4rem}.mw4{max-width:8rem}.mw5{max-width:16rem}.mw6{max-width:32rem}.mw7{max-width:48rem}.mw8{max-width:64rem}.mw9{max-width:96rem}.mw-none{max-width:none}.w1{width:1rem}.w2{width:2rem}.w3{width:4rem}.w4{width:8rem}.w5{width:16rem}.w-10{width:10%}.w-20{width:20%}.w-25{width:25%}.w-30{width:30%}.w-33{width:33%}.w-34{width:34%}.w-40{width:40%}.w-50{width:50%}.w-60{width:60%}.w-70{width:70%}.w-75{width:75%}.w-80{width:80%}.w-90{width:90%}.w-100{width:100%}.w-third{width:33.33333%}.w-two-thirds{width:66.66667%}.w-auto{width:auto}.overflow-visible{overflow:visible}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.overflow-auto{overflow:auto}.overflow-x-visible{overflow-x:visible}.overflow-x-hidden{overflow-x:hidden}.overflow-x-scroll{overflow-x:scroll}.overflow-x-auto{overflow-x:auto}.overflow-y-visible{overflow-y:visible}.overflow-y-hidden{overflow-y:hidden}.overflow-y-scroll{overflow-y:scroll}.overflow-y-auto{overflow-y:auto}.static{position:static}.relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.o-100{opacity:1}.o-90{opacity:.9}.o-80{opacity:.8}.o-70{opacity:.7}.o-60{opacity:.6}.o-50{opacity:.5}.o-40{opacity:.4}.o-30{opacity:.3}.o-20{opacity:.2}.o-10{opacity:.1}.o-05{opacity:.05}.o-025{opacity:.025}.o-0{opacity:0}.rotate-45{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-135{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.rotate-225{-webkit-transform:rotate(225deg);transform:rotate(225deg)}.rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-315{-webkit-transform:rotate(315deg);transform:rotate(315deg)}.black-90{color:rgba(0,0,0,.9)}.black-80{color:rgba(0,0,0,.8)}.black-70{color:rgba(0,0,0,.7)}.black-60{color:rgba(0,0,0,.6)}.black-50{color:rgba(0,0,0,.5)}.black-40{color:rgba(0,0,0,.4)}.black-30{color:rgba(0,0,0,.3)}.black-20{color:rgba(0,0,0,.2)}.black-10{color:rgba(0,0,0,.1)}.black-05{color:rgba(0,0,0,.05)}.white-90{color:hsla(0,0%,100%,.9)}.white-80{color:hsla(0,0%,100%,.8)}.white-70{color:hsla(0,0%,100%,.7)}.white-60{color:hsla(0,0%,100%,.6)}.white-50{color:hsla(0,0%,100%,.5)}.white-40{color:hsla(0,0%,100%,.4)}.white-30{color:hsla(0,0%,100%,.3)}.white-20{color:hsla(0,0%,100%,.2)}.white-10{color:hsla(0,0%,100%,.1)}.black{color:#000}.near-black{color:#111}.dark-gray{color:#333}.mid-gray{color:#555}.gray{color:#777}.silver{color:#999}.light-silver{color:#aaa}.moon-gray{color:#ccc}.light-gray{color:#eee}.near-white{color:#f4f4f4}.white{color:#fff}.dark-red{color:#e7040f}.red{color:#ff4136}.light-red{color:#ff725c}.orange{color:#ff6300}.gold{color:#ffb700}.yellow{color:gold}.light-yellow{color:#fbf1a9}.purple{color:#5e2ca5}.light-purple{color:#a463f2}.dark-pink{color:#d5008f}.hot-pink{color:#ff41b4}.pink{color:#ff80cc}.light-pink{color:#ffa3d7}.dark-green{color:#137752}.green{color:#19a974}.light-green{color:#9eebcf}.navy{color:#001b44}.dark-blue{color:#00449e}.blue{color:#357edd}.light-blue{color:#96ccff}.lightest-blue{color:#cdecff}.washed-blue{color:#f6fffe}.washed-green{color:#e8fdf5}.washed-yellow{color:#fffceb}.washed-red{color:#ffdfdf}.color-inherit{color:inherit}.bg-black-90{background-color:rgba(0,0,0,.9)}.bg-black-80{background-color:rgba(0,0,0,.8)}.bg-black-70{background-color:rgba(0,0,0,.7)}.bg-black-60{background-color:rgba(0,0,0,.6)}.bg-black-50{background-color:rgba(0,0,0,.5)}.bg-black-40{background-color:rgba(0,0,0,.4)}.bg-black-30{background-color:rgba(0,0,0,.3)}.bg-black-20{background-color:rgba(0,0,0,.2)}.bg-black-10{background-color:rgba(0,0,0,.1)}.bg-black-05{background-color:rgba(0,0,0,.05)}.bg-white-90{background-color:hsla(0,0%,100%,.9)}.bg-white-80{background-color:hsla(0,0%,100%,.8)}.bg-white-70{background-color:hsla(0,0%,100%,.7)}.bg-white-60{background-color:hsla(0,0%,100%,.6)}.bg-white-50{background-color:hsla(0,0%,100%,.5)}.bg-white-40{background-color:hsla(0,0%,100%,.4)}.bg-white-30{background-color:hsla(0,0%,100%,.3)}.bg-white-20{background-color:hsla(0,0%,100%,.2)}.bg-white-10{background-color:hsla(0,0%,100%,.1)}.bg-black{background-color:#000}.bg-near-black{background-color:#111}.bg-dark-gray{background-color:#333}.bg-mid-gray{background-color:#555}.bg-gray{background-color:#777}.bg-silver{background-color:#999}.bg-light-silver{background-color:#aaa}.bg-moon-gray{background-color:#ccc}.bg-light-gray{background-color:#eee}.bg-near-white{background-color:#f4f4f4}.bg-white{background-color:#fff}.bg-transparent{background-color:transparent}.bg-dark-red{background-color:#e7040f}.bg-red{background-color:#ff4136}.bg-light-red{background-color:#ff725c}.bg-orange{background-color:#ff6300}.bg-gold{background-color:#ffb700}.bg-yellow{background-color:gold}.bg-light-yellow{background-color:#fbf1a9}.bg-purple{background-color:#5e2ca5}.bg-light-purple{background-color:#a463f2}.bg-dark-pink{background-color:#d5008f}.bg-hot-pink{background-color:#ff41b4}.bg-pink{background-color:#ff80cc}.bg-light-pink{background-color:#ffa3d7}.bg-dark-green{background-color:#137752}.bg-green{background-color:#19a974}.bg-light-green{background-color:#9eebcf}.bg-navy{background-color:#001b44}.bg-dark-blue{background-color:#00449e}.bg-blue{background-color:#357edd}.bg-light-blue{background-color:#96ccff}.bg-lightest-blue{background-color:#cdecff}.bg-washed-blue{background-color:#f6fffe}.bg-washed-green{background-color:#e8fdf5}.bg-washed-yellow{background-color:#fffceb}.bg-washed-red{background-color:#ffdfdf}.bg-inherit{background-color:inherit}.hover-black:focus,.hover-black:hover{color:#000}.hover-near-black:focus,.hover-near-black:hover{color:#111}.hover-dark-gray:focus,.hover-dark-gray:hover{color:#333}.hover-mid-gray:focus,.hover-mid-gray:hover{color:#555}.hover-gray:focus,.hover-gray:hover{color:#777}.hover-silver:focus,.hover-silver:hover{color:#999}.hover-light-silver:focus,.hover-light-silver:hover{color:#aaa}.hover-moon-gray:focus,.hover-moon-gray:hover{color:#ccc}.hover-light-gray:focus,.hover-light-gray:hover{color:#eee}.hover-near-white:focus,.hover-near-white:hover{color:#f4f4f4}.hover-white:focus,.hover-white:hover{color:#fff}.hover-black-90:focus,.hover-black-90:hover{color:rgba(0,0,0,.9)}.hover-black-80:focus,.hover-black-80:hover{color:rgba(0,0,0,.8)}.hover-black-70:focus,.hover-black-70:hover{color:rgba(0,0,0,.7)}.hover-black-60:focus,.hover-black-60:hover{color:rgba(0,0,0,.6)}.hover-black-50:focus,.hover-black-50:hover{color:rgba(0,0,0,.5)}.hover-black-40:focus,.hover-black-40:hover{color:rgba(0,0,0,.4)}.hover-black-30:focus,.hover-black-30:hover{color:rgba(0,0,0,.3)}.hover-black-20:focus,.hover-black-20:hover{color:rgba(0,0,0,.2)}.hover-black-10:focus,.hover-black-10:hover{color:rgba(0,0,0,.1)}.hover-white-90:focus,.hover-white-90:hover{color:hsla(0,0%,100%,.9)}.hover-white-80:focus,.hover-white-80:hover{color:hsla(0,0%,100%,.8)}.hover-white-70:focus,.hover-white-70:hover{color:hsla(0,0%,100%,.7)}.hover-white-60:focus,.hover-white-60:hover{color:hsla(0,0%,100%,.6)}.hover-white-50:focus,.hover-white-50:hover{color:hsla(0,0%,100%,.5)}.hover-white-40:focus,.hover-white-40:hover{color:hsla(0,0%,100%,.4)}.hover-white-30:focus,.hover-white-30:hover{color:hsla(0,0%,100%,.3)}.hover-white-20:focus,.hover-white-20:hover{color:hsla(0,0%,100%,.2)}.hover-white-10:focus,.hover-white-10:hover{color:hsla(0,0%,100%,.1)}.hover-inherit:focus,.hover-inherit:hover{color:inherit}.hover-bg-black:focus,.hover-bg-black:hover{background-color:#000}.hover-bg-near-black:focus,.hover-bg-near-black:hover{background-color:#111}.hover-bg-dark-gray:focus,.hover-bg-dark-gray:hover{background-color:#333}.hover-bg-mid-gray:focus,.hover-bg-mid-gray:hover{background-color:#555}.hover-bg-gray:focus,.hover-bg-gray:hover{background-color:#777}.hover-bg-silver:focus,.hover-bg-silver:hover{background-color:#999}.hover-bg-light-silver:focus,.hover-bg-light-silver:hover{background-color:#aaa}.hover-bg-moon-gray:focus,.hover-bg-moon-gray:hover{background-color:#ccc}.hover-bg-light-gray:focus,.hover-bg-light-gray:hover{background-color:#eee}.hover-bg-near-white:focus,.hover-bg-near-white:hover{background-color:#f4f4f4}.hover-bg-white:focus,.hover-bg-white:hover{background-color:#fff}.hover-bg-transparent:focus,.hover-bg-transparent:hover{background-color:transparent}.hover-bg-black-90:focus,.hover-bg-black-90:hover{background-color:rgba(0,0,0,.9)}.hover-bg-black-80:focus,.hover-bg-black-80:hover{background-color:rgba(0,0,0,.8)}.hover-bg-black-70:focus,.hover-bg-black-70:hover{background-color:rgba(0,0,0,.7)}.hover-bg-black-60:focus,.hover-bg-black-60:hover{background-color:rgba(0,0,0,.6)}.hover-bg-black-50:focus,.hover-bg-black-50:hover{background-color:rgba(0,0,0,.5)}.hover-bg-black-40:focus,.hover-bg-black-40:hover{background-color:rgba(0,0,0,.4)}.hover-bg-black-30:focus,.hover-bg-black-30:hover{background-color:rgba(0,0,0,.3)}.hover-bg-black-20:focus,.hover-bg-black-20:hover{background-color:rgba(0,0,0,.2)}.hover-bg-black-10:focus,.hover-bg-black-10:hover{background-color:rgba(0,0,0,.1)}.hover-bg-white-90:focus,.hover-bg-white-90:hover{background-color:hsla(0,0%,100%,.9)}.hover-bg-white-80:focus,.hover-bg-white-80:hover{background-color:hsla(0,0%,100%,.8)}.hover-bg-white-70:focus,.hover-bg-white-70:hover{background-color:hsla(0,0%,100%,.7)}.hover-bg-white-60:focus,.hover-bg-white-60:hover{background-color:hsla(0,0%,100%,.6)}.hover-bg-white-50:focus,.hover-bg-white-50:hover{background-color:hsla(0,0%,100%,.5)}.hover-bg-white-40:focus,.hover-bg-white-40:hover{background-color:hsla(0,0%,100%,.4)}.hover-bg-white-30:focus,.hover-bg-white-30:hover{background-color:hsla(0,0%,100%,.3)}.hover-bg-white-20:focus,.hover-bg-white-20:hover{background-color:hsla(0,0%,100%,.2)}.hover-bg-white-10:focus,.hover-bg-white-10:hover{background-color:hsla(0,0%,100%,.1)}.hover-dark-red:focus,.hover-dark-red:hover{color:#e7040f}.hover-red:focus,.hover-red:hover{color:#ff4136}.hover-light-red:focus,.hover-light-red:hover{color:#ff725c}.hover-orange:focus,.hover-orange:hover{color:#ff6300}.hover-gold:focus,.hover-gold:hover{color:#ffb700}.hover-yellow:focus,.hover-yellow:hover{color:gold}.hover-light-yellow:focus,.hover-light-yellow:hover{color:#fbf1a9}.hover-purple:focus,.hover-purple:hover{color:#5e2ca5}.hover-light-purple:focus,.hover-light-purple:hover{color:#a463f2}.hover-dark-pink:focus,.hover-dark-pink:hover{color:#d5008f}.hover-hot-pink:focus,.hover-hot-pink:hover{color:#ff41b4}.hover-pink:focus,.hover-pink:hover{color:#ff80cc}.hover-light-pink:focus,.hover-light-pink:hover{color:#ffa3d7}.hover-dark-green:focus,.hover-dark-green:hover{color:#137752}.hover-green:focus,.hover-green:hover{color:#19a974}.hover-light-green:focus,.hover-light-green:hover{color:#9eebcf}.hover-navy:focus,.hover-navy:hover{color:#001b44}.hover-dark-blue:focus,.hover-dark-blue:hover{color:#00449e}.hover-blue:focus,.hover-blue:hover{color:#357edd}.hover-light-blue:focus,.hover-light-blue:hover{color:#96ccff}.hover-lightest-blue:focus,.hover-lightest-blue:hover{color:#cdecff}.hover-washed-blue:focus,.hover-washed-blue:hover{color:#f6fffe}.hover-washed-green:focus,.hover-washed-green:hover{color:#e8fdf5}.hover-washed-yellow:focus,.hover-washed-yellow:hover{color:#fffceb}.hover-washed-red:focus,.hover-washed-red:hover{color:#ffdfdf}.hover-bg-dark-red:focus,.hover-bg-dark-red:hover{background-color:#e7040f}.hover-bg-red:focus,.hover-bg-red:hover{background-color:#ff4136}.hover-bg-light-red:focus,.hover-bg-light-red:hover{background-color:#ff725c}.hover-bg-orange:focus,.hover-bg-orange:hover{background-color:#ff6300}.hover-bg-gold:focus,.hover-bg-gold:hover{background-color:#ffb700}.hover-bg-yellow:focus,.hover-bg-yellow:hover{background-color:gold}.hover-bg-light-yellow:focus,.hover-bg-light-yellow:hover{background-color:#fbf1a9}.hover-bg-purple:focus,.hover-bg-purple:hover{background-color:#5e2ca5}.hover-bg-light-purple:focus,.hover-bg-light-purple:hover{background-color:#a463f2}.hover-bg-dark-pink:focus,.hover-bg-dark-pink:hover{background-color:#d5008f}.hover-bg-hot-pink:focus,.hover-bg-hot-pink:hover{background-color:#ff41b4}.hover-bg-pink:focus,.hover-bg-pink:hover{background-color:#ff80cc}.hover-bg-light-pink:focus,.hover-bg-light-pink:hover{background-color:#ffa3d7}.hover-bg-dark-green:focus,.hover-bg-dark-green:hover{background-color:#137752}.hover-bg-green:focus,.hover-bg-green:hover{background-color:#19a974}.hover-bg-light-green:focus,.hover-bg-light-green:hover{background-color:#9eebcf}.hover-bg-navy:focus,.hover-bg-navy:hover{background-color:#001b44}.hover-bg-dark-blue:focus,.hover-bg-dark-blue:hover{background-color:#00449e}.hover-bg-blue:focus,.hover-bg-blue:hover{background-color:#357edd}.hover-bg-light-blue:focus,.hover-bg-light-blue:hover{background-color:#96ccff}.hover-bg-lightest-blue:focus,.hover-bg-lightest-blue:hover{background-color:#cdecff}.hover-bg-washed-blue:focus,.hover-bg-washed-blue:hover{background-color:#f6fffe}.hover-bg-washed-green:focus,.hover-bg-washed-green:hover{background-color:#e8fdf5}.hover-bg-washed-yellow:focus,.hover-bg-washed-yellow:hover{background-color:#fffceb}.hover-bg-washed-red:focus,.hover-bg-washed-red:hover{background-color:#ffdfdf}.hover-bg-inherit:focus,.hover-bg-inherit:hover{background-color:inherit}.pa0{padding:0}.pa1{padding:.25rem}.pa2{padding:.5rem}.pa3{padding:1rem}.pa4{padding:2rem}.pa5{padding:4rem}.pa6{padding:8rem}.pa7{padding:16rem}.pl0{padding-left:0}.pl1{padding-left:.25rem}.pl2{padding-left:.5rem}.pl3{padding-left:1rem}.pl4{padding-left:2rem}.pl5{padding-left:4rem}.pl6{padding-left:8rem}.pl7{padding-left:16rem}.pr0{padding-right:0}.pr1{padding-right:.25rem}.pr2{padding-right:.5rem}.pr3{padding-right:1rem}.pr4{padding-right:2rem}.pr5{padding-right:4rem}.pr6{padding-right:8rem}.pr7{padding-right:16rem}.pb0{padding-bottom:0}.pb1{padding-bottom:.25rem}.pb2{padding-bottom:.5rem}.pb3{padding-bottom:1rem}.pb4{padding-bottom:2rem}.pb5{padding-bottom:4rem}.pb6{padding-bottom:8rem}.pb7{padding-bottom:16rem}.pt0{padding-top:0}.pt1{padding-top:.25rem}.pt2{padding-top:.5rem}.pt3{padding-top:1rem}.pt4{padding-top:2rem}.pt5{padding-top:4rem}.pt6{padding-top:8rem}.pt7{padding-top:16rem}.pv0{padding-top:0;padding-bottom:0}.pv1{padding-top:.25rem;padding-bottom:.25rem}.pv2{padding-top:.5rem;padding-bottom:.5rem}.pv3{padding-top:1rem;padding-bottom:1rem}.pv4{padding-top:2rem;padding-bottom:2rem}.pv5{padding-top:4rem;padding-bottom:4rem}.pv6{padding-top:8rem;padding-bottom:8rem}.pv7{padding-top:16rem;padding-bottom:16rem}.ph0{padding-left:0;padding-right:0}.ph1{padding-left:.25rem;padding-right:.25rem}.ph2{padding-left:.5rem;padding-right:.5rem}.ph3{padding-left:1rem;padding-right:1rem}.ph4{padding-left:2rem;padding-right:2rem}.ph5{padding-left:4rem;padding-right:4rem}.ph6{padding-left:8rem;padding-right:8rem}.ph7{padding-left:16rem;padding-right:16rem}.ma0{margin:0}.ma1{margin:.25rem}.ma2{margin:.5rem}.ma3{margin:1rem}.ma4{margin:2rem}.ma5{margin:4rem}.ma6{margin:8rem}.ma7{margin:16rem}.ml0{margin-left:0}.ml1{margin-left:.25rem}.ml2{margin-left:.5rem}.ml3{margin-left:1rem}.ml4{margin-left:2rem}.ml5{margin-left:4rem}.ml6{margin-left:8rem}.ml7{margin-left:16rem}.mr0{margin-right:0}.mr1{margin-right:.25rem}.mr2{margin-right:.5rem}.mr3{margin-right:1rem}.mr4{margin-right:2rem}.mr5{margin-right:4rem}.mr6{margin-right:8rem}.mr7{margin-right:16rem}.mb0{margin-bottom:0}.mb1{margin-bottom:.25rem}.mb2{margin-bottom:.5rem}.mb3{margin-bottom:1rem}.mb4{margin-bottom:2rem}.mb5{margin-bottom:4rem}.mb6{margin-bottom:8rem}.mb7{margin-bottom:16rem}.mt0{margin-top:0}.mt1{margin-top:.25rem}.mt2{margin-top:.5rem}.mt3{margin-top:1rem}.mt4{margin-top:2rem}.mt5{margin-top:4rem}.mt6{margin-top:8rem}.mt7{margin-top:16rem}.mv0{margin-top:0;margin-bottom:0}.mv1{margin-top:.25rem;margin-bottom:.25rem}.mv2{margin-top:.5rem;margin-bottom:.5rem}.mv3{margin-top:1rem;margin-bottom:1rem}.mv4{margin-top:2rem;margin-bottom:2rem}.mv5{margin-top:4rem;margin-bottom:4rem}.mv6{margin-top:8rem;margin-bottom:8rem}.mv7{margin-top:16rem;margin-bottom:16rem}.mh0{margin-left:0;margin-right:0}.mh1{margin-left:.25rem;margin-right:.25rem}.mh2{margin-left:.5rem;margin-right:.5rem}.mh3{margin-left:1rem;margin-right:1rem}.mh4{margin-left:2rem;margin-right:2rem}.mh5{margin-left:4rem;margin-right:4rem}.mh6{margin-left:8rem;margin-right:8rem}.mh7{margin-left:16rem;margin-right:16rem}.na1{margin:-.25rem}.na2{margin:-.5rem}.na3{margin:-1rem}.na4{margin:-2rem}.na5{margin:-4rem}.na6{margin:-8rem}.na7{margin:-16rem}.nl1{margin-left:-.25rem}.nl2{margin-left:-.5rem}.nl3{margin-left:-1rem}.nl4{margin-left:-2rem}.nl5{margin-left:-4rem}.nl6{margin-left:-8rem}.nl7{margin-left:-16rem}.nr1{margin-right:-.25rem}.nr2{margin-right:-.5rem}.nr3{margin-right:-1rem}.nr4{margin-right:-2rem}.nr5{margin-right:-4rem}.nr6{margin-right:-8rem}.nr7{margin-right:-16rem}.nb1{margin-bottom:-.25rem}.nb2{margin-bottom:-.5rem}.nb3{margin-bottom:-1rem}.nb4{margin-bottom:-2rem}.nb5{margin-bottom:-4rem}.nb6{margin-bottom:-8rem}.nb7{margin-bottom:-16rem}.nt1{margin-top:-.25rem}.nt2{margin-top:-.5rem}.nt3{margin-top:-1rem}.nt4{margin-top:-2rem}.nt5{margin-top:-4rem}.nt6{margin-top:-8rem}.nt7{margin-top:-16rem}.collapse{border-collapse:collapse;border-spacing:0}.striped--light-silver:nth-child(odd){background-color:#aaa}.striped--moon-gray:nth-child(odd){background-color:#ccc}.striped--light-gray:nth-child(odd){background-color:#eee}.striped--near-white:nth-child(odd){background-color:#f4f4f4}.stripe-light:nth-child(odd){background-color:hsla(0,0%,100%,.1)}.stripe-dark:nth-child(odd){background-color:rgba(0,0,0,.1)}.strike{text-decoration:line-through}.underline{text-decoration:underline}.no-underline{text-decoration:none}.tl{text-align:left}.tr{text-align:right}.tc{text-align:center}.tj{text-align:justify}.ttc{text-transform:capitalize}.ttl{text-transform:lowercase}.ttu{text-transform:uppercase}.ttn{text-transform:none}.f-6,.f-headline{font-size:6rem}.f-5,.f-subheadline{font-size:5rem}.f1{font-size:3rem}.f2{font-size:2.25rem}.f3{font-size:1.5rem}.f4{font-size:1.25rem}.f5{font-size:1rem}.f6{font-size:.875rem}.f7{font-size:.75rem}.measure{max-width:30em}.measure-wide{max-width:34em}.measure-narrow{max-width:20em}.indent{text-indent:1em;margin-top:0;margin-bottom:0}.small-caps{font-variant:small-caps}.truncate{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.overflow-container{overflow-y:scroll}.center{margin-left:auto}.center,.mr-auto{margin-right:auto}.ml-auto{margin-left:auto}.clip{position:fixed!important;_position:absolute!important;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px)}.ws-normal{white-space:normal}.nowrap{white-space:nowrap}.pre{white-space:pre}.v-base{vertical-align:baseline}.v-mid{vertical-align:middle}.v-top{vertical-align:top}.v-btm{vertical-align:bottom}.dim{opacity:1}.dim,.dim:focus,.dim:hover{transition:opacity .15s ease-in}.dim:focus,.dim:hover{opacity:.5}.dim:active{opacity:.8;transition:opacity .15s ease-out}.glow,.glow:focus,.glow:hover{transition:opacity .15s ease-in}.glow:focus,.glow:hover{opacity:1}.hide-child .child{opacity:0;transition:opacity .15s ease-in}.hide-child:active .child,.hide-child:focus .child,.hide-child:hover .child{opacity:1;transition:opacity .15s ease-in}.underline-hover:focus,.underline-hover:hover{text-decoration:underline}.grow{-moz-osx-font-smoothing:grayscale;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-transform:translateZ(0);transform:translateZ(0);transition:-webkit-transform .25s ease-out;transition:transform .25s ease-out;transition:transform .25s ease-out,-webkit-transform .25s ease-out}.grow:focus,.grow:hover{-webkit-transform:scale(1.05);transform:scale(1.05)}.grow:active{-webkit-transform:scale(.9);transform:scale(.9)}.grow-large{-moz-osx-font-smoothing:grayscale;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-transform:translateZ(0);transform:translateZ(0);transition:-webkit-transform .25s ease-in-out;transition:transform .25s ease-in-out;transition:transform .25s ease-in-out,-webkit-transform .25s ease-in-out}.grow-large:focus,.grow-large:hover{-webkit-transform:scale(1.2);transform:scale(1.2)}.grow-large:active{-webkit-transform:scale(.95);transform:scale(.95)}.pointer:hover,.shadow-hover{cursor:pointer}.shadow-hover{position:relative;transition:all .5s cubic-bezier(.165,.84,.44,1)}.shadow-hover:after{content:"";box-shadow:0 0 16px 2px rgba(0,0,0,.2);border-radius:inherit;opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;transition:opacity .5s cubic-bezier(.165,.84,.44,1)}.shadow-hover:focus:after,.shadow-hover:hover:after{opacity:1}.bg-animate,.bg-animate:focus,.bg-animate:hover{transition:background-color .15s ease-in-out}.z-0{z-index:0}.z-1{z-index:1}.z-2{z-index:2}.z-3{z-index:3}.z-4{z-index:4}.z-5{z-index:5}.z-999{z-index:999}.z-9999{z-index:9999}.z-max{z-index:2147483647}.z-inherit{z-index:inherit}.z-initial{z-index:auto}.z-unset{z-index:unset}.nested-copy-line-height ol,.nested-copy-line-height p,.nested-copy-line-height ul{line-height:1.5}.nested-headline-line-height h1,.nested-headline-line-height h2,.nested-headline-line-height h3,.nested-headline-line-height h4,.nested-headline-line-height h5,.nested-headline-line-height h6{line-height:1.25}.nested-list-reset ol,.nested-list-reset ul{padding-left:0;margin-left:0;list-style-type:none}.nested-copy-indent p+p{text-indent:1em;margin-top:0;margin-bottom:0}.nested-copy-separator p+p{margin-top:1.5em}.nested-img img{width:100%;max-width:100%;display:block}.nested-links a{color:#357edd;transition:color .15s ease-in}.nested-links a:focus,.nested-links a:hover{color:#96ccff;transition:color .15s ease-in}.debug *{outline:1px solid gold}.debug-white *{outline:1px solid #fff}.debug-black *{outline:1px solid #000}.debug-grid{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAFElEQVR4AWPAC97/9x0eCsAEPgwAVLshdpENIxcAAAAASUVORK5CYII=) repeat 0 0}.debug-grid-16{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMklEQVR4AWOgCLz/b0epAa6UGuBOqQHOQHLUgFEDnAbcBZ4UGwDOkiCnkIhdgNgNxAYAiYlD+8sEuo8AAAAASUVORK5CYII=) repeat 0 0}.debug-grid-8-solid{background:#fff url(data:image/gif;base64,R0lGODdhCAAIAPEAAADw/wDx/////wAAACwAAAAACAAIAAACDZQvgaeb/lxbAIKA8y0AOw==) repeat 0 0}.debug-grid-16-solid{background:#fff url(data:image/gif;base64,R0lGODdhEAAQAPEAAADw/wDx/xXy/////ywAAAAAEAAQAAACIZyPKckYDQFsb6ZqD85jZ2+BkwiRFKehhqQCQgDHcgwEBQA7) repeat 0 0}@media screen and (min-width:30em){.aspect-ratio-ns{height:0;position:relative}.aspect-ratio--16x9-ns{padding-bottom:56.25%}.aspect-ratio--9x16-ns{padding-bottom:177.77%}.aspect-ratio--4x3-ns{padding-bottom:75%}.aspect-ratio--3x4-ns{padding-bottom:133.33%}.aspect-ratio--6x4-ns{padding-bottom:66.6%}.aspect-ratio--4x6-ns{padding-bottom:150%}.aspect-ratio--8x5-ns{padding-bottom:62.5%}.aspect-ratio--5x8-ns{padding-bottom:160%}.aspect-ratio--7x5-ns{padding-bottom:71.42%}.aspect-ratio--5x7-ns{padding-bottom:140%}.aspect-ratio--1x1-ns{padding-bottom:100%}.aspect-ratio--object-ns{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;z-index:100}.cover-ns{background-size:cover!important}.contain-ns{background-size:contain!important}.bg-center-ns{background-position:50%}.bg-center-ns,.bg-top-ns{background-repeat:no-repeat}.bg-top-ns{background-position:top}.bg-right-ns{background-position:100%}.bg-bottom-ns,.bg-right-ns{background-repeat:no-repeat}.bg-bottom-ns{background-position:bottom}.bg-left-ns{background-repeat:no-repeat;background-position:0}.outline-ns{outline:1px solid}.outline-transparent-ns{outline:1px solid transparent}.outline-0-ns{outline:0}.ba-ns{border-style:solid;border-width:1px}.bt-ns{border-top-style:solid;border-top-width:1px}.br-ns{border-right-style:solid;border-right-width:1px}.bb-ns{border-bottom-style:solid;border-bottom-width:1px}.bl-ns{border-left-style:solid;border-left-width:1px}.bn-ns{border-style:none;border-width:0}.br0-ns{border-radius:0}.br1-ns{border-radius:.125rem}.br2-ns{border-radius:.25rem}.br3-ns{border-radius:.5rem}.br4-ns{border-radius:1rem}.br-100-ns{border-radius:100%}.br-pill-ns{border-radius:9999px}.br--bottom-ns{border-top-left-radius:0;border-top-right-radius:0}.br--top-ns{border-bottom-right-radius:0}.br--right-ns,.br--top-ns{border-bottom-left-radius:0}.br--right-ns{border-top-left-radius:0}.br--left-ns{border-top-right-radius:0;border-bottom-right-radius:0}.br-inherit-ns{border-radius:inherit}.br-initial-ns{border-radius:initial}.br-unset-ns{border-radius:unset}.b--dotted-ns{border-style:dotted}.b--dashed-ns{border-style:dashed}.b--solid-ns{border-style:solid}.b--none-ns{border-style:none}.bw0-ns{border-width:0}.bw1-ns{border-width:.125rem}.bw2-ns{border-width:.25rem}.bw3-ns{border-width:.5rem}.bw4-ns{border-width:1rem}.bw5-ns{border-width:2rem}.bt-0-ns{border-top-width:0}.br-0-ns{border-right-width:0}.bb-0-ns{border-bottom-width:0}.bl-0-ns{border-left-width:0}.shadow-1-ns{box-shadow:0 0 4px 2px rgba(0,0,0,.2)}.shadow-2-ns{box-shadow:0 0 8px 2px rgba(0,0,0,.2)}.shadow-3-ns{box-shadow:2px 2px 4px 2px rgba(0,0,0,.2)}.shadow-4-ns{box-shadow:2px 2px 8px 0 rgba(0,0,0,.2)}.shadow-5-ns{box-shadow:4px 4px 8px 0 rgba(0,0,0,.2)}.top-0-ns{top:0}.left-0-ns{left:0}.right-0-ns{right:0}.bottom-0-ns{bottom:0}.top-1-ns{top:1rem}.left-1-ns{left:1rem}.right-1-ns{right:1rem}.bottom-1-ns{bottom:1rem}.top-2-ns{top:2rem}.left-2-ns{left:2rem}.right-2-ns{right:2rem}.bottom-2-ns{bottom:2rem}.top--1-ns{top:-1rem}.right--1-ns{right:-1rem}.bottom--1-ns{bottom:-1rem}.left--1-ns{left:-1rem}.top--2-ns{top:-2rem}.right--2-ns{right:-2rem}.bottom--2-ns{bottom:-2rem}.left--2-ns{left:-2rem}.absolute--fill-ns{top:0;right:0;bottom:0;left:0}.cl-ns{clear:left}.cr-ns{clear:right}.cb-ns{clear:both}.cn-ns{clear:none}.dn-ns{display:none}.di-ns{display:inline}.db-ns{display:block}.dib-ns{display:inline-block}.dit-ns{display:inline-table}.dt-ns{display:table}.dtc-ns{display:table-cell}.dt-row-ns{display:table-row}.dt-row-group-ns{display:table-row-group}.dt-column-ns{display:table-column}.dt-column-group-ns{display:table-column-group}.dt--fixed-ns{table-layout:fixed;width:100%}.flex-ns{display:flex}.inline-flex-ns{display:inline-flex}.flex-auto-ns{flex:1 1 auto;min-width:0;min-height:0}.flex-none-ns{flex:none}.flex-column-ns{flex-direction:column}.flex-row-ns{flex-direction:row}.flex-wrap-ns{flex-wrap:wrap}.flex-nowrap-ns{flex-wrap:nowrap}.flex-wrap-reverse-ns{flex-wrap:wrap-reverse}.flex-column-reverse-ns{flex-direction:column-reverse}.flex-row-reverse-ns{flex-direction:row-reverse}.items-start-ns{align-items:flex-start}.items-end-ns{align-items:flex-end}.items-center-ns{align-items:center}.items-baseline-ns{align-items:baseline}.items-stretch-ns{align-items:stretch}.self-start-ns{align-self:flex-start}.self-end-ns{align-self:flex-end}.self-center-ns{align-self:center}.self-baseline-ns{align-self:baseline}.self-stretch-ns{align-self:stretch}.justify-start-ns{justify-content:flex-start}.justify-end-ns{justify-content:flex-end}.justify-center-ns{justify-content:center}.justify-between-ns{justify-content:space-between}.justify-around-ns{justify-content:space-around}.content-start-ns{align-content:flex-start}.content-end-ns{align-content:flex-end}.content-center-ns{align-content:center}.content-between-ns{align-content:space-between}.content-around-ns{align-content:space-around}.content-stretch-ns{align-content:stretch}.order-0-ns{order:0}.order-1-ns{order:1}.order-2-ns{order:2}.order-3-ns{order:3}.order-4-ns{order:4}.order-5-ns{order:5}.order-6-ns{order:6}.order-7-ns{order:7}.order-8-ns{order:8}.order-last-ns{order:99999}.flex-grow-0-ns{flex-grow:0}.flex-grow-1-ns{flex-grow:1}.flex-shrink-0-ns{flex-shrink:0}.flex-shrink-1-ns{flex-shrink:1}.fl-ns{float:left}.fl-ns,.fr-ns{_display:inline}.fr-ns{float:right}.fn-ns{float:none}.i-ns{font-style:italic}.fs-normal-ns{font-style:normal}.normal-ns{font-weight:400}.b-ns{font-weight:700}.fw1-ns{font-weight:100}.fw2-ns{font-weight:200}.fw3-ns{font-weight:300}.fw4-ns{font-weight:400}.fw5-ns{font-weight:500}.fw6-ns{font-weight:600}.fw7-ns{font-weight:700}.fw8-ns{font-weight:800}.fw9-ns{font-weight:900}.h1-ns{height:1rem}.h2-ns{height:2rem}.h3-ns{height:4rem}.h4-ns{height:8rem}.h5-ns{height:16rem}.h-25-ns{height:25%}.h-50-ns{height:50%}.h-75-ns{height:75%}.h-100-ns{height:100%}.min-h-100-ns{min-height:100%}.vh-25-ns{height:25vh}.vh-50-ns{height:50vh}.vh-75-ns{height:75vh}.vh-100-ns{height:100vh}.min-vh-100-ns{min-height:100vh}.h-auto-ns{height:auto}.h-inherit-ns{height:inherit}.tracked-ns{letter-spacing:.1em}.tracked-tight-ns{letter-spacing:-.05em}.tracked-mega-ns{letter-spacing:.25em}.lh-solid-ns{line-height:1}.lh-title-ns{line-height:1.25}.lh-copy-ns{line-height:1.5}.mw-100-ns{max-width:100%}.mw1-ns{max-width:1rem}.mw2-ns{max-width:2rem}.mw3-ns{max-width:4rem}.mw4-ns{max-width:8rem}.mw5-ns{max-width:16rem}.mw6-ns{max-width:32rem}.mw7-ns{max-width:48rem}.mw8-ns{max-width:64rem}.mw9-ns{max-width:96rem}.mw-none-ns{max-width:none}.w1-ns{width:1rem}.w2-ns{width:2rem}.w3-ns{width:4rem}.w4-ns{width:8rem}.w5-ns{width:16rem}.w-10-ns{width:10%}.w-20-ns{width:20%}.w-25-ns{width:25%}.w-30-ns{width:30%}.w-33-ns{width:33%}.w-34-ns{width:34%}.w-40-ns{width:40%}.w-50-ns{width:50%}.w-60-ns{width:60%}.w-70-ns{width:70%}.w-75-ns{width:75%}.w-80-ns{width:80%}.w-90-ns{width:90%}.w-100-ns{width:100%}.w-third-ns{width:33.33333%}.w-two-thirds-ns{width:66.66667%}.w-auto-ns{width:auto}.overflow-visible-ns{overflow:visible}.overflow-hidden-ns{overflow:hidden}.overflow-scroll-ns{overflow:scroll}.overflow-auto-ns{overflow:auto}.overflow-x-visible-ns{overflow-x:visible}.overflow-x-hidden-ns{overflow-x:hidden}.overflow-x-scroll-ns{overflow-x:scroll}.overflow-x-auto-ns{overflow-x:auto}.overflow-y-visible-ns{overflow-y:visible}.overflow-y-hidden-ns{overflow-y:hidden}.overflow-y-scroll-ns{overflow-y:scroll}.overflow-y-auto-ns{overflow-y:auto}.static-ns{position:static}.relative-ns{position:relative}.absolute-ns{position:absolute}.fixed-ns{position:fixed}.rotate-45-ns{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-90-ns{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-135-ns{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.rotate-180-ns{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.rotate-225-ns{-webkit-transform:rotate(225deg);transform:rotate(225deg)}.rotate-270-ns{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-315-ns{-webkit-transform:rotate(315deg);transform:rotate(315deg)}.pa0-ns{padding:0}.pa1-ns{padding:.25rem}.pa2-ns{padding:.5rem}.pa3-ns{padding:1rem}.pa4-ns{padding:2rem}.pa5-ns{padding:4rem}.pa6-ns{padding:8rem}.pa7-ns{padding:16rem}.pl0-ns{padding-left:0}.pl1-ns{padding-left:.25rem}.pl2-ns{padding-left:.5rem}.pl3-ns{padding-left:1rem}.pl4-ns{padding-left:2rem}.pl5-ns{padding-left:4rem}.pl6-ns{padding-left:8rem}.pl7-ns{padding-left:16rem}.pr0-ns{padding-right:0}.pr1-ns{padding-right:.25rem}.pr2-ns{padding-right:.5rem}.pr3-ns{padding-right:1rem}.pr4-ns{padding-right:2rem}.pr5-ns{padding-right:4rem}.pr6-ns{padding-right:8rem}.pr7-ns{padding-right:16rem}.pb0-ns{padding-bottom:0}.pb1-ns{padding-bottom:.25rem}.pb2-ns{padding-bottom:.5rem}.pb3-ns{padding-bottom:1rem}.pb4-ns{padding-bottom:2rem}.pb5-ns{padding-bottom:4rem}.pb6-ns{padding-bottom:8rem}.pb7-ns{padding-bottom:16rem}.pt0-ns{padding-top:0}.pt1-ns{padding-top:.25rem}.pt2-ns{padding-top:.5rem}.pt3-ns{padding-top:1rem}.pt4-ns{padding-top:2rem}.pt5-ns{padding-top:4rem}.pt6-ns{padding-top:8rem}.pt7-ns{padding-top:16rem}.pv0-ns{padding-top:0;padding-bottom:0}.pv1-ns{padding-top:.25rem;padding-bottom:.25rem}.pv2-ns{padding-top:.5rem;padding-bottom:.5rem}.pv3-ns{padding-top:1rem;padding-bottom:1rem}.pv4-ns{padding-top:2rem;padding-bottom:2rem}.pv5-ns{padding-top:4rem;padding-bottom:4rem}.pv6-ns{padding-top:8rem;padding-bottom:8rem}.pv7-ns{padding-top:16rem;padding-bottom:16rem}.ph0-ns{padding-left:0;padding-right:0}.ph1-ns{padding-left:.25rem;padding-right:.25rem}.ph2-ns{padding-left:.5rem;padding-right:.5rem}.ph3-ns{padding-left:1rem;padding-right:1rem}.ph4-ns{padding-left:2rem;padding-right:2rem}.ph5-ns{padding-left:4rem;padding-right:4rem}.ph6-ns{padding-left:8rem;padding-right:8rem}.ph7-ns{padding-left:16rem;padding-right:16rem}.ma0-ns{margin:0}.ma1-ns{margin:.25rem}.ma2-ns{margin:.5rem}.ma3-ns{margin:1rem}.ma4-ns{margin:2rem}.ma5-ns{margin:4rem}.ma6-ns{margin:8rem}.ma7-ns{margin:16rem}.ml0-ns{margin-left:0}.ml1-ns{margin-left:.25rem}.ml2-ns{margin-left:.5rem}.ml3-ns{margin-left:1rem}.ml4-ns{margin-left:2rem}.ml5-ns{margin-left:4rem}.ml6-ns{margin-left:8rem}.ml7-ns{margin-left:16rem}.mr0-ns{margin-right:0}.mr1-ns{margin-right:.25rem}.mr2-ns{margin-right:.5rem}.mr3-ns{margin-right:1rem}.mr4-ns{margin-right:2rem}.mr5-ns{margin-right:4rem}.mr6-ns{margin-right:8rem}.mr7-ns{margin-right:16rem}.mb0-ns{margin-bottom:0}.mb1-ns{margin-bottom:.25rem}.mb2-ns{margin-bottom:.5rem}.mb3-ns{margin-bottom:1rem}.mb4-ns{margin-bottom:2rem}.mb5-ns{margin-bottom:4rem}.mb6-ns{margin-bottom:8rem}.mb7-ns{margin-bottom:16rem}.mt0-ns{margin-top:0}.mt1-ns{margin-top:.25rem}.mt2-ns{margin-top:.5rem}.mt3-ns{margin-top:1rem}.mt4-ns{margin-top:2rem}.mt5-ns{margin-top:4rem}.mt6-ns{margin-top:8rem}.mt7-ns{margin-top:16rem}.mv0-ns{margin-top:0;margin-bottom:0}.mv1-ns{margin-top:.25rem;margin-bottom:.25rem}.mv2-ns{margin-top:.5rem;margin-bottom:.5rem}.mv3-ns{margin-top:1rem;margin-bottom:1rem}.mv4-ns{margin-top:2rem;margin-bottom:2rem}.mv5-ns{margin-top:4rem;margin-bottom:4rem}.mv6-ns{margin-top:8rem;margin-bottom:8rem}.mv7-ns{margin-top:16rem;margin-bottom:16rem}.mh0-ns{margin-left:0;margin-right:0}.mh1-ns{margin-left:.25rem;margin-right:.25rem}.mh2-ns{margin-left:.5rem;margin-right:.5rem}.mh3-ns{margin-left:1rem;margin-right:1rem}.mh4-ns{margin-left:2rem;margin-right:2rem}.mh5-ns{margin-left:4rem;margin-right:4rem}.mh6-ns{margin-left:8rem;margin-right:8rem}.mh7-ns{margin-left:16rem;margin-right:16rem}.na1-ns{margin:-.25rem}.na2-ns{margin:-.5rem}.na3-ns{margin:-1rem}.na4-ns{margin:-2rem}.na5-ns{margin:-4rem}.na6-ns{margin:-8rem}.na7-ns{margin:-16rem}.nl1-ns{margin-left:-.25rem}.nl2-ns{margin-left:-.5rem}.nl3-ns{margin-left:-1rem}.nl4-ns{margin-left:-2rem}.nl5-ns{margin-left:-4rem}.nl6-ns{margin-left:-8rem}.nl7-ns{margin-left:-16rem}.nr1-ns{margin-right:-.25rem}.nr2-ns{margin-right:-.5rem}.nr3-ns{margin-right:-1rem}.nr4-ns{margin-right:-2rem}.nr5-ns{margin-right:-4rem}.nr6-ns{margin-right:-8rem}.nr7-ns{margin-right:-16rem}.nb1-ns{margin-bottom:-.25rem}.nb2-ns{margin-bottom:-.5rem}.nb3-ns{margin-bottom:-1rem}.nb4-ns{margin-bottom:-2rem}.nb5-ns{margin-bottom:-4rem}.nb6-ns{margin-bottom:-8rem}.nb7-ns{margin-bottom:-16rem}.nt1-ns{margin-top:-.25rem}.nt2-ns{margin-top:-.5rem}.nt3-ns{margin-top:-1rem}.nt4-ns{margin-top:-2rem}.nt5-ns{margin-top:-4rem}.nt6-ns{margin-top:-8rem}.nt7-ns{margin-top:-16rem}.strike-ns{text-decoration:line-through}.underline-ns{text-decoration:underline}.no-underline-ns{text-decoration:none}.tl-ns{text-align:left}.tr-ns{text-align:right}.tc-ns{text-align:center}.tj-ns{text-align:justify}.ttc-ns{text-transform:capitalize}.ttl-ns{text-transform:lowercase}.ttu-ns{text-transform:uppercase}.ttn-ns{text-transform:none}.f-6-ns,.f-headline-ns{font-size:6rem}.f-5-ns,.f-subheadline-ns{font-size:5rem}.f1-ns{font-size:3rem}.f2-ns{font-size:2.25rem}.f3-ns{font-size:1.5rem}.f4-ns{font-size:1.25rem}.f5-ns{font-size:1rem}.f6-ns{font-size:.875rem}.f7-ns{font-size:.75rem}.measure-ns{max-width:30em}.measure-wide-ns{max-width:34em}.measure-narrow-ns{max-width:20em}.indent-ns{text-indent:1em;margin-top:0;margin-bottom:0}.small-caps-ns{font-variant:small-caps}.truncate-ns{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.center-ns{margin-left:auto}.center-ns,.mr-auto-ns{margin-right:auto}.ml-auto-ns{margin-left:auto}.clip-ns{position:fixed!important;_position:absolute!important;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px)}.ws-normal-ns{white-space:normal}.nowrap-ns{white-space:nowrap}.pre-ns{white-space:pre}.v-base-ns{vertical-align:baseline}.v-mid-ns{vertical-align:middle}.v-top-ns{vertical-align:top}.v-btm-ns{vertical-align:bottom}}@media screen and (min-width:30em) and (max-width:60em){.aspect-ratio-m{height:0;position:relative}.aspect-ratio--16x9-m{padding-bottom:56.25%}.aspect-ratio--9x16-m{padding-bottom:177.77%}.aspect-ratio--4x3-m{padding-bottom:75%}.aspect-ratio--3x4-m{padding-bottom:133.33%}.aspect-ratio--6x4-m{padding-bottom:66.6%}.aspect-ratio--4x6-m{padding-bottom:150%}.aspect-ratio--8x5-m{padding-bottom:62.5%}.aspect-ratio--5x8-m{padding-bottom:160%}.aspect-ratio--7x5-m{padding-bottom:71.42%}.aspect-ratio--5x7-m{padding-bottom:140%}.aspect-ratio--1x1-m{padding-bottom:100%}.aspect-ratio--object-m{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;z-index:100}.cover-m{background-size:cover!important}.contain-m{background-size:contain!important}.bg-center-m{background-position:50%}.bg-center-m,.bg-top-m{background-repeat:no-repeat}.bg-top-m{background-position:top}.bg-right-m{background-position:100%}.bg-bottom-m,.bg-right-m{background-repeat:no-repeat}.bg-bottom-m{background-position:bottom}.bg-left-m{background-repeat:no-repeat;background-position:0}.outline-m{outline:1px solid}.outline-transparent-m{outline:1px solid transparent}.outline-0-m{outline:0}.ba-m{border-style:solid;border-width:1px}.bt-m{border-top-style:solid;border-top-width:1px}.br-m{border-right-style:solid;border-right-width:1px}.bb-m{border-bottom-style:solid;border-bottom-width:1px}.bl-m{border-left-style:solid;border-left-width:1px}.bn-m{border-style:none;border-width:0}.br0-m{border-radius:0}.br1-m{border-radius:.125rem}.br2-m{border-radius:.25rem}.br3-m{border-radius:.5rem}.br4-m{border-radius:1rem}.br-100-m{border-radius:100%}.br-pill-m{border-radius:9999px}.br--bottom-m{border-top-left-radius:0;border-top-right-radius:0}.br--top-m{border-bottom-right-radius:0}.br--right-m,.br--top-m{border-bottom-left-radius:0}.br--right-m{border-top-left-radius:0}.br--left-m{border-top-right-radius:0;border-bottom-right-radius:0}.br-inherit-m{border-radius:inherit}.br-initial-m{border-radius:initial}.br-unset-m{border-radius:unset}.b--dotted-m{border-style:dotted}.b--dashed-m{border-style:dashed}.b--solid-m{border-style:solid}.b--none-m{border-style:none}.bw0-m{border-width:0}.bw1-m{border-width:.125rem}.bw2-m{border-width:.25rem}.bw3-m{border-width:.5rem}.bw4-m{border-width:1rem}.bw5-m{border-width:2rem}.bt-0-m{border-top-width:0}.br-0-m{border-right-width:0}.bb-0-m{border-bottom-width:0}.bl-0-m{border-left-width:0}.shadow-1-m{box-shadow:0 0 4px 2px rgba(0,0,0,.2)}.shadow-2-m{box-shadow:0 0 8px 2px rgba(0,0,0,.2)}.shadow-3-m{box-shadow:2px 2px 4px 2px rgba(0,0,0,.2)}.shadow-4-m{box-shadow:2px 2px 8px 0 rgba(0,0,0,.2)}.shadow-5-m{box-shadow:4px 4px 8px 0 rgba(0,0,0,.2)}.top-0-m{top:0}.left-0-m{left:0}.right-0-m{right:0}.bottom-0-m{bottom:0}.top-1-m{top:1rem}.left-1-m{left:1rem}.right-1-m{right:1rem}.bottom-1-m{bottom:1rem}.top-2-m{top:2rem}.left-2-m{left:2rem}.right-2-m{right:2rem}.bottom-2-m{bottom:2rem}.top--1-m{top:-1rem}.right--1-m{right:-1rem}.bottom--1-m{bottom:-1rem}.left--1-m{left:-1rem}.top--2-m{top:-2rem}.right--2-m{right:-2rem}.bottom--2-m{bottom:-2rem}.left--2-m{left:-2rem}.absolute--fill-m{top:0;right:0;bottom:0;left:0}.cl-m{clear:left}.cr-m{clear:right}.cb-m{clear:both}.cn-m{clear:none}.dn-m{display:none}.di-m{display:inline}.db-m{display:block}.dib-m{display:inline-block}.dit-m{display:inline-table}.dt-m{display:table}.dtc-m{display:table-cell}.dt-row-m{display:table-row}.dt-row-group-m{display:table-row-group}.dt-column-m{display:table-column}.dt-column-group-m{display:table-column-group}.dt--fixed-m{table-layout:fixed;width:100%}.flex-m{display:flex}.inline-flex-m{display:inline-flex}.flex-auto-m{flex:1 1 auto;min-width:0;min-height:0}.flex-none-m{flex:none}.flex-column-m{flex-direction:column}.flex-row-m{flex-direction:row}.flex-wrap-m{flex-wrap:wrap}.flex-nowrap-m{flex-wrap:nowrap}.flex-wrap-reverse-m{flex-wrap:wrap-reverse}.flex-column-reverse-m{flex-direction:column-reverse}.flex-row-reverse-m{flex-direction:row-reverse}.items-start-m{align-items:flex-start}.items-end-m{align-items:flex-end}.items-center-m{align-items:center}.items-baseline-m{align-items:baseline}.items-stretch-m{align-items:stretch}.self-start-m{align-self:flex-start}.self-end-m{align-self:flex-end}.self-center-m{align-self:center}.self-baseline-m{align-self:baseline}.self-stretch-m{align-self:stretch}.justify-start-m{justify-content:flex-start}.justify-end-m{justify-content:flex-end}.justify-center-m{justify-content:center}.justify-between-m{justify-content:space-between}.justify-around-m{justify-content:space-around}.content-start-m{align-content:flex-start}.content-end-m{align-content:flex-end}.content-center-m{align-content:center}.content-between-m{align-content:space-between}.content-around-m{align-content:space-around}.content-stretch-m{align-content:stretch}.order-0-m{order:0}.order-1-m{order:1}.order-2-m{order:2}.order-3-m{order:3}.order-4-m{order:4}.order-5-m{order:5}.order-6-m{order:6}.order-7-m{order:7}.order-8-m{order:8}.order-last-m{order:99999}.flex-grow-0-m{flex-grow:0}.flex-grow-1-m{flex-grow:1}.flex-shrink-0-m{flex-shrink:0}.flex-shrink-1-m{flex-shrink:1}.fl-m{float:left}.fl-m,.fr-m{_display:inline}.fr-m{float:right}.fn-m{float:none}.i-m{font-style:italic}.fs-normal-m{font-style:normal}.normal-m{font-weight:400}.b-m{font-weight:700}.fw1-m{font-weight:100}.fw2-m{font-weight:200}.fw3-m{font-weight:300}.fw4-m{font-weight:400}.fw5-m{font-weight:500}.fw6-m{font-weight:600}.fw7-m{font-weight:700}.fw8-m{font-weight:800}.fw9-m{font-weight:900}.h1-m{height:1rem}.h2-m{height:2rem}.h3-m{height:4rem}.h4-m{height:8rem}.h5-m{height:16rem}.h-25-m{height:25%}.h-50-m{height:50%}.h-75-m{height:75%}.h-100-m{height:100%}.min-h-100-m{min-height:100%}.vh-25-m{height:25vh}.vh-50-m{height:50vh}.vh-75-m{height:75vh}.vh-100-m{height:100vh}.min-vh-100-m{min-height:100vh}.h-auto-m{height:auto}.h-inherit-m{height:inherit}.tracked-m{letter-spacing:.1em}.tracked-tight-m{letter-spacing:-.05em}.tracked-mega-m{letter-spacing:.25em}.lh-solid-m{line-height:1}.lh-title-m{line-height:1.25}.lh-copy-m{line-height:1.5}.mw-100-m{max-width:100%}.mw1-m{max-width:1rem}.mw2-m{max-width:2rem}.mw3-m{max-width:4rem}.mw4-m{max-width:8rem}.mw5-m{max-width:16rem}.mw6-m{max-width:32rem}.mw7-m{max-width:48rem}.mw8-m{max-width:64rem}.mw9-m{max-width:96rem}.mw-none-m{max-width:none}.w1-m{width:1rem}.w2-m{width:2rem}.w3-m{width:4rem}.w4-m{width:8rem}.w5-m{width:16rem}.w-10-m{width:10%}.w-20-m{width:20%}.w-25-m{width:25%}.w-30-m{width:30%}.w-33-m{width:33%}.w-34-m{width:34%}.w-40-m{width:40%}.w-50-m{width:50%}.w-60-m{width:60%}.w-70-m{width:70%}.w-75-m{width:75%}.w-80-m{width:80%}.w-90-m{width:90%}.w-100-m{width:100%}.w-third-m{width:33.33333%}.w-two-thirds-m{width:66.66667%}.w-auto-m{width:auto}.overflow-visible-m{overflow:visible}.overflow-hidden-m{overflow:hidden}.overflow-scroll-m{overflow:scroll}.overflow-auto-m{overflow:auto}.overflow-x-visible-m{overflow-x:visible}.overflow-x-hidden-m{overflow-x:hidden}.overflow-x-scroll-m{overflow-x:scroll}.overflow-x-auto-m{overflow-x:auto}.overflow-y-visible-m{overflow-y:visible}.overflow-y-hidden-m{overflow-y:hidden}.overflow-y-scroll-m{overflow-y:scroll}.overflow-y-auto-m{overflow-y:auto}.static-m{position:static}.relative-m{position:relative}.absolute-m{position:absolute}.fixed-m{position:fixed}.rotate-45-m{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-90-m{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-135-m{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.rotate-180-m{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.rotate-225-m{-webkit-transform:rotate(225deg);transform:rotate(225deg)}.rotate-270-m{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-315-m{-webkit-transform:rotate(315deg);transform:rotate(315deg)}.pa0-m{padding:0}.pa1-m{padding:.25rem}.pa2-m{padding:.5rem}.pa3-m{padding:1rem}.pa4-m{padding:2rem}.pa5-m{padding:4rem}.pa6-m{padding:8rem}.pa7-m{padding:16rem}.pl0-m{padding-left:0}.pl1-m{padding-left:.25rem}.pl2-m{padding-left:.5rem}.pl3-m{padding-left:1rem}.pl4-m{padding-left:2rem}.pl5-m{padding-left:4rem}.pl6-m{padding-left:8rem}.pl7-m{padding-left:16rem}.pr0-m{padding-right:0}.pr1-m{padding-right:.25rem}.pr2-m{padding-right:.5rem}.pr3-m{padding-right:1rem}.pr4-m{padding-right:2rem}.pr5-m{padding-right:4rem}.pr6-m{padding-right:8rem}.pr7-m{padding-right:16rem}.pb0-m{padding-bottom:0}.pb1-m{padding-bottom:.25rem}.pb2-m{padding-bottom:.5rem}.pb3-m{padding-bottom:1rem}.pb4-m{padding-bottom:2rem}.pb5-m{padding-bottom:4rem}.pb6-m{padding-bottom:8rem}.pb7-m{padding-bottom:16rem}.pt0-m{padding-top:0}.pt1-m{padding-top:.25rem}.pt2-m{padding-top:.5rem}.pt3-m{padding-top:1rem}.pt4-m{padding-top:2rem}.pt5-m{padding-top:4rem}.pt6-m{padding-top:8rem}.pt7-m{padding-top:16rem}.pv0-m{padding-top:0;padding-bottom:0}.pv1-m{padding-top:.25rem;padding-bottom:.25rem}.pv2-m{padding-top:.5rem;padding-bottom:.5rem}.pv3-m{padding-top:1rem;padding-bottom:1rem}.pv4-m{padding-top:2rem;padding-bottom:2rem}.pv5-m{padding-top:4rem;padding-bottom:4rem}.pv6-m{padding-top:8rem;padding-bottom:8rem}.pv7-m{padding-top:16rem;padding-bottom:16rem}.ph0-m{padding-left:0;padding-right:0}.ph1-m{padding-left:.25rem;padding-right:.25rem}.ph2-m{padding-left:.5rem;padding-right:.5rem}.ph3-m{padding-left:1rem;padding-right:1rem}.ph4-m{padding-left:2rem;padding-right:2rem}.ph5-m{padding-left:4rem;padding-right:4rem}.ph6-m{padding-left:8rem;padding-right:8rem}.ph7-m{padding-left:16rem;padding-right:16rem}.ma0-m{margin:0}.ma1-m{margin:.25rem}.ma2-m{margin:.5rem}.ma3-m{margin:1rem}.ma4-m{margin:2rem}.ma5-m{margin:4rem}.ma6-m{margin:8rem}.ma7-m{margin:16rem}.ml0-m{margin-left:0}.ml1-m{margin-left:.25rem}.ml2-m{margin-left:.5rem}.ml3-m{margin-left:1rem}.ml4-m{margin-left:2rem}.ml5-m{margin-left:4rem}.ml6-m{margin-left:8rem}.ml7-m{margin-left:16rem}.mr0-m{margin-right:0}.mr1-m{margin-right:.25rem}.mr2-m{margin-right:.5rem}.mr3-m{margin-right:1rem}.mr4-m{margin-right:2rem}.mr5-m{margin-right:4rem}.mr6-m{margin-right:8rem}.mr7-m{margin-right:16rem}.mb0-m{margin-bottom:0}.mb1-m{margin-bottom:.25rem}.mb2-m{margin-bottom:.5rem}.mb3-m{margin-bottom:1rem}.mb4-m{margin-bottom:2rem}.mb5-m{margin-bottom:4rem}.mb6-m{margin-bottom:8rem}.mb7-m{margin-bottom:16rem}.mt0-m{margin-top:0}.mt1-m{margin-top:.25rem}.mt2-m{margin-top:.5rem}.mt3-m{margin-top:1rem}.mt4-m{margin-top:2rem}.mt5-m{margin-top:4rem}.mt6-m{margin-top:8rem}.mt7-m{margin-top:16rem}.mv0-m{margin-top:0;margin-bottom:0}.mv1-m{margin-top:.25rem;margin-bottom:.25rem}.mv2-m{margin-top:.5rem;margin-bottom:.5rem}.mv3-m{margin-top:1rem;margin-bottom:1rem}.mv4-m{margin-top:2rem;margin-bottom:2rem}.mv5-m{margin-top:4rem;margin-bottom:4rem}.mv6-m{margin-top:8rem;margin-bottom:8rem}.mv7-m{margin-top:16rem;margin-bottom:16rem}.mh0-m{margin-left:0;margin-right:0}.mh1-m{margin-left:.25rem;margin-right:.25rem}.mh2-m{margin-left:.5rem;margin-right:.5rem}.mh3-m{margin-left:1rem;margin-right:1rem}.mh4-m{margin-left:2rem;margin-right:2rem}.mh5-m{margin-left:4rem;margin-right:4rem}.mh6-m{margin-left:8rem;margin-right:8rem}.mh7-m{margin-left:16rem;margin-right:16rem}.na1-m{margin:-.25rem}.na2-m{margin:-.5rem}.na3-m{margin:-1rem}.na4-m{margin:-2rem}.na5-m{margin:-4rem}.na6-m{margin:-8rem}.na7-m{margin:-16rem}.nl1-m{margin-left:-.25rem}.nl2-m{margin-left:-.5rem}.nl3-m{margin-left:-1rem}.nl4-m{margin-left:-2rem}.nl5-m{margin-left:-4rem}.nl6-m{margin-left:-8rem}.nl7-m{margin-left:-16rem}.nr1-m{margin-right:-.25rem}.nr2-m{margin-right:-.5rem}.nr3-m{margin-right:-1rem}.nr4-m{margin-right:-2rem}.nr5-m{margin-right:-4rem}.nr6-m{margin-right:-8rem}.nr7-m{margin-right:-16rem}.nb1-m{margin-bottom:-.25rem}.nb2-m{margin-bottom:-.5rem}.nb3-m{margin-bottom:-1rem}.nb4-m{margin-bottom:-2rem}.nb5-m{margin-bottom:-4rem}.nb6-m{margin-bottom:-8rem}.nb7-m{margin-bottom:-16rem}.nt1-m{margin-top:-.25rem}.nt2-m{margin-top:-.5rem}.nt3-m{margin-top:-1rem}.nt4-m{margin-top:-2rem}.nt5-m{margin-top:-4rem}.nt6-m{margin-top:-8rem}.nt7-m{margin-top:-16rem}.strike-m{text-decoration:line-through}.underline-m{text-decoration:underline}.no-underline-m{text-decoration:none}.tl-m{text-align:left}.tr-m{text-align:right}.tc-m{text-align:center}.tj-m{text-align:justify}.ttc-m{text-transform:capitalize}.ttl-m{text-transform:lowercase}.ttu-m{text-transform:uppercase}.ttn-m{text-transform:none}.f-6-m,.f-headline-m{font-size:6rem}.f-5-m,.f-subheadline-m{font-size:5rem}.f1-m{font-size:3rem}.f2-m{font-size:2.25rem}.f3-m{font-size:1.5rem}.f4-m{font-size:1.25rem}.f5-m{font-size:1rem}.f6-m{font-size:.875rem}.f7-m{font-size:.75rem}.measure-m{max-width:30em}.measure-wide-m{max-width:34em}.measure-narrow-m{max-width:20em}.indent-m{text-indent:1em;margin-top:0;margin-bottom:0}.small-caps-m{font-variant:small-caps}.truncate-m{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.center-m{margin-left:auto}.center-m,.mr-auto-m{margin-right:auto}.ml-auto-m{margin-left:auto}.clip-m{position:fixed!important;_position:absolute!important;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px)}.ws-normal-m{white-space:normal}.nowrap-m{white-space:nowrap}.pre-m{white-space:pre}.v-base-m{vertical-align:baseline}.v-mid-m{vertical-align:middle}.v-top-m{vertical-align:top}.v-btm-m{vertical-align:bottom}}@media screen and (min-width:60em){.aspect-ratio-l{height:0;position:relative}.aspect-ratio--16x9-l{padding-bottom:56.25%}.aspect-ratio--9x16-l{padding-bottom:177.77%}.aspect-ratio--4x3-l{padding-bottom:75%}.aspect-ratio--3x4-l{padding-bottom:133.33%}.aspect-ratio--6x4-l{padding-bottom:66.6%}.aspect-ratio--4x6-l{padding-bottom:150%}.aspect-ratio--8x5-l{padding-bottom:62.5%}.aspect-ratio--5x8-l{padding-bottom:160%}.aspect-ratio--7x5-l{padding-bottom:71.42%}.aspect-ratio--5x7-l{padding-bottom:140%}.aspect-ratio--1x1-l{padding-bottom:100%}.aspect-ratio--object-l{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;z-index:100}.cover-l{background-size:cover!important}.contain-l{background-size:contain!important}.bg-center-l{background-position:50%}.bg-center-l,.bg-top-l{background-repeat:no-repeat}.bg-top-l{background-position:top}.bg-right-l{background-position:100%}.bg-bottom-l,.bg-right-l{background-repeat:no-repeat}.bg-bottom-l{background-position:bottom}.bg-left-l{background-repeat:no-repeat;background-position:0}.outline-l{outline:1px solid}.outline-transparent-l{outline:1px solid transparent}.outline-0-l{outline:0}.ba-l{border-style:solid;border-width:1px}.bt-l{border-top-style:solid;border-top-width:1px}.br-l{border-right-style:solid;border-right-width:1px}.bb-l{border-bottom-style:solid;border-bottom-width:1px}.bl-l{border-left-style:solid;border-left-width:1px}.bn-l{border-style:none;border-width:0}.br0-l{border-radius:0}.br1-l{border-radius:.125rem}.br2-l{border-radius:.25rem}.br3-l{border-radius:.5rem}.br4-l{border-radius:1rem}.br-100-l{border-radius:100%}.br-pill-l{border-radius:9999px}.br--bottom-l{border-top-left-radius:0;border-top-right-radius:0}.br--top-l{border-bottom-right-radius:0}.br--right-l,.br--top-l{border-bottom-left-radius:0}.br--right-l{border-top-left-radius:0}.br--left-l{border-top-right-radius:0;border-bottom-right-radius:0}.br-inherit-l{border-radius:inherit}.br-initial-l{border-radius:initial}.br-unset-l{border-radius:unset}.b--dotted-l{border-style:dotted}.b--dashed-l{border-style:dashed}.b--solid-l{border-style:solid}.b--none-l{border-style:none}.bw0-l{border-width:0}.bw1-l{border-width:.125rem}.bw2-l{border-width:.25rem}.bw3-l{border-width:.5rem}.bw4-l{border-width:1rem}.bw5-l{border-width:2rem}.bt-0-l{border-top-width:0}.br-0-l{border-right-width:0}.bb-0-l{border-bottom-width:0}.bl-0-l{border-left-width:0}.shadow-1-l{box-shadow:0 0 4px 2px rgba(0,0,0,.2)}.shadow-2-l{box-shadow:0 0 8px 2px rgba(0,0,0,.2)}.shadow-3-l{box-shadow:2px 2px 4px 2px rgba(0,0,0,.2)}.shadow-4-l{box-shadow:2px 2px 8px 0 rgba(0,0,0,.2)}.shadow-5-l{box-shadow:4px 4px 8px 0 rgba(0,0,0,.2)}.top-0-l{top:0}.left-0-l{left:0}.right-0-l{right:0}.bottom-0-l{bottom:0}.top-1-l{top:1rem}.left-1-l{left:1rem}.right-1-l{right:1rem}.bottom-1-l{bottom:1rem}.top-2-l{top:2rem}.left-2-l{left:2rem}.right-2-l{right:2rem}.bottom-2-l{bottom:2rem}.top--1-l{top:-1rem}.right--1-l{right:-1rem}.bottom--1-l{bottom:-1rem}.left--1-l{left:-1rem}.top--2-l{top:-2rem}.right--2-l{right:-2rem}.bottom--2-l{bottom:-2rem}.left--2-l{left:-2rem}.absolute--fill-l{top:0;right:0;bottom:0;left:0}.cl-l{clear:left}.cr-l{clear:right}.cb-l{clear:both}.cn-l{clear:none}.dn-l{display:none}.di-l{display:inline}.db-l{display:block}.dib-l{display:inline-block}.dit-l{display:inline-table}.dt-l{display:table}.dtc-l{display:table-cell}.dt-row-l{display:table-row}.dt-row-group-l{display:table-row-group}.dt-column-l{display:table-column}.dt-column-group-l{display:table-column-group}.dt--fixed-l{table-layout:fixed;width:100%}.flex-l{display:flex}.inline-flex-l{display:inline-flex}.flex-auto-l{flex:1 1 auto;min-width:0;min-height:0}.flex-none-l{flex:none}.flex-column-l{flex-direction:column}.flex-row-l{flex-direction:row}.flex-wrap-l{flex-wrap:wrap}.flex-nowrap-l{flex-wrap:nowrap}.flex-wrap-reverse-l{flex-wrap:wrap-reverse}.flex-column-reverse-l{flex-direction:column-reverse}.flex-row-reverse-l{flex-direction:row-reverse}.items-start-l{align-items:flex-start}.items-end-l{align-items:flex-end}.items-center-l{align-items:center}.items-baseline-l{align-items:baseline}.items-stretch-l{align-items:stretch}.self-start-l{align-self:flex-start}.self-end-l{align-self:flex-end}.self-center-l{align-self:center}.self-baseline-l{align-self:baseline}.self-stretch-l{align-self:stretch}.justify-start-l{justify-content:flex-start}.justify-end-l{justify-content:flex-end}.justify-center-l{justify-content:center}.justify-between-l{justify-content:space-between}.justify-around-l{justify-content:space-around}.content-start-l{align-content:flex-start}.content-end-l{align-content:flex-end}.content-center-l{align-content:center}.content-between-l{align-content:space-between}.content-around-l{align-content:space-around}.content-stretch-l{align-content:stretch}.order-0-l{order:0}.order-1-l{order:1}.order-2-l{order:2}.order-3-l{order:3}.order-4-l{order:4}.order-5-l{order:5}.order-6-l{order:6}.order-7-l{order:7}.order-8-l{order:8}.order-last-l{order:99999}.flex-grow-0-l{flex-grow:0}.flex-grow-1-l{flex-grow:1}.flex-shrink-0-l{flex-shrink:0}.flex-shrink-1-l{flex-shrink:1}.fl-l{float:left}.fl-l,.fr-l{_display:inline}.fr-l{float:right}.fn-l{float:none}.i-l{font-style:italic}.fs-normal-l{font-style:normal}.normal-l{font-weight:400}.b-l{font-weight:700}.fw1-l{font-weight:100}.fw2-l{font-weight:200}.fw3-l{font-weight:300}.fw4-l{font-weight:400}.fw5-l{font-weight:500}.fw6-l{font-weight:600}.fw7-l{font-weight:700}.fw8-l{font-weight:800}.fw9-l{font-weight:900}.h1-l{height:1rem}.h2-l{height:2rem}.h3-l{height:4rem}.h4-l{height:8rem}.h5-l{height:16rem}.h-25-l{height:25%}.h-50-l{height:50%}.h-75-l{height:75%}.h-100-l{height:100%}.min-h-100-l{min-height:100%}.vh-25-l{height:25vh}.vh-50-l{height:50vh}.vh-75-l{height:75vh}.vh-100-l{height:100vh}.min-vh-100-l{min-height:100vh}.h-auto-l{height:auto}.h-inherit-l{height:inherit}.tracked-l{letter-spacing:.1em}.tracked-tight-l{letter-spacing:-.05em}.tracked-mega-l{letter-spacing:.25em}.lh-solid-l{line-height:1}.lh-title-l{line-height:1.25}.lh-copy-l{line-height:1.5}.mw-100-l{max-width:100%}.mw1-l{max-width:1rem}.mw2-l{max-width:2rem}.mw3-l{max-width:4rem}.mw4-l{max-width:8rem}.mw5-l{max-width:16rem}.mw6-l{max-width:32rem}.mw7-l{max-width:48rem}.mw8-l{max-width:64rem}.mw9-l{max-width:96rem}.mw-none-l{max-width:none}.w1-l{width:1rem}.w2-l{width:2rem}.w3-l{width:4rem}.w4-l{width:8rem}.w5-l{width:16rem}.w-10-l{width:10%}.w-20-l{width:20%}.w-25-l{width:25%}.w-30-l{width:30%}.w-33-l{width:33%}.w-34-l{width:34%}.w-40-l{width:40%}.w-50-l{width:50%}.w-60-l{width:60%}.w-70-l{width:70%}.w-75-l{width:75%}.w-80-l{width:80%}.w-90-l{width:90%}.w-100-l{width:100%}.w-third-l{width:33.33333%}.w-two-thirds-l{width:66.66667%}.w-auto-l{width:auto}.overflow-visible-l{overflow:visible}.overflow-hidden-l{overflow:hidden}.overflow-scroll-l{overflow:scroll}.overflow-auto-l{overflow:auto}.overflow-x-visible-l{overflow-x:visible}.overflow-x-hidden-l{overflow-x:hidden}.overflow-x-scroll-l{overflow-x:scroll}.overflow-x-auto-l{overflow-x:auto}.overflow-y-visible-l{overflow-y:visible}.overflow-y-hidden-l{overflow-y:hidden}.overflow-y-scroll-l{overflow-y:scroll}.overflow-y-auto-l{overflow-y:auto}.static-l{position:static}.relative-l{position:relative}.absolute-l{position:absolute}.fixed-l{position:fixed}.rotate-45-l{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-90-l{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-135-l{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.rotate-180-l{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.rotate-225-l{-webkit-transform:rotate(225deg);transform:rotate(225deg)}.rotate-270-l{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-315-l{-webkit-transform:rotate(315deg);transform:rotate(315deg)}.pa0-l{padding:0}.pa1-l{padding:.25rem}.pa2-l{padding:.5rem}.pa3-l{padding:1rem}.pa4-l{padding:2rem}.pa5-l{padding:4rem}.pa6-l{padding:8rem}.pa7-l{padding:16rem}.pl0-l{padding-left:0}.pl1-l{padding-left:.25rem}.pl2-l{padding-left:.5rem}.pl3-l{padding-left:1rem}.pl4-l{padding-left:2rem}.pl5-l{padding-left:4rem}.pl6-l{padding-left:8rem}.pl7-l{padding-left:16rem}.pr0-l{padding-right:0}.pr1-l{padding-right:.25rem}.pr2-l{padding-right:.5rem}.pr3-l{padding-right:1rem}.pr4-l{padding-right:2rem}.pr5-l{padding-right:4rem}.pr6-l{padding-right:8rem}.pr7-l{padding-right:16rem}.pb0-l{padding-bottom:0}.pb1-l{padding-bottom:.25rem}.pb2-l{padding-bottom:.5rem}.pb3-l{padding-bottom:1rem}.pb4-l{padding-bottom:2rem}.pb5-l{padding-bottom:4rem}.pb6-l{padding-bottom:8rem}.pb7-l{padding-bottom:16rem}.pt0-l{padding-top:0}.pt1-l{padding-top:.25rem}.pt2-l{padding-top:.5rem}.pt3-l{padding-top:1rem}.pt4-l{padding-top:2rem}.pt5-l{padding-top:4rem}.pt6-l{padding-top:8rem}.pt7-l{padding-top:16rem}.pv0-l{padding-top:0;padding-bottom:0}.pv1-l{padding-top:.25rem;padding-bottom:.25rem}.pv2-l{padding-top:.5rem;padding-bottom:.5rem}.pv3-l{padding-top:1rem;padding-bottom:1rem}.pv4-l{padding-top:2rem;padding-bottom:2rem}.pv5-l{padding-top:4rem;padding-bottom:4rem}.pv6-l{padding-top:8rem;padding-bottom:8rem}.pv7-l{padding-top:16rem;padding-bottom:16rem}.ph0-l{padding-left:0;padding-right:0}.ph1-l{padding-left:.25rem;padding-right:.25rem}.ph2-l{padding-left:.5rem;padding-right:.5rem}.ph3-l{padding-left:1rem;padding-right:1rem}.ph4-l{padding-left:2rem;padding-right:2rem}.ph5-l{padding-left:4rem;padding-right:4rem}.ph6-l{padding-left:8rem;padding-right:8rem}.ph7-l{padding-left:16rem;padding-right:16rem}.ma0-l{margin:0}.ma1-l{margin:.25rem}.ma2-l{margin:.5rem}.ma3-l{margin:1rem}.ma4-l{margin:2rem}.ma5-l{margin:4rem}.ma6-l{margin:8rem}.ma7-l{margin:16rem}.ml0-l{margin-left:0}.ml1-l{margin-left:.25rem}.ml2-l{margin-left:.5rem}.ml3-l{margin-left:1rem}.ml4-l{margin-left:2rem}.ml5-l{margin-left:4rem}.ml6-l{margin-left:8rem}.ml7-l{margin-left:16rem}.mr0-l{margin-right:0}.mr1-l{margin-right:.25rem}.mr2-l{margin-right:.5rem}.mr3-l{margin-right:1rem}.mr4-l{margin-right:2rem}.mr5-l{margin-right:4rem}.mr6-l{margin-right:8rem}.mr7-l{margin-right:16rem}.mb0-l{margin-bottom:0}.mb1-l{margin-bottom:.25rem}.mb2-l{margin-bottom:.5rem}.mb3-l{margin-bottom:1rem}.mb4-l{margin-bottom:2rem}.mb5-l{margin-bottom:4rem}.mb6-l{margin-bottom:8rem}.mb7-l{margin-bottom:16rem}.mt0-l{margin-top:0}.mt1-l{margin-top:.25rem}.mt2-l{margin-top:.5rem}.mt3-l{margin-top:1rem}.mt4-l{margin-top:2rem}.mt5-l{margin-top:4rem}.mt6-l{margin-top:8rem}.mt7-l{margin-top:16rem}.mv0-l{margin-top:0;margin-bottom:0}.mv1-l{margin-top:.25rem;margin-bottom:.25rem}.mv2-l{margin-top:.5rem;margin-bottom:.5rem}.mv3-l{margin-top:1rem;margin-bottom:1rem}.mv4-l{margin-top:2rem;margin-bottom:2rem}.mv5-l{margin-top:4rem;margin-bottom:4rem}.mv6-l{margin-top:8rem;margin-bottom:8rem}.mv7-l{margin-top:16rem;margin-bottom:16rem}.mh0-l{margin-left:0;margin-right:0}.mh1-l{margin-left:.25rem;margin-right:.25rem}.mh2-l{margin-left:.5rem;margin-right:.5rem}.mh3-l{margin-left:1rem;margin-right:1rem}.mh4-l{margin-left:2rem;margin-right:2rem}.mh5-l{margin-left:4rem;margin-right:4rem}.mh6-l{margin-left:8rem;margin-right:8rem}.mh7-l{margin-left:16rem;margin-right:16rem}.na1-l{margin:-.25rem}.na2-l{margin:-.5rem}.na3-l{margin:-1rem}.na4-l{margin:-2rem}.na5-l{margin:-4rem}.na6-l{margin:-8rem}.na7-l{margin:-16rem}.nl1-l{margin-left:-.25rem}.nl2-l{margin-left:-.5rem}.nl3-l{margin-left:-1rem}.nl4-l{margin-left:-2rem}.nl5-l{margin-left:-4rem}.nl6-l{margin-left:-8rem}.nl7-l{margin-left:-16rem}.nr1-l{margin-right:-.25rem}.nr2-l{margin-right:-.5rem}.nr3-l{margin-right:-1rem}.nr4-l{margin-right:-2rem}.nr5-l{margin-right:-4rem}.nr6-l{margin-right:-8rem}.nr7-l{margin-right:-16rem}.nb1-l{margin-bottom:-.25rem}.nb2-l{margin-bottom:-.5rem}.nb3-l{margin-bottom:-1rem}.nb4-l{margin-bottom:-2rem}.nb5-l{margin-bottom:-4rem}.nb6-l{margin-bottom:-8rem}.nb7-l{margin-bottom:-16rem}.nt1-l{margin-top:-.25rem}.nt2-l{margin-top:-.5rem}.nt3-l{margin-top:-1rem}.nt4-l{margin-top:-2rem}.nt5-l{margin-top:-4rem}.nt6-l{margin-top:-8rem}.nt7-l{margin-top:-16rem}.strike-l{text-decoration:line-through}.underline-l{text-decoration:underline}.no-underline-l{text-decoration:none}.tl-l{text-align:left}.tr-l{text-align:right}.tc-l{text-align:center}.tj-l{text-align:justify}.ttc-l{text-transform:capitalize}.ttl-l{text-transform:lowercase}.ttu-l{text-transform:uppercase}.ttn-l{text-transform:none}.f-6-l,.f-headline-l{font-size:6rem}.f-5-l,.f-subheadline-l{font-size:5rem}.f1-l{font-size:3rem}.f2-l{font-size:2.25rem}.f3-l{font-size:1.5rem}.f4-l{font-size:1.25rem}.f5-l{font-size:1rem}.f6-l{font-size:.875rem}.f7-l{font-size:.75rem}.measure-l{max-width:30em}.measure-wide-l{max-width:34em}.measure-narrow-l{max-width:20em}.indent-l{text-indent:1em;margin-top:0;margin-bottom:0}.small-caps-l{font-variant:small-caps}.truncate-l{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.center-l{margin-left:auto}.center-l,.mr-auto-l{margin-right:auto}.ml-auto-l{margin-left:auto}.clip-l{position:fixed!important;_position:absolute!important;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px)}.ws-normal-l{white-space:normal}.nowrap-l{white-space:nowrap}.pre-l{white-space:pre}.v-base-l{vertical-align:baseline}.v-mid-l{vertical-align:middle}.v-top-l{vertical-align:top}.v-btm-l{vertical-align:bottom}}
    7 | 
    8 | 

/* =====================================================================================
   FILE: app/lib/tone.js
   ===================================================================================== */

    1 | /*
    2 | /app/lib/tone.js
    3 | Tone.js audio synthesis library bundle enabling sound generation and effects.
    4 | */
    5 | /*! For license information please see Tone.js.LICENSE.txt */
    6 | !function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Tone=e():t.Tone=e()}("undefined"!=typeof self?self:this,(()=>(()=>{var t={871:function(t,e,s){!function(t,e,s,n){"use strict";var i=function(t,e,s){return{endTime:e,insertTime:s,type:"exponentialRampToValue",value:t}},o=function(t,e,s){return{endTime:e,insertTime:s,type:"linearRampToValue",value:t}},r=function(t,e){return{startTime:e,type:"setValue",value:t}},a=function(t,e,s){return{duration:s,startTime:e,type:"setValueCurve",values:t}},c=function(t,e,s){var n=s.startTime,i=s.target,o=s.timeConstant;return i+(e-i)*Math.exp((n-t)/o)},h=function(t){return"exponentialRampToValue"===t.type},l=function(t){return"linearRampToValue"===t.type},u=function(t){return h(t)||l(t)},p=function(t){return"setValue"===t.type},d=function(t){return"setValueCurve"===t.type},f=function t(e,s,n,i){var o=e[s];return void 0===o?i:u(o)||p(o)?o.value:d(o)?o.values[o.values.length-1]:c(n,t(e,s-1,o.startTime,i),o)},_=function(t,e,s,n,i){return void 0===s?[n.insertTime,i]:u(s)?[s.endTime,s.value]:p(s)?[s.startTime,s.value]:d(s)?[s.startTime+s.duration,s.values[s.values.length-1]]:[s.startTime,f(t,e-1,s.startTime,i)]},m=function(t){return"cancelAndHold"===t.type},g=function(t){return"cancelScheduledValues"===t.type},v=function(t){return m(t)||g(t)?t.cancelTime:h(t)||l(t)?t.endTime:t.startTime},y=function(t,e,s,n){var i=n.endTime,o=n.value;return s===o?o:0<s&&0<o||s<0&&o<0?s*Math.pow(o/s,(t-e)/(i-e)):0},x=function(t,e,s,n){return s+(t-e)/(n.endTime-e)*(n.value-s)},w=function(t,e){var s=e.duration,n=e.startTime,i=e.values;return function(t,e){var s=Math.floor(e),n=Math.ceil(e);return s===n?t[s]:(1-(e-s))*t[s]+(1-(n-e))*t[n]}(i,(t-n)/s*(i.length-1))},b=function(t){return"setTarget"===t.type},T=function(){return n((function t(e){s(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}),[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=v(t);if(m(t)||g(t)){var s=this._automationEvents.findIndex((function(s){return g(t)&&d(s)?s.startTime+s.duration>=e:v(s)>=e})),n=this._automationEvents[s];if(-1!==s&&(this._automationEvents=this._automationEvents.slice(0,s)),m(t)){var c=this._automationEvents[this._automationEvents.length-1];if(void 0!==n&&u(n)){if(void 0!==c&&b(c))throw new Error("The internal list is malformed.");var p=void 0===c?n.insertTime:d(c)?c.startTime+c.duration:v(c),f=void 0===c?this._defaultValue:d(c)?c.values[c.values.length-1]:c.value,_=h(n)?y(e,p,f,n):x(e,p,f,n),w=h(n)?i(_,e,this._currenTime):o(_,e,this._currenTime);this._automationEvents.push(w)}if(void 0!==c&&b(c)&&this._automationEvents.push(r(this.getValue(e),e)),void 0!==c&&d(c)&&c.startTime+c.duration>e){var T=e-c.startTime,S=(c.values.length-1)/c.duration,k=Math.max(2,1+Math.ceil(T*S)),A=T/(k-1)*S,C=c.values.slice(0,k);if(A<1)for(var O=1;O<k;O+=1){var D=A*O%1;C[O]=c.values[O-1]*(1-D)+c.values[O]*D}this._automationEvents[this._automationEvents.length-1]=a(C,c.startTime,T)}}}else{var M=this._automationEvents.findIndex((function(t){return v(t)>e})),E=-1===M?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[M-1];if(void 0!==E&&d(E)&&v(E)+E.duration>e)return!1;var R=h(t)?i(t.value,t.endTime,this._currenTime):l(t)?o(t.value,e,this._currenTime):t;if(-1===M)this._automationEvents.push(R);else{if(d(t)&&e+t.duration>v(this._automationEvents[M]))return!1;this._automationEvents.splice(M,0,R)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return v(e)>t}));if(e>1){var s=this._automationEvents.slice(e-1),n=s[0];b(n)&&s.unshift(r(f(this._automationEvents,e-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=s}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var s=this._automationEvents.findIndex((function(e){return v(e)>t})),n=this._automationEvents[s],i=(-1===s?this._automationEvents.length:s)-1,o=this._automationEvents[i];if(void 0!==o&&b(o)&&(void 0===n||!u(n)||n.insertTime>t))return c(t,f(this._automationEvents,i-1,o.startTime,this._defaultValue),o);if(void 0!==o&&p(o)&&(void 0===n||!u(n)))return o.value;if(void 0!==o&&d(o)&&(void 0===n||!u(n)||o.startTime+o.duration>t))return t<o.startTime+o.duration?w(t,o):o.values[o.values.length-1];if(void 0!==o&&u(o)&&(void 0===n||!u(n)))return o.value;if(void 0!==n&&h(n)){var r=_(this._automationEvents,i,o,n,this._defaultValue),a=e(r,2),m=a[0],g=a[1];return y(t,m,g,n)}if(void 0!==n&&l(n)){var T=_(this._automationEvents,i,o,n,this._defaultValue),S=e(T,2),k=S[0],A=S[1];return x(t,k,A,n)}return this._defaultValue}}])}();t.AutomationEventList=T,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,s){return{startTime:e,target:t,timeConstant:s,type:"setTarget"}},t.createSetValueAutomationEvent=r,t.createSetValueCurveAutomationEvent=a}(e,s(821),s(805),s(989))},113:t=>{t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n},t.exports.__esModule=!0,t.exports.default=t.exports},569:t=>{t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},805:t=>{t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},989:(t,e,s)=>{var n=s(498);function i(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}t.exports=function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},474:t=>{t.exports=function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var n,i,o,r,a=[],c=!0,h=!1;try{if(o=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;c=!1}else for(;!(c=(n=o.call(s)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){h=!0,i=t}finally{try{if(!c&&null!=s.return&&(r=s.return(),Object(r)!==r))return}finally{if(h)throw i}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports},18:t=>{t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},821:(t,e,s)=>{var n=s(569),i=s(474),o=s(744),r=s(18);t.exports=function(t,e){return n(t)||i(t,e)||o(t,e)||r()},t.exports.__esModule=!0,t.exports.default=t.exports},327:(t,e,s)=>{var n=s(564).default;t.exports=function(t,e){if("object"!=n(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},498:(t,e,s)=>{var n=s(564).default,i=s(327);t.exports=function(t){var e=i(t,"string");return"symbol"==n(e)?e:e+""},t.exports.__esModule=!0,t.exports.default=t.exports},564:t=>{function e(s){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(s)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},744:(t,e,s)=>{var n=s(113);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,s),o.exports}s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";s.r(n),s.d(n,{AMOscillator:()=>Ho,AMSynth:()=>Or,Abs:()=>dr,Add:()=>ir,AmplitudeEnvelope:()=>kr,Analyser:()=>Ya,AudioToGain:()=>Yo,AutoFilter:()=>pa,AutoPanner:()=>fa,AutoWah:()=>ma,BaseContext:()=>Ci,BiquadFilter:()=>Dr,BitCrusher:()=>va,Buffer:()=>Oc,BufferSource:()=>Mc,Buffers:()=>Dc,Channel:()=>nc,Chebyshev:()=>xa,Chorus:()=>ka,Clock:()=>vo,Compressor:()=>cc,Context:()=>Oi,Convolver:()=>fc,CrossFade:()=>ha,DCMeter:()=>Ka,Delay:()=>yo,Destination:()=>yc,Distortion:()=>Aa,Draw:()=>Sc,DuoSynth:()=>qr,EQ3:()=>dc,Emitter:()=>Ai,Envelope:()=>wr,FFT:()=>Ja,FMOscillator:()=>Jo,FMSynth:()=>Ir,FatOscillator:()=>tr,FeedbackCombFilter:()=>Ur,FeedbackDelay:()=>Oa,Filter:()=>Mr,Follower:()=>_a,Freeverb:()=>qa,Frequency:()=>Ji,FrequencyClass:()=>Yi,FrequencyEnvelope:()=>Er,FrequencyShifter:()=>Ma,Gain:()=>ho,GainToAudio:()=>fr,Gate:()=>hc,GrainPlayer:()=>pr,GreaterThan:()=>vr,GreaterThanZero:()=>gr,IntervalTimeline:()=>Mo,JCReverb:()=>Na,LFO:()=>ar,Limiter:()=>lc,Listener:()=>bc,Loop:()=>Hr,LowpassCombFilter:()=>Qr,Master:()=>xc,MembraneSynth:()=>Nr,Merge:()=>ba,MetalSynth:()=>Vr,Meter:()=>Ha,MidSideCompressor:()=>uc,MidSideMerge:()=>Ua,MidSideSplit:()=>Ba,Midi:()=>Ao,MidiClass:()=>ko,Mono:()=>ic,MonoSynth:()=>Rr,MultibandCompressor:()=>pc,MultibandSplit:()=>oc,Multiply:()=>$o,Negate:()=>_r,Noise:()=>zo,NoiseSynth:()=>Pr,Offline:()=>To,OfflineContext:()=>qi,OmniOscillator:()=>nr,OnePoleFilter:()=>Gr,Oscillator:()=>Xo,PWMOscillator:()=>er,PanVol:()=>sc,Panner:()=>da,Panner3D:()=>rc,Param:()=>no,Part:()=>Jr,Pattern:()=>aa,Phaser:()=>za,PingPongDelay:()=>ja,PitchShift:()=>La,Player:()=>lr,Players:()=>ur,PluckSynth:()=>Zr,PolySynth:()=>Xr,Pow:()=>Fo,PulseOscillator:()=>Ko,Recorder:()=>ac,Reverb:()=>Wa,Sampler:()=>Yr,Scale:()=>or,ScaleExp:()=>yr,Sequence:()=>ca,Signal:()=>po,Solo:()=>ec,Split:()=>wa,StateTimeline:()=>so,StereoWidener:()=>Qa,Subtract:()=>mr,SyncedSignal:()=>xr,Synth:()=>Ar,Ticks:()=>Oo,TicksClass:()=>Co,Time:()=>Xi,TimeClass:()=>Zi,Timeline:()=>wi,ToneAudioBuffer:()=>Ri,ToneAudioBuffers:()=>So,ToneAudioNode:()=>io,ToneBufferSource:()=>Lo,ToneEvent:()=>$r,ToneOscillatorNode:()=>Zo,Transport:()=>gc,TransportTime:()=>to,TransportTimeClass:()=>Ki,Tremolo:()=>Za,Unit:()=>e,UserMedia:()=>Go,Vibrato:()=>Xa,Volume:()=>xo,WaveShaper:()=>Io,Waveform:()=>tc,Zero:()=>rr,connect:()=>ro,connectSeries:()=>oo,connectSignal:()=>fo,context:()=>Ac,dbToGain:()=>ji,debug:()=>t,defaultArg:()=>pi,disconnect:()=>ao,fanIn:()=>co,ftom:()=>Bi,gainToDb:()=>Li,getContext:()=>Vi,getDestination:()=>wc,getDraw:()=>kc,getListener:()=>Tc,getTransport:()=>vc,immediate:()=>mc,intervalToFrequencyRatio:()=>zi,isArray:()=>Ln,isBoolean:()=>jn,isDefined:()=>Fn,isFunction:()=>Vn,isNote:()=>Wn,isNumber:()=>Nn,isObject:()=>Pn,isString:()=>zn,isUndef:()=>In,loaded:()=>Cc,mtof:()=>Gi,now:()=>_c,optionsFromArguments:()=>ui,setContext:()=>Ni,start:()=>Pi,supported:()=>qn,version:()=>i});var t={};s.r(t),s.d(t,{assert:()=>Bn,assertContextRunning:()=>Gn,assertRange:()=>Un,assertUsedScheduleTime:()=>Yn,enterScheduledCallback:()=>Xn,log:()=>Jn,setLogger:()=>Hn,warn:()=>Kn});var e={};s.r(e);const i="15.0.4";var o=s(871);const r=new WeakSet,a=new WeakMap,c=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,d=new WeakMap,f=new WeakMap,_=new WeakMap,m={construct:()=>m},g=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,v=(t,e)=>{const s=[];let n=t.replace(/^[\s]+/,""),i=n.match(g);for(;null!==i;){const t=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());s.push(o),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(g)}return[s.join(";"),n]},y=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},x=t=>{if(!(t=>{try{new new Proxy(t,m)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},w=(t,e)=>{const s=t.get(e);if(void 0===s)throw new Error("A value with the given key could not be found.");return s},b=(t,e)=>{const s=Array.from(t).filter(e);if(s.length>1)throw Error("More than one element was found.");if(0===s.length)throw Error("No element was found.");const[n]=s;return t.delete(n),n},T=(t,e,s,n)=>{const i=w(t,e),o=b(i,(t=>t[0]===s&&t[1]===n));return 0===i.size&&t.delete(e),o},S=t=>w(p,t),k=t=>{if(r.has(t))throw new Error("The AudioNode is already stored.");r.add(t),S(t).forEach((t=>t(!0)))},A=t=>"port"in t,C=t=>{if(!r.has(t))throw new Error("The AudioNode is not stored.");r.delete(t),S(t).forEach((t=>t(!1)))},O=(t,e)=>{!A(t)&&e.every((t=>0===t.size))&&C(t)},D={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},M=(t,e)=>t.context===e,E=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},R=()=>new DOMException("","IndexSizeError"),q=t=>{var e;t.getChannelData=(e=t.getChannelData,s=>{try{return e.call(t,s)}catch(t){if(12===t.code)throw R();throw t}})},I={numberOfChannels:1},F=-34028234663852886e22,V=-F,N=t=>r.has(t),P={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},j=t=>w(a,t),L=t=>w(h,t),z=(t,e)=>{const{activeInputs:s}=j(t);s.forEach((s=>s.forEach((([s])=>{e.includes(t)||z(s,[...e,t])}))));const n=(t=>"playbackRate"in t)(t)?[t.playbackRate]:A(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of n){const s=L(t);void 0!==s&&s.activeInputs.forEach((([t])=>z(t,e)))}N(t)&&C(t)},W=t=>{z(t.destination,[])},B=t=>"context"in t,U=t=>B(t[0]),G=(t,e,s,n)=>{for(const e of t)if(s(e)){if(n)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Q=(t,e,[s,n],i)=>{G(t,[e,s,n],(t=>t[0]===e&&t[1]===s),i)},Z=(t,[e,s,n],i)=>{const o=t.get(e);void 0===o?t.set(e,new Set([[s,n]])):G(o,[s,n],(t=>t[0]===s),i)},X=t=>"inputs"in t,Y=(t,e,s,n)=>{if(X(e)){const i=e.inputs[n];return t.connect(i,s,0),[i,s,0]}return t.connect(e,s,n),[e,s,n]},$=(t,e,s)=>{for(const n of t)if(n[0]===e&&n[1]===s)return t.delete(n),n;return null},H=(t,e)=>{if(!S(t).delete(e))throw new Error("Missing the expected event listener.")},J=(t,e,s)=>{const n=w(t,e),i=b(n,(t=>t[0]===s));return 0===n.size&&t.delete(e),i},K=(t,e,s,n)=>{X(e)?t.disconnect(e.inputs[n],s,0):t.disconnect(e,s,n)},tt=t=>w(c,t),et=t=>w(l,t),st=t=>d.has(t),nt=t=>!r.has(t),it=(t,e)=>new Promise((s=>{if(null!==e)s(!0);else{const e=t.createScriptProcessor(256,1,1),n=t.createGain(),i=t.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const r=t.createBufferSource();r.buffer=i,r.loop=!0,r.connect(e).connect(t.destination),r.connect(n),r.disconnect(n),e.onaudioprocess=n=>{const i=n.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?s(!0):s(!1),r.stop(),e.onaudioprocess=null,r.disconnect(e),e.disconnect(t.destination)},r.start()}})),ot=(t,e)=>{const s=new Map;for(const e of t)for(const t of e){const e=s.get(t);s.set(t,void 0===e?1:e+1)}s.forEach(((t,s)=>e(s,t)))},rt=t=>"context"in t,at=t=>{const e=new Map;t.connect=(t=>(s,n=0,i=0)=>{const o=rt(s)?t(s,n,i):t(s,n),r=e.get(s);return void 0===r?e.set(s,[{input:i,output:n}]):r.every((t=>t.input!==i||t.output!==n))&&r.push({input:i,output:n}),o})(t.connect.bind(t)),t.disconnect=(s=>(n,i,o)=>{if(s.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,s]of e){const i=s.filter((t=>t.output!==n));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(n))if(void 0===i)e.delete(n);else{const t=e.get(n);if(void 0!==t){const s=t.filter((t=>t.output!==i&&(t.input!==o||void 0===o)));0===s.length?e.delete(n):e.set(n,s)}}for(const[s,n]of e)n.forEach((e=>{rt(s)?t.connect(s,e.output,e.input):t.connect(s,e.output)}))})(t.disconnect)},ct=(t,e,s,n,i)=>{const[o,r]=((t,e,s,n)=>{const{activeInputs:i,passiveInputs:o}=j(e),r=$(i[n],t,s);return null===r?[T(o,t,s,n)[2],!1]:[r[2],!0]})(t,s,n,i);if(null!==o&&(H(t,o),!r||e||st(t)||K(tt(t),tt(s),n,i)),N(s)){const{activeInputs:t}=j(s);O(s,t)}},ht=(t,e,s,n)=>{const[i,o]=((t,e,s)=>{const{activeInputs:n,passiveInputs:i}=L(e),o=$(n,t,s);return null===o?[J(i,t,s)[1],!1]:[o[2],!0]})(t,s,n);null!==i&&(H(t,i),!o||e||st(t)||tt(t).disconnect(et(s),n))};class lt{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((s,n)=>t.call(e,s,n,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const ut={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function pt(t,e,s,n,i){if("function"==typeof t.copyFromChannel)0===e[s].byteLength&&(e[s]=new Float32Array(128)),t.copyFromChannel(e[s],n,i);else{const o=t.getChannelData(n);if(0===e[s].byteLength)e[s]=o.slice(i,i+128);else{const t=new Float32Array(o.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[s].set(t)}}}const dt=(t,e,s,n,i)=>{"function"==typeof t.copyToChannel?0!==e[s].byteLength&&t.copyToChannel(e[s],n,i):0!==e[s].byteLength&&t.getChannelData(n).set(e[s],i)},ft=(t,e)=>{const s=[];for(let n=0;n<t;n+=1){const t=[],i="number"==typeof e?e:e[n];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));s.push(t)}return s},_t=async(t,e,s,n,i,o,r)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,c=n.channelCount*n.numberOfInputs,h=i.reduce(((t,e)=>t+e),0),l=0===h?null:s.createBuffer(h,a,s.sampleRate);if(void 0===o)throw new Error("Missing the processor constructor.");const u=j(t),p=await((t,e)=>{const s=w(_,t),n=tt(e);return w(s,n)})(s,t),d=ft(n.numberOfInputs,n.channelCount),f=ft(n.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let h=0;h<a;h+=128){if(n.numberOfInputs>0&&null!==e)for(let t=0;t<n.numberOfInputs;t+=1)for(let s=0;s<n.channelCount;s+=1)pt(e,d[t],s,s,h);void 0!==o.parameterDescriptors&&null!==e&&o.parameterDescriptors.forEach((({name:t},s)=>{pt(e,m,t,c+s,h)}));for(let t=0;t<n.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=d.map(((t,e)=>0===u.activeInputs[e].size?[]:t)),e=r(h/s.sampleRate,s.sampleRate,(()=>p.process(t,f,m)));if(null!==l)for(let t=0,e=0;t<n.numberOfOutputs;t+=1){for(let s=0;s<i[t];s+=1)dt(l,f[t],s,e+s,h);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return l},mt={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},gt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},vt={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},yt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},xt={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},wt=t=>{const{port1:e,port2:s}=new MessageChannel;return new Promise((n=>{const i=()=>{s.onmessage=null,e.close(),s.close(),n()};s.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}}))},bt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Tt=(t,e,s)=>{const n=e[s];if(void 0===n)throw t();return n},St={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},kt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},At=()=>new DOMException("","InvalidStateError"),Ct=()=>new DOMException("","InvalidAccessError"),Ot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Dt=(t,e,s,n,i,o,r,a,c,h,l)=>{const u=h.length;let p=a;for(let a=0;a<u;a+=1){let u=s[0]*h[a];for(let e=1;e<i;e+=1){const n=p-e&c-1;u+=s[e]*o[n],u-=t[e]*r[n]}for(let t=i;t<n;t+=1)u+=s[t]*o[p-t&c-1];for(let s=i;s<e;s+=1)u-=t[s]*r[p-s&c-1];o[p]=h[a],r[p]=u,p=p+1&c-1,l[a]=u}return p},Mt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Et=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const s=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==s&&(s.catch((()=>{})),!0)}catch{}return!1},Rt=(t,e,s)=>{const n=e[s];void 0!==n&&n!==t[s]&&(t[s]=n)},qt=(t,e)=>{Rt(t,e,"channelCount"),Rt(t,e,"channelCountMode"),Rt(t,e,"channelInterpretation")},It=t=>"function"==typeof t.getFloatTimeDomainData,Ft=(t,e,s)=>{const n=e[s];void 0!==n&&n!==t[s].value&&(t[s].value=n)},Vt=t=>{t.start=(e=>(s=0,n=0,i)=>{if("number"==typeof i&&i<0||n<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(t,s,n,i)})(t.start)},Nt=t=>{var e;t.stop=(e=t.stop,(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(t,s)})},Pt=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),jt=(t,e)=>{const s=t.createBiquadFilter();return qt(s,e),Ft(s,e,"Q"),Ft(s,e,"detune"),Ft(s,e,"frequency"),Ft(s,e,"gain"),Rt(s,e,"type"),s},Lt=(t,e)=>{const s=t.createChannelSplitter(e.numberOfOutputs);return qt(s,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw At()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw At()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw At()}})})(s),s},zt=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Wt=(t,e)=>{const s=t.createDelay(e.maxDelayTime);return qt(s,e),Ft(s,e,"delayTime"),s},Bt=(t,e)=>{const s=t.createGain();return qt(s,e),Ft(s,e,"gain"),s};function Ut(t,e){const s=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/s,(t[1]*e[0]-t[0]*e[1])/s]}function Gt(t,e){let s=[0,0];for(let o=t.length-1;o>=0;o-=1)i=e,s=[(n=s)[0]*i[0]-n[1]*i[1],n[0]*i[1]+n[1]*i[0]],s[0]+=t[o];var n,i;return s}const Qt=(t,e,s,n)=>t.createScriptProcessor(e,s,n),Zt=()=>new DOMException("","NotSupportedError"),Xt={numberOfChannels:1},Yt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},$t={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Ht={disableNormalization:!1},Jt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Kt=()=>new DOMException("","UnknownError"),te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ee=(t,e,s)=>void 0===t.copyFromChannel?t.getChannelData(s)[0]:(t.copyFromChannel(e,s),e[0]),se=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},ne=(t,e,s,n)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:o,set:r}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:s(o),set:n(r)})},ie=(t,e,s)=>{try{t.setValueAtTime(e,s)}catch(n){if(9!==n.code)throw n;ie(t,e,s+1e-7)}},oe=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},re=t=>{const e=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch{return!1}},ae=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ce=()=>{try{new DOMException}catch{return!1}return!0},he=()=>new Promise((t=>{const e=new ArrayBuffer(0),{port1:s,port2:n}=new MessageChannel;s.onmessage=({data:e})=>t(null!==e),n.postMessage(e,[e])})),le=(t,e)=>{const s=e.createGain();t.connect(s);const n=(e=>()=>{e.call(t,s),t.removeEventListener("ended",n)})(t.disconnect);t.addEventListener("ended",n),zt(t,s),t.stop=(e=>{let n=!1;return(i=0)=>{if(n)try{e.call(t,i)}catch{s.gain.setValueAtTime(0,i)}else e.call(t,i),n=!0}})(t.stop)},ue=(t,e)=>s=>{const n={value:t};return Object.defineProperties(s,{currentTarget:n,target:n}),"function"==typeof e?e.call(t,s):e.handleEvent.call(t,s)},pe=(t=>(e,s,[n,i,o],r)=>{t(e[i],[s,n,o],(t=>t[0]===s&&t[1]===n),r)})(G),de=(t=>(e,s,[n,i,o],r)=>{const a=e.get(n);void 0===a?e.set(n,new Set([[i,s,o]])):t(a,[i,s,o],(t=>t[0]===i&&t[1]===s),r)})(G),fe=(t=>(e,s,n,i)=>t(e[i],(t=>t[0]===s&&t[1]===n)))(b),_e=new WeakMap,me=(t=>e=>{var s;return null!==(s=t.get(e))&&void 0!==s?s:0})(_e),ge=(ve=new Map,ye=new WeakMap,(t,e)=>{const s=ye.get(t);if(void 0!==s)return s;const n=ve.get(t);if(void 0!==n)return n;try{const s=e();return s instanceof Promise?(ve.set(t,s),s.catch((()=>!1)).then((e=>(ve.delete(t),ye.set(t,e),e)))):(ye.set(t,s),s)}catch{return ye.set(t,!1),!1}});var ve,ye;const xe="undefined"==typeof window?null:window,we=((t,e)=>(s,n)=>{const i=s.createAnalyser();if(qt(i,n),!(n.maxDecibels>n.minDecibels))throw e();return Rt(i,n,"fftSize"),Rt(i,n,"maxDecibels"),Rt(i,n,"minDecibels"),Rt(i,n,"smoothingTimeConstant"),t(It,(()=>It(i)))||(t=>{t.getFloatTimeDomainData=e=>{const s=new Uint8Array(e.length);t.getByteTimeDomainData(s);const n=Math.max(s.length,t.fftSize);for(let t=0;t<n;t+=1)e[t]=.0078125*(s[t]-128);return e}})(i),i})(ge,R),be=(t=>e=>{const s=t(e);if(null===s.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return s.renderer})(j),Te=((t,e,s)=>async(n,i,o)=>{const r=t(n);await Promise.all(r.activeInputs.map(((t,r)=>Array.from(t).map((async([t,a])=>{const c=e(t),h=await c.render(t,i),l=n.context.destination;s(t)||n===l&&s(n)||h.connect(o,a,r)})))).reduce(((t,e)=>[...t,...e]),[]))})(j,be,st),Se=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const r=n.get(o);return void 0!==r?Promise.resolve(r):(async(i,o)=>{let r=e(i);if(!M(r,o)){const e={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,fftSize:r.fftSize,maxDecibels:r.maxDecibels,minDecibels:r.minDecibels,smoothingTimeConstant:r.smoothingTimeConstant};r=t(o,e)}return n.set(o,r),await s(i,o,r),r})(i,o)}}})(we,tt,Te),ke=(Ae=u,t=>{const e=Ae.get(t);if(void 0===e)throw At();return e});var Ae;const Ce=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(xe),Oe=(t=>e=>null!==t&&e instanceof t)(Ce),De=new WeakMap,Me=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,s,n){if(null!==s){let i=this._listeners.get(s);void 0===i&&(i=t(this,s),"function"==typeof s&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,s){const n=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===n?null:n,s)}})(ue),Ee=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(xe),Re=(t=>e=>null!==t&&e instanceof t)(Ee),qe=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(xe),Ie=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(xe),Fe=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(xe),Ve=((t,e,s,n,i,o,r,a,h,l,u,d,f,_,m,g)=>class extends l{constructor(e,n,i,o){super(i),this._context=e,this._nativeAudioNode=i;const r=u(e);d(r)&&!0!==s(it,(()=>it(r,g)))&&at(i),c.set(this,i),p.set(this,new Set),"closed"!==e.state&&n&&k(this),t(this,o,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,s=0,a=0){if(s<0||s>=this._nativeAudioNode.numberOfOutputs)throw i();const c=u(this._context),l=m(c);if(f(t)||_(t))throw o();if(B(t)){const i=tt(t);try{const e=Y(this._nativeAudioNode,i,s,a),n=nt(this);(l||n)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!n&&nt(t)&&k(t)}catch(t){if(12===t.code)throw o();throw t}if(e(this,t,s,a,l)){const e=h([this],t);ot(e,n(l))}return t}const p=et(t);if("playbackRate"===p.name&&1024===p.maxValue)throw r();try{this._nativeAudioNode.connect(p,s),(l||nt(this))&&this._nativeAudioNode.disconnect(p,s)}catch(t){if(12===t.code)throw o();throw t}if(((t,e,s,n)=>{const{activeInputs:i,passiveInputs:o}=L(e),{outputs:r}=j(t),a=S(t),c=r=>{const a=tt(t),c=et(e);if(r){const e=J(o,t,s);Q(i,t,e,!1),n||st(t)||a.connect(c,s)}else{const e=((t,e,s)=>b(t,(t=>t[0]===e&&t[1]===s)))(i,t,s);Z(o,e,!1),n||st(t)||a.disconnect(c,s)}};return!!G(r,[e,s],(t=>t[0]===e&&t[1]===s),!0)&&(a.add(c),N(t)?Q(i,t,[s,c],!0):Z(o,[t,s,c],!0),!0)})(this,t,s,l)){const e=h([this],t);ot(e,n(l))}}disconnect(t,e,s){let n;const r=u(this._context),c=m(r);if(void 0===t)n=((t,e)=>{const s=j(t),n=[];for(const i of s.outputs)U(i)?ct(t,e,...i):ht(t,e,...i),n.push(i[0]);return s.outputs.clear(),n})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();n=((t,e,s)=>{const n=j(t),i=[];for(const o of n.outputs)o[1]===s&&(U(o)?ct(t,e,...o):ht(t,e,...o),i.push(o[0]),n.outputs.delete(o));return i})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(B(t)&&void 0!==s&&(s<0||s>=t.numberOfInputs))throw i();if(n=((t,e,s,n,i)=>{const o=j(t);return Array.from(o.outputs).filter((t=>!(t[0]!==s||void 0!==n&&t[1]!==n||void 0!==i&&t[2]!==i))).map((s=>(U(s)?ct(t,e,...s):ht(t,e,...s),o.outputs.delete(s),s[0])))})(this,c,t,e,s),0===n.length)throw o()}for(const t of n){const e=h([this],t);ot(e,a)}}})((Ne=a,(t,e,s)=>{const n=[];for(let t=0;t<s.numberOfInputs;t+=1)n.push(new Set);Ne.set(t,{activeInputs:n,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,s,n,i,o,r,a,c,h,l,u,p)=>{const d=new WeakMap;return(f,_,m,g,v)=>{const{activeInputs:y,passiveInputs:x}=o(_),{outputs:w}=o(f),b=a(f),S=o=>{const a=c(_),h=c(f);if(o){const e=T(x,f,m,g);t(y,f,e,!1),v||u(f)||s(h,a,m,g),p(_)&&k(_)}else{const t=n(y,f,m,g);e(x,g,t,!1),v||u(f)||i(h,a,m,g);const s=r(_);if(0===s)l(_)&&O(_,y);else{const t=d.get(_);void 0!==t&&clearTimeout(t),d.set(_,setTimeout((()=>{l(_)&&O(_,y)}),1e3*s))}}};return!!h(w,[_,m,g],(t=>t[0]===_&&t[1]===m&&t[2]===g),!0)&&(b.add(S),l(f)?t(y,f,[m,g,S],!0):e(x,g,[f,m,S],!0),!0)}})(pe,de,Y,fe,K,j,me,S,tt,G,N,st,nt),ge,((t,e,s,n,i,o)=>r=>(a,c)=>{const h=t.get(a);if(void 0===h){if(!r&&o(a)){const t=n(a),{outputs:o}=s(a);for(const s of o)if(U(s)){const i=n(s[0]);e(t,i,s[1],s[2])}else{const e=i(s[0]);t.disconnect(e,s[1])}}t.set(a,c)}else t.set(a,h+c)})(d,K,j,tt,et,N),R,Ct,Zt,((t,e,s,n,i,o,r,a)=>(c,h)=>{const l=e.get(c);if(void 0===l)throw new Error("Missing the expected cycle count.");const u=o(c.context),p=a(u);if(l===h){if(e.delete(c),!p&&r(c)){const e=n(c),{outputs:o}=s(c);for(const s of o)if(U(s)){const i=n(s[0]);t(e,i,s[1],s[2])}else{const t=i(s[0]);e.connect(t,s[1])}}}else e.set(c,l-h)})(Y,d,j,tt,et,ke,N,Oe),((t,e,s)=>function n(i,o){const r=B(o)?o:s(t,o);if((t=>"delayTime"in t)(r))return[];if(i[0]===r)return[i];if(i.includes(r))return[];const{outputs:a}=e(r);return Array.from(a).map((t=>n([...i,r],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(De,j,w),Me,ke,Re,qe,Ie,Oe,Fe);var Ne;const Pe=((t,e,s,n,i,o)=>class extends t{constructor(t,s){const r=i(t),a={...D,...s},c=n(r,a);super(t,!1,c,o(r)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,s()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,s()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ve,Se,R,we,ke,Oe),je=new WeakSet,Le=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(xe),ze=(We=new Uint32Array(1),t=>(We[0]=t,We[0]));var We;const Be=((t,e)=>s=>{s.copyFromChannel=(n,i,o=0)=>{const r=t(o),a=t(i);if(a>=s.numberOfChannels)throw e();const c=s.length,h=s.getChannelData(a),l=n.length;for(let t=r<0?-r:0;t+r<c&&t<l;t+=1)n[t]=h[t+r]},s.copyToChannel=(n,i,o=0)=>{const r=t(o),a=t(i);if(a>=s.numberOfChannels)throw e();const c=s.length,h=s.getChannelData(a),l=n.length;for(let t=r<0?-r:0;t+r<c&&t<l;t+=1)h[t+r]=n[t]}})(ze,R),Ue=(t=>e=>{e.copyFromChannel=(s=>(n,i,o=0)=>{const r=t(o),a=t(i);if(r<e.length)return s.call(e,n,a,r)})(e.copyFromChannel),e.copyToChannel=(s=>(n,i,o=0)=>{const r=t(o),a=t(i);if(r<e.length)return s.call(e,n,a,r)})(e.copyToChannel)})(ze),Ge=((t,e,s,n,i,o,r,a)=>{let c=null;return class h{constructor(h){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:l,numberOfChannels:u,sampleRate:p}={...I,...h};null===c&&(c=new i(1,1,44100));const d=null!==n&&e(o,o)?new n({length:l,numberOfChannels:u,sampleRate:p}):c.createBuffer(u,l,p);if(0===d.numberOfChannels)throw s();return"function"!=typeof d.copyFromChannel?(r(d),q(d)):e(E,(()=>E(d)))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===h.prototype||t.has(e)}}})(je,ge,Zt,Le,Ce,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Le),Be,Ue),Qe=(t=>(e,s)=>{const n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.connect(n).connect(e.destination);const i=()=>{s.removeEventListener("ended",i),s.disconnect(n),n.disconnect()};s.addEventListener("ended",i)})(Bt),Ze=((t,e,s)=>async(n,i,o)=>{const r=e(n);await Promise.all(Array.from(r.activeInputs).map((async([e,n])=>{const r=t(e),a=await r.render(e,i);s(e)||a.connect(o,n)})))})(be,L,st),Xe=(t=>(e,s,n)=>t(s,e,n))(Ze),Ye=((t,e,s,n,i,o,r,a,c,h,l)=>(c,u)=>{const p=c.createBufferSource();return qt(p,u),Ft(p,u,"playbackRate"),Rt(p,u,"buffer"),Rt(p,u,"loop"),Rt(p,u,"loopEnd"),Rt(p,u,"loopStart"),e(s,(()=>s(c)))||(t=>{t.start=(e=>{let s=!1;return(n=0,i=0,o)=>{if(s)throw At();e.call(t,n,i,o),s=!0}})(t.start)})(p),e(n,(()=>n(c)))||(t=>{t.start=(e=>(s=0,n=0,i)=>{const o=t.buffer,r=null===o?n:Math.min(o.duration,n);null!==o&&r>o.duration-.5/t.context.sampleRate?e.call(t,s,0,0):e.call(t,s,r,i)})(t.start)})(p),e(i,(()=>i(c)))||h(p,c),e(o,(()=>o(c)))||Vt(p),e(r,(()=>r(c)))||l(p,c),e(a,(()=>a(c)))||Nt(p),t(c,p),p})(Qe,ge,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),s=t.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),oe,re,ae,0,(t=>(e,s)=>{const n=s.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=n),t(e,"buffer",(t=>()=>{const s=t.call(e);return s===n?null:s}),(t=>s=>t.call(e,null===s?n:s)))})(ne),le),$e=((t,e)=>(s,n,i)=>(t(n).replay(i),e(n,s,i)))((t=>e=>{const s=t(e);if(null===s.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer})(L),Ze),He=((t,e,s,n,i)=>()=>{const o=new WeakMap;let r=null,a=null;return{set start(t){r=t},set stop(t){a=t},render(c,h){const l=o.get(h);return void 0!==l?Promise.resolve(l):(async(c,h)=>{let l=s(c);const u=M(l,h);if(!u){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(h,t),null!==r&&l.start(...r),null!==a&&l.stop(a)}return o.set(h,l),u?await t(h,c.playbackRate,l.playbackRate):await n(h,c.playbackRate,l.playbackRate),await i(c,h,l),l})(c,h)}}})(Xe,Ye,tt,$e,Te),Je=((t,e,s,n,i,r,a,c,h,l,u,p,d)=>(n,f,_,m=null,g=null)=>{const v=_.value,y=new o.AutomationEventList(v),x=f?(t=>({replay(e){for(const s of t)if("exponentialRampToValue"===s.type){const{endTime:t,value:n}=s;e.exponentialRampToValueAtTime(n,t)}else if("linearRampToValue"===s.type){const{endTime:t,value:n}=s;e.linearRampToValueAtTime(n,t)}else if("setTarget"===s.type){const{startTime:t,target:n,timeConstant:i}=s;e.setTargetAtTime(n,t,i)}else if("setValue"===s.type){const{startTime:t,value:n}=s;e.setValueAtTime(n,t)}else{if("setValueCurve"!==s.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:n,values:i}=s;e.setValueCurveAtTime(i,n,t)}}}}))(y):null,w={get defaultValue(){return v},get maxValue(){return null===m?_.maxValue:m},get minValue(){return null===g?_.minValue:g},get value(){return _.value},set value(t){_.value=t,w.setValueAtTime(t,n.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof _.cancelAndHoldAtTime)null===x&&y.flush(n.context.currentTime),y.add(i(t)),_.cancelAndHoldAtTime(t);else{const e=Array.from(y).pop();null===x&&y.flush(n.context.currentTime),y.add(i(t));const s=Array.from(y).pop();_.cancelScheduledValues(t),e!==s&&void 0!==s&&("exponentialRampToValue"===s.type?_.exponentialRampToValueAtTime(s.value,s.endTime):"linearRampToValue"===s.type?_.linearRampToValueAtTime(s.value,s.endTime):"setValue"===s.type?_.setValueAtTime(s.value,s.startTime):"setValueCurve"===s.type&&_.setValueCurveAtTime(s.values,s.startTime,s.duration))}return w},cancelScheduledValues:t=>(null===x&&y.flush(n.context.currentTime),y.add(r(t)),_.cancelScheduledValues(t),w),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;const s=n.context.currentTime;return null===x&&y.flush(s),0===Array.from(y).length&&(y.add(l(v,s)),_.setValueAtTime(v,s)),y.add(a(t,e)),_.exponentialRampToValueAtTime(t,e),w},linearRampToValueAtTime(t,e){const s=n.context.currentTime;return null===x&&y.flush(s),0===Array.from(y).length&&(y.add(l(v,s)),_.setValueAtTime(v,s)),y.add(c(t,e)),_.linearRampToValueAtTime(t,e),w},setTargetAtTime:(t,e,s)=>(null===x&&y.flush(n.context.currentTime),y.add(h(t,e,s)),_.setTargetAtTime(t,e,s),w),setValueAtTime:(t,e)=>(null===x&&y.flush(n.context.currentTime),y.add(l(t,e)),_.setValueAtTime(t,e),w),setValueCurveAtTime(t,e,s){const i=t instanceof Float32Array?t:new Float32Array(t);if(null!==p&&"webkitAudioContext"===p.name){const t=e+s,o=n.context.sampleRate,r=Math.ceil(e*o),a=Math.floor(t*o),c=a-r,h=new Float32Array(c);for(let t=0;t<c;t+=1){const n=(i.length-1)/s*((r+t)/o-e),a=Math.floor(n),c=Math.ceil(n);h[t]=a===c?i[a]:(1-(n-a))*i[a]+(1-(c-n))*i[c]}null===x&&y.flush(n.context.currentTime),y.add(u(h,e,s)),_.setValueCurveAtTime(h,e,s);const l=a/o;l<t&&d(w,h[h.length-1],l),d(w,i[i.length-1],t)}else null===x&&y.flush(n.context.currentTime),y.add(u(i,e,s)),_.setValueCurveAtTime(i,e,s);return w}};return s.set(w,_),e.set(w,n),t(w,x),w})((Ke=h,(t,e)=>{Ke.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),De,l,0,o.createCancelAndHoldAutomationEvent,o.createCancelScheduledValuesAutomationEvent,o.createExponentialRampToValueAutomationEvent,o.createLinearRampToValueAutomationEvent,o.createSetTargetAutomationEvent,o.createSetValueAutomationEvent,o.createSetValueCurveAutomationEvent,Ee,ie);var Ke;const ts=((t,e,s,n,i,o,r,a)=>class extends t{constructor(t,n){const a=o(t),c={...P,...n},h=i(a,c),l=r(a),u=l?e():null;super(t,!1,h,u),this._audioBufferSourceNodeRenderer=u,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=h,this._onended=null,this._playbackRate=s(this,l,h.playbackRate,V,F)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const s=this._nativeAudioBufferSourceNode.onended;this._onended=null!==s&&s===e?t:s}get playbackRate(){return this._playbackRate}start(t=0,e=0,s){if(this._nativeAudioBufferSourceNode.start(t,e,s),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===s?[t,e]:[t,e,s]),"closed"!==this.context.state){k(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ve,He,Je,At,Ye,ke,Oe,ue),es=((t,e,s,n,i,o,r,a)=>class extends t{constructor(t,e){const s=o(t),n=r(s),c=i(s,e,n);super(t,!1,c,n?(t=>{const e=new WeakMap;return{render(s,n){const i=e.get(n);return void 0!==i?Promise.resolve(i):(async(s,n)=>{const i=n.destination;return e.set(n,i),await t(s,n,i),i})(s,n)}}})(a):null),this._isNodeOfNativeOfflineAudioContext=n,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw s();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ve,0,R,At,((t,e)=>(s,n,i)=>{const o=s.destination;if(o.channelCount!==n)try{o.channelCount=n}catch{}i&&"explicit"!==o.channelCountMode&&(o.channelCountMode="explicit"),0===o.maxChannelCount&&Object.defineProperty(o,"maxChannelCount",{value:n});const r=t(s,{channelCount:n,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1});return e(r,"channelCount",(t=>()=>t.call(r)),(t=>e=>{t.call(r,e);try{o.channelCount=e}catch(t){if(e>o.maxChannelCount)throw t}})),e(r,"channelCountMode",(t=>()=>t.call(r)),(t=>e=>{t.call(r,e),o.channelCountMode=e})),e(r,"channelInterpretation",(t=>()=>t.call(r)),(t=>e=>{t.call(r,e),o.channelInterpretation=e})),Object.defineProperty(r,"maxChannelCount",{get:()=>o.maxChannelCount}),r.connect(o),r})(Bt,ne),ke,Oe,Te),ss=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(r,a){const c=o.get(a);return void 0!==c?Promise.resolve(c):(async(r,a)=>{let c=s(r);const h=M(c,a);if(!h){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return o.set(a,c),h?(await t(a,r.Q,c.Q),await t(a,r.detune,c.detune),await t(a,r.frequency,c.frequency),await t(a,r.gain,c.gain)):(await n(a,r.Q,c.Q),await n(a,r.detune,c.detune),await n(a,r.frequency,c.frequency),await n(a,r.gain,c.gain)),await i(r,a,c),c})(r,a)}}})(Xe,jt,tt,$e,Te),ns=(t=>(e,s)=>t.set(e,s))(_e),is=((t,e,s,n,i,o,r,a)=>class extends t{constructor(t,n){const c=o(t),h={...mt,...n},l=i(c,h),u=r(c);super(t,!1,l,u?s():null),this._Q=e(this,u,l.Q,V,F),this._detune=e(this,u,l.detune,1200*Math.log2(V),-1200*Math.log2(V)),this._frequency=e(this,u,l.frequency,t.sampleRate/2,0),this._gain=e(this,u,l.gain,40*Math.log10(V),F),this._nativeBiquadFilterNode=l,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,s){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,s)}catch(t){if(11===t.code)throw n();throw t}if(t.length!==e.length||e.length!==s.length)throw n()}})(Ve,Je,ss,Ct,jt,ke,Oe,ns),os=((t,e)=>(s,n,i)=>{const o=new Set;return s.connect=(i=>(r,a=0,c=0)=>{const h=0===o.size;if(e(r))return i.call(s,r,a,c),t(o,[r,a,c],(t=>t[0]===r&&t[1]===a&&t[2]===c),!0),h&&n(),r;i.call(s,r,a),t(o,[r,a],(t=>t[0]===r&&t[1]===a),!0),h&&n()})(s.connect),s.disconnect=(t=>(n,r,a)=>{const c=o.size>0;if(void 0===n)t.apply(s),o.clear();else if("number"==typeof n){t.call(s,n);for(const t of o)t[1]===n&&o.delete(t)}else{e(n)?t.call(s,n,r,a):t.call(s,n,r);for(const t of o)t[0]!==n||void 0!==r&&t[1]!==r||void 0!==a&&t[2]!==a||o.delete(t)}const h=0===o.size;c&&h&&i()})(s.disconnect),s})(G,qe),rs=((t,e)=>(s,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=s.createBufferSource();e(n,(()=>{const t=n.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(n,0,e)}),(()=>i.disconnect(n)))})(At,os),as=((t,e)=>(s,n)=>{const i=s.createChannelMerger(n.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(s,i),qt(i,n),i})(Ee,rs),cs=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const r=n.get(o);return void 0!==r?Promise.resolve(r):(async(i,o)=>{let r=e(i);if(!M(r,o)){const e={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,numberOfInputs:r.numberOfInputs};r=t(o,e)}return n.set(o,r),await s(i,o,r),r})(i,o)}}})(as,tt,Te),hs=((t,e,s,n,i)=>class extends t{constructor(t,o){const r=n(t),a={...gt,...o};super(t,!1,s(r,a),i(r)?e():null)}})(Ve,cs,as,ke,Oe),ls=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const r=n.get(o);return void 0!==r?Promise.resolve(r):(async(i,o)=>{let r=e(i);if(!M(r,o)){const e={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,numberOfOutputs:r.numberOfOutputs};r=t(o,e)}return n.set(o,r),await s(i,o,r),r})(i,o)}}})(Lt,tt,Te),us=((t,e,s,n,i,o)=>class extends t{constructor(t,o){const r=n(t),a=(t=>({...t,channelCount:t.numberOfOutputs}))({...vt,...o});super(t,!1,s(r,a),i(r)?e():null)}})(Ve,ls,Lt,ke,Oe),ps=((t,e,s,n)=>(i,{offset:o,...r})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),h=s(i,{...r,gain:o}),l=a.getChannelData(0);l[0]=1,l[1]=1,c.buffer=a,c.loop=!0;const u={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){h.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){h.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t},get context(){return h.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get offset(){return h.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(i,c),n(zt(u,h),(()=>c.connect(h)),(()=>c.disconnect(h)))})(Qe,Ye,Bt,os),ds=((t,e,s,n,i)=>(o,r)=>{if(void 0===o.createConstantSource)return s(o,r);const a=o.createConstantSource();return qt(a,r),Ft(a,r,"offset"),e(n,(()=>n(o)))||Vt(a),e(i,(()=>i(o)))||Nt(a),t(o,a),a})(Qe,ge,ps,oe,ae),fs=((t,e,s,n,i)=>()=>{const o=new WeakMap;let r=null,a=null;return{set start(t){r=t},set stop(t){a=t},render(c,h){const l=o.get(h);return void 0!==l?Promise.resolve(l):(async(c,h)=>{let l=s(c);const u=M(l,h);if(!u){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(h,t),null!==r&&l.start(r),null!==a&&l.stop(a)}return o.set(h,l),u?await t(h,c.offset,l.offset):await n(h,c.offset,l.offset),await i(c,h,l),l})(c,h)}}})(Xe,ds,tt,$e,Te),_s=((t,e,s,n,i,o,r)=>class extends t{constructor(t,r){const a=i(t),c={...yt,...r},h=n(a,c),l=o(a),u=l?s():null;super(t,!1,h,u),this._constantSourceNodeRenderer=u,this._nativeConstantSourceNode=h,this._offset=e(this,l,h.offset,V,F),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?r(this,t):null;this._nativeConstantSourceNode.onended=e;const s=this._nativeConstantSourceNode.onended;this._onended=null!==s&&s===e?t:s}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){k(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ve,Je,fs,ds,ke,Oe,ue),ms=((t,e)=>(s,n)=>{const i=s.createConvolver();if(qt(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),Rt(i,n,"buffer"),n.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>s=>{if(s>2)throw t();return e.call(i,s)})),"max"===n.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>s=>{if("max"===s)throw t();return e.call(i,s)})),i})(Zt,ne),gs=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const r=n.get(o);return void 0!==r?Promise.resolve(r):(async(i,o)=>{let r=e(i);if(!M(r,o)){const e={buffer:r.buffer,channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,disableNormalization:!r.normalize};r=t(o,e)}return n.set(o,r),X(r)?await s(i,o,r.inputs[0]):await s(i,o,r),r})(i,o)}}})(ms,tt,Te),vs=((t,e,s,n,i,o)=>class extends t{constructor(t,r){const a=n(t),c={...xt,...r},h=s(a,c);super(t,!1,h,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=h,null!==c.buffer&&o(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0,o(this,0)}else this._isBufferNullified=!1,o(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ve,gs,ms,ke,Oe,ns),ys=((t,e,s,n,i)=>o=>{const r=new WeakMap;return{render(a,c){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(a,c)=>{let h=s(a);const l=M(h,c);if(!l){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:o};h=e(c,t)}return r.set(c,h),l?await t(c,a.delayTime,h.delayTime):await n(c,a.delayTime,h.delayTime),await i(a,c,h),h})(a,c)}}})(Xe,Wt,tt,$e,Te),xs=((t,e,s,n,i,o,r)=>class extends t{constructor(t,a){const c=i(t),h={...bt,...a},l=n(c,h),u=o(c);super(t,!1,l,u?s(h.maxDelayTime):null),this._delayTime=e(this,u,l.delayTime),r(this,h.maxDelayTime)}get delayTime(){return this._delayTime}})(Ve,Je,ys,Wt,ke,Oe,ns),ws=(t=>(e,s)=>{const n=e.createDynamicsCompressor();if(qt(n,s),s.channelCount>2)throw t();if("max"===s.channelCountMode)throw t();return Ft(n,s,"attack"),Ft(n,s,"knee"),Ft(n,s,"ratio"),Ft(n,s,"release"),Ft(n,s,"threshold"),n})(Zt),bs=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(r,a){const c=o.get(a);return void 0!==c?Promise.resolve(c):(async(r,a)=>{let c=s(r);const h=M(c,a);if(!h){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return o.set(a,c),h?(await t(a,r.attack,c.attack),await t(a,r.knee,c.knee),await t(a,r.ratio,c.ratio),await t(a,r.release,c.release),await t(a,r.threshold,c.threshold)):(await n(a,r.attack,c.attack),await n(a,r.knee,c.knee),await n(a,r.ratio,c.ratio),await n(a,r.release,c.release),await n(a,r.threshold,c.threshold)),await i(r,a,c),c})(r,a)}}})(Xe,ws,tt,$e,Te),Ts=((t,e,s,n,i,o,r,a)=>class extends t{constructor(t,i){const c=o(t),h={...St,...i},l=n(c,h),u=r(c);super(t,!1,l,u?s():null),this._attack=e(this,u,l.attack),this._knee=e(this,u,l.knee),this._nativeDynamicsCompressorNode=l,this._ratio=e(this,u,l.ratio),this._release=e(this,u,l.release),this._threshold=e(this,u,l.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ve,Je,bs,ws,Zt,ke,Oe,ns),Ss=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(r,a){const c=o.get(a);return void 0!==c?Promise.resolve(c):(async(r,a)=>{let c=s(r);const h=M(c,a);if(!h){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return o.set(a,c),h?await t(a,r.gain,c.gain):await n(a,r.gain,c.gain),await i(r,a,c),c})(r,a)}}})(Xe,Bt,tt,$e,Te),ks=((t,e,s,n,i,o)=>class extends t{constructor(t,r){const a=i(t),c={...kt,...r},h=n(a,c),l=o(a);super(t,!1,h,l?s():null),this._gain=e(this,l,h.gain,V,F)}get gain(){return this._gain}})(Ve,Je,Ss,Bt,ke,Oe),As=((t,e,s,n)=>(i,o,{channelCount:r,channelCountMode:a,channelInterpretation:c,feedback:h,feedforward:l})=>{const u=Pt(o,i.sampleRate),p=h instanceof Float64Array?h:new Float64Array(h),d=l instanceof Float64Array?l:new Float64Array(l),f=p.length,_=d.length,m=Math.min(f,_);if(0===f||f>20)throw n();if(0===p[0])throw e();if(0===_||_>20)throw n();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<_;t+=1)d[t]/=p[0];for(let t=1;t<f;t+=1)p[t]/=p[0]}const g=s(i,u,r,r);g.channelCount=r,g.channelCountMode=a,g.channelInterpretation=c;const v=[],y=[],x=[];for(let t=0;t<r;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),x.push(e)}g.onaudioprocess=t=>{const e=t.inputBuffer,s=t.outputBuffer,n=e.numberOfChannels;for(let t=0;t<n;t+=1){const n=e.getChannelData(t),i=s.getChannelData(t);v[t]=Dt(p,f,d,_,m,y[t],x[t],v[t],32,n,i)}};const w=i.sampleRate/2;return zt({get bufferSize(){return u},get channelCount(){return g.channelCount},set channelCount(t){g.channelCount=t},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){g.channelCountMode=t},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(t){g.channelInterpretation=t},get context(){return g.context},get inputs(){return[g]},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},addEventListener:(...t)=>g.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>g.dispatchEvent(t[0]),getFrequencyResponse(e,s,n){if(e.length!==s.length||s.length!==n.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/w),o=[Math.cos(i),Math.sin(i)],r=Ut(Gt(d,o),Gt(p,o));s[t]=Math.sqrt(r[0]*r[0]+r[1]*r[1]),n[t]=Math.atan2(r[1],r[0])}},removeEventListener:(...t)=>g.removeEventListener(t[0],t[1],t[2])},g)})(Ct,At,Qt,Zt),Cs=((t,e,s,n)=>i=>t(Et,(()=>Et(i)))?Promise.resolve(t(n,n)).then((t=>{if(!t){const t=s(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const s=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{s.disconnect(),t(e.renderedBuffer)},s.connect(i.destination),i.startRendering()})))(ge,Bt,Qt,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const s=new e(1,1,44100),n=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{s.oncomplete=()=>{n.disconnect(),t(0!==s.currentTime)},s.startRendering()}))})(Bt,Ce)),Os=((t,e,s,n,i)=>(o,r)=>{const a=new WeakMap;let c=null;return{render(h,l){const u=a.get(l);return void 0!==u?Promise.resolve(u):(async(h,l)=>{let u=null,p=e(h);const d=M(p,l);if(void 0===l.createIIRFilter?u=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=l.createIIRFilter(r,o)),a.set(l,null===u?p:u),null!==u){if(null===c){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new s(h.context.destination.channelCount,h.context.length,l.sampleRate);c=(async()=>(await n(h,t,t.destination),((t,e,s,n)=>{const i=s instanceof Float64Array?s:new Float64Array(s),o=n instanceof Float64Array?n:new Float64Array(n),r=i.length,a=o.length,c=Math.min(r,a);if(1!==i[0]){for(let t=0;t<r;t+=1)o[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const h=new Float32Array(32),l=new Float32Array(32),u=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let e=0;e<p;e+=1){const s=t.getChannelData(e),n=u.getChannelData(e);h.fill(0),l.fill(0),Dt(i,r,o,a,c,h,l,0,32,s,n)}return u})(await i(t),l,o,r)))()}const t=await c;return u.buffer=t,u.start(0),u}return await n(h,l,p),p})(h,l)}}})(Ye,tt,Ce,Te,Cs),Ds=(t=>(e,s,n)=>{if(void 0===e.createIIRFilter)return t(e,s,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return qt(i,n),i})(As),Ms=((t,e,s,n,i,o)=>class extends t{constructor(t,r){const a=n(t),c=i(a),h={...Ot,...r},l=e(a,c?null:t.baseLatency,h);super(t,!1,l,c?s(h.feedback,h.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(s,n,i)=>{if(s.length!==n.length||n.length!==i.length)throw Ct();return e.call(t,s,n,i)})})(l),this._nativeIIRFilterNode=l,o(this,1)}getFrequencyResponse(t,e,s){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,s)}})(Ve,Ds,Os,ke,Oe,ns),Es=((t,e,s,n,i,o,r,a)=>(c,h)=>{const l=h.listener,{forwardX:u,forwardY:p,forwardZ:d,positionX:f,positionY:_,positionZ:m,upX:g,upY:v,upZ:y}=void 0===l.forwardX?(()=>{const u=new Float32Array(1),p=e(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=r(h);let f=!1,_=[0,0,-1,0,1,0],m=[0,0,0];const g=()=>{if(f)return;f=!0;const t=n(h,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[o(t,u,0),o(t,u,1),o(t,u,2),o(t,u,3),o(t,u,4),o(t,u,5)];e.some(((t,e)=>t!==_[e]))&&(l.setOrientation(...e),_=e);const s=[o(t,u,6),o(t,u,7),o(t,u,8)];s.some(((t,e)=>t!==m[e]))&&(l.setPosition(...s),m=s)},p.connect(t)},v=t=>e=>{e!==_[t]&&(_[t]=e,l.setOrientation(..._))},y=t=>e=>{e!==m[t]&&(m[t]=e,l.setPosition(...m))},x=(e,n,o)=>{const r=s(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n});r.connect(p,0,e),r.start(),Object.defineProperty(r.offset,"defaultValue",{get:()=>n});const l=t({context:c},d,r.offset,V,F);var u,f,_,m,v,y,x;return a(l,"value",(t=>()=>t.call(l)),(t=>e=>{try{t.call(l,e)}catch(t){if(9!==t.code)throw t}g(),d&&o(e)})),l.cancelAndHoldAtTime=(u=l.cancelAndHoldAtTime,d?()=>{throw i()}:(...t)=>{const e=u.apply(l,t);return g(),e}),l.cancelScheduledValues=(f=l.cancelScheduledValues,d?()=>{throw i()}:(...t)=>{const e=f.apply(l,t);return g(),e}),l.exponentialRampToValueAtTime=(_=l.exponentialRampToValueAtTime,d?()=>{throw i()}:(...t)=>{const e=_.apply(l,t);return g(),e}),l.linearRampToValueAtTime=(m=l.linearRampToValueAtTime,d?()=>{throw i()}:(...t)=>{const e=m.apply(l,t);return g(),e}),l.setTargetAtTime=(v=l.setTargetAtTime,d?()=>{throw i()}:(...t)=>{const e=v.apply(l,t);return g(),e}),l.setValueAtTime=(y=l.setValueAtTime,d?()=>{throw i()}:(...t)=>{const e=y.apply(l,t);return g(),e}),l.setValueCurveAtTime=(x=l.setValueCurveAtTime,d?()=>{throw i()}:(...t)=>{const e=x.apply(l,t);return g(),e}),l};return{forwardX:x(0,0,v(0)),forwardY:x(1,0,v(1)),forwardZ:x(2,-1,v(2)),positionX:x(6,0,y(0)),positionY:x(7,0,y(1)),positionZ:x(8,0,y(2)),upX:x(3,0,v(3)),upY:x(4,1,v(4)),upZ:x(5,0,v(5))}})():l;return{get forwardX(){return u},get forwardY(){return p},get forwardZ(){return d},get positionX(){return f},get positionY(){return _},get positionZ(){return m},get upX(){return g},get upY(){return v},get upZ(){return y}}})(Je,as,ds,Qt,Zt,ee,Oe,ne),Rs=new WeakMap,qs=((t,e,s,n,i,o)=>class extends s{constructor(s,o){super(s),this._nativeContext=s,u.set(this,s),n(s)&&i.set(s,new Set),this._destination=new t(this,o),this._listener=e(this,s),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?o(this,t):null;this._nativeContext.onstatechange=e;const s=this._nativeContext.onstatechange;this._onstatechange=null!==s&&s===e?t:s}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(es,Es,Me,Oe,Rs,ue),Is=((t,e,s,n,i,o)=>(r,a)=>{const c=r.createOscillator();return qt(c,a),Ft(c,a,"detune"),Ft(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):Rt(c,a,"type"),e(s,(()=>s(r)))||Vt(c),e(n,(()=>n(r)))||o(c,r),e(i,(()=>i(r)))||Nt(c),t(r,c),c})(Qe,ge,oe,re,ae,le),Fs=((t,e,s,n,i)=>()=>{const o=new WeakMap;let r=null,a=null,c=null;return{set periodicWave(t){r=t},set start(t){a=t},set stop(t){c=t},render(h,l){const u=o.get(l);return void 0!==u?Promise.resolve(u):(async(h,l)=>{let u=s(h);const p=M(u,l);if(!p){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,periodicWave:null===r?void 0:r,type:u.type};u=e(l,t),null!==a&&u.start(a),null!==c&&u.stop(c)}return o.set(l,u),p?(await t(l,h.detune,u.detune),await t(l,h.frequency,u.frequency)):(await n(l,h.detune,u.detune),await n(l,h.frequency,u.frequency)),await i(h,l,u),u})(h,l)}}})(Xe,Is,tt,$e,Te),Vs=((t,e,s,n,i,o,r)=>class extends t{constructor(t,r){const a=i(t),c={...Yt,...r},h=s(a,c),l=o(a),u=l?n():null,p=t.sampleRate/2;super(t,!1,h,u),this._detune=e(this,l,h.detune,153600,-153600),this._frequency=e(this,l,h.frequency,p,-p),this._nativeOscillatorNode=h,this._onended=null,this._oscillatorNodeRenderer=u,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?r(this,t):null;this._nativeOscillatorNode.onended=e;const s=this._nativeOscillatorNode.onended;this._onended=null!==s&&s===e?t:s}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){k(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ve,Je,Is,Fs,ke,Oe,ue),Ns=(t=>(e,s)=>{const n=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(s),n.start(),()=>{n.stop(),n.disconnect(s)}})(Ye),Ps=((t,e,s,n,i)=>(o,{curve:r,oversample:a,...c})=>{const h=o.createWaveShaper(),l=o.createWaveShaper();qt(h,c),qt(l,c);const u=s(o,{...c,gain:1}),p=s(o,{...c,gain:-1}),d=s(o,{...c,gain:1}),f=s(o,{...c,gain:-1});let _=null,m=!1,g=null;const v={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){u.channelCount=t,p.channelCount=t,h.channelCount=t,d.channelCount=t,l.channelCount=t,f.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){u.channelCountMode=t,p.channelCountMode=t,h.channelCountMode=t,d.channelCountMode=t,l.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t,p.channelInterpretation=t,h.channelInterpretation=t,d.channelInterpretation=t,l.channelInterpretation=t,f.channelInterpretation=t},get context(){return h.context},get curve(){return g},set curve(s){if(null!==s&&s.length<2)throw e();if(null===s)h.curve=s,l.curve=s;else{const t=s.length,e=new Float32Array(t+2-t%2),n=new Float32Array(t+2-t%2);e[0]=s[0],n[0]=-s[t-1];const i=Math.ceil((t+1)/2),o=(t+1)/2-1;for(let r=1;r<i;r+=1){const a=r/i*o,c=Math.floor(a),h=Math.ceil(a);e[r]=c===h?s[c]:(1-(a-c))*s[c]+(1-(h-a))*s[h],n[r]=c===h?-s[t-1-c]:-(1-(a-c))*s[t-1-c]-(1-(h-a))*s[t-1-h]}e[i]=t%2==1?s[i-1]:(s[i-2]+s[i-1])/2,h.curve=e,l.curve=n}g=s,m&&(n(g)&&null===_?_=t(o,u):null!==_&&(_(),_=null))},get inputs(){return[u]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(t){h.oversample=t,l.oversample=t},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};return null!==r&&(v.curve=r instanceof Float32Array?r:new Float32Array(r)),a!==v.oversample&&(v.oversample=a),i(zt(v,d),(()=>{u.connect(h).connect(d),u.connect(p).connect(l).connect(f).connect(d),m=!0,n(g)&&(_=t(o,u))}),(()=>{u.disconnect(h),h.disconnect(d),u.disconnect(p),p.disconnect(l),l.disconnect(f),f.disconnect(d),m=!1,null!==_&&(_(),_=null)}))})(Ns,At,Bt,se,os),js=((t,e,s,n,i,o,r)=>(a,c)=>{const h=a.createWaveShaper();if(null!==o&&"webkitAudioContext"===o.name&&void 0===a.createGain().gain.automationRate)return s(a,c);qt(h,c);const l=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==l&&l.length<2)throw e();Rt(h,{curve:l},"curve"),Rt(h,c,"oversample");let u=null,p=!1;return r(h,"curve",(t=>()=>t.call(h)),(e=>s=>(e.call(h,s),p&&(n(s)&&null===u?u=t(a,h):n(s)||null===u||(u(),u=null)),s))),i(h,(()=>{p=!0,n(h.curve)&&(u=t(a,h))}),(()=>{p=!1,null!==u&&(u(),u=null)}))})(Ns,At,Ps,se,os,Ee,ne),Ls=((t,e,s,n,i,o,r,a,c,h)=>(l,{coneInnerAngle:u,coneOuterAngle:p,coneOuterGain:d,distanceModel:f,maxDistance:_,orientationX:m,orientationY:g,orientationZ:v,panningModel:y,positionX:x,positionY:w,positionZ:b,refDistance:T,rolloffFactor:S,...k})=>{const A=l.createPanner();if(k.channelCount>2)throw r();if("max"===k.channelCountMode)throw r();qt(A,k);const C={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},O=s(l,{...C,channelInterpretation:"speakers",numberOfInputs:6}),D=n(l,{...k,gain:1}),M=n(l,{...C,gain:1}),E=n(l,{...C,gain:0}),R=n(l,{...C,gain:0}),q=n(l,{...C,gain:0}),I=n(l,{...C,gain:0}),F=n(l,{...C,gain:0}),V=i(l,256,6,1),N=o(l,{...C,curve:new Float32Array([1,1]),oversample:"none"});let P=[m,g,v],j=[x,w,b];const L=new Float32Array(1);V.onaudioprocess=({inputBuffer:t})=>{const e=[c(t,L,0),c(t,L,1),c(t,L,2)];e.some(((t,e)=>t!==P[e]))&&(A.setOrientation(...e),P=e);const s=[c(t,L,3),c(t,L,4),c(t,L,5)];s.some(((t,e)=>t!==j[e]))&&(A.setPosition(...s),j=s)},Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const z={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(t){if(t>2)throw r();D.channelCount=t,A.channelCount=t},get channelCountMode(){return A.channelCountMode},set channelCountMode(t){if("max"===t)throw r();D.channelCountMode=t,A.channelCountMode=t},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(t){D.channelInterpretation=t,A.channelInterpretation=t},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(t){A.coneInnerAngle=t},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(t){A.coneOuterAngle=t},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();A.coneOuterGain=t},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(t){A.distanceModel=t},get inputs(){return[D]},get maxDistance(){return A.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;A.maxDistance=t},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return E.gain},get orientationZ(){return R.gain},get panningModel(){return A.panningModel},set panningModel(t){A.panningModel=t},get positionX(){return q.gain},get positionY(){return I.gain},get positionZ(){return F.gain},get refDistance(){return A.refDistance},set refDistance(t){if(t<0)throw new RangeError;A.refDistance=t},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;A.rolloffFactor=t},addEventListener:(...t)=>D.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>D.dispatchEvent(t[0]),removeEventListener:(...t)=>D.removeEventListener(t[0],t[1],t[2])};return u!==z.coneInnerAngle&&(z.coneInnerAngle=u),p!==z.coneOuterAngle&&(z.coneOuterAngle=p),d!==z.coneOuterGain&&(z.coneOuterGain=d),f!==z.distanceModel&&(z.distanceModel=f),_!==z.maxDistance&&(z.maxDistance=_),m!==z.orientationX.value&&(z.orientationX.value=m),g!==z.orientationY.value&&(z.orientationY.value=g),v!==z.orientationZ.value&&(z.orientationZ.value=v),y!==z.panningModel&&(z.panningModel=y),x!==z.positionX.value&&(z.positionX.value=x),w!==z.positionY.value&&(z.positionY.value=w),b!==z.positionZ.value&&(z.positionZ.value=b),T!==z.refDistance&&(z.refDistance=T),S!==z.rolloffFactor&&(z.rolloffFactor=S),1===P[0]&&0===P[1]&&0===P[2]||A.setOrientation(...P),0===j[0]&&0===j[1]&&0===j[2]||A.setPosition(...j),h(zt(z,A),(()=>{D.connect(A),t(D,N,0,0),N.connect(M).connect(O,0,0),N.connect(E).connect(O,0,1),N.connect(R).connect(O,0,2),N.connect(q).connect(O,0,3),N.connect(I).connect(O,0,4),N.connect(F).connect(O,0,5),O.connect(V).connect(l.destination)}),(()=>{D.disconnect(A),a(D,N,0,0),N.disconnect(M),M.disconnect(O),N.disconnect(E),E.disconnect(O),N.disconnect(R),R.disconnect(O),N.disconnect(q),q.disconnect(O),N.disconnect(I),I.disconnect(O),N.disconnect(F),F.disconnect(O),O.disconnect(V),V.disconnect(l.destination)}))})(Y,At,as,Bt,Qt,js,Zt,K,ee,os),zs=(t=>(e,s)=>{const n=e.createPanner();return void 0===n.orientationX?t(e,s):(qt(n,s),Ft(n,s,"orientationX"),Ft(n,s,"orientationY"),Ft(n,s,"orientationZ"),Ft(n,s,"positionX"),Ft(n,s,"positionY"),Ft(n,s,"positionZ"),Rt(n,s,"coneInnerAngle"),Rt(n,s,"coneOuterAngle"),Rt(n,s,"coneOuterGain"),Rt(n,s,"distanceModel"),Rt(n,s,"maxDistance"),Rt(n,s,"panningModel"),Rt(n,s,"refDistance"),Rt(n,s,"rolloffFactor"),n)})(Ls),Ws=((t,e,s,n,i,o,r,a,c,h)=>()=>{const l=new WeakMap;let u=null;return{render(p,d){const f=l.get(d);return void 0!==f?Promise.resolve(f):(async(p,d)=>{let f=null,_=o(p);const m={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},g={...m,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},v=M(_,d);if("bufferSize"in _)f=n(d,{...m,gain:1});else if(!v){const t={...g,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(d,t)}if(l.set(d,null===f?_:f),null!==f){if(null===u){if(null===r)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new r(6,p.context.length,d.sampleRate),n=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});n.connect(t.destination),u=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,n)=>{const i=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===n?1:0});return await a(t,e,i.offset),i})));for(let t=0;t<6;t+=1)e[t].connect(n,0,t),e[t].start(0);return h(t)})()}const t=await u,o=n(d,{...m,gain:1});await c(p,d,o);const l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let _=[l[0][0],l[1][0],l[2][0]],v=[l[3][0],l[4][0],l[5][0]],y=n(d,{...m,gain:1}),x=i(d,{...g,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:v[0],positionY:v[1],positionZ:v[2]});o.connect(y).connect(x.inputs[0]),x.connect(f);for(let e=128;e<t.length;e+=128){const t=[l[0][e],l[1][e],l[2][e]],s=[l[3][e],l[4][e],l[5][e]];if(t.some(((t,e)=>t!==_[e]))||s.some(((t,e)=>t!==v[e]))){_=t,v=s;const r=e/d.sampleRate;y.gain.setValueAtTime(0,r),y=n(d,{...m,gain:0}),x=i(d,{...g,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),y.gain.setValueAtTime(1,r),o.connect(y).connect(x.inputs[0]),x.connect(f)}}return f}return v?(await t(d,p.orientationX,_.orientationX),await t(d,p.orientationY,_.orientationY),await t(d,p.orientationZ,_.orientationZ),await t(d,p.positionX,_.positionX),await t(d,p.positionY,_.positionY),await t(d,p.positionZ,_.positionZ)):(await a(d,p.orientationX,_.orientationX),await a(d,p.orientationY,_.orientationY),await a(d,p.orientationZ,_.orientationZ),await a(d,p.positionX,_.positionX),await a(d,p.positionY,_.positionY),await a(d,p.positionZ,_.positionZ)),X(_)?await c(p,d,_.inputs[0]):await c(p,d,_),_})(p,d)}}})(Xe,as,ds,Bt,zs,tt,Ce,$e,Te,Cs),Bs=((t,e,s,n,i,o,r)=>class extends t{constructor(t,a){const c=i(t),h={...$t,...a},l=s(c,h),u=o(c);super(t,!1,l,u?n():null),this._nativePannerNode=l,this._orientationX=e(this,u,l.orientationX,V,F),this._orientationY=e(this,u,l.orientationY,V,F),this._orientationZ=e(this,u,l.orientationZ,V,F),this._positionX=e(this,u,l.positionX,V,F),this._positionY=e(this,u,l.positionY,V,F),this._positionZ=e(this,u,l.positionZ,V,F),r(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ve,Je,zs,Ws,ke,Oe,ns),Us=(t=>(e,{disableNormalization:s,imag:n,real:i})=>{const o=n instanceof Float32Array?n:new Float32Array(n),r=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(r,o,{disableNormalization:s});if(Array.from(n).length<2)throw t();return a})(R),Gs=((t,e,s,n)=>class n{constructor(n,i){const o=e(n),r=(t=>{const{imag:e,real:s}=t;return void 0===e?void 0===s?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(s,(()=>0)),real:s}:void 0===s?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:s}})({...Ht,...i}),a=t(o,r);return s.add(a),a}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===n.prototype||s.has(t)}})(Us,ke,new WeakSet),Qs=((t,e,s,n,i,o)=>{const r=16385,a=new Float32Array([1,1]),c=Math.PI/2,h={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...h,oversample:"none"},u=(t,o,u,p,d)=>{if(1===o)return((t,e,i,o)=>{const u=new Float32Array(r),p=new Float32Array(r);for(let t=0;t<r;t+=1){const e=t/16384*c;u[t]=Math.cos(e),p[t]=Math.sin(e)}const d=s(t,{...h,gain:0}),f=n(t,{...l,curve:u}),_=n(t,{...l,curve:a}),m=s(t,{...h,gain:0}),g=n(t,{...l,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===_.inputs?_:_.inputs[0]),e.connect(m),_.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===g.inputs?g:g.inputs[0]),f.connect(d.gain),g.connect(m.gain),d.connect(o,0,0),m.connect(o,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===_.inputs?_:_.inputs[0]),e.disconnect(m),_.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===g.inputs?g:g.inputs[0]),f.disconnect(d.gain),g.disconnect(m.gain),d.disconnect(o,0,0),m.disconnect(o,0,1)}}})(t,u,p,d);if(2===o)return((t,i,o,u)=>{const p=new Float32Array(r),d=new Float32Array(r),f=new Float32Array(r),_=new Float32Array(r),m=Math.floor(8192.5);for(let t=0;t<r;t+=1)if(t>m){const e=(t-m)/(16384-m)*c;p[t]=Math.cos(e),d[t]=Math.sin(e),f[t]=0,_[t]=1}else{const e=t/(16384-m)*c;p[t]=1,d[t]=0,f[t]=Math.cos(e),_[t]=Math.sin(e)}const g=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=s(t,{...h,gain:0}),y=n(t,{...l,curve:p}),x=s(t,{...h,gain:0}),w=n(t,{...l,curve:d}),b=n(t,{...l,curve:a}),T=s(t,{...h,gain:0}),S=n(t,{...l,curve:f}),k=s(t,{...h,gain:0}),A=n(t,{...l,curve:_});return{connectGraph(){i.connect(g),i.connect(void 0===b.inputs?b:b.inputs[0]),g.connect(v,0),g.connect(x,0),g.connect(T,1),g.connect(k,1),b.connect(o),o.connect(void 0===y.inputs?y:y.inputs[0]),o.connect(void 0===w.inputs?w:w.inputs[0]),o.connect(void 0===S.inputs?S:S.inputs[0]),o.connect(void 0===A.inputs?A:A.inputs[0]),y.connect(v.gain),w.connect(x.gain),S.connect(T.gain),A.connect(k.gain),v.connect(u,0,0),T.connect(u,0,0),x.connect(u,0,1),k.connect(u,0,1)},disconnectGraph(){i.disconnect(g),i.disconnect(void 0===b.inputs?b:b.inputs[0]),g.disconnect(v,0),g.disconnect(x,0),g.disconnect(T,1),g.disconnect(k,1),b.disconnect(o),o.disconnect(void 0===y.inputs?y:y.inputs[0]),o.disconnect(void 0===w.inputs?w:w.inputs[0]),o.disconnect(void 0===S.inputs?S:S.inputs[0]),o.disconnect(void 0===A.inputs?A:A.inputs[0]),y.disconnect(v.gain),w.disconnect(x.gain),S.disconnect(T.gain),A.disconnect(k.gain),v.disconnect(u,0,0),T.disconnect(u,0,0),x.disconnect(u,0,1),k.disconnect(u,0,1)}}})(t,u,p,d);throw i()};return(e,{channelCount:n,channelCountMode:r,pan:a,...c})=>{if("max"===r)throw i();const h=t(e,{...c,channelCount:1,channelCountMode:r,numberOfInputs:2}),l=s(e,{...c,channelCount:n,channelCountMode:r,gain:1}),p=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:f}=u(e,n,l,p,h);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const _={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(t){l.channelCount!==t&&(m&&f(),({connectGraph:d,disconnectGraph:f}=u(e,t,l,p,h)),m&&d()),l.channelCount=t},get channelCountMode(){return l.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();l.channelCountMode=t},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t},get context(){return l.context},get inputs(){return[l]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2])};let m=!1;return o(zt(_,h),(()=>{d(),m=!0}),(()=>{f(),m=!1}))}})(as,Lt,Bt,js,Zt,os),Zs=((t,e)=>(s,n)=>{const i=n.channelCountMode;if("clamped-max"===i)throw e();if(void 0===s.createStereoPanner)return t(s,n);const o=s.createStereoPanner();return qt(o,n),Ft(o,n,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),o})(Qs,Zt),Xs=((t,e,s,n,i)=>()=>{const o=new WeakMap;return{render(r,a){const c=o.get(a);return void 0!==c?Promise.resolve(c):(async(r,a)=>{let c=s(r);const h=M(c,a);if(!h){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return o.set(a,c),h?await t(a,r.pan,c.pan):await n(a,r.pan,c.pan),X(c)?await i(r,a,c.inputs[0]):await i(r,a,c),c})(r,a)}}})(Xe,Zs,tt,$e,Te),Ys=((t,e,s,n,i,o)=>class extends t{constructor(t,r){const a=i(t),c={...Jt,...r},h=s(a,c),l=o(a);super(t,!1,h,l?n():null),this._pan=e(this,l,h.pan)}get pan(){return this._pan}})(Ve,Je,Zs,Xs,ke,Oe),$s=((t,e,s)=>()=>{const n=new WeakMap;return{render(i,o){const r=n.get(o);return void 0!==r?Promise.resolve(r):(async(i,o)=>{let r=e(i);if(!M(r,o)){const e={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,curve:r.curve,oversample:r.oversample};r=t(o,e)}return n.set(o,r),X(r)?await s(i,o,r.inputs[0]):await s(i,o,r),r})(i,o)}}})(js,tt,Te),Hs=((t,e,s,n,i,o,r)=>class extends t{constructor(t,e){const a=i(t),c={...te,...e},h=s(a,c);super(t,!0,h,o(a)?n():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=h,r(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ve,At,js,$s,ke,Oe,ns),Js=(t=>null!==t&&t.isSecureContext)(xe),Ks=(t=>(e,s,n)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*s)},currentTime:{configurable:!0,get:()=>e}});try{return n()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(xe),tn=new WeakMap,en=((t,e)=>s=>{let n=t.get(s);if(void 0!==n)return n;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),t.set(s,n),n})(tn,Ce),sn=Js?((t,e,s,n,i,o,r,a,c,h,l,u,p)=>{let d=0;return(_,m,g={credentials:"omit"})=>{const w=l.get(_);if(void 0!==w&&w.has(m))return Promise.resolve();const b=h.get(_);if(void 0!==b){const t=b.get(m);if(void 0!==t)return t}const T=o(_),S=void 0===T.audioWorklet?i(m).then((([t,e])=>{const[n,i]=v(t,e);return s(`${n};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;n(T.currentTime,T.sampleRate,(()=>t(class{},void 0,((t,s)=>{if(""===t.trim())throw e();const n=f.get(T);if(void 0!==n){if(n.has(t))throw e();x(s),y(s.parameterDescriptors),n.set(t,s)}else x(s),y(s.parameterDescriptors),f.set(T,new Map([[t,s]]))}),T.sampleRate,void 0,void 0)))})):Promise.all([i(m),Promise.resolve(t(u,u))]).then((([[t,e],s])=>{const n=d+1;d=n;const[i,o]=v(t,e),h=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${o}\n})(${s?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${s?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${s?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${n}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(h);return T.audioWorklet.addModule(l,g).then((()=>{if(a(T))return T;const t=r(T);return t.audioWorklet.addModule(l,g).then((()=>t))})).then((t=>{if(null===c)throw new SyntaxError;try{new c(t,`__sac${n}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));return void 0===b?h.set(_,new Map([[m,S]])):b.set(m,S),S.then((()=>{const t=l.get(_);void 0===t?l.set(_,new Set([m])):t.add(m)})).finally((()=>{const t=h.get(_);void 0!==t&&t.delete(m)})),S}})(ge,Zt,(t=>e=>new Promise(((s,n)=>{if(null===t)return void n(new SyntaxError);const i=t.document.head;if(null===i)n(new SyntaxError);else{const o=t.document.createElement("script"),r=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(r),c=t.onerror,h=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,s,i,o,r)=>s===a||s===t.location.href&&1===i&&1===o?(h(),n(r),!1):null!==c?c(e,s,i,o,r):void 0,o.onerror=()=>{h(),n(new SyntaxError)},o.onload=()=>{h(),s()},o.src=a,o.type="module",i.appendChild(o)}})))(xe),Ks,(async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw new DOMException("","AbortError")}),ke,en,Oe,Fe,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const s=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(s);let o=!1,r=!1;try{await n.audioWorklet.addModule(i);const e=new t(n,"a",{numberOfOutputs:0}),s=n.createOscillator();e.port.onmessage=()=>o=!0,e.onprocessorerror=()=>r=!0,s.connect(e),s.start(0),await n.startRendering(),await new Promise((t=>setTimeout(t)))}catch{}finally{URL.revokeObjectURL(i)}return o&&!r})(Fe,Ce),xe):void 0,nn=((t,e)=>s=>t(s)||e(s))(Re,Oe),on=((t,e,s,n,i,o,r,a,c,h,l)=>(s,n)=>{const u=r(s)?s:o(s);if(i.has(n)){const t=new DOMException("","DataCloneError");return Promise.reject(t)}try{i.add(n)}catch{}return e(c,(()=>c(u)))?u.decodeAudioData(n).then((s=>(wt(n).catch((()=>{})),e(a,(()=>a(s)))||l(s),t.add(s),s))):new Promise(((e,s)=>{const i=async()=>{try{await wt(n)}catch{}},o=t=>{s(t),i()};try{u.decodeAudioData(n,(s=>{"function"!=typeof s.copyFromChannel&&(h(s),q(s)),t.add(s),i().then((()=>e(s)))}),(t=>{o(null===t?new DOMException("","EncodingError"):t)}))}catch(t){o(t)}}))})(je,ge,0,0,new WeakSet,ke,nn,E,Et,Be,Ue),rn=((t,e,s,n,i,o,r,a,c,h,l,u,p,d,f,_,m,g,v,y)=>class extends f{constructor(e,s){super(e,s),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,s)=>t(this,e,s)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,n){return new s({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new n(this)}createChannelMerger(t=6){return new o(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new r(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(t=1){return new l(this,{maxDelayTime:t})}createDynamicsCompressor(){return new u(this)}createGain(){return new p(this)}createIIRFilter(t,e){return new d(this,{feedback:e,feedforward:t})}createOscillator(){return new _(this)}createPanner(){return new m(this)}createPeriodicWave(t,e,s={disableNormalization:!1}){return new g(this,{...s,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,s){return h(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof s&&s(t),t}))}})(sn,Pe,Ge,ts,is,hs,us,_s,vs,on,xs,Ts,ks,Ms,qs,Vs,Bs,Gs,Ys,Hs),an=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t),o=((t,e)=>t.createMediaElementSource(e.mediaElement))(i,e);if(n(i))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ve,0,ke,Oe),cn=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t);if(n(i))throw new TypeError;const o=((t,e)=>{const s=t.createMediaStreamDestination();return qt(s,e),1===s.numberOfOutputs&&Object.defineProperty(s,"numberOfOutputs",{get:()=>0}),s})(i,{...Mt,...e});super(t,!1,o,null),this._nativeMediaStreamAudioDestinationNode=o}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ve,0,ke,Oe),hn=((t,e,s,n)=>class extends t{constructor(t,e){const i=s(t),o=((t,{mediaStream:e})=>{const s=e.getAudioTracks();s.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const n=s.slice(0,1),i=t.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i})(i,e);if(n(i))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ve,0,ke,Oe),ln=((t,e)=>(s,{mediaStreamTrack:n})=>{if("function"==typeof s.createMediaStreamTrackSource)return s.createMediaStreamTrackSource(n);const i=new MediaStream([n]),o=s.createMediaStreamSource(i);if("audio"!==n.kind)throw t();if(e(s))throw new TypeError;return o})(At,Oe),un=((t,e,s)=>class extends t{constructor(t,n){const i=s(t);super(t,!0,e(i,n),null)}})(Ve,ln,ke),pn=((t,e,s,n,i,o,r,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new c(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw s();throw t}if(null===e)throw n();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw s();super(e,2);const{latencyHint:i}=t,{sampleRate:o}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/o:"interactive"===i||void 0===i?256/o:"playback"===i?1024/o:128*Math.max(2,Math.min(128,Math.round(i*o/128)))/o,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),W(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new o(this)}createMediaStreamSource(t){return new r(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const s=()=>{this._nativeAudioContext.removeEventListener("statechange",s),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",s)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(rn,At,Zt,Kt,an,cn,hn,un,Ee),dn=(t=>e=>{const s=t.get(e);if(void 0===s)throw new Error("The context has no set of AudioWorkletNodes.");return s})(Rs),fn=(t=>(e,s)=>{t(e).add(s)})(dn),_n=(t=>(e,s,n=0,i=0)=>{const o=e[n];if(void 0===o)throw t();return rt(s)?o.connect(s,0,i):o.connect(s,0)})(R),mn=(t=>(e,s)=>{t(e).delete(s)})(dn),gn=(t=>(e,s=void 0,n=void 0,i=0)=>void 0===s?e.forEach((t=>t.disconnect())):"number"==typeof s?Tt(t,e,s).disconnect():rt(s)?void 0===n?e.forEach((t=>t.disconnect(s))):void 0===i?Tt(t,e,n).disconnect(s,0):Tt(t,e,n).disconnect(s,0,i):void 0===n?e.forEach((t=>t.disconnect(s))):Tt(t,e,n).disconnect(s,0))(R),vn=new WeakMap,yn=((t,e)=>s=>e(t,s))(vn,w),xn=((t,e,s,n,i,o,r,a,c,h,l,u,p)=>(d,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw c();const v=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(v.some((t=>t<1)))throw c();if(v.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw c();const y=g.channelCount*g.numberOfInputs,x=v.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(y+w>6||x>6)throw c();const b=new MessageChannel,T=[],S=[];for(let t=0;t<g.numberOfInputs;t+=1)T.push(r(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),S.push(i(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const k=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:s,name:n}of m.parameterDescriptors){const i=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[n]?g.parameterData[n]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?V:e},minValue:{get:()=>void 0===s?F:s}}),k.push(i)}const A=n(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+w)}),C=Pt(f,d.sampleRate),O=a(d,C,y+w,Math.max(1,x)),D=i(d,{channelCount:Math.max(1,x),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,x)}),M=[];for(let t=0;t<g.numberOfOutputs;t+=1)M.push(n(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[t]}));for(let t=0;t<g.numberOfInputs;t+=1){T[t].connect(S[t]);for(let e=0;e<g.channelCount;e+=1)S[t].connect(A,e,t*g.channelCount+e)}const E=new lt(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const s=k[e];return s.connect(A,0,y+e),s.start(0),[t,s.offset]})));A.connect(O);let R=g.channelInterpretation,q=null;const I=0===g.numberOfOutputs?[O]:M,N={get bufferSize(){return C},get channelCount(){return g.channelCount},set channelCount(t){throw s()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw s()},get channelInterpretation(){return R},set channelInterpretation(t){for(const e of T)e.channelInterpretation=t;R=t},get context(){return O.context},get inputs(){return T},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return q},set onprocessorerror(t){"function"==typeof q&&N.removeEventListener("processorerror",q),q="function"==typeof t?t:null,"function"==typeof q&&N.addEventListener("processorerror",q)},get parameters(){return E},get port(){return b.port2},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,I),disconnect:h.bind(null,I),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])},P=new Map;var j,L;b.port1.addEventListener=(j=b.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const s=P.get(t[1]);void 0!==s?t[1]=s:(t[1]=t=>{l(d.currentTime,d.sampleRate,(()=>e(t)))},P.set(e,t[1]))}}return j.call(b.port1,t[0],t[1],t[2])}),b.port1.removeEventListener=(L=b.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=P.get(t[1]);void 0!==e&&(P.delete(t[1]),t[1]=e)}return L.call(b.port1,t[0],t[1],t[2])});let z=null;Object.defineProperty(b.port1,"onmessage",{get:()=>z,set:t=>{"function"==typeof z&&b.port1.removeEventListener("message",z),z="function"==typeof t?t:null,"function"==typeof z&&(b.port1.addEventListener("message",z),b.port1.start())}}),m.prototype.port=b.port1;let W=null;const B=((t,e,s,n)=>{let i=_.get(t);void 0===i&&(i=new WeakMap,_.set(t,i));const o=(async(t,e)=>{const s=await(t=>new Promise(((e,s)=>{const{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:t})=>{n.close(),i.close(),e(t)},n.onmessageerror=({data:t})=>{n.close(),i.close(),s(t)},i.postMessage(t)})))(e);return new t(s)})(s,n);return i.set(e,o),o})(d,N,m,g);B.then((t=>W=t));const U=ft(g.numberOfInputs,g.channelCount),G=ft(g.numberOfOutputs,v),Q=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let Z=!0;const X=()=>{g.numberOfOutputs>0&&O.disconnect(D);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const s=M[t];for(let n=0;n<v[t];n+=1)D.disconnect(s,e+n,n);e+=v[t]}},Y=new Map;O.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==W){const s=u(N);for(let n=0;n<C;n+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let s=0;s<g.channelCount;s+=1)pt(t,U[e],s,s,n);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},s)=>{pt(t,Q,e,y+s,n)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<v[t];e+=1)0===G[t][e].byteLength&&(G[t][e]=new Float32Array(128));try{const t=U.map(((t,e)=>{if(s[e].size>0)return Y.set(e,C/128),t;const n=Y.get(e);return void 0===n?[]:(t.every((t=>t.every((t=>0===t))))&&(1===n?Y.delete(e):Y.set(e,n-1)),t)})),i=l(d.currentTime+n/d.sampleRate,d.sampleRate,(()=>W.process(t,G,Q)));Z=i;for(let t=0,s=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<v[t];i+=1)dt(e,G[t],i,s+i,n);s+=v[t]}}catch(t){Z=!1,N.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!Z){for(let t=0;t<g.numberOfInputs;t+=1){T[t].disconnect(S[t]);for(let e=0;e<g.channelCount;e+=1)S[n].disconnect(A,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=k[e];t.disconnect(A,0,y+e),t.stop()}}A.disconnect(O),O.onaudioprocess=null,$?X():K();break}}}};let $=!1;const H=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),J=()=>O.connect(H).connect(d.destination),K=()=>{O.disconnect(H),H.disconnect()};return J(),p(N,(()=>{if(Z){K(),g.numberOfOutputs>0&&O.connect(D);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const s=M[t];for(let n=0;n<v[t];n+=1)D.connect(s,e+n,n);e+=v[t]}}$=!0}),(()=>{Z&&(J(),X()),$=!1}))})(_n,R,At,as,Lt,ds,Bt,Qt,Zt,gn,Ks,yn,os),wn=((t,e,s,n,i)=>(o,r,a,c,h,l)=>{if(null!==a)try{const e=new a(o,c,l),n=new Map;let r=null;if(Object.defineProperties(e,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>r,set:t=>{"function"==typeof r&&e.removeEventListener("processorerror",r),r="function"==typeof t?t:null,"function"==typeof r&&e.addEventListener("processorerror",r)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const s=n.get(t[1]);void 0!==s?t[1]=s:(t[1]=s=>{"error"===s.type?(Object.defineProperties(s,{type:{value:"processorerror"}}),e(s)):e(new ErrorEvent(t[0],{...s}))},n.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(u=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=n.get(t[1]);void 0!==e&&(n.delete(t[1]),t[1]=e)}return u.call(e,"error",t[1],t[2]),u.call(e,t[0],t[1],t[2])}),0!==l.numberOfOutputs){const t=s(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return e.connect(t).connect(o.destination),i(e,(()=>t.disconnect()),(()=>t.connect(o.destination)))}return e}catch(t){if(11===t.code)throw n();throw t}var u,p;if(void 0===h)throw n();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(l),e(o,r,h,l)})(At,xn,Bt,Zt,os),bn=((t,e,s,n,i,o,r,a,c,h,l,u,p,d,f,_)=>(m,g,v)=>{const y=new WeakMap;let x=null;return{render(w,b){a(b,w);const T=y.get(b);return void 0!==T?Promise.resolve(T):(async(a,w)=>{let b=l(a),T=null;const S=M(b,w),k=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(null===u){const t=k.reduce(((t,e)=>t+e),0),s=i(w,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),o=[];for(let t=0;t<a.numberOfOutputs;t+=1)o.push(n(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[t]}));const h=r(w,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1});h.connect=e.bind(null,o),h.disconnect=c.bind(null,o),T=[s,o,h]}else S||(b=new u(w,m));if(y.set(w,null===T?b:T[2]),null!==T){if(null===x){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,s=t+e,c=async()=>{const c=new p(s,128*Math.ceil(a.context.length/128),w.sampleRate),h=[],l=[];for(let t=0;t<g.numberOfInputs;t+=1)h.push(r(c,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),l.push(i(c,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const u=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=o(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(c,t,e.offset),e}))),m=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<g.numberOfInputs;t+=1){h[t].connect(l[t]);for(let e=0;e<g.channelCount;e+=1)l[t].connect(m,e,t*g.channelCount+e)}for(const[e,s]of u.entries())s.connect(m,0,t+e),s.start(0);return m.connect(c.destination),await Promise.all(h.map((t=>f(a,c,t)))),_(c)};x=_t(a,0===s?null:await c(),w,g,k,v,h)}const t=await x,e=s(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,l,u]=T;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const s=l[t];for(let n=0;n<k[t];n+=1)c.connect(s,e+n,n);e+=k[t]}return u}if(S)for(const[e,s]of a.parameters.entries())await t(w,s,b.parameters.get(e));else for(const[t,e]of a.parameters.entries())await d(w,e,b.parameters.get(t));return await f(a,w,b),b})(w,b)}}})(Xe,_n,Ye,as,Lt,ds,Bt,mn,gn,Ks,tt,Fe,Ce,$e,Te,Cs),Tn=(t=>e=>t.get(e))(tn),Sn=(t=>(e,s)=>{t.set(e,s)})(vn),kn=Js?((t,e,s,n,i,o,r,a,c,h,l,u,p,d)=>class extends e{constructor(e,l,p){var d;const _=a(e),m=c(_),g=(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))}))({...ut,...p});(t=>{const{port1:e,port2:s}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),s.close()}})(g);const v=f.get(_),y=null==v?void 0:v.get(l),x=m||"closed"!==_.state?_:null!==(d=r(_))&&void 0!==d?d:_,w=i(x,m?null:e.baseLatency,h,l,y,g);super(e,!0,w,m?n(l,g,y):null);const b=[];w.parameters.forEach(((t,e)=>{const n=s(this,m,t);b.push([e,n])})),this._nativeAudioWorkletNode=w,this._onprocessorerror=null,this._parameters=new lt(b),m&&t(_,this);const{activeInputs:T}=o(this);u(w,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const s=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==s&&s===e?t:s}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(fn,Ve,Je,bn,wn,j,Tn,ke,Oe,Fe,0,Sn,0,ue):void 0,An=((t,e)=>(s,n,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(s,n,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Zt,Ce),Cn=((t,e,s,n,i,o,r,a)=>(c,h)=>s(c).render(c,h).then((()=>Promise.all(Array.from(n(h)).map((t=>s(t).render(t,h)))))).then((()=>i(h))).then((s=>("function"!=typeof s.copyFromChannel?(r(s),q(s)):e(o,(()=>o(s)))||a(s),t.add(s),s))))(je,ge,be,dn,Cs,E,Be,Ue),On=((t,e,s,n,i)=>class extends t{constructor(t,s,i){let o;if("number"==typeof t&&void 0!==s&&void 0!==i)o={length:s,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");o=t}const{length:r,numberOfChannels:a,sampleRate:c}={...Xt,...o},h=n(a,r,c);e(Et,(()=>Et(h)))||h.addEventListener("statechange",(()=>{let t=0;const e=s=>{"running"===this._state&&(t>0?(h.removeEventListener("statechange",e),s.stopImmediatePropagation(),this._waitForThePromiseToSettle(s)):t+=1)};return e})()),super(h,a),this._length=r,this._nativeOfflineAudioContext=h,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(s()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,W(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(rn,ge,At,An,Cn),Dn=((t,e)=>s=>{const n=t.get(s);return e(n)||e(s)})(u,Re),Mn=((t,e)=>s=>t.has(s)||e(s))(c,qe),En=((t,e)=>s=>t.has(s)||e(s))(l,Ie),Rn=((t,e)=>s=>{const n=t.get(s);return e(n)||e(s)})(u,Oe),qn=()=>(async(t,e,s,n,i,o,r,a,c,h,l,u,p,d,f,_)=>!!(t(e,e)&&t(s,s)&&t(i,i)&&t(o,o)&&t(a,a)&&t(c,c)&&t(h,h)&&t(l,l)&&t(u,u)&&t(p,p)&&t(d,d))&&(await Promise.all([t(n,n),t(r,r),t(f,f),t(_,_)])).every((t=>t)))(ge,(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createBuffer(1,1,44100);if(void 0===e.copyToChannel)return!0;const s=new Float32Array(2);try{e.copyFromChannel(s,0,0)}catch{return!1}return!0})(Ce),(t=>()=>{if(null===t)return!1;if(void 0!==t.prototype&&void 0!==t.prototype.close)return!0;const e=new t,s=void 0!==e.close;try{e.close()}catch{}return s})(Ee),(t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);return new Promise((t=>{let s=!0;const n=n=>{s&&(s=!1,e.startRendering(),t(n instanceof TypeError))};let i;try{i=e.decodeAudioData(null,(()=>{}),n)}catch(t){n(t)}void 0!==i&&i.catch(n)}))})(Ce),(t=>()=>{if(null===t)return!1;let e;try{e=new t({latencyHint:"balanced"})}catch{return!1}return e.close(),!0})(Ee),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createGain(),s=e.connect(e)===e;return e.disconnect(e),s})(Ce),((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const s=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new MessageChannel,i=new e(1,128,44100),o=URL.createObjectURL(s);let r=!1;try{await i.audioWorklet.addModule(o);const e=new t(i,"a",{numberOfOutputs:0}),s=i.createOscillator();await new Promise((t=>{e.port.onmessage=()=>t(),e.port.postMessage(n.port2,[n.port2])})),e.port.onmessage=()=>r=!0,s.connect(e),s.start(0),await i.startRendering(),r=await new Promise((t=>{n.port1.onmessage=({data:e})=>t(1===e),n.port1.postMessage(0)}))}catch{}finally{n.port1.close(),URL.revokeObjectURL(o)}return r})(Fe,Ce),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createChannelMerger();if("max"===e.channelCountMode)return!0;try{e.channelCount=2}catch{return!0}return!1})(Ce),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100);return void 0===e.createConstantSource||e.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(Ce),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),s=e.createConvolver();s.buffer=e.createBuffer(1,1,e.sampleRate);try{s.buffer=e.createBuffer(1,1,e.sampleRate)}catch{return!1}return!0})(Ce),(t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createConvolver();try{e.channelCount=1}catch{return!1}return!0})(Ce),ce,(t=>()=>null!==t&&t.hasOwnProperty("isSecureContext"))(xe),(t=>()=>{if(null===t)return!1;const e=new t;try{return e.createMediaStreamSource(new MediaStream),!1}catch(t){return!0}finally{e.close()}})(Ee),(t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);if(void 0===e.createStereoPanner)return Promise.resolve(!0);if(void 0===e.createConstantSource)return Promise.resolve(!0);const s=e.createConstantSource(),n=e.createStereoPanner();return s.channelCount=1,s.offset.value=1,n.channelCount=1,s.start(),s.connect(n).connect(e.destination),e.startRendering().then((t=>1!==t.getChannelData(0)[0]))})(Ce),he);function In(t){return void 0===t}function Fn(t){return void 0!==t}function Vn(t){return"function"==typeof t}function Nn(t){return"number"==typeof t}function Pn(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function jn(t){return"boolean"==typeof t}function Ln(t){return Array.isArray(t)}function zn(t){return"string"==typeof t}function Wn(t){return zn(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function Bn(t,e){if(!t)throw new Error(e)}function Un(t,e,s=1/0){if(!(e<=t&&t<=s))throw new RangeError(`Value must be within [${e}, ${s}], got: ${t}`)}function Gn(t){t.isOffline||"running"===t.state||Kn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Qn=!1,Zn=!1;function Xn(t){Qn=t}function Yn(t){In(t)&&Qn&&!Zn&&(Zn=!0,Kn("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let $n=console;function Hn(t){$n=t}function Jn(...t){$n.log(...t)}function Kn(...t){$n.warn(...t)}const ti="object"==typeof self?self:null,ei=ti&&(ti.hasOwnProperty("AudioContext")||ti.hasOwnProperty("webkitAudioContext"));function si(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r}function ni(t,e,s,n){return new(s||(s=Promise))((function(i,o){function r(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}c((n=n.apply(t,e||[])).next())}))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;class ii{constructor(t,e,s,n){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(n||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),"worker"===this._type&&(null===(e=this._worker)||void 0===e||e.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function oi(t){return En(t)}function ri(t){return Mn(t)}function ai(t){return Rn(t)}function ci(t){return Dn(t)}function hi(t,e){return"value"===t||oi(e)||ri(e)||function(t){return t instanceof Ge}(e)}function li(t,...e){if(!e.length)return t;const s=e.shift();if(Pn(t)&&Pn(s))for(const e in s)hi(e,s[e])?t[e]=s[e]:Pn(s[e])?(t[e]||Object.assign(t,{[e]:{}}),li(t[e],s[e])):Object.assign(t,{[e]:s[e]});return li(t,...e)}function ui(t,e,s=[],n){const i={},o=Array.from(e);if(Pn(o[0])&&n&&!Reflect.has(o[0],n)&&(Object.keys(o[0]).some((e=>Reflect.has(t,e)))||(li(i,{[n]:o[0]}),s.splice(s.indexOf(n),1),o.shift())),1===o.length&&Pn(o[0]))li(i,o[0]);else for(let t=0;t<s.length;t++)Fn(o[t])&&(i[s[t]]=o[t]);return li(t,i)}function pi(t,e){return In(t)?e:t}function di(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class fi{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||ti&&this.toString()===ti.TONE_DEBUG_CLASS)&&Jn(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}fi.version=i;const _i=1e-6;function mi(t,e){return t>e+_i}function gi(t,e){return mi(t,e)||yi(t,e)}function vi(t,e){return t+_i<e}function yi(t,e){return Math.abs(t-e)<_i}function xi(t,e,s){return Math.max(Math.min(t,s),e)}class wi extends fi{constructor(){super(),this.name="Timeline",this._timeline=[];const t=ui(wi.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Bn(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Bn(gi(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return-1!==s?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(yi(this._timeline[e].time,t)){for(let s=e;s>=0&&yi(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&gi(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let s=0;const n=this._timeline.length;let i=n;if(n>0&&this._timeline[n-1][e]<=t)return n-1;for(;s<i;){let n=Math.floor(s+(i-s)/2);const o=this._timeline[n],r=this._timeline[n+1];if(yi(o[e],t)){for(let s=n;s<this._timeline.length&&yi(this._timeline[s][e],t);s++)n=s;return n}if(vi(o[e],t)&&mi(r[e],t))return n;mi(o[e],t)?i=n:s=n+1}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return-1!==s&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let n=this._search(t),i=this._search(e);return-1!==n&&-1!==i?(this._timeline[n].time!==t&&(n+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,n,i)):-1===n&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(-1!==s&&yi(this._timeline[s].time,t)){let n=s;for(let e=s;e>=0&&yi(this._timeline[e].time,t);e--)n=e;this._iterate((t=>{e(t)}),n,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const bi=[];function Ti(t){bi.push(t)}const Si=[];function ki(t){Si.push(t)}class Ai extends fi{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{In(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const s=(...n)=>{e(...n),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach((t=>{if(In(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(In(e))this._events[t]=[];else{const s=this._events[t];for(let t=s.length-1;t>=0;t--)s[t]===e&&s.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let t=0,n=s.length;t<n;t++)s[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const s=Object.getOwnPropertyDescriptor(Ai.prototype,e);Object.defineProperty(t.prototype,e,s)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Ci extends Ai{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Oi extends Ci{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new wi,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=ui(Oi.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=(null===(t=arguments[0])||void 0===t?void 0:t.latencyHint)||""):(this._context=function(t){return new pn(t)}({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new ii(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[(null===(e=arguments[0])||void 0===e?void 0:e.hasOwnProperty("updateInterval"))?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,bi.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Bn(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Bn(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Bn(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Bn(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,s){return Bn(Fn(kn),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(null==ti?void 0:ti.BaseAudioContext)?null==ti?void 0:ti.AudioWorkletNode:kn)(t,e,s)}(this.rawContext,t,e)}addAudioWorkletModule(t){return ni(this,void 0,void 0,(function*(){Bn(Fn(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise}))}workletsAreReady(){return ni(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return ci(this._context)?this._context.resume():Promise.resolve()}close(){return ni(this,void 0,void 0,(function*(){var t;ci(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(t=this,Si.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let e=0;e<s.length;e++)s[e]=t;const n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=e,n.loop=!0,n.start(0),this._constants.set(t,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this.close(),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,n=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),n()},id:s,time:i+e})};return n(),s}}function Di(t,e){Ln(e)?e.forEach((e=>Di(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function Mi(t,e){Ln(e)?e.forEach((e=>Mi(t,e))):Object.defineProperty(t,e,{writable:!0})}const Ei=()=>{};class Ri extends fi{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ei;const t=ui(Ri.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,zn(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Ei,onload:Ei,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Vi().sampleRate}set(t){return t instanceof Ri?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return ni(this,void 0,void 0,(function*(){const e=Ri.load(t).then((t=>{this.set(t),this.onload(this)}));Ri.downloads.push(e);try{yield e}finally{const t=Ri.downloads.indexOf(e);Ri.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Ln(t)&&t[0].length>0,s=e?t.length:1,n=e?t[0].length:t.length,i=Vi(),o=i.createBuffer(s,n,i.sampleRate),r=e||1!==s?t:[t];for(let t=0;t<s;t++)o.copyToChannel(r[t],t);return this._buffer=o,this}toMono(t){if(Nn(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let s=0;s<e;s++){const e=this.toArray(s);for(let s=0;s<e.length;s++)t[s]+=e[s]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Nn(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){Bn(this.loaded,"Buffer is not loaded");const s=Math.floor(t*this.sampleRate),n=Math.floor(e*this.sampleRate);Bn(s<n,"The start time must be less than the end time");const i=n-s,o=Vi().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)o.copyToChannel(this.getChannelData(t).subarray(s,n),t);return new Ri(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Ri).fromArray(t)}static fromUrl(t){return ni(this,void 0,void 0,(function*(){const e=new Ri;return yield e.load(t)}))}static load(t){return ni(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const s=e[1].split("|");let n=s[0];for(const t of s)if(Ri.supportsType(t)){n=t;break}t=t.replace(e[0],n)}const s=""===Ri.baseUrl||Ri.baseUrl.endsWith("/")?Ri.baseUrl:Ri.baseUrl+"/",n=document.createElement("a");n.href=s+t,n.pathname=(n.pathname+n.hash).split("/").map(encodeURIComponent).join("/");const i=yield fetch(n.href);if(!i.ok)throw new Error(`could not load url: ${t}`);const o=yield i.arrayBuffer();return yield Vi().decodeAudioData(o)}))}static supportsType(t){const e=t.split("."),s=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+s)}static loaded(){return ni(this,void 0,void 0,(function*(){for(yield Promise.resolve();Ri.downloads.length;)yield Ri.downloads[0]}))}}Ri.baseUrl="",Ri.downloads=[];class qi extends Oi{constructor(){var t,e,s;super({clockSource:"offline",context:ai(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],s=arguments[2],new On(t,e,s)),lookAhead:0,updateInterval:ai(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ai(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return ni(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(){return ni(this,arguments,void 0,(function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Ri(e)}))}close(){return Promise.resolve()}}const Ii=new class extends Ci{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t){return ni(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let Fi=Ii;function Vi(){return Fi===Ii&&ei&&Ni(new Oi),Fi}function Ni(t,e=!1){e&&Fi.dispose(),Fi=ci(t)?new Oi(t):ai(t)?new qi(t):t}function Pi(){return Fi.resume()}if(ti&&!ti.TONE_SILENCE_LOGGING){let t="v";"dev"===i&&(t="");const e=` * Tone.js ${t}${i} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function ji(t){return Math.pow(10,t/20)}function Li(t){return Math.log(t)/Math.LN10*20}function zi(t){return Math.pow(2,t/12)}let Wi=440;function Bi(t){return Math.round(Ui(t))}function Ui(t){return 69+12*Math.log2(t/Wi)}function Gi(t){return Wi*Math.pow(2,(t-69)/12)}class Qi extends fi{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),n="."===e?1.5:1;return 1===s?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/s)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let n=0;return t&&"0"!==t&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n+=this._beatsToUnits(parseFloat(e))),s&&"0"!==s&&(n+=this._beatsToUnits(parseFloat(s)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Qi&&this.fromType(this._val),In(this._val))return this._noArg();if(zn(this._val)&&In(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Pn(this._val)){let t=0;for(const e in this._val)if(Fn(this._val[e])){const s=this._val[e];t+=new this.constructor(this.context,e).valueOf()*s}return t}if(Fn(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return zn(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Zi extends Qi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Zi(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),n=this.valueOf();return n+(Math.round(n/s)*s-n)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const s=Math.pow(2,t);e.push(s+"n."),e.push(s+"n"),e.push(s+"t")}e.push("0");let s=e[0],n=new Zi(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Zi(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(n-t)&&(s=e,n=i)})),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let n=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=n.toString();return i.length>3&&(n=parseFloat(parseFloat(i).toFixed(3))),[s,e,n].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Bi(this.toFrequency())}_now(){return this.context.now()}}function Xi(t,e){return new Zi(Vi(),t,e)}class Yi extends Zi{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Wi}static set A4(t){!function(t){Wi=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Yi.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const s=$i[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?s:Yi.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let n=1;return t&&"0"!==t&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n*=this._beatsToUnits(parseFloat(e))),s&&"0"!==s&&(n*=this._beatsToUnits(parseFloat(s)/4)),n}}})}transpose(t){return new Yi(this.context,this.valueOf()*zi(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Bi(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Yi.A4);let s=Math.round(12*e)+57;const n=Math.floor(s/12);return n<0&&(s+=-12*n),Hi[s%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Gi(t)}static ftom(t){return Bi(t)}}const $i={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Hi=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Ji(t,e){return new Yi(Vi(),t,e)}class Ki extends Zi{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function to(t,e){return new Ki(Vi(),t,e)}class eo extends fi{constructor(){super();const t=ui(eo.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Vi()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return Yn(t),new Zi(this.context,t).toSeconds()}toFrequency(t){return new Yi(this.context,t).toFrequency()}toTicks(t){return new Ki(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((s=>{In(t[s])&&delete e[s]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const s=this[e];Fn(s)&&Fn(s.value)&&Fn(s.setValueAtTime)?t[e]=s.value:s instanceof eo?t[e]=s._getPartialProperties(t[e]):Ln(s)||Nn(s)||zn(s)||jn(s)?t[e]=s:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Fn(this[e])&&(this[e]&&Fn(this[e].value)&&Fn(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof eo?this[e].set(t[e]):this[e]=t[e])})),this}}class so extends wi{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,s){return Un(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){for(let s=this._search(e);s>=0;s--){const e=this._timeline[s];if(e.state===t)return e}}getNextState(t,e){const s=this._search(e);if(-1!==s)for(let e=s;e<this._timeline.length;e++){const s=this._timeline[e];if(s.state===t)return s}}}class no extends eo{constructor(){const t=ui(no.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Bn(Fn(t.param)&&(oi(t.param)||t.param instanceof no),"param must be an AudioParam");!oi(t.param);)t.param=t.param._param;this._swappable=!!Fn(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new wi(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Fn(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(eo.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Fn(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Fn(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Fn(this.maxValue)&&Fn(this.minValue)&&Un(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?ji(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?Li(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),n=this._fromType(t);return Bn(isFinite(n)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),n=this._events.get(e);let i=this._initialValue;if(null===n)i=this._initialValue;else if("setTargetAtTime"!==n.type||null!==s&&"setValueAtTime"!==s.type)if(null===s)i=n.value;else if("linearRampToValueAtTime"===s.type||"exponentialRampToValueAtTime"===s.type){let t=n.value;if("setTargetAtTime"===n.type){const e=this._events.getBefore(n.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===s.type?this._linearInterpolate(n.time,t,s.time,s.value,e):this._exponentialInterpolate(n.time,t,s.time,s.value,e)}else i=n.value;else{const t=this._events.getBefore(n.time);let s;s=null===t?this._initialValue:t.value,"setTargetAtTime"===n.type&&(i=this._exponentialApproach(n.time,s,n.value,n.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),n=this.toSeconds(e);return Bn(isFinite(s)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:n,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,n),this._param.linearRampToValueAtTime(s,n),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=yi(s,0)?this._minOutput:s,this._assertRange(s);const n=this.toSeconds(e);return Bn(isFinite(s)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,n),this._param.exponentialRampToValueAtTime(s,n),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const n=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,n),this.cancelAndHoldAtTime(e+.9*s),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const n=this._fromType(t);Bn(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(n),Bn(isFinite(n)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(n,i,s),this}setValueCurveAtTime(t,e,s,n=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*n;this.setValueAtTime(this._toType(i),e);const o=s/(t.length-1);for(let s=1;s<t.length;s++){const i=this._fromType(t[s])*n;this.linearRampToValueAtTime(this._toType(i),e+s*o)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Bn(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));Bn(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const n=this._events.get(e),i=this._events.getAfter(e);return n&&yi(n.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(s),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&"setTargetAtTime"===s.type){const n=this._events.getAfter(s.time),i=n?n.time:e+2,o=(i-e)/10;for(let s=e;s<i;s+=o)t.linearRampToValueAtTime(this.getValueAtTime(s),s)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Bn(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,n,i){return s+(e-s)*Math.exp(-(i-t)/n)}_linearInterpolate(t,e,s,n,i){return e+(i-t)/(s-t)*(n-e)}_exponentialInterpolate(t,e,s,n,i){return e*Math.pow(n/e,(i-t)/(s-t))}}class io extends eo{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Fn(this.input)?oi(this.input)||this.input instanceof no?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Fn(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Fn(t)&&(t instanceof io||ri(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Bn(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return ro(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Kn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return ao(this,t,e,s),this}chain(...t){return oo(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Fn(this.input)&&(this.input instanceof io?this.input.dispose():ri(this.input)&&this.input.disconnect()),Fn(this.output)&&(this.output instanceof io?this.output.dispose():ri(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function oo(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof io?t.connect(e):ri(t)&&ro(t,e),e)),e)}function ro(t,e,s=0,n=0){for(Bn(Fn(t),"Cannot connect from undefined node"),Bn(Fn(e),"Cannot connect to undefined node"),(e instanceof io||ri(e))&&Bn(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Bn(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof io||e instanceof no;)Fn(e.input)&&(e=e.input);for(;t instanceof io;)Fn(t.output)&&(t=t.output);oi(e)?t.connect(e,s):t.connect(e,s,n)}function ao(t,e,s=0,n=0){if(Fn(e))for(;e instanceof io;)e=e.input;for(;!ri(t);)Fn(t.output)&&(t=t.output);oi(e)?t.disconnect(e,s):ri(e)?t.disconnect(e,s,n):t.disconnect()}function co(...t){const e=t.pop();Fn(e)&&t.forEach((t=>ro(t,e)))}class ho extends io{constructor(){const t=ui(ho.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new no({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Di(this,"gain")}static getDefaults(){return Object.assign(io.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class lo extends io{constructor(t){super(t),this.onended=Ei,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ho({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(io.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ei})}_startGain(t,e=1){Bn(-1===this._startTime,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Bn(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ei&&(this.onended(this),this.onended=Ei,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Bn(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ei,this}}class uo extends lo{constructor(){const t=ui(uo.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ro(this._source,this._gainNode),this.offset=new no({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(lo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class po extends io{constructor(){const t=ui(po.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new uo({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(io.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return fo(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,n){return this._param.setValueCurveAtTime(t,e,s,n),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function fo(t,e,s,n){(e instanceof no||oi(e)||e instanceof po&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof po&&(e.overridden=!0)),ro(t,e,s,n)}class _o extends no{constructor(){const t=ui(_o.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new wi(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(no.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const n=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(1/s,1));for(let t=0;t<=o;t++){const o=s*t+e,r=this._exponentialApproach(i.time,i.value,n,s,o);this.linearRampToValueAtTime(this._toType(r),o)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),o=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),o=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),n=this._events.get(e),i=Math.round(Math.max(10*(e-n.time),1)),o=(e-n.time)/i;for(let t=0;t<=i;t++){const i=o*t+n.time,r=this._exponentialInterpolate(n.time,n.value,e,s,i);this.linearRampToValueAtTime(this._toType(r),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(In(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let n=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(n=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+n)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(e);return this.getTimeOfTick(n+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&"linearRampToValueAtTime"===s.type&&e.value!==s.value){const n=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(s.time))-n)/(s.time-e.time),o=Math.sqrt(Math.pow(n,2)-2*i*(e.ticks-t)),r=(-n+o)/i;return(r>0?r:(-n-o)/i)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),n=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+n)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class mo extends po{constructor(){const t=ui(mo.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new _o({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(po.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class go extends eo{constructor(){const t=ui(go.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new so,this._tickOffset=new wi,this._ticksAtTime=new wi,this._secondsAtTime=new wi,this.frequency=new mo({context:this.context,units:t.units,value:t.frequency}),Di(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},eo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return"started"!==this._state.getValueAtTime(s)&&(this._state.setStateAtTime("started",s),Fn(e)&&this.setTicksAtTime(e,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),n=this._ticksAtTime.get(e),i={state:"paused",time:e};this._state.add(i);let o=n||s,r=n?n.ticks:0,a=null;return this._state.forEachBetween(o.time,e+this.sampleTime,(t=>{let e=o.time;const s=this._tickOffset.get(t.time);s&&s.time>=o.time&&(r=s.ticks,e=s.time),"started"===o.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e),t.time!==i.time&&(a={state:t.state,time:t.time,ticks:r})),o=t})),this._state.remove(i),a&&this._ticksAtTime.add(a),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);const n=this._secondsAtTime.get(t);let i=n||e,o=n?n.seconds:0,r=null;return this._state.forEachBetween(i.time,t+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(o=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(o+=t.time-e,t.time!==s.time&&(r={state:t.state,time:t.time,seconds:o})),i=t})),this._state.remove(s),r&&this._secondsAtTime.add(r),o}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),n=this._state.get(e),i=Math.max(s.time,n.time),o=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(t,e,s){let n=this._state.get(t);this._state.forEachBetween(t,e,(e=>{n&&"started"===n.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(n.time,t),e.time-this.sampleTime,s),n=e}));let i=null;if(n&&"started"===n.state){const o=Math.max(n.time,t),r=this.frequency.getTicksAtTime(o),a=r-this.frequency.getTicksAtTime(n.time);let c=Math.ceil(a)-a;c=yi(c,1)?0:c;let h=this.frequency.getTimeOfTick(r+c);for(;h<e;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(t){i=t;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class vo extends eo{constructor(){const t=ui(vo.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=Ei,this._lastUpdate=0,this._state=new so("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new go({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Di(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(eo.getDefaults(),{callback:Ei,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Gn(this.context);const s=this.toSeconds(t);return this.log("start",s),"started"!==this._state.getValueAtTime(s)&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(n+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ai.mixin(vo);class yo extends io{constructor(){const t=ui(yo.getDefaults(),arguments,["delayTime","maxDelay"]);super(t),this.name="Delay";const e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new no({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),Di(this,"delayTime")}static getDefaults(){return Object.assign(io.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class xo extends io{constructor(){const t=ui(xo.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new ho({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Di(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class wo extends io{constructor(){const t=ui(wo.getDefaults(),arguments);super(t),this.name="Destination",this.input=new xo({context:this.context}),this.output=new ho({context:this.context}),this.volume=this.input.volume,oo(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),oo(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Ti((t=>{t.destination=new wo({context:t})})),ki((t=>{t.destination.dispose()}));class bo extends io{constructor(){super(...arguments),this.name="Listener",this.positionX=new no({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new no({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new no({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new no({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new no({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new no({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new no({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new no({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new no({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(io.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function To(t,e){return ni(this,arguments,void 0,(function*(t,e,s=2,n=Vi().sampleRate){const i=Vi(),o=new qi(s,e,n);Ni(o),yield t(o);const r=o.render();Ni(i);const a=yield r;return new Ri(a)}))}Ti((t=>{t.listener=new bo({context:t})})),ki((t=>{t.listener.dispose()}));class So extends fi{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=ui(So.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ei,onload:Ei,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Bn(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,s=Ei,n=Ei){return zn(e)?(this.baseUrl&&"data:audio/"===e.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(t.toString(),new Ri(this.baseUrl+e,s,n))):this._buffers.set(t.toString(),new Ri(e,s,n)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class ko extends Yi{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Bi(super._frequencyToUnits(t))}_ticksToUnits(t){return Bi(super._ticksToUnits(t))}_beatsToUnits(t){return Bi(super._beatsToUnits(t))}_secondsToUnits(t){return Bi(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return Gi(this.toMidi())}transpose(t){return new ko(this.context,this.toMidi()+t)}}function Ao(t,e){return new ko(Vi(),t,e)}class Co extends Ki{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Oo(t,e){return new Co(Vi(),t,e)}class Do extends eo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new wi,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Ti((t=>{t.draw=new Do({context:t})})),ki((t=>{t.draw.dispose()}));class Mo extends fi{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Bn(Fn(t.time),"Events must have a time property"),Bn(Fn(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Eo(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,s=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,s=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,s=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,s=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,s=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),s&&this._rebalance(s)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),n=t.right;n&&(t.right=n.left,n.left=t),null!==e?s?e.left=n:e.right=n:this._setRoot(n)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),n=t.left;n&&(t.left=n.right,n.right=t),null!==e?s?e.left=n:e.right=n:this._setRoot(n)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let s=1;s<e.length;s++)e[s].low>t.low&&(t=e[s]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const s=[];this._root.search(t,s),s.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const s=[];this._root.searchAfter(t,s),s.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class Eo{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Ro extends fi{constructor(t){super(),this.name="TimelineValue",this._timeline=new wi({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class qo extends io{constructor(){super(ui(qo.getDefaults(),arguments,["context"]))}connect(t,e=0,s=0){return fo(this,t,e,s),this}}class Io extends qo{constructor(){const t=ui(Io.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Ln(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Vn(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(po.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let n=0,i=e;n<i;n++){const e=n/(i-1)*2-1;s[n]=t(e,n)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Bn(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Fo extends qo{constructor(){const t=ui(Fo.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new Io({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(qo.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Vo{constructor(t,e){this.id=Vo._eventId++,this._remainderTime=0;const s=Object.assign(Vo.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:Ei,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Vo._eventId=0;class No extends Vo{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(No.getDefaults(),e);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Vo.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return vi(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Co(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){vi(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Co(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);mi(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Po extends eo{constructor(){const t=ui(Po.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new Ro(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new wi,this._repeatedEvents=new Mo,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new vo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Di(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(eo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const s=e%(2*this._swingTicks)/(2*this._swingTicks),n=Math.sin(s*Math.PI)*this._swingAmount;t+=new Co(this.context,2*this._swingTicks/3).toSeconds()*n}Xn(!0),this._timeline.forEachAtTime(e,(e=>e.invoke(t))),Xn(!1)}schedule(t,e){const s=new Vo(this,{callback:t,time:new Ki(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,n=1/0){const i=new No(this,{callback:t,duration:new Zi(this.context,n).toTicks(),interval:new Zi(this.context,e).toTicks(),time:new Ki(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new Vo(this,{callback:t,once:!0,time:new Ki(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new Co(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let s;return this.context.resume(),Fn(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Ln(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Zi(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Zi(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Co(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Co(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const s=this._clock.getTicksAtTime(e),n=e+this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e);this.emit("stop",n),this._clock.setTicksAtTime(t,n),this.emit("start",n,this._clock.getSecondsAtTime(n))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),s=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(s,e)}}syncSignal(t,e){const s=this.now();let n=this.bpm,i=1/(60/n.getValueAtTime(s)/this.PPQ),o=[];if("time"===t.units){const t=1/64/i,e=new ho(t),s=new Fo(-1),r=new ho(t);n.chain(e,s,r),n=r,i=1/i,o=[e,s,r]}e||(e=0!==t.getValueAtTime(s)?t.getValueAtTime(s)/i:0);const r=new ho(e);return n.connect(r),r.connect(t._param),o.push(r),this._syncedSignals.push({initial:t.value,nodes:o,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.nodes.forEach((t=>t.dispose())),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Mi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ai.mixin(Po),Ti((t=>{t.transport=new Po({context:t})})),ki((t=>{t.transport.dispose()}));class jo extends io{constructor(t){super(t),this.input=void 0,this._state=new so("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ei,this._syncedStop=Ei,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new xo({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Di(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,onstop:Ei,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let n=In(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(n=this._clampToCurrentTime(n),this._synced||"started"!==this._state.getValueAtTime(n))if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const t=this._state.get(n);t&&(t.offset=this.toSeconds(pi(e,0)),t.duration=s?this.toSeconds(s):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,s)}),n);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else Gn(this.context),this._start(n,e,s);else Bn(mi(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,e,s);return this}stop(t){let e=In(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Fn(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(mi(e,0)){const s=this._state.get(e);if(s&&"started"===s.state&&s.time!==e){const n=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-n),this._start(t,this.toSeconds(s.offset)+n,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ei,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Lo extends lo{constructor(){const t=ui(Lo.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ro(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new no({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Ri(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(lo.getDefaults(),{url:new Ri,loop:!1,loopEnd:0,loopStart:0,onload:Ei,onerror:Ei,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,n=1){Bn(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,n),e=this.loop?pi(e,this.loopStart):pi(e,0);let o=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),s=t-e;gi(o,t)&&(o=(o-e)%s+e),yi(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,vi(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),Fn(s)){let t=this.toSeconds(s);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class zo extends jo{constructor(){const t=ui(zo.getDefaults(),arguments,["type"]);super(t),this.name="Noise",this._source=null,this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(jo.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(Bn(t in Uo,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=Uo[this._type];this._source=new Lo({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Wo=220500,Bo={brown:null,pink:null,white:null},Uo={get brown(){if(!Bo.brown){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(Wo);t[e]=s;let n=0;for(let t=0;t<Wo;t++){const e=2*Math.random()-1;s[t]=(n+.02*e)/1.02,n=s[t],s[t]*=3.5}}Bo.brown=(new Ri).fromArray(t)}return Bo.brown},get pink(){if(!Bo.pink){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(Wo);let n,i,o,r,a,c,h;t[e]=s,n=i=o=r=a=c=h=0;for(let t=0;t<Wo;t++){const e=2*Math.random()-1;n=.99886*n+.0555179*e,i=.99332*i+.0750759*e,o=.969*o+.153852*e,r=.8665*r+.3104856*e,a=.55*a+.5329522*e,c=-.7616*c-.016898*e,s[t]=n+i+o+r+a+c+h+.5362*e,s[t]*=.11,h=.115926*e}}Bo.pink=(new Ri).fromArray(t)}return Bo.pink},get white(){if(!Bo.white){const t=[];for(let e=0;e<2;e++){const s=new Float32Array(Wo);t[e]=s;for(let t=0;t<Wo;t++)s[t]=2*Math.random()-1}Bo.white=(new Ri).fromArray(t)}return Bo.white}};class Go extends io{constructor(){const t=ui(Go.getDefaults(),arguments,["volume"]);super(t),this.name="UserMedia",this._volume=this.output=new xo({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Di(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}open(t){return ni(this,void 0,void 0,(function*(){Bn(Go.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const e=yield Go.enumerateDevices();Nn(t)?this._device=e[t]:(this._device=e.find((e=>e.label===t||e.deviceId===t)),!this._device&&e.length>0&&(this._device=e[0]),Bn(Fn(this._device),`No matching device ${t}`));const s={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(s.audio.deviceId=this._device.deviceId);const n=yield navigator.mediaDevices.getUserMedia(s);if(!this._stream){this._stream=n;const t=this.context.createMediaStreamSource(n);ro(t,this.output),this._mediaStream=t}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((t=>{t.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return ni(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((t=>"audioinput"===t.kind))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Fn(navigator.mediaDevices)&&Fn(navigator.mediaDevices.getUserMedia)}}function Qo(t,e){return ni(this,void 0,void 0,(function*(){const s=e/t.context.sampleRate,n=new qi(1,s,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/s,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)}))}class Zo extends lo{constructor(){const t=ui(Zo.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ro(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new no({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new no({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Di(this,["frequency","detune"])}static getDefaults(){return Object.assign(lo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Xo extends jo{constructor(){const t=ui(Xo.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new po({context:this.context,units:"frequency",value:t.frequency}),Di(this,"frequency"),this.detune=new po({context:this.context,units:"cents",value:t.detune}),Di(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(jo.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Zo({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return Xo._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,s=this._partials,e.length===s.length&&e.every(((t,e)=>s[e]===t)));var e,s}));{const t=Xo._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Fn(e)){const{partials:t,wave:s}=e;this._wave=s,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,s]=this._getRealImaginary(t,this._phase),n=this.context.createPeriodicWave(e,s);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Xo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),Xo._periodicWaveCache.length>100&&Xo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Un(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,s)=>e[s]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let s=2048;const n=new Float32Array(s),i=new Float32Array(s);let o=1;if("custom"===t){if(o=this._partials.length+1,this._partialCount=this._partials.length,s=o,0===this._partials.length)return[n,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(o=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],o=Math.max(o,2),s=o):this._partialCount=0,this._partials=[]}for(let r=1;r<s;++r){const s=2/(r*Math.PI);let a;switch(t){case"sine":a=r<=o?1:0,this._partials[r-1]=a;break;case"square":a=1&r?2*s:0,this._partials[r-1]=a;break;case"sawtooth":a=s*(1&r?1:-1),this._partials[r-1]=a;break;case"triangle":a=1&r?s*s*2*(r-1>>1&1?-1:1):0,this._partials[r-1]=a;break;case"custom":a=this._partials[r-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(n[r]=-a*Math.sin(e*r),i[r]=a*Math.cos(e*r)):(n[r]=0,i[r]=0)}return[n,i]}_inverseFFT(t,e,s){let n=0;const i=t.length;for(let o=0;o<i;o++)n+=t[o]*Math.cos(o*s)+e[o]*Math.sin(o*s);return n}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const n=2*Math.PI;for(let i=0;i<32;i++)s=Math.max(this._inverseFFT(t,e,i/32*n),s);return xi(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Xo._periodicWaveCache=[];class Yo extends qo{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Io({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class $o extends po{constructor(){const t=ui($o.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ho({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Ho extends jo{constructor(){const t=ui(Ho.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new Yo({context:this.context}),this._modulationNode=new ho({context:this.context}),this._carrier=new Xo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Xo({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new $o({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Di(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Jo extends jo{constructor(){const t=ui(Jo.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new ho({context:this.context,gain:0}),this._carrier=new Xo({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new po({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Xo({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new $o({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new $o({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Di(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Ko extends jo{constructor(){const t=ui(Ko.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new ho({context:this.context,gain:0}),this._thresh=new Io({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new po({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Xo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Di(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(jo.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class tr extends jo{constructor(){const t=ui(tr.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new po({context:this.context,units:"frequency",value:t.frequency}),this.detune=new po({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Di(this,["frequency","detune"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach(((t,n)=>t.detune.value=e+s*n))}}get count(){return this._oscillators.length}set count(t){if(Un(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const s=new Xo({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):Ei});"custom"===this.type&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class er extends jo{constructor(){const t=ui(er.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new $o({context:this.context,value:2}),this._pulse=new Ko({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Xo({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Di(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(jo.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const sr={am:Ho,fat:tr,fm:Jo,oscillator:Xo,pulse:Ko,pwm:er};class nr extends jo{constructor(){const t=ui(nr.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new po({context:this.context,units:"frequency",value:t.frequency}),this.detune=new po({context:this.context,units:"cents",value:t.detune}),Di(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Xo.getDefaults(),Jo.getDefaults(),Ho.getDefaults(),tr.getDefaults(),Ko.getDefaults(),er.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=sr[t],s=this.now();if(this._oscillator){const t=this._oscillator;t.stop(s),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof sr[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Nn(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Nn(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&zn(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return ni(this,arguments,void 0,(function*(t=1024){return Qo(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class ir extends po{constructor(){super(ui(ir.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new ho({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,oo(this._constantSource,this._sum)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class or extends qo{constructor(){const t=ui(or.getDefaults(),arguments,["min","max"]);super(t),this.name="Scale",this._mult=this.input=new $o({context:this.context,value:t.max-t.min}),this._add=this.output=new ir({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(qo.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class rr extends qo{constructor(){super(ui(rr.getDefaults(),arguments)),this.name="Zero",this._gain=new ho({context:this.context}),this.output=this._gain,this.input=void 0,ro(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ao(this.context.getConstant(0),this._gain),this}}class ar extends io{constructor(){const t=ui(ar.getDefaults(),arguments,["frequency","min","max"]);super(t),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=no.prototype._fromType,this._toType=no.prototype._toType,this._is=no.prototype._is,this._clampValue=no.prototype._clampValue,this._oscillator=new Xo(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ho({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new po({context:this.context,units:"audioRange",value:0}),this._zeros=new rr({context:this.context}),this._a2g=new Yo({context:this.context}),this._scaler=this.output=new or({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Di(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Xo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,s=this.max;this._units=t,this.min=e,this.max=s}get state(){return this._oscillator.state}connect(t,e,s){return(t instanceof no||t instanceof po)&&(this.convert=t.convert,this.units=t.units),fo(this,t,e,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function cr(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(n){Un(n,t,e),s.set(this,n)}})}}function hr(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(n){Un(this.toSeconds(n),t,e),s.set(this,n)}})}}class lr extends jo{constructor(){const t=ui(lr.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new Ri({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(jo.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ei,onerror:Ei,playbackRate:1,reverse:!1})}load(t){return ni(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=Ei){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){e=this._loop?pi(e,this._loopStart):pi(e,0);const n=this.toSeconds(e),i=s;s=pi(s,Math.max(this._buffer.duration-n,0));let o=this.toSeconds(s);o/=this._playbackRate,t=this.toSeconds(t);const r=new Lo({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+o),this._state.setStateAtTime("stopped",t+o,{implicitEnd:!0})),this._activeSources.add(r),this._loop&&In(i)?r.start(t,n):r.start(t,n,o-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var n;null===(n=[...this._activeSources].pop())||void 0===n||n.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if("started"===this._state.getValueAtTime(s)){const e=this.toSeconds(t);this._stop(s),this._start(s,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Un(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Un(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((s=>{s.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}si([hr(0)],lr.prototype,"fadeIn",void 0),si([hr(0)],lr.prototype,"fadeOut",void 0);class ur extends io{constructor(){const t=ui(ur.getDefaults(),arguments,["urls","onload"],"urls");super(t),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new xo({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Di(this,"volume"),this._buffers=new So({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(jo.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ei,onerror:Ei,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach((e=>{e.fadeIn=t}))}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach((e=>{e.fadeOut=t}))}get state(){return Array.from(this._players).some((([t,e])=>"started"===e.state))?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(Bn(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new lr({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,s){return Bn(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,s),this}stopAll(t){return this._players.forEach((e=>e.stop(t))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((t=>t.dispose())),this._buffers.dispose(),this}}class pr extends jo{constructor(){const t=ui(pr.getDefaults(),arguments,["url","onload"]);super(t),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[],this.buffer=new Ri({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new vo({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(jo.getDefaults(),{onload:Ei,onerror:Ei,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,s){e=pi(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const n=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/n),s&&this.stop(t+this.toSeconds(s))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){this._stop(t),this._start(t,e,s)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach((e=>{e.fadeOut=0,e.stop(t)})),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),s=e*this._grainSize;if(this.log("offset",s),!this.loop&&s>this.buffer.duration)return void this.stop(t);const n=s<this._overlap?0:this._overlap,i=new Lo({context:this.context,url:this.buffer,fadeIn:n,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:zi(this.detune/100)}).connect(this.output);i.start(t,this._grainSize*e),i.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(i),i.onended=()=>{const t=this._activeSources.indexOf(i);-1!==t&&this._activeSources.splice(t,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){Un(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&Un(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&Un(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);Un(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((t=>t.dispose())),this}}class dr extends qo{constructor(){super(...arguments),this.name="Abs",this._abs=new Io({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class fr extends qo{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Io({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class _r extends qo{constructor(){super(...arguments),this.name="Negate",this._multiply=new $o({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class mr extends po{constructor(){super(ui(mr.getDefaults(),arguments,["value"])),this.override=!1,this.name="Subtract",this._sum=new ho({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new _r({context:this.context}),this.subtrahend=this._param,oo(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class gr extends qo{constructor(){super(ui(gr.getDefaults(),arguments)),this.name="GreaterThanZero",this._thresh=this.output=new Io({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new $o({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class vr extends po{constructor(){const t=ui(vr.getDefaults(),arguments,["value"]);super(t),this.name="GreaterThan",this.override=!1,this._subtract=this.input=new mr({context:this.context,value:t.value}),this._gtz=this.output=new gr({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Di(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class yr extends or{constructor(){const t=ui(yr.getDefaults(),arguments,["min","max","exponent"]);super(t),this.name="ScaleExp",this.input=this._exp=new Fo({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(or.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class xr extends po{constructor(){const t=ui(po.getDefaults(),arguments,["value","units"]);super(t),this.name="SyncedSignal",this.override=!1,this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new uo({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){const e=new Ki(this.context,t).toSeconds();return super.getValueAtTime(e)}setValueAtTime(t,e){const s=new Ki(this.context,e).toSeconds();return super.setValueAtTime(t,s),this}linearRampToValueAtTime(t,e){const s=new Ki(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,s),this}exponentialRampToValueAtTime(t,e){const s=new Ki(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,s),this}setTargetAtTime(t,e,s){const n=new Ki(this.context,e).toSeconds();return super.setTargetAtTime(t,n,s),this}cancelScheduledValues(t){const e=new Ki(this.context,t).toSeconds();return super.cancelScheduledValues(e),this}setValueCurveAtTime(t,e,s,n){const i=new Ki(this.context,e).toSeconds();return s=this.toSeconds(s),super.setValueCurveAtTime(t,i,s,n),this}cancelAndHoldAtTime(t){const e=new Ki(this.context,t).toSeconds();return super.cancelAndHoldAtTime(e),this}setRampPoint(t){const e=new Ki(this.context,t).toSeconds();return super.setRampPoint(e),this}exponentialRampTo(t,e,s){const n=new Ki(this.context,s).toSeconds();return super.exponentialRampTo(t,e,n),this}linearRampTo(t,e,s){const n=new Ki(this.context,s).toSeconds();return super.linearRampTo(t,e,n),this}targetRampTo(t,e,s){const n=new Ki(this.context,s).toSeconds();return super.targetRampTo(t,e,n),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class wr extends io{constructor(){const t=ui(wr.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new po({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(io.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(zn(t))return t;{let s;for(s in br)if(br[s][e]===t)return s;return t}}_setCurve(t,e,s){if(zn(s)&&Reflect.has(br,s)){const n=br[s];Pn(n)?"_decayCurve"!==t&&(this[t]=n[e]):this[t]=n}else{if(!Ln(s)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+s);this[t]=s}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let s=this.toSeconds(this.attack);const n=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0&&(s=(1-i)/(1/s)),s<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,s,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,s,t);else{this._sig.cancelAndHoldAtTime(t);let n=this._attackCurve;for(let t=1;t<n.length;t++)if(n[t-1]<=i&&i<=n[t]){n=this._attackCurve.slice(t),n[0]=i;break}this._sig.setValueCurveAtTime(n,t,s,e)}if(n&&this.sustain<1){const i=e*this.sustain,o=t+s;this.log("decay",o),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,n+o):this._sig.exponentialApproachValueAtTime(i,o,n)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,s,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,s,t):(Bn(Ln(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return fo(this,t,e,s),this}asArray(){return ni(this,arguments,void 0,(function*(t=1024){const e=t/this.context.sampleRate,s=new qi(1,e,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=n+this.toSeconds(this.release),o=.1*i,r=i+o,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/r,decay:e*this.toSeconds(this.decay)/r,release:e*this.toSeconds(this.release)/r,context:s}));return a._sig.toDestination(),a.triggerAttackRelease(e*(n+o)/r,0),(yield s.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}si([hr(0)],wr.prototype,"attack",void 0),si([hr(0)],wr.prototype,"decay",void 0),si([cr(0,1)],wr.prototype,"sustain",void 0),si([hr(0)],wr.prototype,"release",void 0);const br=(()=>{const t=128;let e,s;const n=[];for(e=0;e<t;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){s=e/127;const t=Math.sin(s*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*s}i[127]=1;const o=[];for(e=0;e<t;e++)o[e]=Math.ceil(e/127*5)/5;const r=[];for(e=0;e<t;e++)s=e/127,r[e]=.5*(1-Math.cos(Math.PI*s));const a=[];for(e=0;e<t;e++){s=e/127;const t=4*Math.pow(s,3)+.2,n=Math.cos(t*Math.PI*2*s);a[e]=Math.abs(n*(1-s))}function c(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=1-t[s];return e}return{bounce:{In:c(a),Out:a},cosine:{In:n,Out:(h=n,h.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:r,Out:c(r)},step:{In:o,Out:c(o)}};var h})();class Tr extends io{constructor(){const t=ui(Tr.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new xo({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Di(this,"volume")}static getDefaults(){return Object.assign(io.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...t)=>{const n=t[e],i=this.context.transport.schedule((n=>{t[e]=n,s.apply(this,t)}),n);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,s,n){const i=this.toSeconds(s),o=this.toSeconds(e);return this.triggerAttack(t,i,n),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Sr extends Tr{constructor(){const t=ui(Sr.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Tr.getDefaults(),{detune:0,onsilence:Ei,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const n=this.toSeconds(e);return this._triggerEnvelopeAttack(n,s),this.setNote(t,n),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),n=t instanceof Yi?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,t,s)}else this.frequency.setValueAtTime(n,s);return this}}si([hr(0)],Sr.prototype,"portamento",void 0);class kr extends wr{constructor(){super(ui(kr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ho({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ar extends Sr{constructor(){const t=ui(Ar.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new nr(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new kr(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Di(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{envelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(di(nr.getDefaults(),[...Object.keys(jo.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+s)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Cr extends Sr{constructor(){const t=ui(Cr.getDefaults(),arguments);super(t),this.name="ModulationSynth",this._carrier=new Ar({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Ar({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new po({context:this.context,units:"frequency"}),this.detune=new po({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new $o({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new ho({context:this.context,gain:0}),Di(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{harmonicity:3,oscillator:Object.assign(di(nr.getDefaults(),[...Object.keys(jo.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(di(nr.getDefaults(),[...Object.keys(jo.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Or extends Cr{constructor(){super(ui(Or.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Yo({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Dr extends io{constructor(){const t=ui(Dr.getDefaults(),arguments,["frequency","type"]);super(t),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new no({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new no({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new no({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new no({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){Bn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let s=0;s<t;s++){const n=19980*Math.pow(s/t,2)+20;e[s]=n}const s=new Float32Array(t),n=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,s,n),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Mr extends io{constructor(){const t=ui(Mr.getDefaults(),arguments,["frequency","type","rolloff"]);super(t),this.name="Filter",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._filters=[],this._filters=[],this.Q=new po({context:this.context,units:"positive",value:t.Q}),this.frequency=new po({context:this.context,units:"frequency",value:t.frequency}),this.detune=new po({context:this.context,units:"cents",value:t.detune}),this.gain=new po({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,Di(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){Bn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=Nn(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let n=s.indexOf(e);Bn(-1!==n,`rolloff can only be ${s.join(", ")}`),n+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(n);for(let t=0;t<n;t++){const e=new Dr({context:this.context});e.type=this._type,this.frequency.connect(e.frequency),this.detune.connect(e.detune),this.Q.connect(e.Q),this.gain.connect(e.gain),this._filters[t]=e}this._internalChannels=this._filters,oo(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new Dr({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{e.getFrequencyResponse(t).forEach(((t,e)=>s[e]*=t))})),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),Mi(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Er extends wr{constructor(){const t=ui(Er.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="FrequencyEnvelope",this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new Fo({context:this.context,value:t.exponent}),this._scale=this.output=new or({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(wr.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);Un(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Rr extends Sr{constructor(){const t=ui(Rr.getDefaults(),arguments);super(t),this.name="MonoSynth",this.oscillator=new nr(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Mr(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new Er(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new kr(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Di(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Sr.getDefaults(),{envelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(di(Mr.getDefaults(),Object.keys(io.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(di(Er.getDefaults(),Object.keys(io.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(di(nr.getDefaults(),Object.keys(jo.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+s)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class qr extends Sr{constructor(){const t=ui(qr.getDefaults(),arguments);super(t),this.name="DuoSynth",this.voice0=new Rr(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Rr(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new $o({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new ar({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new ho({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new po({context:this.context,units:"frequency",value:440}),this.detune=new po({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Di(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return li(Sr.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:li(di(Rr.getDefaults(),Object.keys(Sr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:li(di(Rr.getDefaults(),Object.keys(Sr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Ir extends Cr{constructor(){const t=ui(Ir.getDefaults(),arguments);super(t),this.name="FMSynth",this.modulationIndex=new $o({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Cr.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Fr=[1,1.483,1.932,2.546,2.63,3.897];class Vr extends Sr{constructor(){const t=ui(Vr.getDefaults(),arguments);super(t),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new po({context:this.context,units:"cents",value:t.detune}),this.frequency=new po({context:this.context,units:"frequency"}),this._amplitude=new ho({context:this.context,gain:0}).connect(this.output),this._highpass=new Mr({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let e=0;e<Fr.length;e++){const s=new Jo({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:0===e?()=>this.onsilence(this):Ei,type:"square"});s.connect(this._highpass),this._oscillators[e]=s;const n=new $o({context:this.context,value:Fr[e]});this._freqMultipliers[e]=n,this.frequency.chain(n,s.frequency),this.detune.connect(s.detune)}this._filterFreqScaler=new or({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new wr({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}static getDefaults(){return li(Sr.getDefaults(),{envelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach((e=>e.start(t))),0===this.envelope.sustain&&this._oscillators.forEach((e=>{e.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach((e=>e.stop(t+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach((e=>e.modulationIndex.value=t))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach((e=>e.harmonicity.value=t))}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach((t=>t.dispose())),this._freqMultipliers.forEach((t=>t.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Nr extends Ar{constructor(){const t=ui(Nr.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Di(this,["oscillator","envelope"])}static getDefaults(){return li(Sr.getDefaults(),Ar.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),n=this.toFrequency(t instanceof Yi?t.toFrequency():t),i=n*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(n,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}si([cr(0)],Nr.prototype,"octaves",void 0),si([hr(0)],Nr.prototype,"pitchDecay",void 0);class Pr extends Tr{constructor(){const t=ui(Pr.getDefaults(),arguments);super(t),this.name="NoiseSynth",this.noise=new zo(Object.assign({context:this.context},t.noise)),this.envelope=new kr(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Tr.getDefaults(),{envelope:Object.assign(di(wr.getDefaults(),Object.keys(io.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(di(zo.getDefaults(),Object.keys(jo.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,s),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const jr=new Set;function Lr(t){jr.add(t)}function zr(t,e){const s=`registerProcessor("${t}", ${e})`;jr.add(s)}class Wr extends io{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Ei;const e=URL.createObjectURL(new Blob([Array.from(jr).join("\n")],{type:"text/javascript"})),s=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(s,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Lr('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),Lr("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),Lr("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");const Br="feedback-comb-filter";zr(Br,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Ur extends Wr{constructor(){const t=ui(Ur.getDefaults(),arguments,["delayTime","resonance"]);super(t),this.name="FeedbackCombFilter",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.delayTime=new no({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new no({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Di(this,["resonance","delayTime"])}_audioWorkletName(){return Br}static getDefaults(){return Object.assign(io.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){oo(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const s=t.parameters.get("feedback");this.resonance.setParam(s)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Gr extends io{constructor(){const t=ui(Gr.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OnePoleFilter",this._frequency=t.frequency,this._type=t.type,this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(io.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),s=1/(2*Math.PI*e);if("lowpass"===this._type){const t=1/(s*this.context.sampleRate),e=t-1;this._filter=this.context.createIIRFilter([t,0],[1,e])}else{const t=1/(s*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,t])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(t),t.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let s=0;s<t;s++){const n=19980*Math.pow(s/t,2)+20;e[s]=n}const s=new Float32Array(t),n=new Float32Array(t);return this._filter.getFrequencyResponse(e,s,n),s}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Qr extends io{constructor(){const t=ui(Qr.getDefaults(),arguments,["delayTime","resonance","dampening"]);super(t),this.name="LowpassCombFilter",this._combFilter=this.output=new Ur({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Gr({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(io.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Zr extends Tr{constructor(){const t=ui(Zr.getDefaults(),arguments);super(t),this.name="PluckSynth",this._noise=new zo({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new Qr({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return li(Tr.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const s=this.toFrequency(t);e=this.toSeconds(e);const n=1/s;return this._lfcf.delayTime.setValueAtTime(n,e),this._noise.start(e),this._noise.stop(e+n*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Xr extends Tr{constructor(){const t=ui(Xr.getDefaults(),arguments,["voice","options"]);super(t),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=t=>this.releaseAll(t),Bn(!Nn(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Tr.getDefaults(),{maxPolyphony:32,options:{},voice:Ar})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Bn(t instanceof Sr,"Voice must extend Monophonic class"),t.connect(this.output),this._voices.push(t),t}Kn("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,s){t.forEach((t=>{const n=new ko(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,s),this._activeVoices.push({midi:n,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const s=new ko(this.context,t).toMidi(),n=this._activeVoices.find((({midi:t,released:e})=>t===s&&!e));n&&(n.voice.triggerRelease(e),n.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,s,n){Bn(!this.disposed,"Synth was already disposed"),s<=this.now()?"attack"===t?this._triggerAttack(e,s,n):this._triggerRelease(e,s):this.context.setTimeout((()=>{this.disposed||this._scheduleEvent(t,e,s,n)}),s-this.now())}triggerAttack(t,e,s){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("attack",t,n,s),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,e,s,n){const i=this.toSeconds(s);if(this.triggerAttack(t,i,n),Ln(e)){Bn(Ln(t),"If the duration is an array, the notes must also be an array");for(let s=0;s<t.length;s++){const n=e[Math.min(s,e.length-1)],o=this.toSeconds(n);Bn(o>0,"The duration must be greater than 0"),this.triggerRelease(t[s],i+o)}}else{const s=this.toSeconds(e);Bn(s>0,"The duration must be greater than 0"),this.triggerRelease(t,i+s)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(t){const e=di(t,["onsilence","context"]);return this.options=li(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Yr extends Tr{constructor(){const t=ui(Yr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach((s=>{const n=parseInt(s,10);if(Bn(Wn(s)||Nn(n)&&isFinite(n),`url key is neither a note or midi pitch: ${s}`),Wn(s)){const n=new Yi(this.context,s).toMidi();e[n]=t.urls[s]}else Nn(n)&&isFinite(n)&&(e[n]=t.urls[n])})),this._buffers=new So({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Tr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ei,onerror:Ei,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=Ui(new Yi(this.context,t).toFrequency()),i=Math.round(n),o=n-i,r=this._findClosest(i),a=i-r,c=this._buffers.get(a),h=zi(r+o),l=new Lo({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);l.start(e,0,c.duration/h,s),Ln(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=new Yi(this.context,t).toMidi();if(this._activeSources.has(s)&&this._activeSources.get(s).length){const t=this._activeSources.get(s);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(s,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;)t.shift().stop(e)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,n=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,n),Ln(e)?(Bn(Ln(t),"notes must be an array when duration is array"),t.forEach(((t,s)=>{const n=e[Math.min(s,e.length-1)];this.triggerRelease(t,i+this.toSeconds(n))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(Bn(Wn(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Wn(t)){const n=new Yi(this.context,t).toMidi();this._buffers.add(n,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}si([hr(0)],Yr.prototype,"attack",void 0),si([hr(0)],Yr.prototype,"release",void 0);class $r extends eo{constructor(){const t=ui($r.getDefaults(),arguments,["callback","value"]);super(t),this.name="ToneEvent",this._state=new so("stopped"),this._startOffset=0,this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(eo.getDefaults(),{callback:Ei,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const s=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||Nn(this._loop)&&this._loop>1){e=1/0,Nn(this._loop)&&(e=this._loop*this._getLoopDuration());const n=this._state.getAfter(s);null!==n&&(e=Math.min(e,n.time-s)),e!==1/0&&(e=new Co(this.context,e));const i=new Co(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new Co(this.context,s),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new Co(this.context,s))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let s=e;null!==t&&(s=t.time),this._rescheduleEvents(s)}return this}cancel(t){t=pi(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;jn(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new Co(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new Co(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const s=this._getLoopDuration();return(t-e.time)%s/s}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class Hr extends eo{constructor(){const t=ui(Hr.getDefaults(),arguments,["callback","interval"]);super(t),this.name="Loop",this._event=new $r({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability,humanize:t.humanize}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(eo.getDefaults(),{interval:"4n",callback:Ei,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class Jr extends $r{constructor(){const t=ui(Jr.getDefaults(),arguments,["callback","events"]);super(t),this.name="Part",this._state=new so("stopped"),this._events=new Set,this._state.increasing=!0,t.events.forEach((t=>{Ln(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign($r.getDefaults(),{events:[]})}start(t,e){const s=this.toTicks(t);if("started"!==this._state.getValueAtTime(s)){e=pi(e,this._loop?this._loopStart:0),e=this._loop?pi(e,this._loopStart):pi(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:s}),this._forEach((e=>{this._startNote(e,s,t)}))}return this}_startNote(t,e,s){e-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(e+=this._getLoopDuration()),t.start(new Co(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new Co(this.context,e))):t.startOffset>=s&&t.start(new Co(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const s=new Ki(this.context,t).toTicks(),n=new Co(this.context,1).toSeconds(),i=this._events.values();let o=i.next();for(;!o.done;){const t=o.value;if(Math.abs(s-t.startOffset)<n)return Fn(e)&&(t.value=e),t;o=i.next()}return Fn(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const s=this.toTicks(t);let n;return e instanceof $r?(n=e,n.callback=this._tick.bind(this)):n=new $r({callback:this._tick.bind(this),context:this.context,value:e}),n.startOffset=s,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new Co(this.context,e.time))}))}remove(t,e){return Pn(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach((s=>{s.startOffset===t&&(In(e)||Fn(e)&&s.value===e)&&(this._events.delete(s),s.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof Jr?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((s=>{s[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new Co(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new Co(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*Kr(t){let e=0;for(;e<t;)e=xi(e,0,t-1),yield e,e++}function*ta(t){let e=t-1;for(;e>=0;)e=xi(e,0,t-1),yield e,e--}function*ea(t,e){for(;;)yield*e(t)}function*sa(t,e){let s=e?0:t-1;for(;;)s=xi(s,0,t-1),yield s,e?(s++,s>=t-1&&(e=!1)):(s--,s<=0&&(e=!0))}function*na(t){let e=0,s=0;for(;e<t;)e=xi(e,0,t-1),yield e,s++,e+=s%2?2:-1}function*ia(t){let e=t-1,s=0;for(;e>=0;)e=xi(e,0,t-1),yield e,s++,e+=s%2?-2:1}function*oa(t){const e=[];for(let s=0;s<t;s++)e.push(s);for(;e.length>0;){const s=xi(e.splice(Math.floor(e.length*Math.random()),1)[0],0,t-1);yield s}}function*ra(t,e="up",s=0){switch(Bn(t>=1,"The number of values must be at least one"),e){case"up":yield*ea(t,Kr);case"down":yield*ea(t,ta);case"upDown":yield*sa(t,!0);case"downUp":yield*sa(t,!1);case"alternateUp":yield*ea(t,na);case"alternateDown":yield*ea(t,ia);case"random":yield*function*(t){for(;;){const e=Math.floor(Math.random()*t);yield e}}(t);case"randomOnce":yield*ea(t,oa);case"randomWalk":yield*function*(t){let e=Math.floor(Math.random()*t);for(;;)0===e?e++:e===t-1||Math.random()<.5?e--:e++,yield e}(t)}}class aa extends Hr{constructor(){const t=ui(aa.getDefaults(),arguments,["callback","values","pattern"]);super(t),this.name="Pattern",this.callback=t.callback,this._values=t.values,this._pattern=ra(t.values.length,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(Hr.getDefaults(),{pattern:"up",values:[],callback:Ei})}_tick(t){const e=this._pattern.next();this._index=e.value,this._value=this._values[e.value],this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=ra(this._values.length,this._type)}}class ca extends $r{constructor(){const t=ui(ca.getDefaults(),arguments,["callback","events","subdivision"]);super(t),this.name="Sequence",this._part=new Jr({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(di($r.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null===e||this.mute||this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new Co(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,s)=>(zn(e)&&isFinite(parseInt(e,10))&&Ln(s)?t[e]=this._createSequence(s):t[e]=s,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,s){t.forEach(((t,n)=>{const i=n*e+s;if(Ln(t))this._rescheduleSequence(t,e/t.length,i);else{const e=new Co(this.context,i,"i").toSeconds();this._part.add(e,t)}}))}_indexTime(t){return new Co(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class ha extends io{constructor(){const t=ui(ha.getDefaults(),arguments,["fade"]);super(t),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new fr({context:this.context}),this.a=new ho({context:this.context,gain:0}),this.b=new ho({context:this.context,gain:0}),this.output=new ho({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new po({context:this.context,units:"normalRange",value:t.fade}),Di(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ro(this._split,this.a.gain,0),ro(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(io.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class la extends io{constructor(t){super(t),this.name="Effect",this._dryWet=new ha({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ho({context:this.context}),this.effectReturn=new ho({context:this.context}),this.input=new ho({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Di(this,"wet")}static getDefaults(){return Object.assign(io.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class ua extends la{constructor(t){super(t),this.name="LFOEffect",this._lfo=new ar({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,Di(this,["frequency","depth"])}static getDefaults(){return Object.assign(la.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class pa extends ua{constructor(){const t=ui(pa.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(t),this.name="AutoFilter",this.filter=new Mr(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(ua.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class da extends io{constructor(){const t=ui(da.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new no({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",Di(this,"pan")}static getDefaults(){return Object.assign(io.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class fa extends ua{constructor(){const t=ui(fa.getDefaults(),arguments,["frequency"]);super(t),this.name="AutoPanner",this._panner=new da({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(ua.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class _a extends io{constructor(){const t=ui(_a.getDefaults(),arguments,["smoothing"]);super(t),this.name="Follower",this._abs=this.input=new dr({context:this.context}),this._lowpass=this.output=new Gr({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(io.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class ma extends la{constructor(){const t=ui(ma.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(t),this.name="AutoWah",this._follower=new _a({context:this.context,smoothing:t.follower}),this._sweepRange=new yr({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new ho({context:this.context}),this._bandpass=new Mr({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new Mr({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,Di(this,["gain","Q"])}static getDefaults(){return Object.assign(la.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return Li(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/ji(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const ga="bit-crusher";zr(ga,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class va extends la{constructor(){const t=ui(va.getDefaults(),arguments,["bits"]);super(t),this.name="BitCrusher",this._bitCrusherWorklet=new ya({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(la.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class ya extends Wr{constructor(){const t=ui(ya.getDefaults(),arguments);super(t),this.name="BitCrusherWorklet",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.bits=new no({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Wr.getDefaults(),{bits:12})}_audioWorkletName(){return ga}onReady(t){oo(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class xa extends la{constructor(){const t=ui(xa.getDefaults(),arguments,["order"]);super(t),this.name="Chebyshev",this._shaper=new Io({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(la.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,s){return s.has(e)||(0===e?s.set(e,0):1===e?s.set(e,t):s.set(e,2*t*this._getCoefficient(t,e-1,s)-this._getCoefficient(t,e-2,s))),s.get(e)}get order(){return this._order}set order(t){Bn(Number.isInteger(t),"'order' must be an integer"),this._order=t,this._shaper.setMap((e=>this._getCoefficient(e,t,new Map)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class wa extends io{constructor(){const t=ui(wa.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(io.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class ba extends io{constructor(){const t=ui(ba.getDefaults(),arguments,["channels"]);super(t),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(io.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Ta extends io{constructor(t){super(t),this.name="StereoEffect",this.input=new ho({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new ha({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new wa({context:this.context,channels:2}),this._merge=new ba({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Di(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),oo(...t),ro(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),oo(...t),ro(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(io.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Sa extends Ta{constructor(t){super(t),this.feedback=new po({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new ho({context:this.context}),this._feedbackR=new ho({context:this.context}),this._feedbackSplit=new wa({context:this.context,channels:2}),this._feedbackMerge=new ba({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Di(this,["feedback"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class ka extends Sa{constructor(){const t=ui(ka.getDefaults(),arguments,["frequency","delayTime","depth"]);super(t),this.name="Chorus",this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new ar({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new ar({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new yo({context:this.context}),this._delayNodeR=new yo({context:this.context}),this.frequency=this._lfoL.frequency,Di(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(Sa.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Aa extends la{constructor(){const t=ui(Aa.getDefaults(),arguments,["distortion"]);super(t),this.name="Distortion",this._shaper=new Io({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(la.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,s=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*s/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Ca extends la{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new ho({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Di(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(la.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Oa extends Ca{constructor(){const t=ui(Oa.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="FeedbackDelay",this._delayNode=new yo({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Di(this,"delayTime")}static getDefaults(){return Object.assign(Ca.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Da extends io{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.offset90=new ho({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),oo(this.input,...this._bank0,this._oneSampleDelay,this.output),oo(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map((t=>{const e=[[t*t,0,-1],[1,0,-t*t]];return this.context.createIIRFilter(e[0],e[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((t=>t.disconnect())),this._bank1.forEach((t=>t.disconnect())),this._oneSampleDelay.disconnect(),this}}class Ma extends la{constructor(){const t=ui(Ma.getDefaults(),arguments,["frequency"]);super(t),this.name="FrequencyShifter",this.frequency=new po({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Zo({context:this.context,type:"sine"}),this._cosine=new Xo({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new $o({context:this.context}),this._cosineMultiply=new $o({context:this.context}),this._negate=new _r({context:this.context}),this._add=new ir({context:this.context}),this._phaseShifter=new Da({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const e=this.immediate();this._sine.start(e),this._cosine.start(e)}static getDefaults(){return Object.assign(la.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const Ea=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Ra=[225,556,441,341];class qa extends Ta{constructor(){const t=ui(qa.getDefaults(),arguments,["roomSize","dampening"]);super(t),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[],this.roomSize=new po({context:this.context,value:t.roomSize,units:"normalRange"}),this._allpassFiltersL=Ra.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._allpassFiltersR=Ra.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._combFilters=Ea.map(((e,s)=>{const n=new Qr({context:this.context,dampening:t.dampening,delayTime:e});return s<Ea.length/2?this.connectEffectLeft(n,...this._allpassFiltersL):this.connectEffectRight(n,...this._allpassFiltersR),this.roomSize.connect(n.resonance),n})),Di(this,["roomSize"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach((e=>e.dampening=t))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((t=>t.disconnect())),this._allpassFiltersR.forEach((t=>t.disconnect())),this._combFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this}}const Ia=[.06748,.06404,.08212,.09004],Fa=[.773,.802,.753,.733],Va=[347,113,37];class Na extends Ta{constructor(){const t=ui(Na.getDefaults(),arguments,["roomSize"]);super(t),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[],this.roomSize=new po({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new or({context:this.context,min:-.733,max:.197}),this._allpassFilters=Va.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._feedbackCombFilters=Ia.map(((t,e)=>{const s=new Ur({context:this.context,delayTime:t});return this._scaleRoomSize.connect(s.resonance),s.resonance.value=Fa[e],e<Ia.length/2?this.connectEffectLeft(...this._allpassFilters,s):this.connectEffectRight(...this._allpassFilters,s),s})),this.roomSize.connect(this._scaleRoomSize),Di(this,["roomSize"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((t=>t.disconnect())),this._feedbackCombFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Pa extends Sa{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Di(this,["feedback"])}}class ja extends Pa{constructor(){const t=ui(ja.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="PingPongDelay",this._leftDelay=new yo({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new yo({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new yo({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new po({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Di(this,["delayTime"])}static getDefaults(){return Object.assign(Pa.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class La extends Ca{constructor(){const t=ui(La.getDefaults(),arguments,["pitch"]);super(t),this.name="PitchShift",this._frequency=new po({context:this.context}),this._delayA=new yo({maxDelay:1,context:this.context}),this._lfoA=new ar({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new yo({maxDelay:1,context:this.context}),this._lfoB=new ar({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new ha({context:this.context}),this._crossFadeLFO=new ar({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new yo({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Di(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Ca.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=zi(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=zi(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class za extends Ta{constructor(){const t=ui(za.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(t),this.name="Phaser",this._lfoL=new ar({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new ar({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new po({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),Di(this,["frequency","Q"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const s=[];for(let n=0;n<t;n++){const t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),e.connect(t.frequency),s.push(t)}return s}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((t=>t.disconnect())),this._filtersR.forEach((t=>t.disconnect())),this.frequency.dispose(),this}}class Wa extends la{constructor(){const t=ui(Wa.getDefaults(),arguments,["decay"]);super(t),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(la.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){Un(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){Un(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return ni(this,void 0,void 0,(function*(){const t=this.ready,e=new qi(2,this._decay+this._preDelay,this.context.sampleRate),s=new zo({context:e}),n=new zo({context:e}),i=new ba({context:e});s.connect(i,0,0),n.connect(i,0,1);const o=new ho({context:e}).toDestination();i.connect(o),s.start(0),n.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const r=e.render();return this.ready=r.then(Ei),yield t,this._convolver.buffer=(yield r).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Ba extends io{constructor(){super(ui(Ba.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new wa({channels:2,context:this.context}),this._midAdd=new ir({context:this.context}),this.mid=new $o({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new mr({context:this.context}),this.side=new $o({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class Ua extends io{constructor(){super(ui(Ua.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new ho({context:this.context}),this.side=new ho({context:this.context}),this._left=new ir({context:this.context}),this._leftMult=new $o({context:this.context,value:Math.SQRT1_2}),this._right=new mr({context:this.context}),this._rightMult=new $o({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new ba({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class Ga extends la{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new Ua({context:this.context}),this._midSideSplit=new Ba({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Qa extends Ga{constructor(){const t=ui(Qa.getDefaults(),arguments,["width"]);super(t),this.name="StereoWidener",this.width=new po({context:this.context,value:t.width,units:"normalRange"}),Di(this,["width"]),this._twoTimesWidthMid=new $o({context:this.context,value:2}),this._twoTimesWidthSide=new $o({context:this.context,value:2}),this._midMult=new $o({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new mr({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),ro(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new $o({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(Ga.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Za extends Ta{constructor(){const t=ui(Za.getDefaults(),arguments,["frequency","depth"]);super(t),this.name="Tremolo",this._lfoL=new ar({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new ar({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new ho({context:this.context}),this._amplitudeR=new ho({context:this.context}),this.frequency=new po({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new po({context:this.context,value:t.depth,units:"normalRange"}),Di(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(Ta.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Xa extends la{constructor(){const t=ui(Xa.getDefaults(),arguments,["frequency","depth"]);super(t),this.name="Vibrato",this._delayNode=new yo({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new ar({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,Di(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(la.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Ya extends io{constructor(){const t=ui(Ya.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new ho({context:this.context}),this._split=new wa({context:this.context,channels:t.channels}),this.input.connect(this._split),Un(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(io.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((t,e)=>{const s=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(s):"waveform"===this._type&&t.getFloatTimeDomainData(s)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach(((e,s)=>{e.fftSize=2*t,this._buffers[s]=new Float32Array(t)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(t){Bn("waveform"===t||"fft"===t,`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach((e=>e.smoothingTimeConstant=t))}dispose(){return super.dispose(),this._analysers.forEach((t=>t.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class $a extends io{constructor(){super(ui($a.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Ya({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Ha extends $a{constructor(){const t=ui(Ha.getDefaults(),arguments,["smoothing"]);super(t),this.name="Meter",this.input=this.output=this._analyser=new Ya({context:this.context,size:256,type:"waveform",channels:t.channelCount}),this.smoothing=t.smoothing,this.normalRange=t.normalRange,this._rms=new Array(t.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign($a.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return Kn("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=(1===this.channels?[t]:t).map(((t,e)=>{const s=t.reduce(((t,e)=>t+e*e),0),n=Math.sqrt(s/t.length);return this._rms[e]=Math.max(n,this._rms[e]*this.smoothing),this.normalRange?this._rms[e]:Li(this._rms[e])}));return 1===this.channels?e[0]:e}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Ja extends $a{constructor(){const t=ui(Ja.getDefaults(),arguments,["size"]);super(t),this.name="FFT",this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(io.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((t=>this.normalRange?ji(t):t))}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return Bn(0<=t&&t<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),t*this.context.sampleRate/(2*this.size)}}class Ka extends $a{constructor(){super(ui(Ka.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class tc extends $a{constructor(){const t=ui(tc.getDefaults(),arguments,["size"]);super(t),this.name="Waveform",this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign($a.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class ec extends io{constructor(){const t=ui(ec.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new ho({context:this.context}),ec._allSolos.has(this.context)||ec._allSolos.set(this.context,new Set),ec._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(io.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),ec._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){ec._soloed.has(this.context)||ec._soloed.set(this.context,new Set),ec._soloed.get(this.context).add(this)}_removeSolo(){ec._soloed.has(this.context)&&ec._soloed.get(this.context).delete(this)}_isSoloed(){return ec._soloed.has(this.context)&&ec._soloed.get(this.context).has(this)}_noSolos(){return!ec._soloed.has(this.context)||ec._soloed.has(this.context)&&0===ec._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ec._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ec._allSolos=new Map,ec._soloed=new Map;class sc extends io{constructor(){const t=ui(sc.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new da({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new xo({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,Di(this,["pan","volume"])}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class nc extends io{constructor(){const t=ui(nc.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new ec({solo:t.solo,context:this.context}),this._panVol=this.output=new sc({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Di(this,["pan","volume"])}static getDefaults(){return Object.assign(io.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return nc.buses.has(t)||nc.buses.set(t,new ho({context:this.context})),nc.buses.get(t)}send(t,e=0){const s=this._getBus(t),n=new ho({context:this.context,units:"decibels",gain:e});return this.connect(n),n.connect(s),n}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}nc.buses=new Map;class ic extends io{constructor(){super(ui(ic.getDefaults(),arguments)),this.name="Mono",this.input=new ho({context:this.context}),this._merge=this.output=new ba({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class oc extends io{constructor(){const t=ui(oc.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(t),this.name="MultibandSplit",this.input=new ho({context:this.context}),this.output=void 0,this.low=new Mr({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Mr({context:this.context,frequency:0,type:"highpass"}),this.mid=new Mr({context:this.context,frequency:0,type:"lowpass"}),this.high=new Mr({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new po({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new po({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new po({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Di(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Mi(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class rc extends io{constructor(){const t=ui(rc.getDefaults(),arguments,["positionX","positionY","positionZ"]);super(t),this.name="Panner3D",this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new no({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new no({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new no({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new no({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new no({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new no({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(io.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,s){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=s,this}setOrientation(t,e,s){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=s,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class ac extends io{constructor(){const t=ui(ac.getDefaults(),arguments);super(t),this.name="Recorder",this.input=new ho({context:this.context}),Bn(ac.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return io.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==ti&&Reflect.has(ti,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return ni(this,void 0,void 0,(function*(){Bn("started"!==this.state,"Recorder is already started");const t=new Promise((t=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),t()};this._recorder.addEventListener("start",e,!1)}));return this._recorder.start(),yield t}))}stop(){return ni(this,void 0,void 0,(function*(){Bn("stopped"!==this.state,"Recorder is not started");const t=new Promise((t=>{const e=s=>{this._recorder.removeEventListener("dataavailable",e,!1),t(s.data)};this._recorder.addEventListener("dataavailable",e,!1)}));return this._recorder.stop(),yield t}))}pause(){return Bn("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class cc extends io{constructor(){const t=ui(cc.getDefaults(),arguments,["threshold","ratio"]);super(t),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new no({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new no({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new no({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new no({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new no({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),Di(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(io.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class hc extends io{constructor(){const t=ui(hc.getDefaults(),arguments,["threshold","smoothing"]);super(t),this.name="Gate",this._follower=new _a({context:this.context,smoothing:t.smoothing}),this._gt=new vr({context:this.context,value:ji(t.threshold)}),this.input=new ho({context:this.context}),this._gate=this.output=new ho({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(io.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Li(this._gt.value)}set threshold(t){this._gt.value=ji(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class lc extends io{constructor(){const t=ui(lc.getDefaults(),arguments,["threshold"]);super(t),this.name="Limiter",this._compressor=this.input=this.output=new cc({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,Di(this,"threshold")}static getDefaults(){return Object.assign(io.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class uc extends io{constructor(){const t=ui(uc.getDefaults(),arguments);super(t),this.name="MidSideCompressor",this._midSideSplit=this.input=new Ba({context:this.context}),this._midSideMerge=this.output=new Ua({context:this.context}),this.mid=new cc(Object.assign(t.mid,{context:this.context})),this.side=new cc(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Di(this,["mid","side"])}static getDefaults(){return Object.assign(io.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class pc extends io{constructor(){const t=ui(pc.getDefaults(),arguments);super(t),this.name="MultibandCompressor",this._splitter=this.input=new oc({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new ho({context:this.context}),this.low=new cc(Object.assign(t.low,{context:this.context})),this.mid=new cc(Object.assign(t.mid,{context:this.context})),this.high=new cc(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Di(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(io.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class dc extends io{constructor(){const t=ui(dc.getDefaults(),arguments,["low","mid","high"]);super(t),this.name="EQ3",this.output=new ho({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new oc({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new ho({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new ho({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new ho({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Di(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(io.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Mi(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class fc extends io{constructor(){const t=ui(fc.getDefaults(),arguments,["url","onload"]);super(t),this.name="Convolver",this._convolver=this.context.createConvolver(),this._buffer=new Ri(t.url,(e=>{this.buffer=e,t.onload()})),this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=t.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(io.getDefaults(),{normalize:!0,onload:Ei})}load(t){return ni(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(t)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const e=this._buffer.get();this._convolver.buffer=e||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function _c(){return Vi().now()}function mc(){return Vi().immediate()}const gc=Vi().transport;function vc(){return Vi().transport}const yc=Vi().destination,xc=Vi().destination;function wc(){return Vi().destination}const bc=Vi().listener;function Tc(){return Vi().listener}const Sc=Vi().draw;function kc(){return Vi().draw}const Ac=Vi();function Cc(){return Ri.loaded()}const Oc=Ri,Dc=So,Mc=Lo})(),n})()));
    7 | //# sourceMappingURL=Tone.js.map
    8 | 

/* =====================================================================================
   FILE: app/phaser/games/follow-the-fade-game.js
   ===================================================================================== */

    1 | /*
    2 | /app/phaser/games/follow-the-fade-game.js
    3 | Implements the Follow the Fade mini-game logic and rendering for the induction arcade.
    4 | */
    5 | // phaser/games/follow-the-fade-game.js
    6 | 
    7 | const DOT_TEXTURE_KEY = "followFadeDot";
    8 | 
    9 | export default class FollowTheFadeGame {
   10 |   constructor(scene, { onComplete, onSuccess }) {
   11 |     this.scene = scene;
   12 |     this.onComplete = onComplete;
   13 |     this.onSuccess = onSuccess;
   14 | 
   15 |     this.successCount = 0;
   16 |     this.targetSuccesses = 10; // a bit shorter
   17 |     this.isActive = true;
   18 | 
   19 |     const { width, height } = scene.scale;
   20 | 
   21 |     // --- create a smooth, anti-aliased dot texture once ---
   22 |     if (!scene.textures.exists(DOT_TEXTURE_KEY)) {
   23 |       const g = scene.add.graphics();
   24 |       const texRadius = 64; // hi-res circle
   25 |       g.fillStyle(0xffffff, 1);
   26 |       g.fillCircle(texRadius, texRadius, texRadius);
   27 |       g.generateTexture(DOT_TEXTURE_KEY, texRadius * 2, texRadius * 2);
   28 |       g.destroy();
   29 |     }
   30 | 
   31 |     const radius = Math.round(Math.min(width, height) * 0.07); // base "big" radius
   32 | 
   33 |     this.dot = scene.add.image(width / 2, height / 2, DOT_TEXTURE_KEY);
   34 |     this.dot.setDisplaySize(radius * 2, radius * 2);
   35 |     this.dot.setAlpha(0.14);
   36 |     scene.gameLayer.add(this.dot);
   37 | 
   38 |     // --- scales for moving vs "ready" ---
   39 |     // big "ready" size
   40 |     this.stationaryScale = this.dot.scaleX;
   41 |     // small "ghost" size
   42 |     this.movingScale = this.stationaryScale * 0.35;
   43 | 
   44 |     // start small
   45 |     this.dot.setScale(this.movingScale);
   46 | 
   47 |     // simple interactive hit (image bounds); success only when tapping the dot
   48 |     this.dot.setInteractive();
   49 | 
   50 |     // --- sparkly particle aura ---
   51 |     this.particles = scene.add.particles(0, 0, DOT_TEXTURE_KEY, {
   52 |       speed: { min: 20, max: 90 },
   53 |       angle: { min: 0, max: 360 },
   54 |       scale: { start: 0.28, end: 0 },
   55 |       alpha: { start: 0.35, end: 0 },
   56 |       lifespan: { min: 350, max: 700 },
   57 |       quantity: 1,
   58 |       frequency: 45,
   59 |       follow: this.dot,
   60 |       followOffset: { x: 0, y: 0 },
   61 |       blendMode: "ADD",
   62 |     });
   63 |     scene.gameLayer.add(this.particles);
   64 | 
   65 |     // --- timing & difficulty settings ---
   66 |     this.threshold = 0.6;   // slightly easier / earlier "ready"
   67 |     this.windowSlack = 0.25; // wider window, easier hits
   68 |     this.minAlpha = 0.14;
   69 |     this.maxAlpha = 1.0;
   70 |     this.brightDuration = 1900; // slower pulses
   71 |     this.ghostChance = 0.10; // fewer tricky pulses
   72 |     this.canScore = false;
   73 |     this.lastAlpha = 0;
   74 | 
   75 |     this.isPopping = false; // used to let the pop animation override scale
   76 | 
   77 |     this.pointerHandler = () => this.handleTap();
   78 |     this.dot.on("pointerdown", this.pointerHandler);
   79 | 
   80 |     this.startPulse();
   81 |   }
   82 | 
   83 |   startPulse() {
   84 |     if (!this.isActive) return;
   85 | 
   86 |     const { width, height } = this.scene.scale;
   87 |     const padding = 60;
   88 |     const targetX = Phaser.Math.Between(padding, width - padding);
   89 |     const targetY = Phaser.Math.Between(padding, height - padding);
   90 |     const ghosting = Math.random() < this.ghostChance;
   91 | 
   92 |     const baseDuration = ghosting
   93 |       ? Math.max(1200, this.brightDuration * 0.85)
   94 |       : this.brightDuration;
   95 | 
   96 |     const activeDuration = baseDuration;
   97 |     const targetAlpha = ghosting
   98 |       ? Math.min(this.maxAlpha, 0.9)
   99 |       : this.maxAlpha;
  100 | 
  101 |     // reset to small + dim at start of each pulse
  102 |     this.dot.setScale(this.movingScale);
  103 |     this.dot.setAlpha(this.minAlpha);
  104 | 
  105 |     // --- movement tween: move as we fade in/out ---
  106 |     if (this.moveTween) this.moveTween.stop();
  107 |     this.moveTween = this.scene.tweens.add({
  108 |       targets: this.dot,
  109 |       x: targetX,
  110 |       y: targetY,
  111 |       duration: activeDuration,
  112 |       ease: "Sine.easeInOut",
  113 |     });
  114 | 
  115 |     // --- alpha + implicit scale tween (scale derived from alpha) ---
  116 |     if (this.pulseTween) this.pulseTween.stop();
  117 |     this.pulseTween = this.scene.tweens.add({
  118 |       targets: this.dot,
  119 |       alpha: { from: this.minAlpha, to: targetAlpha },
  120 |       duration: activeDuration,
  121 |       yoyo: true,
  122 |       hold: ghosting ? 60 : 140,
  123 |       ease: "Sine.easeInOut",
  124 |       onStart: () => {
  125 |         if (!this.isActive) return;
  126 |         this.canScore = false;
  127 |         this.lastAlpha = this.minAlpha;
  128 |       },
  129 |       onUpdate: (tween, target) => {
  130 |         if (!this.isActive) return;
  131 | 
  132 |         const a = target.alpha;
  133 |         this.lastAlpha = a;
  134 | 
  135 |         // let particles breathe with brightness (still constantly emitting)
  136 |         if (this.particles) {
  137 |           this.particles.setAlpha(a);
  138 |         }
  139 | 
  140 |         // smooth scale: small when dim, big when bright
  141 |         if (!this.isPopping) {
  142 |           const norm = Phaser.Math.Clamp(
  143 |             (a - this.minAlpha) / (this.maxAlpha - this.minAlpha),
  144 |             0,
  145 |             1,
  146 |           );
  147 |           const s = Phaser.Math.Linear(this.movingScale, this.stationaryScale, norm);
  148 |           this.dot.setScale(s);
  149 |         }
  150 | 
  151 |         // scoring window driven by alpha
  152 |         if (!this.canScore && a >= this.threshold) {
  153 |           this.canScore = true;
  154 |         }
  155 |         if (this.canScore && a < this.threshold - this.windowSlack) {
  156 |           this.canScore = false;
  157 |         }
  158 |       },
  159 |       onComplete: () => {
  160 |         if (!this.isActive) return;
  161 |         this.canScore = false;
  162 |         // start next pulse-cycle
  163 |         this.startPulse();
  164 |       },
  165 |     });
  166 |   }
  167 | 
  168 |   handleTap() {
  169 |     if (!this.isActive) return;
  170 | 
  171 |     if (this.canScore) {
  172 |       // GOOD TAP
  173 |       this.canScore = false;
  174 |       this.successCount++;
  175 | 
  176 |       // stop current tweens so the pop feels clean
  177 |       if (this.pulseTween) {
  178 |         this.pulseTween.stop();
  179 |         this.pulseTween = null;
  180 |       }
  181 |       if (this.moveTween) {
  182 |         this.moveTween.stop();
  183 |         this.moveTween = null;
  184 |       }
  185 | 
  186 |       this.isPopping = true;
  187 | 
  188 |       // 1) grow a bit bigger than ready size
  189 |       this.scene.tweens.add({
  190 |         targets: this.dot,
  191 |         scaleX: this.stationaryScale * 1.2,
  192 |         scaleY: this.stationaryScale * 1.2,
  193 |         duration: 140,
  194 |         ease: "Sine.easeOut",
  195 |         onComplete: () => {
  196 |           // 2) shrink down to the small moving size
  197 |           this.scene.tweens.add({
  198 |             targets: this.dot,
  199 |             scaleX: this.movingScale,
  200 |             scaleY: this.movingScale,
  201 |             duration: 220,
  202 |             ease: "Sine.easeInOut",
  203 |             onComplete: () => {
  204 |               this.isPopping = false;
  205 |               if (this.isActive) {
  206 |                 this.startPulse();
  207 |               }
  208 |             },
  209 |           });
  210 |         },
  211 |       });
  212 | 
  213 |       this.bumpDifficulty();
  214 | 
  215 |       if (this.onSuccess) {
  216 |         this.onSuccess({
  217 |           successCount: this.successCount,
  218 |           targetSuccesses: this.targetSuccesses,
  219 |         });
  220 |       }
  221 | 
  222 |       if (this.successCount >= this.targetSuccesses) {
  223 |         this.finishGame();
  224 |       }
  225 |     } else {
  226 |       // MISS
  227 |       const brightness = this.dot.alpha;
  228 |       this.scene.tweens.add({
  229 |         targets: this.dot,
  230 |         alpha: {
  231 |           from: brightness,
  232 |           to: Math.max(this.minAlpha, brightness - 0.18),
  233 |         },
  234 |         duration: 110,
  235 |         yoyo: true,
  236 |         ease: "Sine.easeInOut",
  237 |       });
  238 |     }
  239 |   }
  240 | 
  241 |   bumpDifficulty() {
  242 |     // Gentle ramp: still noticeably harder, but not brutal.
  243 |     this.brightDuration = Math.max(1100, this.brightDuration * 0.96);
  244 |     this.threshold = Math.min(0.82, this.threshold + 0.01);
  245 |     this.ghostChance = Math.min(0.25, this.ghostChance + 0.01);
  246 |   }
  247 | 
  248 |   finishGame() {
  249 |     if (!this.isActive) return;
  250 |     this.isActive = false;
  251 | 
  252 |     if (this.pulseTween) this.pulseTween.stop();
  253 |     if (this.moveTween) this.moveTween.stop();
  254 | 
  255 |     if (this.onComplete) {
  256 |       this.onComplete({
  257 |         successCount: this.successCount,
  258 |         targetSuccesses: this.targetSuccesses,
  259 |       });
  260 |     }
  261 |   }
  262 | 
  263 |   update() {}
  264 | 
  265 |   destroy() {
  266 |     this.isActive = false;
  267 |     if (this.pulseTween) this.pulseTween.stop();
  268 |     if (this.moveTween) this.moveTween.stop();
  269 | 
  270 |     if (this.dot && this.pointerHandler) {
  271 |       this.dot.off("pointerdown", this.pointerHandler);
  272 |     }
  273 | 
  274 |     if (this.particles) {
  275 |       this.particles.destroy();
  276 |     }
  277 |     if (this.dot) this.dot.destroy();
  278 |   }
  279 | }
  280 | 

/* =====================================================================================
   FILE: app/phaser/games/tap-when-white-game.js
   ===================================================================================== */

    1 | /*
    2 | /app/phaser/games/tap-when-white-game.js
    3 | Implements the Tap When White reflex mini-game including scoring and timing.
    4 | */
    5 | // phaser/games/tap-when-white-game.js
    6 | 
    7 | export default class TapWhenWhiteGame {
    8 |   constructor(scene, { onComplete, onSuccess }) {
    9 |     this.scene = scene;
   10 |     this.onComplete = onComplete;
   11 |     this.onSuccess = onSuccess;
   12 | 
   13 |     this.successCount = 0;
   14 |     this.targetSuccesses = 10;
   15 |     this.isActive = true;
   16 | 
   17 |     const { width, height } = scene.scale;
   18 | 
   19 |     // White overlay whose alpha we pulse 0 → 1
   20 |     this.whiteOverlay = scene.add.rectangle(
   21 |       width / 2,
   22 |       height / 2,
   23 |       width,
   24 |       height,
   25 |       0xffffff,
   26 |       1
   27 |     );
   28 |     this.whiteOverlay.setAlpha(0);
   29 |     scene.gameLayer.add(this.whiteOverlay);
   30 | 
   31 |     this.threshold = 0.7;
   32 |     this.canScore = false;
   33 |     this.lastAlpha = 0;
   34 | 
   35 |     this.tween = scene.tweens.add({
   36 |       targets: this.whiteOverlay,
   37 |       alpha: { from: 0, to: 1 },
   38 |       duration: 1500,
   39 |       yoyo: true,
   40 |       repeat: -1,
   41 |       ease: "Sine.easeInOut",
   42 |       onUpdate: (tween, target) => {
   43 |         const a = target.alpha;
   44 |         if (this.lastAlpha < this.threshold && a >= this.threshold) {
   45 |           this.canScore = true;
   46 |         }
   47 |         this.lastAlpha = a;
   48 |       },
   49 |     });
   50 | 
   51 |     this.pointerHandler = (pointer) => this.handleTap(pointer);
   52 |     scene.input.on("pointerdown", this.pointerHandler);
   53 |   }
   54 | 
   55 |   handleTap() {
   56 |     if (!this.isActive) return;
   57 | 
   58 |     const brightness = this.whiteOverlay.alpha;
   59 | 
   60 |     if (brightness >= this.threshold && this.canScore) {
   61 |       this.canScore = false;
   62 |       this.successCount++;
   63 | 
   64 |       this.scene.tweens.add({
   65 |         targets: this.whiteOverlay,
   66 |         scaleX: 1.02,
   67 |         scaleY: 1.02,
   68 |         yoyo: true,
   69 |         duration: 120,
   70 |       });
   71 | 
   72 |       if (this.onSuccess) {
   73 |         this.onSuccess({
   74 |           successCount: this.successCount,
   75 |           targetSuccesses: this.targetSuccesses,
   76 |         });
   77 |       }
   78 | 
   79 |       if (this.successCount >= this.targetSuccesses) {
   80 |         this.finishGame();
   81 |       }
   82 |     } else {
   83 |       this.scene.tweens.add({
   84 |         targets: this.whiteOverlay,
   85 |         alpha: { from: brightness, to: Math.max(0, brightness - 0.2) },
   86 |         yoyo: true,
   87 |         duration: 90,
   88 |       });
   89 |     }
   90 |   }
   91 | 
   92 |   finishGame() {
   93 |     if (!this.isActive) return;
   94 |     this.isActive = false;
   95 | 
   96 |     if (this.tween) this.tween.stop();
   97 | 
   98 |     if (this.onComplete) {
   99 |       this.onComplete({
  100 |         successCount: this.successCount,
  101 |         targetSuccesses: this.targetSuccesses,
  102 |       });
  103 |     }
  104 |   }
  105 | 
  106 |   update() {}
  107 | 
  108 |   destroy() {
  109 |     this.isActive = false;
  110 |     if (this.tween) this.tween.stop();
  111 |     if (this.scene && this.pointerHandler) {
  112 |       this.scene.input.off("pointerdown", this.pointerHandler);
  113 |     }
  114 |     if (this.whiteOverlay) this.whiteOverlay.destroy();
  115 |   }
  116 | }
  117 | 

/* =====================================================================================
   FILE: app/phaser/induction-arcade-game.js
   ===================================================================================== */

    1 | /*
    2 | /app/phaser/induction-arcade-game.js
    3 | Coordinates initialization of Phaser scenes and audio for the induction arcade.
    4 | */
    5 | // phaser/induction-arcade-game.js
    6 | import InductionArcadeScene from "./induction-arcade-scene.js";
    7 | import SpiralPostFXPipeline from "./spiral-postfx-pipeline.js";
    8 | 
    9 | let arcadeGame = null;
   10 | let arcadeScene = null;
   11 | let readyCallbacks = [];
   12 | 
   13 | function handleSceneReady(sceneInstance, onGameEvent) {
   14 |   arcadeScene = sceneInstance;
   15 | 
   16 |   if (arcadeScene && onGameEvent) {
   17 |     arcadeScene.externalEventHandler = onGameEvent;
   18 |   }
   19 | 
   20 |   if (arcadeScene && readyCallbacks.length) {
   21 |     readyCallbacks.forEach((cb) => cb(arcadeScene));
   22 |     readyCallbacks = [];
   23 |   }
   24 | }
   25 | 
   26 | function listenForSceneReady(onGameEvent) {
   27 |   const sceneInstance = arcadeGame?.scene?.keys?.["InductionArcadeScene"];
   28 | 
   29 |   if (!sceneInstance) return;
   30 | 
   31 |   const scenePlugin = sceneInstance.scene;
   32 |   const sceneIsActive =
   33 |     scenePlugin && typeof scenePlugin.isActive === "function"
   34 |       ? scenePlugin.isActive()
   35 |       : false;
   36 | 
   37 |   if (sceneIsActive) {
   38 |     handleSceneReady(sceneInstance, onGameEvent);
   39 |     return;
   40 |   }
   41 | 
   42 |   sceneInstance.events.once("ready", () => {
   43 |     handleSceneReady(sceneInstance, onGameEvent);
   44 |   });
   45 | }
   46 | 
   47 | // ----------------- Sizing helpers -----------------
   48 | 
   49 | function calculateGameDimensions() {
   50 |   const viewportWidth = window.innerWidth;
   51 |   const viewportHeight = window.innerHeight;
   52 | 
   53 |   const maxHeight = 720;
   54 |   const targetHeight = Math.min(viewportHeight, maxHeight);
   55 | 
   56 |   const windowAspect = viewportWidth / viewportHeight;
   57 |   const maxAspect = 1; // always taller than wide
   58 |   const targetAspect = Math.min(windowAspect, maxAspect);
   59 | 
   60 |   const targetWidth = Math.round(targetHeight * targetAspect);
   61 | 
   62 |   return { width: targetWidth, height: targetHeight };
   63 | }
   64 | 
   65 | function resizeCanvas(game) {
   66 |   if (!game) return;
   67 | 
   68 |   const { width, height } = calculateGameDimensions();
   69 |   game.scale.resize(width, height);
   70 | 
   71 |   const canvas = game.canvas;
   72 |   if (canvas) {
   73 |     canvas.style.height = "100vh";
   74 |     canvas.style.width = "auto";
   75 |     canvas.style.maxHeight = "100vh";
   76 |     canvas.style.maxWidth = "calc(100vh)";
   77 |   }
   78 | }
   79 | 
   80 | // ----------------- Arcade init / accessors -----------------
   81 | 
   82 | export function initArcadeGame({ onGameEvent } = {}) {
   83 |   if (arcadeGame) {
   84 |     // already created
   85 |     if (arcadeScene && onGameEvent) {
   86 |       arcadeScene.externalEventHandler = onGameEvent;
   87 |     }
   88 |     return { game: arcadeGame, scene: arcadeScene };
   89 |   }
   90 | 
   91 |   const { width, height } = calculateGameDimensions();
   92 | 
   93 |   const config = {
   94 |     type: Phaser.AUTO,
   95 |     width,
   96 |     height,
   97 |     parent: "game",
   98 |     backgroundColor: "#000000",
   99 |     scale: {
  100 |       mode: Phaser.Scale.NONE,
  101 |     },
  102 |     // Register the spiral as a PostFX pipeline so the scene can use camera.setPostPipeline("SpiralPostFX")
  103 |     pipeline: {
  104 |       SpiralPostFX: SpiralPostFXPipeline,
  105 |     },
  106 |     scene: [InductionArcadeScene],
  107 |   };
  108 | 
  109 |   arcadeGame = new Phaser.Game(config);
  110 |   resizeCanvas(arcadeGame);
  111 | 
  112 |   listenForSceneReady(onGameEvent);
  113 | 
  114 |   window.addEventListener("resize", () => resizeCanvas(arcadeGame));
  115 | 
  116 |   return { game: arcadeGame, scene: arcadeScene };
  117 | }
  118 | 
  119 | export function getArcadeScene() {
  120 |   return arcadeScene;
  121 | }
  122 | 
  123 | export function onArcadeReady(cb) {
  124 |   if (arcadeScene) {
  125 |     cb(arcadeScene);
  126 |   } else {
  127 |     readyCallbacks.push(cb);
  128 |   }
  129 | }
  130 | 

/* =====================================================================================
   FILE: app/phaser/induction-arcade-scene.js
   ===================================================================================== */

    1 | /*
    2 | /app/phaser/induction-arcade-scene.js
    3 | Defines the primary Phaser scene orchestrating visual effects and game progression.
    4 | */
    5 | // phaser/induction-arcade-scene.js
    6 | import TapWhenWhiteGame from "./games/tap-when-white-game.js";
    7 | import FollowTheFadeGame from "./games/follow-the-fade-game.js";
    8 | 
    9 | export default class InductionArcadeScene extends Phaser.Scene {
   10 |   constructor() {
   11 |     super({ key: "InductionArcadeScene" });
   12 |     this.mode = "idle"; // 'idle' | 'inductionArcade'
   13 |     this.externalEventHandler = null;
   14 |     this.currentMinigame = null;
   15 |     this.spiralTween = null;
   16 |     this.sequenceStage = 0;
   17 |   }
   18 | 
   19 |   preload() {}
   20 | 
   21 |   create() {
   22 |     this.bgLayer = this.add.container(0, 0);
   23 |     this.gameLayer = this.add.container(0, 0);
   24 | 
   25 |     this.createIdleBackground();
   26 | 
   27 |     this.events.emit("ready");
   28 |     console.log("InductionArcadeScene created");
   29 |   }
   30 | 
   31 |   createIdleBackground() {
   32 |     // Simple black bg; spiral is handled by postFX
   33 |     this.bgLayer.removeAll(true);
   34 | 
   35 |     const g = this.add.graphics();
   36 |     g.fillStyle(0x000000, 1);
   37 |     g.fillRect(0, 0, this.scale.width, this.scale.height);
   38 |     this.bgLayer.add(g);
   39 | 
   40 |     // Idle spiral: very subtle
   41 |     this.setSpiralOpacity(0.01, { duration: 0 });
   42 |   }
   43 | 
   44 |   getSpiralPipeline() {
   45 |     if (!this.cameras || !this.cameras.main) return null;
   46 | 
   47 |     const cam = this.cameras.main;
   48 |     let pipeline = cam.getPostPipeline("SpiralPostFX");
   49 | 
   50 |     if (Array.isArray(pipeline)) {
   51 |       pipeline = pipeline[0];
   52 |     }
   53 | 
   54 |     if (!pipeline) {
   55 |       cam.setPostPipeline("SpiralPostFX");
   56 |       pipeline = cam.getPostPipeline("SpiralPostFX");
   57 |       if (Array.isArray(pipeline)) {
   58 |         pipeline = pipeline[0];
   59 |       }
   60 |     }
   61 | 
   62 |     return pipeline || null;
   63 |   }
   64 | 
   65 |   setSpiralOpacity(targetOpacity, { duration = 0 } = {}) {
   66 |     const pipeline = this.getSpiralPipeline();
   67 |     if (!pipeline) return;
   68 | 
   69 |     const clamped = Phaser.Math.Clamp(targetOpacity, 0, 1);
   70 | 
   71 |     if (this.spiralTween) {
   72 |       this.spiralTween.stop();
   73 |       this.spiralTween = null;
   74 |     }
   75 | 
   76 |     if (duration > 0) {
   77 |       this.spiralTween = this.tweens.add({
   78 |         targets: pipeline,
   79 |         overlay: clamped,
   80 |         duration,
   81 |         ease: "Sine.easeInOut",
   82 |         onComplete: () => {
   83 |           pipeline.setOverlay(clamped);
   84 |           this.spiralTween = null;
   85 |         },
   86 |       });
   87 |     } else {
   88 |       pipeline.setOverlay(clamped);
   89 |     }
   90 |   }
   91 | 
   92 |   setMode(mode, config = {}) {
   93 |     if (this.mode === mode) return;
   94 |     this.mode = mode;
   95 | 
   96 |     this.clearCurrentMinigame();
   97 | 
   98 |     if (mode === "idle") {
   99 |       this.createIdleBackground();
  100 |       return;
  101 |     }
  102 | 
  103 |     if (mode === "inductionArcade") {
  104 |       this.startArcade(config);
  105 |     }
  106 |   }
  107 | 
  108 |   startArcade(config) {
  109 |     const {
  110 |       spiralOpacity = 0.2,
  111 |       spiralFadeIn = false,
  112 |       spiralFadeDuration = 1000,
  113 |       initialGame = "tapWhenWhite",
  114 |       autoStart = true,
  115 |       final = false,
  116 |     } = config;
  117 | 
  118 |     // Set spiral level for the minigame
  119 |     if (spiralFadeIn) {
  120 |       this.setSpiralOpacity(0, { duration: 0 });
  121 |       this.setSpiralOpacity(spiralOpacity, { duration: spiralFadeDuration });
  122 |     } else {
  123 |       this.setSpiralOpacity(spiralOpacity, { duration: 0 });
  124 |     }
  125 | 
  126 |     this.sequenceStage = 0;
  127 | 
  128 |     if (autoStart) {
  129 |       this.startMinigame(initialGame, { final });
  130 |     }
  131 |   }
  132 | 
  133 |   startMinigame(gameId, { final = false } = {}) {
  134 |     if (!gameId) return;
  135 | 
  136 |     if (gameId === "tapWhenWhite") {
  137 |       this.startTapWhenWhite({ final });
  138 |       return;
  139 |     }
  140 | 
  141 |     if (gameId === "followTheFade") {
  142 |       this.startFollowTheFade({ final });
  143 |     }
  144 |   }
  145 | 
  146 |   clearCurrentMinigame() {
  147 |     if (this.currentMinigame && this.currentMinigame.destroy) {
  148 |       this.currentMinigame.destroy();
  149 |       this.currentMinigame = null;
  150 |     }
  151 |     if (this.gameLayer) {
  152 |       this.gameLayer.removeAll(true);
  153 |     }
  154 |   }
  155 | 
  156 |   startTapWhenWhite({ final = false } = {}) {
  157 |     this.clearCurrentMinigame();
  158 | 
  159 |     this.currentMinigame = new TapWhenWhiteGame(this, {
  160 |       onComplete: (result) => {
  161 |         this.handleMinigameComplete("tapWhenWhite", result, { final });
  162 |       },
  163 |       onSuccess: (payload) => {
  164 |         this.handleMinigameSuccess("tapWhenWhite", payload);
  165 |       },
  166 |     });
  167 |   }
  168 | 
  169 |   startFollowTheFade({ final = true } = {}) {
  170 |     this.clearCurrentMinigame();
  171 | 
  172 |     this.currentMinigame = new FollowTheFadeGame(this, {
  173 |       onComplete: (result) => {
  174 |         this.handleMinigameComplete("followTheFade", result, { final });
  175 |       },
  176 |       onSuccess: (payload) => {
  177 |         this.handleMinigameSuccess("followTheFade", payload);
  178 |       },
  179 |     });
  180 |   }
  181 | 
  182 |   handleMinigameSuccess(id, payload) {
  183 |     this.emitGameEvent("minigame/success", { id, ...payload });
  184 |   }
  185 | 
  186 |   handleMinigameComplete(id, result, { final = false } = {}) {
  187 |     this.emitGameEvent("minigame/complete", {
  188 |       id,
  189 |       ...result,
  190 |       final,
  191 |     });
  192 | 
  193 |     this.clearCurrentMinigame();
  194 | 
  195 |     if (!final) {
  196 |       this.sequenceStage += 1;
  197 |       this.tweens.add({
  198 |         targets: this.cameras.main,
  199 |         zoom: 1.015,
  200 |         yoyo: true,
  201 |         duration: 280,
  202 |         ease: "Sine.easeInOut",
  203 |       });
  204 |       return;
  205 |     }
  206 |     this.setMode("idle");
  207 |   }
  208 | 
  209 |   emitGameEvent(type, payload) {
  210 |     if (this.externalEventHandler) {
  211 |       this.externalEventHandler({ type, payload });
  212 |     }
  213 |   }
  214 | 
  215 |   update(time, delta) {
  216 |     if (this.currentMinigame && this.currentMinigame.update) {
  217 |       this.currentMinigame.update(time, delta);
  218 |     }
  219 |   }
  220 | }
  221 | 

/* =====================================================================================
   FILE: app/phaser/spiral-postfx-pipeline.js
   ===================================================================================== */

    1 | /*
    2 | /app/phaser/spiral-postfx-pipeline.js
    3 | Implements a custom Phaser post-processing pipeline for spiral visual effects.
    4 | */
    5 | // phaser/spiral-postfx-pipeline.js
    6 | export default class SpiralPostFXPipeline extends Phaser.Renderer.WebGL
    7 |   .Pipelines.PostFXPipeline {
    8 |   constructor(game) {
    9 |     super({
   10 |       game,
   11 |       name: "SpiralPostFX",
   12 |       fragShader: `
   13 |         precision mediump float;
   14 | 
   15 |         uniform sampler2D uMainSampler;
   16 |         uniform vec2 uResolution;
   17 |         uniform float uTime;
   18 |         uniform float uOverlay; // 0..1
   19 | 
   20 |         varying vec2 outTexCoord;
   21 | 
   22 |         void main() {
   23 |           // Base scene color
   24 |           vec3 sceneColor = texture2D(uMainSampler, outTexCoord).rgb;
   25 | 
   26 |           // Spiral coords in screen space
   27 |           vec2 uv = gl_FragCoord.xy / uResolution;
   28 |           vec2 p = uv - 0.5;
   29 |           float aspect = uResolution.x / uResolution.y;
   30 |           p.x *= aspect;
   31 | 
   32 |           float r = length(p);
   33 |           float angle = atan(p.y, p.x);
   34 | 
   35 |           float arms  = 4.0;
   36 |           float twist = 12.0;
   37 |           float speed = 3.5;
   38 | 
   39 |           float theta = angle + r * twist - uTime * speed;
   40 |           float v = sin(theta * arms);
   41 | 
   42 |           // Soft grayscale 0..1
   43 |           float stripes = 0.5 + 0.5 * v;
   44 | 
   45 |           // Use overlay as "how much spiral to mix in"
   46 |           float intensity = mix(0.5, stripes, 0.8); // 0.5..spiral, fixed contrast
   47 |           vec3 spiralColor = vec3(intensity);
   48 | 
   49 |           vec3 finalColor = mix(sceneColor, spiralColor, uOverlay);
   50 | 
   51 |           gl_FragColor = vec4(finalColor, 1.0);
   52 |         }
   53 |       `,
   54 |     });
   55 | 
   56 |     this.overlay = 0.0; // default subtlety
   57 |   }
   58 | 
   59 |   onPreRender() {
   60 |     const res = this.renderer;
   61 |     this.set2f("uResolution", res.width, res.height);
   62 |     this.set1f("uTime", this.game.loop.time / 1000.0);
   63 |     this.set1f("uOverlay", this.overlay);
   64 |   }
   65 | 
   66 |   setOverlay(value) {
   67 |     this.overlay = Phaser.Math.Clamp(value, 0, 1);
   68 |   }
   69 | }
   70 | 

/* =====================================================================================
   FILE: app/scripts/get-all-code.js
   ===================================================================================== */

    1 | /* /app/scripts/get-all-code.js
    2 |    Reads all source code files under a project folder (recursively),
    3 |    ignoring the "/lib" folder, and writes the combined output to a single file.
    4 | */
    5 | 
    6 | "use strict";
    7 | 
    8 | const fs = require("node:fs");
    9 | const path = require("node:path");
   10 | 
   11 | function normalizePathForOutput(filePath) {
   12 |   return filePath.split(path.sep).join("/");
   13 | }
   14 | 
   15 | function shouldIgnorePath(absolutePath, ignoreAbsolutePaths) {
   16 |   const resolved = path.resolve(absolutePath);
   17 |   return ignoreAbsolutePaths.some((ignored) => {
   18 |     const ignoredResolved = path.resolve(ignored);
   19 |     return resolved === ignoredResolved || resolved.startsWith(ignoredResolved + path.sep);
   20 |   });
   21 | }
   22 | 
   23 | function isProbablyTextFileByExtension(filePath, allowedExtensionsLowerCase) {
   24 |   const extension = path.extname(filePath).toLowerCase();
   25 |   return allowedExtensionsLowerCase.has(extension);
   26 | }
   27 | 
   28 | function readDirectoryRecursively(options) {
   29 |   const {
   30 |     rootDirectoryAbsolutePath,
   31 |     ignoreAbsolutePaths,
   32 |     allowedExtensionsLowerCase,
   33 |     maxFileSizeBytes,
   34 |   } = options;
   35 | 
   36 |   /** @type {string[]} */
   37 |   const collectedFilePaths = [];
   38 | 
   39 |   /** @type {string[]} */
   40 |   const directoriesToVisit = [rootDirectoryAbsolutePath];
   41 | 
   42 |   while (directoriesToVisit.length > 0) {
   43 |     const currentDirectory = directoriesToVisit.pop();
   44 | 
   45 |     if (!currentDirectory) continue;
   46 |     if (shouldIgnorePath(currentDirectory, ignoreAbsolutePaths)) continue;
   47 | 
   48 |     let dirEntries;
   49 |     try {
   50 |       dirEntries = fs.readdirSync(currentDirectory, { withFileTypes: true });
   51 |     } catch (error) {
   52 |       // If something is unreadable (permissions), skip it.
   53 |       continue;
   54 |     }
   55 | 
   56 |     for (const dirent of dirEntries) {
   57 |       const absoluteEntryPath = path.join(currentDirectory, dirent.name);
   58 | 
   59 |       if (shouldIgnorePath(absoluteEntryPath, ignoreAbsolutePaths)) {
   60 |         continue;
   61 |       }
   62 | 
   63 |       // Skip hidden folders/files (like .git, .DS_Store) by default.
   64 |       if (dirent.name.startsWith(".")) {
   65 |         continue;
   66 |       }
   67 | 
   68 |       if (dirent.isDirectory()) {
   69 |         directoriesToVisit.push(absoluteEntryPath);
   70 |         continue;
   71 |       }
   72 | 
   73 |       if (!dirent.isFile()) continue;
   74 | 
   75 |       if (!isProbablyTextFileByExtension(absoluteEntryPath, allowedExtensionsLowerCase)) {
   76 |         continue;
   77 |       }
   78 | 
   79 |       let fileStats;
   80 |       try {
   81 |         fileStats = fs.statSync(absoluteEntryPath);
   82 |       } catch (error) {
   83 |         continue;
   84 |       }
   85 | 
   86 |       if (fileStats.size > maxFileSizeBytes) {
   87 |         // Skip giant files so the output stays manageable.
   88 |         continue;
   89 |       }
   90 | 
   91 |       collectedFilePaths.push(absoluteEntryPath);
   92 |     }
   93 |   }
   94 | 
   95 |   collectedFilePaths.sort((a, b) => a.localeCompare(b));
   96 |   return collectedFilePaths;
   97 | }
   98 | 
   99 | function buildCombinedOutput(options) {
  100 |   const { rootDirectoryAbsolutePath, filePathsAbsolute, includeLineNumbers } = options;
  101 | 
  102 |   const chunks = [];
  103 |   chunks.push(
  104 |     [
  105 |       "/*",
  106 |       "  Combined project source export",
  107 |       `  Root: ${normalizePathForOutput(rootDirectoryAbsolutePath)}`,
  108 |       `  Generated: ${new Date().toISOString()}`,
  109 |       "*/",
  110 |       "",
  111 |     ].join("\n"),
  112 |   );
  113 | 
  114 |   for (const absoluteFilePath of filePathsAbsolute) {
  115 |     const relativeFilePath = path.relative(rootDirectoryAbsolutePath, absoluteFilePath);
  116 |     const relativeFilePathNormalized = normalizePathForOutput(relativeFilePath);
  117 | 
  118 |     let fileContents;
  119 |     try {
  120 |       fileContents = fs.readFileSync(absoluteFilePath, "utf8");
  121 |     } catch (error) {
  122 |       continue;
  123 |     }
  124 | 
  125 |     // Normalize newlines for consistent copy/paste.
  126 |     const normalizedContents = fileContents.replace(/\r\n/g, "\n");
  127 | 
  128 |     chunks.push(
  129 |       [
  130 |         "",
  131 |         "/* =====================================================================================",
  132 |         `   FILE: ${relativeFilePathNormalized}`,
  133 |         "   ===================================================================================== */",
  134 |         "",
  135 |       ].join("\n"),
  136 |     );
  137 | 
  138 |     if (!includeLineNumbers) {
  139 |       chunks.push(normalizedContents);
  140 |       continue;
  141 |     }
  142 | 
  143 |     const lines = normalizedContents.split("\n");
  144 |     const numberedLines = lines.map((line, index) => {
  145 |       const lineNumber = String(index + 1).padStart(5, " ");
  146 |       return `${lineNumber} | ${line}`;
  147 |     });
  148 |     chunks.push(numberedLines.join("\n"));
  149 |   }
  150 | 
  151 |   chunks.push("");
  152 |   return chunks.join("\n");
  153 | }
  154 | 
  155 | function parseCommandLineArguments() {
  156 |   const args = process.argv.slice(2);
  157 | 
  158 |   const parsed = {
  159 |     root: process.cwd(),
  160 |     out: path.join(process.cwd(), "ALL_CODE.txt"),
  161 |     includeLineNumbers: false,
  162 |   };
  163 | 
  164 |   for (let index = 0; index < args.length; index += 1) {
  165 |     const arg = args[index];
  166 | 
  167 |     if (arg === "--root") {
  168 |       parsed.root = args[index + 1] ? path.resolve(args[index + 1]) : parsed.root;
  169 |       index += 1;
  170 |       continue;
  171 |     }
  172 | 
  173 |     if (arg === "--out") {
  174 |       parsed.out = args[index + 1] ? path.resolve(args[index + 1]) : parsed.out;
  175 |       index += 1;
  176 |       continue;
  177 |     }
  178 | 
  179 |     if (arg === "--line-numbers") {
  180 |       parsed.includeLineNumbers = true;
  181 |       continue;
  182 |     }
  183 | 
  184 |     if (arg === "--help" || arg === "-h") {
  185 |       return { ...parsed, help: true };
  186 |     }
  187 |   }
  188 | 
  189 |   return parsed;
  190 | }
  191 | 
  192 | function main() {
  193 |   const parsedArguments = parseCommandLineArguments();
  194 | 
  195 |   if (parsedArguments.help) {
  196 |     console.log(`
  197 | Usage:
  198 |   node app/scripts/get-all-code.js [--root <path>] [--out <file>] [--line-numbers]
  199 | 
  200 | Examples:
  201 |   node app/scripts/get-all-code.js
  202 |   node app/scripts/get-all-code.js --root . --out ALL_CODE.txt
  203 |   node app/scripts/get-all-code.js --root ./app --out ./exports/ALL_CODE.txt --line-numbers
  204 | 
  205 | Notes:
  206 |   - Skips hidden folders/files (anything starting with ".")
  207 |   - Ignores the "/lib" folder at the root of --root (external libraries)
  208 |   - Skips files larger than 2 MB (adjust in script if needed)
  209 | `);
  210 |     process.exit(0);
  211 |   }
  212 | 
  213 |   const rootDirectoryAbsolutePath = path.resolve(parsedArguments.root);
  214 | 
  215 |   const ignoreAbsolutePaths = [
  216 |     path.join(rootDirectoryAbsolutePath, "lib"),
  217 |     path.join(rootDirectoryAbsolutePath, "node_modules"),
  218 |     path.join(rootDirectoryAbsolutePath, "dist"),
  219 |     path.join(rootDirectoryAbsolutePath, "build"),
  220 |     path.join(rootDirectoryAbsolutePath, "coverage"),
  221 |     path.join(rootDirectoryAbsolutePath, ".git"),
  222 |   ];
  223 | 
  224 |   const allowedExtensionsLowerCase = new Set([
  225 |     ".js",
  226 |     ".mjs",
  227 |     ".cjs",
  228 |     ".ts",
  229 |     ".tsx",
  230 |     ".jsx",
  231 |     ".json",
  232 |     ".css",
  233 |     ".scss",
  234 |     ".sass",
  235 |     ".less",
  236 |     ".html",
  237 |     ".htm",
  238 |     ".md",
  239 |     ".yml",
  240 |     ".yaml",
  241 |     ".txt",
  242 |     ".glsl",
  243 |     ".frag",
  244 |     ".vert",
  245 |   ]);
  246 | 
  247 |   const maxFileSizeBytes = 2 * 1024 * 1024; // 2 MB
  248 | 
  249 |   const filePathsAbsolute = readDirectoryRecursively({
  250 |     rootDirectoryAbsolutePath,
  251 |     ignoreAbsolutePaths,
  252 |     allowedExtensionsLowerCase,
  253 |     maxFileSizeBytes,
  254 |   });
  255 | 
  256 |   const combinedOutput = buildCombinedOutput({
  257 |     rootDirectoryAbsolutePath,
  258 |     filePathsAbsolute,
  259 |     includeLineNumbers: parsedArguments.includeLineNumbers,
  260 |   });
  261 | 
  262 |   const outFileAbsolutePath = path.resolve(parsedArguments.out);
  263 |   const outDirectory = path.dirname(outFileAbsolutePath);
  264 | 
  265 |   fs.mkdirSync(outDirectory, { recursive: true });
  266 |   fs.writeFileSync(outFileAbsolutePath, combinedOutput, "utf8");
  267 | 
  268 |   console.log(`Wrote ${filePathsAbsolute.length} files into: ${outFileAbsolutePath}`);
  269 | }
  270 | 
  271 | main();
  272 | 

/* =====================================================================================
   FILE: app/store/induction-arcade-store.js
   ===================================================================================== */

    1 | /*
    2 | /app/store/induction-arcade-store.js
    3 | Handles game lifecycle state and user progress for the induction arcade experience.
    4 | */
    5 | // store/induction-arcade-store.js
    6 | import { onArcadeReady } from "../phaser/induction-arcade-game.js";
    7 | import {
    8 |   DEFAULT_LEFT_FREQUENCY,
    9 |   DEFAULT_RIGHT_FREQUENCY,
   10 |   startBinauralBeat,
   11 |   stopBinauralBeat,
   12 |   updateBinauralBeat,
   13 |   warmBinauralBeatContext,
   14 | } from "../audio/binaural-beat.js";
   15 | import {
   16 |   complianceInstructions,
   17 |   complianceLikertLabels,
   18 |   complianceLikertOptions,
   19 | } from "../data/compliance-questions.js";
   20 | import {
   21 |   BASE_SPIRAL_INTENSITY,
   22 |   BEAT_INTENSITY_BASE,
   23 |   BEAT_INTENSITY_SCALE,
   24 |   DEFAULT_STARTING_GAME,
   25 |   DEPTH_INCREMENT_PER_SUCCESS,
   26 |   GAME_IDS,
   27 |   MAX_DEPTH_LEVEL,
   28 |   PHASES,
   29 |   SPIRAL_SCALE_PER_DEPTH,
   30 |   TIMING,
   31 | } from "../data/induction-arcade-constants.js";
   32 | import { ContentDirector } from "../directors/content-director.js";
   33 | 
   34 | // ----------------- Helpers -----------------
   35 | 
   36 | function clearIntermissionSurveyTimeouts(state) {
   37 |   const timeoutIds = state.inductionArcade?.surveyTimeoutIds || [];
   38 |   timeoutIds.forEach((timeoutId) => {
   39 |     clearTimeout(timeoutId);
   40 |   });
   41 |   state.inductionArcade.surveyTimeoutIds = [];
   42 | }
   43 | 
   44 | function trackIntermissionSurveyTimeout(state, timeoutId) {
   45 |   state.inductionArcade.surveyTimeoutIds = [
   46 |     ...(state.inductionArcade.surveyTimeoutIds || []),
   47 |     timeoutId,
   48 |   ];
   49 | }
   50 | 
   51 | function removeIntermissionSurveyTimeout(state, timeoutId) {
   52 |   state.inductionArcade.surveyTimeoutIds = (
   53 |     state.inductionArcade.surveyTimeoutIds || []
   54 |   ).filter((id) => id !== timeoutId);
   55 | }
   56 | 
   57 | function clearAffirmationTimeout(state) {
   58 |   if (!state.inductionArcade?.affirmationTimeoutId) return;
   59 | 
   60 |   clearTimeout(state.inductionArcade.affirmationTimeoutId);
   61 |   state.inductionArcade.affirmationTimeoutId = null;
   62 | }
   63 | 
   64 | function calculateBeatFrequencies(depthLevel = 0) {
   65 |   const adjustment = depthLevel * 2;
   66 |   return {
   67 |     leftFrequency: DEFAULT_LEFT_FREQUENCY + adjustment,
   68 |     rightFrequency: DEFAULT_RIGHT_FREQUENCY + adjustment,
   69 |   };
   70 | }
   71 | 
   72 | function deriveEnvironmentFromDepth(depthLevel = 0) {
   73 |   return {
   74 |     depthLevel,
   75 |     spiralIntensity: BASE_SPIRAL_INTENSITY + depthLevel * SPIRAL_SCALE_PER_DEPTH,
   76 |     beatIntensity: BEAT_INTENSITY_BASE + depthLevel * BEAT_INTENSITY_SCALE,
   77 |   };
   78 | }
   79 | 
   80 | function createIntermissionSurveyState({ active = false, depth = 0 } = {}) {
   81 |   return {
   82 |     instructions: complianceInstructions,
   83 |     likertOptions: complianceLikertOptions,
   84 |     likertLabels: complianceLikertLabels,
   85 |     questions: ContentDirector.getSurvey({ depth, count: 5 }),
   86 |     currentIndex: 0,
   87 |     responses: {},
   88 |     lastAffirmation: "",
   89 |     animPhase: "idle",
   90 |     selectedValue: null,
   91 |     selectedQuestionId: null,
   92 |     active,
   93 |   };
   94 | }
   95 | 
   96 | function resetBeatState(state) {
   97 |   state.inductionArcade.binauralBeat = {
   98 |     leftFrequency: DEFAULT_LEFT_FREQUENCY,
   99 |     rightFrequency: DEFAULT_RIGHT_FREQUENCY,
  100 |     playing: false,
  101 |   };
  102 | }
  103 | 
  104 | function resetIntermissionSurvey(state, { active = false } = {}) {
  105 |   clearIntermissionSurveyTimeouts(state);
  106 |   const depth = ContentDirector.normalizeDepth(state.conditioning?.depth || 0);
  107 |   state.inductionArcade.survey = createIntermissionSurveyState({
  108 |     active,
  109 |     depth,
  110 |   });
  111 | }
  112 | 
  113 | function createInterjectionState() {
  114 |   return {
  115 |     active: false,
  116 |     type: null,
  117 |     steps: [],
  118 |     currentIndex: 0,
  119 |     nextType: "focus",
  120 |   };
  121 | }
  122 | 
  123 | function resetInterjection(state) {
  124 |   state.inductionArcade.interjection = createInterjectionState();
  125 | }
  126 | 
  127 | function getDepth(state) {
  128 |   const currentDepth = state.conditioning?.depth ?? state.inductionArcade?.env?.depthLevel;
  129 |   return ContentDirector.normalizeDepth(currentDepth || 0);
  130 | }
  131 | 
  132 | function normalizeGameId(raw) {
  133 |   if (!raw) return null;
  134 | 
  135 |   const str = `${raw}`.trim();
  136 | 
  137 |   // Already-normalized IDs
  138 |   if (str === GAME_IDS.TAP_WHEN_WHITE || str === GAME_IDS.FOLLOW_THE_FADE) {
  139 |     return str;
  140 |   }
  141 | 
  142 |   const normalized = str
  143 |     .toLowerCase()
  144 |     .replace(/\s+/g, "-")
  145 |     .replace(/_/g, "-");
  146 | 
  147 |   if (normalized === "tap-when-white") return "tapWhenWhite";
  148 |   if (normalized === "follow-the-fade") return "followTheFade";
  149 | 
  150 |   return null;
  151 | }
  152 | 
  153 | /**
  154 |  * Read the starting game from the URL hash, e.g.:
  155 |  *   #induction-arcade?game=follow-the-fade
  156 |  */
  157 | function parseStartingGameFromHash() {
  158 |   if (typeof window === "undefined") return null;
  159 | 
  160 |   const hash = window.location.hash || "";
  161 |   const hashParamsString = hash.includes("?") ? hash.split("?")[1] : "";
  162 |   const hashParams = new URLSearchParams(hashParamsString);
  163 |   const gameParam = hashParams.get("game");
  164 | 
  165 |   return normalizeGameId(gameParam);
  166 | }
  167 | 
  168 | function getGameOrder(startingGame) {
  169 |   const start = normalizeGameId(startingGame);
  170 | 
  171 |   if (start === GAME_IDS.FOLLOW_THE_FADE) {
  172 |     return [GAME_IDS.FOLLOW_THE_FADE, GAME_IDS.TAP_WHEN_WHITE];
  173 |   }
  174 | 
  175 |   // Default: tapWhenWhite first, then followTheFade
  176 |   return [GAME_IDS.TAP_WHEN_WHITE, GAME_IDS.FOLLOW_THE_FADE];
  177 | }
  178 | 
  179 | function setInductionArcadePhase(state, emitter, nextPhase, patch = {}) {
  180 |   clearAffirmationTimeout(state);
  181 |   if (nextPhase !== PHASES.SURVEY) {
  182 |     clearIntermissionSurveyTimeouts(state);
  183 |   }
  184 | 
  185 |   let phaseSpecificPatch = {};
  186 | 
  187 |   if (
  188 |     nextPhase === PHASES.HEADPHONES ||
  189 |     nextPhase === PHASES.INTRO
  190 |   ) {
  191 |     stopBinauralBeat();
  192 |     resetBeatState(state);
  193 |     resetIntermissionSurvey(state);
  194 |     resetInterjection(state);
  195 |     state.conditioning.depth = 0;
  196 |     phaseSpecificPatch = {
  197 |       lastAffirmation: "",
  198 |       currentGameId: null,
  199 |       nextGameId: null,
  200 |       env: deriveEnvironmentFromDepth(state.conditioning.depth),
  201 |     };
  202 |   }
  203 | 
  204 |   if (nextPhase === PHASES.INSTRUCTIONS) {
  205 |     resetIntermissionSurvey(state, { active: false });
  206 |   }
  207 | 
  208 |   if (nextPhase === PHASES.SURVEY) {
  209 |     resetIntermissionSurvey(state, { active: true });
  210 |   }
  211 | 
  212 |   if (nextPhase === PHASES.INTERJECTION) {
  213 |     resetIntermissionSurvey(state, { active: false });
  214 |   }
  215 | 
  216 |   if (nextPhase === PHASES.COMPLETE) {
  217 |     stopBinauralBeat();
  218 |     resetBeatState(state);
  219 |     resetIntermissionSurvey(state);
  220 |     resetInterjection(state);
  221 |     state.conditioning.depth = 0;
  222 |     phaseSpecificPatch = {
  223 |       lastAffirmation: "",
  224 |       currentGameId: null,
  225 |       nextGameId: null,
  226 |       env: deriveEnvironmentFromDepth(state.conditioning.depth),
  227 |     };
  228 |   }
  229 | 
  230 |   state.inductionArcade = {
  231 |     ...state.inductionArcade,
  232 |     ...phaseSpecificPatch,
  233 |     ...patch,
  234 |     phase: nextPhase,
  235 |   };
  236 | 
  237 |   emitter.emit("render");
  238 | }
  239 | 
  240 | function advanceConditioningLoop(
  241 |   state,
  242 |   emitter,
  243 |   { nextGameId = null, allowInterjection = true } = {}
  244 | ) {
  245 |   const depth = getDepth(state);
  246 |   const prospectiveInterjectionType =
  247 |     state.inductionArcade.interjection?.nextType || "focus";
  248 |   const shouldInsertInterjection = depth >= 1 && nextGameId !== null;
  249 | 
  250 |   if (allowInterjection && shouldInsertInterjection) {
  251 |     const interjectionSteps = ContentDirector.getInterjection({
  252 |       depth,
  253 |       type: prospectiveInterjectionType,
  254 |     });
  255 | 
  256 |     if (interjectionSteps.length) {
  257 |       const nextTypeAfterThis =
  258 |         prospectiveInterjectionType === "focus" ? "relaxation" : "focus";
  259 |       state.inductionArcade.interjection = {
  260 |         active: true,
  261 |         type: prospectiveInterjectionType,
  262 |         steps: interjectionSteps,
  263 |         currentIndex: 0,
  264 |         nextType: nextTypeAfterThis,
  265 |       };
  266 | 
  267 |       setInductionArcadePhase(state, emitter, PHASES.INTERJECTION, {
  268 |         interjection: state.inductionArcade.interjection,
  269 |       });
  270 |       return;
  271 |     }
  272 |   }
  273 | 
  274 |   setInductionArcadePhase(
  275 |     state,
  276 |     emitter,
  277 |     nextGameId ? PHASES.INSTRUCTIONS : PHASES.COMPLETE,
  278 |     {
  279 |       currentGameId: null,
  280 |       nextGameId,
  281 |     }
  282 |   );
  283 | }
  284 | 
  285 | // ----------------- Store -----------------
  286 | 
  287 | export default function inductionArcadeStore(state, emitter) {
  288 |   const startingFromHash = parseStartingGameFromHash();
  289 | 
  290 |   state.conditioning = state.conditioning || { depth: 0 };
  291 | 
  292 |   state.inductionArcade = state.inductionArcade || {
  293 |     active: false,
  294 |     phase: PHASES.HEADPHONES,
  295 |     env: deriveEnvironmentFromDepth(state.conditioning.depth || 0),
  296 |     startingGame: startingFromHash || DEFAULT_STARTING_GAME,
  297 |     gameOrder: getGameOrder(startingFromHash || DEFAULT_STARTING_GAME),
  298 |     currentGameId: null,
  299 |     nextGameId: null,
  300 |     lastAffirmation: "",
  301 |     affirmationTimeoutId: null,
  302 |     surveyTimeoutIds: [],
  303 |     survey: createIntermissionSurveyState({ depth: state.conditioning.depth || 0 }),
  304 |     interjection: createInterjectionState(),
  305 |     binauralBeat: {
  306 |       leftFrequency: DEFAULT_LEFT_FREQUENCY,
  307 |       rightFrequency: DEFAULT_RIGHT_FREQUENCY,
  308 |       playing: false,
  309 |     },
  310 |   };
  311 | 
  312 |   // ---- Game events coming from Phaser ----
  313 | 
  314 |   emitter.on("inductionArcade/gameEvent", (evt) => {
  315 |     const { type, payload } = evt;
  316 |     console.log("Game event from Phaser:", type, payload);
  317 | 
  318 |     if (type === "minigame/success") {
  319 |       const depth = getDepth(state);
  320 |       const newDepth = Math.min(
  321 |         MAX_DEPTH_LEVEL,
  322 |         depth + DEPTH_INCREMENT_PER_SUCCESS
  323 |       );
  324 | 
  325 |       state.conditioning.depth = newDepth;
  326 |       state.inductionArcade.env = {
  327 |         ...state.inductionArcade.env,
  328 |         ...deriveEnvironmentFromDepth(newDepth),
  329 |       };
  330 | 
  331 |       if (state.inductionArcade.binauralBeat.playing) {
  332 |         const frequencies = calculateBeatFrequencies(newDepth);
  333 |         state.inductionArcade.binauralBeat = {
  334 |           ...state.inductionArcade.binauralBeat,
  335 |           ...frequencies,
  336 |         };
  337 |         updateBinauralBeat(frequencies);
  338 |       }
  339 | 
  340 |       state.inductionArcade.lastAffirmation = ContentDirector.getAffirmation({
  341 |         depth: newDepth,
  342 |         outcome: "success",
  343 |       });
  344 | 
  345 |       clearAffirmationTimeout(state);
  346 | 
  347 |       state.inductionArcade.affirmationTimeoutId = setTimeout(() => {
  348 |         state.inductionArcade.lastAffirmation = "";
  349 |         state.inductionArcade.affirmationTimeoutId = null;
  350 |         emitter.emit("render");
  351 |       }, TIMING.AFFIRMATION_CLEAR_MS);
  352 | 
  353 |       onArcadeReady((scene) => {
  354 |         if (scene.setSpiralOpacity) {
  355 |           scene.setSpiralOpacity(state.inductionArcade.env.spiralIntensity, {
  356 |             duration: 600,
  357 |           });
  358 |         }
  359 |       });
  360 | 
  361 |       emitter.emit("render");
  362 |     }
  363 | 
  364 |     if (type === "minigame/complete") {
  365 |       const { final = true } = payload || {};
  366 | 
  367 |       if (final) {
  368 |         setInductionArcadePhase(state, emitter, PHASES.COMPLETE, {
  369 |           currentGameId: null,
  370 |           nextGameId: null,
  371 |         });
  372 |       } else {
  373 |         // Move to next game in the order, keep env.spiralIntensity
  374 |         const currentIndex = state.inductionArcade.gameOrder.indexOf(
  375 |           state.inductionArcade.currentGameId
  376 |         );
  377 |         const nextIndex = currentIndex + 1;
  378 |         const nextGame = state.inductionArcade.gameOrder[nextIndex] || null;
  379 | 
  380 |         setInductionArcadePhase(
  381 |           state,
  382 |           emitter,
  383 |           nextGame ? PHASES.SURVEY : PHASES.COMPLETE,
  384 |           {
  385 |             currentGameId: null,
  386 |             nextGameId: nextGame,
  387 |           }
  388 |         );
  389 | 
  390 |         // Re-assert spiral at current env intensity while showing survey/instructions
  391 |         onArcadeReady((scene) => {
  392 |           if (scene.setSpiralOpacity) {
  393 |             scene.setSpiralOpacity(state.inductionArcade.env.spiralIntensity, {
  394 |               duration: 800,
  395 |             });
  396 |           }
  397 |         });
  398 |       }
  399 | 
  400 |       emitter.emit("render");
  401 |     }
  402 |   });
  403 | 
  404 |   // ---- Intermission survey between minigames ----
  405 | 
  406 |   emitter.on("inductionArcade/answerSurveyQuestion", (value) => {
  407 |     const survey = state.inductionArcade.survey;
  408 |     if (!survey?.active) return;
  409 |     if (survey.animPhase !== "idle") return;
  410 | 
  411 |     clearIntermissionSurveyTimeouts(state);
  412 | 
  413 |     const question = survey.questions?.[survey.currentIndex];
  414 |     if (!question) return;
  415 | 
  416 |     const numeric = Number(value);
  417 |     const newResponses = {
  418 |       ...survey.responses,
  419 |       [question.id]: numeric,
  420 |     };
  421 | 
  422 |     const isPraise = numeric >= 4;
  423 |     const fullAffirmation = ContentDirector.getAffirmation({
  424 |       depth: getDepth(state),
  425 |       outcome: isPraise ? "success" : "neutral",
  426 |     });
  427 | 
  428 |     const nextIndex = survey.currentIndex + 1;
  429 |     const isLast = nextIndex >= (survey.questions?.length || 0);
  430 | 
  431 |     state.inductionArcade.survey = {
  432 |       ...survey,
  433 |       responses: newResponses,
  434 |       lastAffirmation: fullAffirmation,
  435 |       animPhase: "affirm",
  436 |       selectedValue: numeric,
  437 |       selectedQuestionId: question.id,
  438 |     };
  439 |     emitter.emit("render");
  440 | 
  441 |     const fadeTimeoutId = setTimeout(() => {
  442 |       removeIntermissionSurveyTimeout(state, fadeTimeoutId);
  443 |       state.inductionArcade.survey = {
  444 |         ...state.inductionArcade.survey,
  445 |         animPhase: "out",
  446 |       };
  447 |       emitter.emit("render");
  448 |     }, TIMING.SURVEY_FADE_MS);
  449 | 
  450 |     trackIntermissionSurveyTimeout(state, fadeTimeoutId);
  451 | 
  452 |     const advanceTimeoutId = setTimeout(() => {
  453 |       removeIntermissionSurveyTimeout(state, advanceTimeoutId);
  454 |       if (isLast) {
  455 |         advanceConditioningLoop(state, emitter, {
  456 |           nextGameId: state.inductionArcade.nextGameId,
  457 |         });
  458 |       } else {
  459 |         state.inductionArcade.survey = {
  460 |           ...state.inductionArcade.survey,
  461 |           currentIndex: nextIndex,
  462 |           animPhase: "idle",
  463 |           lastAffirmation: "",
  464 |           selectedValue: null,
  465 |           selectedQuestionId: null,
  466 |         };
  467 |       }
  468 | 
  469 |       emitter.emit("render");
  470 |     }, TIMING.SURVEY_ADVANCE_MS);
  471 | 
  472 |     trackIntermissionSurveyTimeout(state, advanceTimeoutId);
  473 |   });
  474 | 
  475 |   emitter.on("inductionArcade/advanceInterjection", () => {
  476 |     const interjection = state.inductionArcade.interjection;
  477 |     if (!interjection?.active) return;
  478 | 
  479 |     const nextIndex = interjection.currentIndex + 1;
  480 |     if (nextIndex >= interjection.steps.length) {
  481 |       const nextGameId = state.inductionArcade.nextGameId;
  482 |       const resetState = createInterjectionState();
  483 |       resetState.nextType = interjection.nextType || resetState.nextType;
  484 |       state.inductionArcade.interjection = resetState;
  485 |       advanceConditioningLoop(state, emitter, {
  486 |         nextGameId,
  487 |         allowInterjection: false,
  488 |       });
  489 |     } else {
  490 |       state.inductionArcade.interjection = {
  491 |         ...interjection,
  492 |         currentIndex: nextIndex,
  493 |       };
  494 |       emitter.emit("render");
  495 |     }
  496 |   });
  497 | 
  498 |   // ---- Lifecycle / navigation ----
  499 | 
  500 |   emitter.on("inductionArcade/enter", () => {
  501 |     if (state.inductionArcade.active) return;
  502 | 
  503 |     const startingFromHashNow = parseStartingGameFromHash();
  504 |     state.inductionArcade.active = true;
  505 |     state.inductionArcade.startingGame =
  506 |       startingFromHashNow || DEFAULT_STARTING_GAME;
  507 |     state.inductionArcade.gameOrder = getGameOrder(
  508 |       state.inductionArcade.startingGame
  509 |     );
  510 | 
  511 |     setInductionArcadePhase(state, emitter, PHASES.HEADPHONES, {
  512 |       lastAffirmation: "",
  513 |       currentGameId: null,
  514 |       nextGameId: null,
  515 |     });
  516 | 
  517 |     onArcadeReady((scene) => {
  518 |       scene.setMode("idle");
  519 |     });
  520 |   });
  521 | 
  522 |   emitter.on("inductionArcade/exit", () => {
  523 |     if (!state.inductionArcade.active) return;
  524 | 
  525 |     state.inductionArcade.active = false;
  526 |     setInductionArcadePhase(state, emitter, PHASES.HEADPHONES, {
  527 |       currentGameId: null,
  528 |       nextGameId: null,
  529 |     });
  530 | 
  531 |     onArcadeReady((scene) => {
  532 |       scene.setMode("idle");
  533 |     });
  534 |   });
  535 | 
  536 |   // First: headphones → intro
  537 |   emitter.on("inductionArcade/confirmHeadphones", async () => {
  538 |     setInductionArcadePhase(state, emitter, PHASES.INTRO, {
  539 |       lastAffirmation: "",
  540 |       currentGameId: null,
  541 |       nextGameId: null,
  542 |     });
  543 | 
  544 |     // Prime Tone.js while we still have a user gesture so iOS Safari will
  545 |     // allow audio playback when the game starts.
  546 |     await warmBinauralBeatContext();
  547 | 
  548 |     onArcadeReady((scene) => {
  549 |       scene.setMode("idle");
  550 |     });
  551 |   });
  552 | 
  553 |   // User presses "I am ready to begin" on the *intro* card
  554 |   emitter.on("inductionArcade/startGame", async () => {
  555 |     // If we already have a queued game, treat this as "beginCurrentGame"
  556 |     // so we don't reset spiralIntensity mid-session.
  557 |     if (
  558 |       state.inductionArcade.currentGameId !== null ||
  559 |       state.inductionArcade.nextGameId !== null
  560 |     ) {
  561 |       console.log(
  562 |         "inductionArcade/startGame called mid-session; delegating to beginCurrentGame"
  563 |       );
  564 |       emitter.emit("inductionArcade/beginCurrentGame");
  565 |       return;
  566 |     }
  567 | 
  568 |     const fromUrl = parseStartingGameFromHash();
  569 |     if (fromUrl) {
  570 |       state.inductionArcade.startingGame = fromUrl;
  571 |     }
  572 | 
  573 |     state.inductionArcade.gameOrder = getGameOrder(
  574 |       state.inductionArcade.startingGame
  575 |     );
  576 |     const nextGameId = state.inductionArcade.gameOrder[0];
  577 | 
  578 |     setInductionArcadePhase(state, emitter, PHASES.INSTRUCTIONS, {
  579 |       currentGameId: null,
  580 |       nextGameId,
  581 |       lastAffirmation: "",
  582 |       env: deriveEnvironmentFromDepth(state.conditioning.depth),
  583 |     });
  584 | 
  585 |     const frequencies = calculateBeatFrequencies(
  586 |       state.inductionArcade.env.depthLevel
  587 |     );
  588 |     state.inductionArcade.binauralBeat = {
  589 |       ...state.inductionArcade.binauralBeat,
  590 |       ...frequencies,
  591 |       playing: true,
  592 |     };
  593 |     const started = await startBinauralBeat(frequencies);
  594 |     if (!started) {
  595 |       state.inductionArcade.binauralBeat = {
  596 |         ...state.inductionArcade.binauralBeat,
  597 |         playing: false,
  598 |       };
  599 |     }
  600 | 
  601 |     onArcadeReady((scene) => {
  602 |       scene.setMode("inductionArcade", {
  603 |         spiralOpacity: state.inductionArcade.env.spiralIntensity,
  604 |         spiralFadeIn: false,
  605 |         spiralFadeDuration: 1200,
  606 |         autoStart: false,
  607 |         initialGame: state.inductionArcade.nextGameId,
  608 |         final: state.inductionArcade.gameOrder.length === 1,
  609 |       });
  610 |     });
  611 | 
  612 |     emitter.emit("render");
  613 |   });
  614 | 
  615 |   // User presses "Start round X" for the current game
  616 |   emitter.on("inductionArcade/beginCurrentGame", () => {
  617 |     const { nextGameId, gameOrder } = state.inductionArcade;
  618 |     if (!nextGameId) return;
  619 | 
  620 |     const isFinal = gameOrder[gameOrder.length - 1] === nextGameId;
  621 | 
  622 |     setInductionArcadePhase(state, emitter, PHASES.GAME, {
  623 |       currentGameId: nextGameId,
  624 |       nextGameId,
  625 |       lastAffirmation: "",
  626 |     });
  627 | 
  628 |     onArcadeReady((scene) => {
  629 |       if (scene.mode !== "inductionArcade") {
  630 |         scene.setMode("inductionArcade", {
  631 |           spiralOpacity: state.inductionArcade.env.spiralIntensity,
  632 |           spiralFadeIn: true,
  633 |           spiralFadeDuration: 1200,
  634 |           autoStart: false,
  635 |           initialGame: nextGameId,
  636 |           final: isFinal,
  637 |         });
  638 |       }
  639 |       if (scene.startMinigame) {
  640 |         scene.startMinigame(nextGameId, { final: isFinal });
  641 |       }
  642 |     });
  643 |   });
  644 | }
  645 | 

/* =====================================================================================
   FILE: app/store/pre-test-survey-store.js
   ===================================================================================== */

    1 | /*
    2 | /app/store/pre-test-survey-store.js
    3 | Manages state and side effects for the pre-test survey workflow.
    4 | */
    5 | // store/pre-test-survey-store.js
    6 | 
    7 | import {
    8 |   complianceInstructions,
    9 |   complianceLikertLabels,
   10 |   complianceLikertOptions,
   11 | } from "../data/compliance-questions.js";
   12 | import { ContentDirector } from "../directors/content-director.js";
   13 | 
   14 | export default function preTestSurveyStore(state, emitter) {
   15 |   const applyPatch = state.applyPatch
   16 |     ? (key, patch) => state.applyPatch(key, patch)
   17 |     : (key, patch) => {
   18 |         state[key] = {
   19 |           ...(state[key] || {}),
   20 |           ...patch,
   21 |         };
   22 |         emitter.emit("render");
   23 |       };
   24 | 
   25 |   state.conditioning = state.conditioning || { depth: 0 };
   26 | 
   27 |   state.preTestSurvey = state.preTestSurvey || {};
   28 |   const s = state.preTestSurvey;
   29 |   const normalizedDepth = ContentDirector.normalizeDepth(
   30 |     state.conditioning.depth || 0
   31 |   );
   32 | 
   33 |   s.instructions = s.instructions || complianceInstructions;
   34 |   s.likertOptions = s.likertOptions || complianceLikertOptions;
   35 |   s.likertLabels = s.likertLabels || complianceLikertLabels;
   36 |   s.questions =
   37 |     s.questions ||
   38 |     ContentDirector.getSurvey({ depth: normalizedDepth, count: 5 });
   39 | 
   40 |   s.currentIndex =
   41 |     typeof s.currentIndex === "number" ? s.currentIndex : 0;
   42 |   s.responses = s.responses || {};
   43 |   s.lastAffirmation = s.lastAffirmation || "";
   44 | 
   45 |   // animation state
   46 |   // phases: 'idle' | 'affirm' | 'out'
   47 |   s.animPhase = s.animPhase || "idle";
   48 |   s.selectedValue =
   49 |     typeof s.selectedValue === "number" ? s.selectedValue : null;
   50 |   s.selectedQuestionId = s.selectedQuestionId || null;
   51 | 
   52 |   emitter.on("preTestSurvey/update", (payload) => {
   53 |     applyPatch("preTestSurvey", payload);
   54 |   });
   55 | 
   56 |   emitter.on("preTestSurvey/reset", () => {
   57 |     applyPatch("preTestSurvey", {
   58 |       currentIndex: 0,
   59 |       responses: {},
   60 |       lastAffirmation: "",
   61 |       animPhase: "idle",
   62 |       selectedValue: null,
   63 |       selectedQuestionId: null,
   64 |     });
   65 |   });
   66 | }
   67 | 

/* =====================================================================================
   FILE: app/store/store.js
   ===================================================================================== */

    1 | /*
    2 | /app/store/store.js
    3 | Configures the Choo application store with routes and shared initialization logic.
    4 | */
    5 | // store/store.js
    6 | import layoutsDictionary, { moduleOrder } from "../views/layouts/layouts-dictionary.js";
    7 | import inductionArcadeStore from "./induction-arcade-store.js";
    8 | import preTestSurveyStore from "./pre-test-survey-store.js";
    9 | 
   10 | function applyPatch(state, emitter, key, patch) {
   11 |   state[key] = {
   12 |     ...(state[key] || {}),
   13 |     ...patch,
   14 |   };
   15 |   emitter.emit("render");
   16 | }
   17 | 
   18 | function pushModuleRoute(emitter, moduleName, resolver) {
   19 |   const target = resolver(moduleName);
   20 |   emitter.emit("pushState", `#${target}`);
   21 | }
   22 | 
   23 | export default function store(state, emitter) {
   24 |   state.moduleOrder = moduleOrder;
   25 |   state.startModule = moduleOrder[0] || "consent";
   26 |   state.conditioning = state.conditioning || { depth: 0 };
   27 | 
   28 |   const resolveModuleName = (moduleName) =>
   29 |     layoutsDictionary[moduleName] ? moduleName : state.startModule;
   30 | 
   31 |   state.applyPatch = (key, patch) => applyPatch(state, emitter, key, patch);
   32 |   state.pushModuleRoute = (moduleName) =>
   33 |     pushModuleRoute(emitter, moduleName, resolveModuleName);
   34 | 
   35 |   inductionArcadeStore(state, emitter);
   36 |   preTestSurveyStore(state, emitter);
   37 | 
   38 |   state.personalInfo = {
   39 |     name: "",
   40 |     gender: "",
   41 |     modality: "",
   42 |     age: 18,
   43 |     consentGiven: false,
   44 |   };
   45 | 
   46 |   emitter.on("personalInfo/update", (payload) => {
   47 |     state.applyPatch("personalInfo", payload);
   48 |   });
   49 | 
   50 |   emitter.on("nav/goToModule", (moduleName) => {
   51 |     state.pushModuleRoute(moduleName);
   52 |   });
   53 | 
   54 |   emitter.on("nav/nextModule", () => {
   55 |     const currentParams = state.params || {};
   56 |     const currentName = currentParams.module || state.startModule;
   57 |     const currentIndex = state.moduleOrder.indexOf(currentName);
   58 |     const nextModuleName =
   59 |       currentIndex >= 0 && currentIndex < state.moduleOrder.length - 1
   60 |         ? state.moduleOrder[currentIndex + 1]
   61 |         : currentName || state.startModule;
   62 |     state.pushModuleRoute(resolveModuleName(nextModuleName));
   63 |   });
   64 | }
   65 | 

/* =====================================================================================
   FILE: app/views/layouts/consent-screen.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/layouts/consent-screen.js
    3 | Presents the consent screen content and captures participant acknowledgment.
    4 | */
    5 | export default function ConsentScreen(state, emit) {
    6 |   return html`
    7 |     <div class="screen-shell">
    8 |       <div class="screen-card">
    9 |         <h1 class="screen-title">
   10 |           Cognitive Conditioning Research Study #217
   11 |         </h1>
   12 |         <p class="screen-subtitle">
   13 |           Please read carefully and proceed only if you consent to participate.
   14 |         </p>
   15 | 
   16 |         <p class="body-text">
   17 |           This is an academic study on attention and compliance. You may stop at
   18 |           any time and withdraw your participation without penalty.
   19 |         </p>
   20 | 
   21 |         <p class="body-text">
   22 |           By selecting “I consent”, you indicate that you have read and understood
   23 |           the information above and agree to participate in this study.
   24 |         </p>
   25 | 
   26 |         <button
   27 |           class="primary-button"
   28 |           onclick=${() => emit("nav/goToModule", "pre-test-survey")}
   29 |         >
   30 |           I consent
   31 |         </button>
   32 |       </div>
   33 |     </div>
   34 |   `;
   35 | }
   36 | 

/* =====================================================================================
   FILE: app/views/layouts/induction-arcade.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/layouts/induction-arcade.js
    3 | Defines the layout for the induction arcade game interface and supporting elements.
    4 | */
    5 | // views/induction-arcade.js
    6 | import IntermissionSurvey from "../partials/intermission-survey.js";
    7 | import InterjectionCard from "../partials/interjection-card.js";
    8 | export default function InductionArcadeLayout(state, emit) {
    9 |   const arcade = state.inductionArcade || {};
   10 |   const {
   11 |     phase = "headphones",
   12 |     lastAffirmation = "",
   13 |     nextGameId,
   14 |     gameOrder = [],
   15 |     survey = {},
   16 |     interjection = {},
   17 |   } = arcade;
   18 | 
   19 |   let isTouch = true;
   20 |   if (typeof window !== "undefined") {
   21 |     isTouch =
   22 |       "ontouchstart" in window ||
   23 |       (navigator && navigator.maxTouchPoints > 0);
   24 |   }
   25 |   const actionWord = isTouch ? "tap" : "click";
   26 | 
   27 |   // Phase helpers
   28 |   const isHeadphones = phase === "headphones";
   29 |   const isIntro = phase === "intro";
   30 |   const isInstructions = phase === "instructions";
   31 |   const isGamePhase = phase === "game";
   32 |   const isSurvey = phase === "survey";
   33 |   const isInterjection = phase === "interjection";
   34 |   const isComplete = phase === "complete";
   35 | 
   36 |   // Button handlers
   37 |   function onIntroBegin(e) {
   38 |     e.preventDefault();
   39 |     emit("inductionArcade/startGame");
   40 |   }
   41 | 
   42 |   function onConfirmHeadphones(e) {
   43 |     e.preventDefault();
   44 |     emit("inductionArcade/confirmHeadphones");
   45 |   }
   46 | 
   47 |   function onBeginCurrentGame(e) {
   48 |     e.preventDefault();
   49 |     emit("inductionArcade/beginCurrentGame");
   50 |   }
   51 | 
   52 |   function onNext(e) {
   53 |     e.preventDefault();
   54 |     emit("nav/nextModule");
   55 |   }
   56 | 
   57 |   // Copy
   58 |   const introText =
   59 |     `This task measures focus and attention. ` +
   60 |     `Watch the screen and ${actionWord} when it reaches the target brightness.`;
   61 | 
   62 |   // Instructions for each minigame
   63 |   let instructionsText = "";
   64 |   let roundLabel = "";
   65 | 
   66 |   if (isInstructions && nextGameId) {
   67 |     const roundIndex = gameOrder.indexOf(nextGameId);
   68 |     const roundNumber = roundIndex >= 0 ? roundIndex + 1 : 1;
   69 |     roundLabel = `Start round ${roundNumber}`;
   70 | 
   71 |     if (nextGameId === "tapWhenWhite") {
   72 |       instructionsText =
   73 |         `Watch the screen and ${actionWord} when the whole display ` +
   74 |         `brightens to white. Stay focused on the changing light.`;
   75 |     } else if (nextGameId === "followTheFade") {
   76 |       instructionsText =
   77 |         `Stay with the softly glowing dot. ${actionWord} as it brightens, ` +
   78 |         `even as it drifts around the screen.`;
   79 |     } else {
   80 |       instructionsText =
   81 |         `Follow the on-screen prompts and ${actionWord} when you reach the target.`;
   82 |     }
   83 |   }
   84 | 
   85 |   const cardClasses = [
   86 |     "instruction-card",
   87 |     isIntro || isHeadphones || isInstructions ? "instruction-card--intro" : "",
   88 |     isComplete ? "instruction-card--complete" : "",
   89 |   ]
   90 |     .filter(Boolean)
   91 |     .join(" ");
   92 | 
   93 |   return html`
   94 |     <section class="layout induction-arcade-layout">
   95 |       ${isInterjection
   96 |         ? InterjectionCard({ interjection, emit })
   97 |         : !isGamePhase && !isSurvey
   98 |         ? html`
   99 |             <div class="${cardClasses}">
  100 |               ${isHeadphones
  101 |                 ? html`
  102 |                     <p class="instruction-main">
  103 |                       During the following tasks we will be studying the impact
  104 |                       of binaural beats on your focus and attention. Please use
  105 |                       headphones for this task.
  106 |                     </p>
  107 |                     <button
  108 |                       class="primary-btn"
  109 |                       onclick=${onConfirmHeadphones}
  110 |                     >
  111 |                       OK, I am wearing headphones
  112 |                     </button>
  113 |                   `
  114 |                 : ""}
  115 | 
  116 |               ${isIntro
  117 |                 ? html`
  118 |                     <p class="instruction-main">
  119 |                       ${introText}
  120 |                     </p>
  121 |                     <button class="primary-btn" onclick=${onIntroBegin}>
  122 |                       I am ready to begin
  123 |                     </button>
  124 |                   `
  125 |                 : ""}
  126 | 
  127 |               ${isInstructions && instructionsText
  128 |                 ? html`
  129 |                     <p class="instruction-main">
  130 |                       ${instructionsText}
  131 |                     </p>
  132 |                     <button
  133 |                       class="primary-btn"
  134 |                       onclick=${onBeginCurrentGame}
  135 |                     >
  136 |                       ${roundLabel || "Start"}
  137 |                     </button>
  138 |                   `
  139 |                 : ""}
  140 | 
  141 |               ${isComplete
  142 |                 ? html`
  143 |                     <p class="instruction-main">
  144 |                       Nice work. You have completed this task.
  145 |                     </p>
  146 |                     <button class="primary-btn" onclick=${onNext}>
  147 |                       Continue to next part
  148 |                     </button>
  149 |                   `
  150 |                 : ""}
  151 |             </div>
  152 |           `
  153 |         : ""}
  154 | 
  155 |       ${isSurvey
  156 |         ? IntermissionSurvey({
  157 |             survey,
  158 |             emit,
  159 |           })
  160 |         : ""}
  161 | 
  162 |       ${lastAffirmation && isGamePhase
  163 |         ? html`
  164 |             <div class="induction-arcade-affirmation-floating">
  165 |               <p class="induction-arcade-affirmation">
  166 |                 ${lastAffirmation}
  167 |               </p>
  168 |             </div>
  169 |           `
  170 |         : ""}
  171 |     </section>
  172 |   `;
  173 | }
  174 | 

/* =====================================================================================
   FILE: app/views/layouts/layouts-dictionary.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/layouts/layouts-dictionary.js
    3 | Exports the mapping of layout names to their rendering functions for routing.
    4 | */
    5 | // views/layouts/layouts-dictionary.js
    6 | import ConsentScreen from "./consent-screen.js";
    7 | import PersonalInfoScreen from "./personal-info-screen.js";
    8 | import PreTestSurvey from "./pre-test-survey.js";
    9 | import InductionArcadeLayout from "./induction-arcade.js";
   10 | 
   11 | export const moduleOrder = [
   12 |   "consent",
   13 |   "personal-info",
   14 |   "pre-test-survey",
   15 |   "induction-arcade",
   16 | 
   17 | ];
   18 | 
   19 | export default {
   20 |   consent: ConsentScreen,
   21 |   "personal-info": PersonalInfoScreen,
   22 |   "pre-test-survey": PreTestSurvey,
   23 |   "induction-arcade": InductionArcadeLayout,
   24 | };
   25 | 

/* =====================================================================================
   FILE: app/views/layouts/personal-info-screen.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/layouts/personal-info-screen.js
    3 | Renders the personal information form for collecting participant details.
    4 | */
    5 | const genders = ["male", "female", "non-binary", "agender"];
    6 | const modalities = ["cisgender", "transgender", "other"];
    7 | 
    8 | export default function PersonalInfoScreen(state, emit) {
    9 |   function onsubmit(e) {
   10 |     e.preventDefault();
   11 |     const form = e.currentTarget;
   12 |     emit("personalInfo/update", {
   13 |       name: form.name.value,
   14 |       gender: form.gender.value,
   15 |       modality: form.modality.value,
   16 |       age: Number(form.age.value),
   17 |       consentGiven: form.consent.checked,
   18 |     });
   19 |     emit("nav/goToModule", "pre-test-survey");
   20 |   }
   21 | 
   22 |   return html`
   23 |     <div class="screen-shell">
   24 |       <div class="screen-card">
   25 |         <h1 class="screen-title">Personal Information</h1>
   26 |         <p class="screen-subtitle">
   27 |           Tell us a little about yourself before we begin the session.
   28 |         </p>
   29 | 
   30 |         <form onsubmit=${onsubmit} class="form-stack">
   31 |           <label class="field-label">Name</label>
   32 |           <input
   33 |             type="text"
   34 |             name="name"
   35 |             class="input-control"
   36 |             value="${state.personalInfo.name}"
   37 |             required
   38 |           />
   39 | 
   40 |           <label class="field-label">Gender</label>
   41 |           <select
   42 |             name="gender"
   43 |             class="input-control"
   44 |             value="${state.personalInfo.gender}"
   45 |           >
   46 |             ${genders.map(
   47 |               (gender) => html`<option value="${gender}">${gender}</option>`
   48 |             )}
   49 |           </select>
   50 | 
   51 |           <label class="field-label">Modality</label>
   52 |           <select
   53 |             name="modality"
   54 |             class="input-control"
   55 |             value="${state.personalInfo.modality}"
   56 |           >
   57 |             ${modalities.map(
   58 |               (modality) =>
   59 |                 html`<option value="${modality}">${modality}</option>`
   60 |             )}
   61 |           </select>
   62 | 
   63 |           <label class="field-label">Age</label>
   64 |           <input
   65 |             type="number"
   66 |             name="age"
   67 |             min="18"
   68 |             class="input-control"
   69 |             value="${state.personalInfo.age}"
   70 |             required
   71 |           />
   72 | 
   73 |           <p class="body-text">
   74 |             This research study is an erotic hypnosis experience designed to
   75 |             induce trance and obedience. For more information on the content see
   76 |             <a href="#content-details">here</a>.
   77 |           </p>
   78 | 
   79 |           <label class="checkbox-row">
   80 |             <input
   81 |               class="checkbox-input"
   82 |               type="checkbox"
   83 |               name="consent"
   84 |               required
   85 |               ${state.personalInfo.consentGiven ? "checked" : ""}
   86 |             />
   87 |             <span>I understand the description above and consent to proceed.</span>
   88 |           </label>
   89 | 
   90 |           <button type="submit" class="primary-button">Continue</button>
   91 |         </form>
   92 |       </div>
   93 |     </div>
   94 |   `;
   95 | }
   96 | 

/* =====================================================================================
   FILE: app/views/layouts/pre-test-survey.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/layouts/pre-test-survey.js
    3 | Constructs the layout for the pre-test survey including navigation controls.
    4 | */
    5 | // views/pre-test-survey.js
    6 | import { ContentDirector } from "../../directors/content-director.js";
    7 | 
    8 | export default function PreTestSurvey(state, emit) {
    9 |   const survey = state.preTestSurvey || {};
   10 |   const {
   11 |     instructions = [],
   12 |     likertOptions = [1, 2, 3, 4, 5],
   13 |     likertLabels = {},
   14 |     questions = [],
   15 |     currentIndex = 0,
   16 |     responses = {},
   17 |     lastAffirmation = "",
   18 |     animPhase = "idle",
   19 |     selectedValue = null,
   20 |     selectedQuestionId = null,
   21 |   } = survey;
   22 | 
   23 |   if (!questions.length) {
   24 |     return html`<div class="pa4 sans-serif">Loading survey…</div>`;
   25 |   }
   26 | 
   27 |   const totalQuestions = questions.length;
   28 |   const question = questions[currentIndex];
   29 |   const answeredCount = Object.keys(responses).filter(
   30 |     (id) => responses[id] != null
   31 |   ).length;
   32 |   const completion = Math.round((answeredCount / totalQuestions) * 100);
   33 | 
   34 |   function handleAnswer(value) {
   35 |     if (animPhase !== "idle") return;
   36 | 
   37 |     const numeric = Number(value);
   38 |     const newResponses = {
   39 |       ...responses,
   40 |       [question.id]: numeric,
   41 |     };
   42 | 
   43 |     const isPraise = numeric >= 4;
   44 |     const fullAffirmation = ContentDirector.getAffirmation({
   45 |       depth: state.conditioning?.depth || 0,
   46 |       outcome: isPraise ? "success" : "neutral",
   47 |     });
   48 | 
   49 |     const nextIndex = currentIndex + 1;
   50 |     const isLast = nextIndex >= totalQuestions;
   51 | 
   52 |     // Phase 1: show affirmation, highlight current
   53 |     emit("preTestSurvey/update", {
   54 |       responses: newResponses,
   55 |       lastAffirmation: fullAffirmation,
   56 |       animPhase: "affirm",
   57 |       selectedValue: numeric,
   58 |       selectedQuestionId: question.id,
   59 |     });
   60 | 
   61 |     // Phase 2: fade out question card
   62 |     window.setTimeout(() => {
   63 |       emit("preTestSurvey/update", {
   64 |         animPhase: "out",
   65 |       });
   66 |     }, 500);
   67 | 
   68 |     // Phase 3: move to next question or next module
   69 |     window.setTimeout(() => {
   70 |       if (isLast) {
   71 |         emit("preTestSurvey/update", {
   72 |           animPhase: "idle",
   73 |           lastAffirmation: "",
   74 |           selectedValue: null,
   75 |           selectedQuestionId: null,
   76 |         });
   77 |         emit("nav/goToModule", "induction-arcade");
   78 |       } else {
   79 |         emit("preTestSurvey/update", {
   80 |           currentIndex: nextIndex,
   81 |           animPhase: "idle",
   82 |           lastAffirmation: "",
   83 |           selectedValue: null,
   84 |           selectedQuestionId: null,
   85 |         });
   86 |       }
   87 |     }, 900);
   88 |   }
   89 | 
   90 |   const showScale = animPhase === "idle";
   91 |   const showAffirmation = animPhase === "affirm" || animPhase === "out";
   92 | 
   93 |   const cardClasses = [
   94 |     "question-card",
   95 |     "animated",
   96 |     animPhase === "affirm" ? "phase-affirm" : "",
   97 |     animPhase === "out" ? "phase-out" : "",
   98 |   ]
   99 |     .filter(Boolean)
  100 |     .join(" ");
  101 | 
  102 |   const selectedForThisQuestion =
  103 |     selectedQuestionId === question.id ? selectedValue : null;
  104 | 
  105 |   return html`
  106 |     <div class="screen-shell pretest-container">
  107 |       <div class="screen-card screen-card--tall">
  108 |         <div class="flex items-center justify-between mb3">
  109 |           <div>
  110 |             <h1 class="screen-title mb1">Pre-Test Survey</h1>
  111 |             <p class="f6 gray mt0">
  112 |               Question ${currentIndex + 1} of ${totalQuestions}
  113 |             </p>
  114 |           </div>
  115 |           <div class="tr">
  116 |             <div class="progress-bg">
  117 |               <div
  118 |                 class="progress-bar"
  119 |                 style="width: ${completion}%;"
  120 |               ></div>
  121 |             </div>
  122 |             <span class="f7 gray mt1 db">
  123 |               ${completion}% complete
  124 |             </span>
  125 |           </div>
  126 |         </div>
  127 | 
  128 |         <div class="mb3">
  129 |           ${instructions.map(
  130 |             (line) => html`<p class="lh-copy mv2 f6 gray">${line}</p>`
  131 |           )}
  132 |         </div>
  133 | 
  134 |         <div class="${cardClasses}">
  135 |           <p class="f4 mb3 question-text">
  136 |             ${question.text}
  137 |           </p>
  138 | 
  139 |           ${showScale
  140 |             ? html`
  141 |                 <div class="flex justify-between mb2 scale-labels">
  142 |                   <span class="f6 gray">
  143 |                     ${likertLabels[1] || "1 - Strongly disagree"}
  144 |                   </span>
  145 |                   <span class="f6 gray">
  146 |                     ${likertLabels[5] || "5 - Strongly agree"}
  147 |                   </span>
  148 |                 </div>
  149 | 
  150 |                 <div
  151 |                   class="rating-scale-row ${animPhase !== "idle"
  152 |                     ? "disabled"
  153 |                     : ""}"
  154 |                 >
  155 |                   ${likertOptions.map((option) => {
  156 |                     const isSelected = selectedForThisQuestion === option;
  157 |                     return html`
  158 |                       <button
  159 |                         type="button"
  160 |                         class="rating-pill ${isSelected ? "selected" : ""}"
  161 |                         onclick=${() => handleAnswer(option)}
  162 |                         aria-label="${likertLabels[option] || option}"
  163 |                       >
  164 |                         ${option}
  165 |                       </button>
  166 |                     `;
  167 |                   })}
  168 |                 </div>
  169 |               `
  170 |             : html`
  171 |                 <div class="affirmation-wrapper">
  172 |                   <p class="affirmation-big">
  173 |                     ${lastAffirmation || "Good."}
  174 |                   </p>
  175 |                 </div>
  176 |               `}
  177 |         </div>
  178 |       </div>
  179 |     </div>
  180 |   `;
  181 | }
  182 | 
  183 | 

/* =====================================================================================
   FILE: app/views/main-view.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/main-view.js
    3 | Composes the primary view routing logic that switches between layout components.
    4 | */
    5 | // views/main-view.js 
    6 | import layoutsDictionary from "./layouts/layouts-dictionary.js";
    7 | 
    8 | export default function MainView(state, emit) {
    9 |   console.log("MainView state:", state);
   10 |   const startModule = state.startModule || Object.keys(layoutsDictionary)[0];
   11 |   const requestedModule = state.params && state.params.module;
   12 |   console.log("Requested module:", requestedModule);
   13 |   const moduleName = layoutsDictionary[requestedModule]
   14 |     ? requestedModule
   15 |     : startModule;
   16 | 
   17 |   const CurrentLayout = layoutsDictionary[moduleName];
   18 |   console.log("CurrentLayout:", moduleName, CurrentLayout);
   19 |   // When we SWITCH INTO induction-arcade, tell store to enter.
   20 |   if (moduleName === "induction-arcade" && !state.inductionArcade?.active) {
   21 |     emit("inductionArcade/enter");
   22 |   }
   23 | 
   24 |   // When we SWITCH OUT, tell store to exit.
   25 |   if (moduleName   !== "induction-arcade" && state.inductionArcade?.active) {
   26 |     emit("inductionArcade/exit");
   27 |   }
   28 |   return html`
   29 |     <div id="app">
   30 |       ${CurrentLayout ? CurrentLayout(state, emit) : "Layout not found"}
   31 |     </div>
   32 |   `;
   33 | }
   34 | 

/* =====================================================================================
   FILE: app/views/partials/interjection-card.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/partials/interjection-card.js
    3 | Renders interjection cards that surface feedback or guidance during gameplay.
    4 | */
    5 | export default function InterjectionCard({ interjection = {}, emit }) {
    6 |   const { steps = [], currentIndex = 0, type = "focus" } = interjection;
    7 |   if (!steps.length) return null;
    8 | 
    9 |   const currentStep = steps[currentIndex] || "";
   10 |   const totalSteps = steps.length;
   11 |   const headline = type === "relaxation" ? "Sink deeper" : "Sharpen focus";
   12 |   const actionLabel = currentIndex + 1 >= totalSteps ? "Continue" : "Next";
   13 | 
   14 |   function advance() {
   15 |     emit("inductionArcade/advanceInterjection");
   16 |   }
   17 | 
   18 |   return html`
   19 |     <div class="screen-shell intermission-survey-shell">
   20 |       <div class="screen-card screen-card--tall">
   21 |         <div class="flex items-center justify-between mb3">
   22 |           <div>
   23 |             <h1 class="screen-title mb1">${headline}</h1>
   24 |             <p class="f6 gray mt0">
   25 |               Step ${currentIndex + 1} of ${totalSteps}
   26 |             </p>
   27 |           </div>
   28 |         </div>
   29 | 
   30 |         <div class="affirmation-wrapper mb3">
   31 |           <p class="affirmation-big">${currentStep}</p>
   32 |         </div>
   33 | 
   34 |         <button class="primary-btn" onclick=${advance}>${actionLabel}</button>
   35 |       </div>
   36 |     </div>
   37 |   `;
   38 | }
   39 | 

/* =====================================================================================
   FILE: app/views/partials/intermission-survey.js
   ===================================================================================== */

    1 | /*
    2 | /app/views/partials/intermission-survey.js
    3 | Displays the intermission survey interface between induction arcade sessions.
    4 | */
    5 | // views/partials/intermission-survey.js
    6 | export default function IntermissionSurvey({ survey = {}, emit }) {
    7 |   const {
    8 |     instructions = [],
    9 |     likertOptions = [],
   10 |     likertLabels = {},
   11 |     questions = [],
   12 |     currentIndex = 0,
   13 |     responses = {},
   14 |     lastAffirmation = "",
   15 |     animPhase = "idle",
   16 |     selectedValue = null,
   17 |     selectedQuestionId = null,
   18 |   } = survey;
   19 | 
   20 |   if (!questions.length) return null;
   21 | 
   22 |   const totalQuestions = questions.length;
   23 |   const question = questions[currentIndex];
   24 |   if (!question) return null;
   25 |   const answeredCount = Object.keys(responses).filter(
   26 |     (id) => responses[id] != null
   27 |   ).length;
   28 |   const completion = Math.round((answeredCount / totalQuestions) * 100);
   29 | 
   30 |   function handleAnswer(value) {
   31 |     emit("inductionArcade/answerSurveyQuestion", value);
   32 |   }
   33 | 
   34 |   const showScale = animPhase === "idle";
   35 |   const selectedForThisQuestion =
   36 |     selectedQuestionId === question.id ? selectedValue : null;
   37 | 
   38 |   return html`
   39 |     <div class="screen-shell intermission-survey-shell">
   40 |       <div class="screen-card screen-card--tall">
   41 |         <div class="flex items-center justify-between mb3">
   42 |           <div>
   43 |             <h1 class="screen-title mb1">Quick check-in</h1>
   44 |             <p class="f6 gray mt0">
   45 |               ${completion}% complete · Question ${currentIndex + 1} of
   46 |               ${totalQuestions}
   47 |             </p>
   48 |           </div>
   49 |         </div>
   50 | 
   51 |         <div class="mb3">
   52 |           ${instructions.map(
   53 |             (line) => html`<p class="lh-copy mv2 f6 instruction-line">${line}</p>`
   54 |           )}
   55 |         </div>
   56 | 
   57 |         <div class="question-card animated">
   58 |           <p class="f4 mb3 question-text">${question.text}</p>
   59 | 
   60 |           ${showScale
   61 |             ? html`
   62 |                 <div class="flex justify-between mb2 scale-labels">
   63 |                   <span class="f6 gray">
   64 |                     ${likertLabels[1] || "1 - Strongly disagree"}
   65 |                   </span>
   66 |                   <span class="f6 gray">
   67 |                     ${likertLabels[5] || "5 - Strongly agree"}
   68 |                   </span>
   69 |                 </div>
   70 | 
   71 |                 <div
   72 |                   class="rating-scale-row ${animPhase !== "idle"
   73 |                     ? "disabled"
   74 |                     : ""}"
   75 |                 >
   76 |                   ${likertOptions.map((option) => {
   77 |                     const isSelected = selectedForThisQuestion === option;
   78 |                     return html`
   79 |                       <button
   80 |                         type="button"
   81 |                         class="rating-pill ${isSelected ? "selected" : ""}"
   82 |                         onclick=${() => handleAnswer(option)}
   83 |                         aria-label="${likertLabels[option] || option}"
   84 |                       >
   85 |                         ${option}
   86 |                       </button>
   87 |                     `;
   88 |                   })}
   89 |                 </div>
   90 |               `
   91 |             : html`
   92 |                 <div class="affirmation-wrapper">
   93 |                   <p class="affirmation-big">${lastAffirmation || "Good."}</p>
   94 |                 </div>
   95 |               `}
   96 |         </div>
   97 |       </div>
   98 |     </div>
   99 |   `;
  100 | }
  101 | 

/* =====================================================================================
   FILE: app/views/styles/induction-arcade-styles.css
   ===================================================================================== */

    1 | /*
    2 | /app/views/styles/induction-arcade-styles.css
    3 | Styles specific to the induction arcade game screens and interactive elements.
    4 | */
    5 | /* Induction Arcade layout shell */
    6 | .induction-arcade-layout {
    7 |   position: absolute;      /* sit over the Phaser canvas */
    8 |   inset: 0;
    9 |   pointer-events: none;    /* taps go to the game by default */
   10 | }
   11 | 
   12 | /* Instruction card – same vibe as question-card, darker */
   13 | .instruction-card {
   14 |   position: absolute;
   15 |   left: 50%;
   16 |   top: 50%;
   17 |   transform: translate(-50%, -50%);
   18 |   max-width: 480px;
   19 |   width: calc(100% - 2.5rem);
   20 |   border-radius: 1rem;
   21 |   padding: 1.75rem 1.5rem;
   22 |   box-shadow: 0 16px 40px rgba(15, 23, 42, 0.35);
   23 |   background: rgba(15, 23, 42, 0.55);
   24 |   border: 1px solid rgba(148, 163, 184, 0.3);
   25 |   color: #f9fafb;
   26 |   text-align: left;
   27 |   backdrop-filter: blur(14px);
   28 |   pointer-events: auto; /* intro/complete are clickable */
   29 |   animation: fadeInUp 0.25s ease-out;
   30 | }
   31 | 
   32 | /* Intro vs complete (both centered) */
   33 | .instruction-card--intro {
   34 |   /* default centered settings already applied */
   35 | }
   36 | 
   37 | .instruction-card--complete {
   38 |   /* same as intro; separate class in case you want different styling later */
   39 | }
   40 | 
   41 | /* Instruction text */
   42 | .instruction-main {
   43 |   margin: 0 0 0.9rem;
   44 |   font-size: 1.25rem;
   45 |   line-height: 1.5;
   46 | }
   47 | 
   48 | /* Primary button */
   49 | .induction-arcade-layout .primary-btn {
   50 |   display: block;
   51 |   margin: 0.6rem auto 0;
   52 |   padding: 0.55rem 1.6rem;
   53 |   border-radius: 9999px;
   54 |   border: none;
   55 |   background: linear-gradient(90deg, #4f46e5, #ec4899);
   56 |   color: white;
   57 |   font-size: 1rem;
   58 |   font-weight: 600;
   59 |   cursor: pointer;
   60 |   box-shadow: 0 6px 16px rgba(79, 70, 229, 0.45);
   61 |   transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
   62 |     filter 0.12s ease-out;
   63 |   pointer-events: auto;
   64 | }
   65 | 
   66 | .induction-arcade-layout .primary-btn:hover {
   67 |   transform: translateY(-1px);
   68 |   box-shadow: 0 10px 24px rgba(79, 70, 229, 0.6);
   69 |   filter: brightness(1.03);
   70 | }
   71 | 
   72 | .induction-arcade-layout .primary-btn:active {
   73 |   transform: translateY(0);
   74 |   box-shadow: 0 4px 12px rgba(79, 70, 229, 0.45);
   75 | }
   76 | .induction-arcade-affirmation-floating {
   77 |   position: absolute;
   78 |   left: 50%;
   79 |   top: 50%;
   80 |   transform: translate(-50%, -50%);
   81 |   pointer-events: none;
   82 | }
   83 | 
   84 | .induction-arcade-affirmation {
   85 |   margin: 0;
   86 |   font-size: 2rem;
   87 |   font-weight: 700;
   88 |   color: #f9fafb;
   89 |   text-shadow: 0 0 12px rgba(0, 0, 0, 0.6);
   90 |   animation: arcadeAffirmInOut 0.9s ease-out;
   91 | }
   92 | 
   93 | @keyframes arcadeAffirmInOut {
   94 |   0% {
   95 |     opacity: 0;
   96 |     transform: translateY(8px);
   97 |   }
   98 |   20% {
   99 |     opacity: 1;
  100 |     transform: translateY(0);
  101 |   }
  102 |   70% {
  103 |     opacity: 1;
  104 |     transform: translateY(0);
  105 |   }
  106 |   100% {
  107 |     opacity: 0;
  108 |     transform: translateY(-8px);
  109 |   }
  110 | }
  111 | 
  112 | 
  113 | /* replace fadeInUp with this on the card */
  114 | .instruction-card {
  115 |   position: absolute;
  116 |   left: 50%;
  117 |   top: 50%;
  118 |   transform: translate(-50%, -50%);
  119 |   /* ... other styles ... */
  120 |   animation: arcadeCardFadeIn 0.25s ease-out;
  121 | }
  122 | 
  123 | /* new keyframes */
  124 | @keyframes arcadeCardFadeIn {
  125 |   from {
  126 |     opacity: 0;
  127 |     transform: translate(-50%, -60%); /* slightly higher */
  128 |   }
  129 |   to {
  130 |     opacity: 1;
  131 |     transform: translate(-50%, -50%);
  132 |   }
  133 | }
  134 | 

/* =====================================================================================
   FILE: app/views/styles/survey-styles.css
   ===================================================================================== */

    1 | /*
    2 | /app/views/styles/survey-styles.css
    3 | Stylesheet defining layout and typography for survey and questionnaire screens.
    4 | */
    5 | .pretest-container {
    6 |   margin: 0 auto;
    7 | }
    8 | 
    9 | /* Progress bar */
   10 | .progress-bg {
   11 |   background: rgba(148, 163, 184, 0.35);
   12 |   border-radius: 9999px;
   13 |   overflow: hidden;
   14 |   height: 0.5rem;
   15 | }
   16 | 
   17 | .progress-bar {
   18 |   height: 100%;
   19 |   background: linear-gradient(90deg, #6366f1, #f472b6);
   20 |   transition: width 0.3s ease-out;
   21 | }
   22 | 
   23 | .intermission-survey-shell .screen-card {
   24 |   background: radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.12), transparent 30%),
   25 |     radial-gradient(circle at 80% 0%, rgba(236, 72, 153, 0.16), transparent 28%),
   26 |     #0b1220;
   27 |   border: 1px solid rgba(148, 163, 184, 0.3);
   28 |   box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
   29 |   color: #e2e8f0;
   30 | }
   31 | 
   32 | .intermission-survey-shell .screen-title,
   33 | .intermission-survey-shell .screen-subtitle,
   34 | .intermission-survey-shell .pretest-page-indicator {
   35 |   color: #e2e8f0;
   36 | }
   37 | 
   38 | .intermission-survey-shell .gray {
   39 |   color: #cbd5e1;
   40 | }
   41 | 
   42 | .intermission-survey-shell .instruction-line {
   43 |   color: #cbd5e1;
   44 |   letter-spacing: 0.01em;
   45 | }
   46 | 
   47 | /* Question card base */
   48 | .question-card {
   49 |   background: rgba(15, 23, 42, 0.85);
   50 |   border-radius: 1rem;
   51 |   padding: 1.75rem 1.5rem;
   52 |   box-shadow: 0 16px 38px rgba(0, 0, 0, 0.45);
   53 |   border: 1px solid rgba(148, 163, 184, 0.35);
   54 |   transition: opacity 0.3s ease-out, transform 0.3s ease-out;
   55 |   backdrop-filter: blur(10px);
   56 |   color: #e2e8f0;
   57 | }
   58 | 
   59 | /* fade in for new questions */
   60 | .question-card.animated {
   61 |   animation: fadeInUp 0.25s ease-out;
   62 | }
   63 | 
   64 | .question-card .question-text {
   65 |   color: #f8fafc;
   66 | }
   67 | 
   68 | @keyframes fadeInUp {
   69 |   from {
   70 |     opacity: 0;
   71 |     transform: translateY(8px);
   72 |   }
   73 |   to {
   74 |     opacity: 1;
   75 |     transform: translateY(0);
   76 |   }
   77 | }
   78 | 
   79 | /* phase: affirm – pop the question a little */
   80 | .question-card.phase-affirm .question-text {
   81 |   animation: question-pop 0.25s ease-out;
   82 | }
   83 | 
   84 | @keyframes question-pop {
   85 |   from {
   86 |     transform: scale(1);
   87 |   }
   88 |   60% {
   89 |     transform: scale(1.02);
   90 |   }
   91 |   to {
   92 |     transform: scale(1);
   93 |   }
   94 | }
   95 | 
   96 | /* phase: out – fade the whole card away */
   97 | .question-card.phase-out {
   98 |   opacity: 0;
   99 |   transform: translateY(-6px);
  100 | }
  101 | 
  102 | /* Scale labels */
  103 | .scale-labels {
  104 |   opacity: 1;
  105 |   transition: opacity 0.2s ease-out;
  106 | }
  107 | 
  108 | .question-card.phase-affirm .scale-labels,
  109 | .question-card.phase-out .scale-labels {
  110 |   opacity: 0;
  111 | }
  112 | 
  113 | .scale-labels span,
  114 | .scale-labels {
  115 |   color: #cbd5e1;
  116 | }
  117 | 
  118 | /* Rating row and pills */
  119 | .rating-scale-row {
  120 |   display: flex;
  121 |   justify-content: space-between;
  122 |   margin-top: 1.5rem;
  123 |   gap: 0.5rem;
  124 | }
  125 | 
  126 | .rating-scale-row.disabled {
  127 |   pointer-events: none;
  128 | }
  129 | 
  130 | /* Base pill */
  131 | .rating-pill {
  132 |   flex: 1;
  133 |   border-radius: 9999px;
  134 |   border: 1px solid rgba(148, 163, 184, 0.35);
  135 |   background: rgba(255, 255, 255, 0.04);
  136 |   font-size: 0.9rem;
  137 |   font-weight: 600;
  138 |   cursor: pointer;
  139 |   padding: 0.5rem 0;
  140 |   transition: all 0.15s ease-out;
  141 |   color: #e2e8f0;
  142 | }
  143 | 
  144 | .rating-pill:hover {
  145 |   transform: translateY(-1px);
  146 |   box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
  147 |   border-color: rgba(236, 72, 153, 0.6);
  148 | }
  149 | 
  150 | /* Selected pill stays strong */
  151 | .rating-pill.selected {
  152 |   border-color: transparent;
  153 |   background: linear-gradient(90deg, rgba(99, 102, 241, 0.85), rgba(236, 72, 153, 0.85));
  154 |   color: #f8fafc;
  155 |   box-shadow: 0 10px 26px rgba(79, 70, 229, 0.45);
  156 | }
  157 | 
  158 | /* When in affirm/out phase, fade out the non-selected pills */
  159 | .question-card.phase-affirm .rating-pill:not(.selected),
  160 | .question-card.phase-out .rating-pill:not(.selected) {
  161 |   opacity: 0;
  162 | }
  163 | 
  164 | /* Affirmation big text */
  165 | .affirmation-wrapper {
  166 |   margin-top: 1.5rem;
  167 |   text-align: center;
  168 | }
  169 | 
  170 | .affirmation-big {
  171 |   font-size: 1.6rem;
  172 |   font-weight: 700;
  173 |   color: #f8fafc;
  174 |   text-shadow: 0 0 18px rgba(0, 0, 0, 0.55);
  175 |   animation: arcadeAffirmInOut 0.9s ease-out;
  176 | }
  177 | 
  178 | @keyframes affirmation-fade {
  179 |   from {
  180 |     opacity: 0;
  181 |     transform: translateY(6px);
  182 |   }
  183 |   to {
  184 |     opacity: 1;
  185 |     transform: translateY(0);
  186 |   }
  187 | }
  188 | 
  189 | /* Container for survey content */
  190 | 
  191 | 
  192 | /* Question text */
  193 | .pretest-question-text {
  194 |   font-size: 1.1rem;
  195 |   font-weight: 600;
  196 |   margin-bottom: 1.25rem;
  197 |   color: #f8fafc;
  198 | }
  199 | 
  200 | /* Put Likert row in a clean column */
  201 | .pretest-likert-row {
  202 |   display: flex;
  203 |   flex-direction: column;
  204 |   gap: 0.75rem;
  205 | }
  206 | 
  207 | /* Individual option row (radio + label) – mobile-friendly */
  208 | .pretest-likert-option {
  209 |   display: flex;
  210 |   align-items: center;
  211 |   gap: 0.5rem;
  212 | }
  213 | 
  214 | /* Radio input sizing */
  215 | .pretest-likert-option input[type="radio"] {
  216 |   width: 1.1rem;
  217 |   height: 1.1rem;
  218 | }
  219 | 
  220 | /* Labels */
  221 | .pretest-likert-label {
  222 |   font-size: 0.95rem;
  223 | }
  224 | 
  225 | /* Page indicator / subtle header */
  226 | .pretest-header {
  227 |   display: flex;
  228 |   justify-content: space-between;
  229 |   align-items: baseline;
  230 |   margin-bottom: 1rem;
  231 | }
  232 | 
  233 | .pretest-page-indicator {
  234 |   font-size: 0.8rem;
  235 |   color: #6b7280;
  236 | }
  237 | 
  238 | 

/* =====================================================================================
   FILE: index.html
   ===================================================================================== */

    1 | /*
    2 | /index.html
    3 | Entry point HTML document configuring the induction arcade application shell and resource links.
    4 | */
    5 | <!DOCTYPE html>
    6 | <html lang="en">
    7 |   <head>
    8 |     <meta charset="UTF-8" />
    9 |     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   10 |     <meta http-equiv="X-UA-Compatible" content="ie=edge" />
   11 |     <title>Research Study #217</title>
   12 |     <script src="./app/lib/choo.js" type="text/javascript"></script>
   13 |     <script src="./app/lib/nanohtml.js" type="text/javascript"></script>
   14 |     <script src="./app/lib/tone.js" type="text/javascript"></script>
   15 |     <script src="./app/lib/phaser.js" type="text/javascript"></script>
   16 |     <link rel="stylesheet" href="./app/lib/tachyons.min.css" />
   17 |     <link rel="stylesheet" type="text/css" href="styles.css" />
   18 |     <script src="./app/index.js" type="module"></script>
   19 |     <link rel="preconnect" href="https://fonts.googleapis.com" />
   20 |     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
   21 |     <link
   22 |       href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap"
   23 |       rel="stylesheet"
   24 |     />
   25 |     <link rel="preconnect" href="https://fonts.googleapis.com" />
   26 |     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
   27 |     <link
   28 |       href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
   29 |       rel="stylesheet"
   30 |     />
   31 |   </head>
   32 | 
   33 | <body>
   34 |   <!-- Phaser layer -->
   35 |   <div id="game"></div>
   36 | 
   37 |   <!-- Choo layer -->
   38 |   <div id="app-wrapper">
   39 |     <div id="app"></div>
   40 |   </div>
   41 | </body>
   42 | 
   43 | </html>
   44 | 

/* =====================================================================================
   FILE: readme.md
   ===================================================================================== */

    1 | /*
    2 | /readme.md
    3 | Overview and usage guidance for the compliance research induction arcade project.
    4 | */
    5 | # 🌀 Cognitive Conditioning Research Study 🌀
    6 | 
    7 | _A hypnotic web experience_
    8 | 
    9 | ## Project Overview
   10 | 
   11 | This is an experimental hypnotic web application designed around the trope of:  
   12 | _“You visit a research study website… and it slowly trains and conditions you.”_
   13 | 
   14 | The project focuses on:
   15 | 
   16 | - ✅ **Gradual induction** (relaxation, breathing)
   17 | - ✅ **Interactive hypnotic loops** (clicker mechanics, simple tasks, juicy feedback)
   18 | - ✅ **Progressive onboarding** (consent → personalization → induction → compliance tasks)
   19 | - ✅ **Mobile-friendly** — designed to feel immersive on both desktop & phone
   20 | - ✅ **Modular & extensible** — supports future skins/tropes (e.g. “nefarious relaxation app”)
   21 | 
   22 | ## Current Features (MVP)
   23 | 
   24 | - Consent screen
   25 | - Personalization screen (name, pronouns)
   26 | - Phase 1: Relaxation + breath pacing loop
   27 | - App state driven by Choo store + event system
   28 | - Mobile-first layout
   29 | 
   30 | ## Tech Stack
   31 | 
   32 | | Layer            | Tool                                                                  |
   33 | | ---------------- | --------------------------------------------------------------------- |
   34 | | App Framework    | [Choo.js](https://github.com/choojs/choo) (imported global)           |
   35 | | UI Components    | nanohtml (global)                                                     |
   36 | | Styling          | Tachyons CSS                                                          |
   37 | | Audio            | Tone.js (global) — for pulse, background layers                       |
   38 | | Optional visuals | p5.js (planned for future phases)                                     |
   39 | | Structure        | Layouts system → `layouts-dictionary.js` → MainView dispatches layout |
   40 | | State            | Choo store — modular per phase                                        |
   41 | | Components       | Modular UI components                                                 |
   42 | 
   43 | ## Architectural Notes
   44 | 
   45 | - **Phase system:** Each phase has its own store module (clean separation of state and event logic)
   46 | - **Layouts:** Layout = full-screen "screen". MainView swaps layouts based on `state.currentLayout`
   47 | - **Components:** Reusable UI elements
   48 | - **State flow:** Choo event-driven (`emit` → update state → render)
   49 | - **Mobile first:** All screens are designed to work smoothly on phone (touch events supported)
   50 | 
   51 | ## Project Goals
   52 | 
   53 | - Build a **modular hypnotic game engine** extensible to multiple MC/fantasy tropes
   54 | - Explore pacing, language, and interaction patterns for **effective interactive hypnosis** experiences
   55 | 

/* =====================================================================================
   FILE: styles.css
   ===================================================================================== */

    1 | /*
    2 | /styles.css
    3 | Global stylesheet controlling layout and typography for the landing page.
    4 | */
    5 | @import './app/views/styles/survey-styles.css';
    6 | @import './app/views/styles/induction-arcade-styles.css';
    7 | /* Make body fill viewport and use a calm, light background */
    8 | html,
    9 | body {
   10 |   margin: 0;
   11 |   padding: 0;
   12 |   height: 100%;
   13 | }
   14 | 
   15 | body {
   16 |   font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
   17 |   background: #3d3d3d;
   18 |   color: #111827;
   19 | }
   20 | 
   21 | /* Phaser canvas layer */
   22 | #game {
   23 |   position: fixed;
   24 |   inset: 0;
   25 |   z-index: 0;
   26 |   display: flex;
   27 |   align-items: center;
   28 |   justify-content: center;
   29 |   width: 100%;
   30 |   height: 100%;
   31 | }
   32 | 
   33 | #game canvas {
   34 |   width: 100vw;
   35 |   height: 100vh;
   36 |   max-width: none;
   37 |   max-height: none;
   38 | }
   39 | 
   40 | /* Choo app layer, centered, over the game */
   41 | #app-wrapper {
   42 |   position: relative;
   43 |   z-index: 1;
   44 |   min-height: 100vh;
   45 |   display: flex;
   46 |   justify-content: center;
   47 |   align-items: center;
   48 |   padding: 2rem 1rem; /* mobile-first padding */
   49 |   pointer-events: none;
   50 |   height: 100vh;
   51 |   width: 100%;
   52 | 
   53 | }
   54 | #app-wrapper > #app {
   55 |     max-width: 100vh;
   56 |     width: 100%;
   57 | }
   58 | 
   59 | /* Outer screen shell: keeps everything centered & constrained */
   60 | .screen-shell {
   61 |   width: 100%;
   62 |   height: 100vh;
   63 |   display: flex;
   64 |   align-items: center;
   65 |   justify-content: center;
   66 | 
   67 |   box-sizing: border-box;
   68 | }
   69 | 
   70 | /* The main card that holds content */
   71 | .screen-card {
   72 |   background: #ffffff;
   73 |   border-radius: 16px;
   74 |   padding: 1.75rem 1.5rem;
   75 |   box-shadow: 0 8px 22px rgba(15, 23, 42, 0.06);
   76 |   width: min(94vw, 740px);
   77 |   max-width: min(740px, 90vh);
   78 |   min-height: 60vh;
   79 |   max-height: 90vh;
   80 |   display: flex;
   81 |   flex-direction: column;
   82 |   gap: 1rem;
   83 |   overflow: auto;
   84 |   box-sizing: border-box;
   85 |   pointer-events: auto;
   86 | }
   87 | 
   88 | @media (orientation: landscape) {
   89 |   .screen-card {
   90 |     width: min(70vw, 740px, 90vh);
   91 |   }
   92 | }
   93 | 
   94 | /* For slightly larger surveying content */
   95 | .screen-card--tall {
   96 |   padding-top: 2rem;
   97 |   padding-bottom: 2rem;
   98 | }
   99 | 
  100 | /* Typography */
  101 | .screen-title {
  102 |   font-size: 1.35rem;
  103 |   font-weight: 600;
  104 |   margin: 0 0 0.25rem 0;
  105 |   color: #111827;
  106 | }
  107 | 
  108 | .screen-subtitle {
  109 |   font-size: 0.95rem;
  110 |   color: #6b7280;
  111 |   margin: 0 0 1rem 0;
  112 | }
  113 | 
  114 | .body-text {
  115 |   font-size: 0.95rem;
  116 |   line-height: 1.6;
  117 |   color: #374151;
  118 |   margin: 0;
  119 | }
  120 | 
  121 | /* Forms */
  122 | .form-stack {
  123 |   display: flex;
  124 |   flex-direction: column;
  125 |   gap: 1rem;
  126 | }
  127 | 
  128 | .field-label {
  129 |   font-size: 0.9rem;
  130 |   font-weight: 600;
  131 |   color: #111827;
  132 | }
  133 | 
  134 | .input-control {
  135 |   width: 100%;
  136 |   padding: 0.65rem 0.75rem;
  137 |   border: 1px solid #d1d5db;
  138 |   border-radius: 10px;
  139 |   background: #ffffff;
  140 |   font-size: 0.95rem;
  141 |   box-sizing: border-box;
  142 | }
  143 | 
  144 | .input-control:focus {
  145 |   outline: 2px solid #1d4ed8;
  146 |   border-color: #1d4ed8;
  147 | }
  148 | 
  149 | .checkbox-row {
  150 |   display: flex;
  151 |   gap: 0.5rem;
  152 |   align-items: flex-start;
  153 |   font-size: 0.9rem;
  154 |   color: #111827;
  155 |   line-height: 1.4;
  156 | }
  157 | 
  158 | .checkbox-input {
  159 |   margin-top: 0.15rem;
  160 |   width: 1.1rem;
  161 |   height: 1.1rem;
  162 |   border: 1px solid #d1d5db;
  163 |   border-radius: 0.25rem;
  164 | }
  165 | 
  166 | /* Buttons */
  167 | .primary-button {
  168 |   display: inline-flex;
  169 |   align-items: center;
  170 |   justify-content: center;
  171 |   padding: 0.75rem 1.5rem;
  172 |   min-width: 8rem;
  173 |   border-radius: 9999px;
  174 |   border: none;
  175 |   font-size: 0.95rem;
  176 |   font-weight: 600;
  177 |   cursor: pointer;
  178 |   background: #1e3a8a;
  179 |   color: #ffffff;
  180 |   transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
  181 |     background 0.12s ease-out;
  182 |   align-self: flex-start;
  183 | }
  184 | 
  185 | .primary-button:hover,
  186 | .primary-button:focus-visible {
  187 |   outline: none;
  188 |   background: #1d4ed8;
  189 |   box-shadow: 0 6px 15px rgba(37, 99, 235, 0.35);
  190 |   transform: translateY(-1px);
  191 | }
  192 | 
  193 | /* induction arcade */
  194 | .induction-arcade-layout {
  195 |   position: relative;
  196 |   width: 100%;
  197 |   height: 100vh;
  198 |   padding: 2rem;
  199 |   box-sizing: border-box;
  200 |   color: #f8f8ff;
  201 |   pointer-events: none; /* important: underlying Phaser still clickable */
  202 | }
  203 | 
  204 | .induction-arcade-layout .module-header,
  205 | .induction-arcade-layout .induction-arcade-body,
  206 | .induction-arcade-layout button {
  207 |   pointer-events: auto; /* re-enable for actual controls */
  208 | }
  209 | 
  210 | .module-header h1 {
  211 |   margin: 0 0 0.25rem;
  212 |   font-size: 1.8rem;
  213 | }
  214 | 
  215 | .module-subtitle {
  216 |   margin: 0;
  217 |   font-size: 0.9rem;
  218 |   opacity: 0.7;
  219 | }
  220 | 
